// web/prisma/schema.prisma
// Prisma —Å—Ö–µ–º–∞ –¥–ª—è Direct Manager —Ä–æ–∑–¥—ñ–ª—É

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // –î–ª—è Prisma Postgres –≤ Vercel –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è PRISMA_DATABASE_URL
  // –Ø–∫—â–æ PRISMA_DATABASE_URL –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ DATABASE_URL
  url      = env("PRISMA_DATABASE_URL")
}

// –°—Ç–∞—Ç—É—Å–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤ (–ù–æ–≤–∏–π, –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è, –ó–∞–ø–∏—Å–∞–≤—Å—è, —Ç–æ—â–æ)
model DirectStatus {
  id        String   @id // UUID –∞–±–æ string ID (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ —è–∫ —î –∑ KV)
  name      String   // –ù–∞–∑–≤–∞ —Å—Ç–∞—Ç—É—Å—É (–Ω–∞–ø—Ä. "–ù–æ–≤–∏–π", "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è", "–ó–∞–ø–∏—Å–∞–≤—Å—è")
  color     String   @default("#6b7280") // –ö–æ–ª—ñ—Ä –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è (hex)
  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  isDefault Boolean  @default(false) // –ß–∏ —Ü–µ —Å—Ç–∞—Ç—É—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –¥–ª—è –Ω–æ–≤–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // –ó–≤'—è–∑–æ–∫ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
  clients DirectClient[]

  @@index([order])
  @@index([isDefault])
  @@map("direct_statuses")
}

// –ö–ª—ñ—î–Ω—Ç–∏ Direct Manager
model DirectClient {
  id                    String    @id // UUID –∞–±–æ timestamp-based ID (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ —è–∫ —î –∑ KV)
  instagramUsername      String    // –ù—ñ–∫–Ω–µ–π–º –≤ Instagram (—É–Ω—ñ–∫–∞–ª—å–Ω–∏–π)
  firstName              String?   // –Ü–º'—è
  lastName               String?   // –ü—Ä—ñ–∑–≤–∏—â–µ
  phone                  String?   // –¢–µ–ª–µ—Ñ–æ–Ω –∑ Altegio (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ —è–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑ API)
  spent                  Int?      // –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∫–ª—ñ—î–Ω—Ç–∞ (–∑ Altegio API)
  visits                 Int?      // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–∑–∏—Ç—ñ–≤ –∫–ª—ñ—î–Ω—Ç–∞ (–∑ Altegio API)
  lastVisitAt            DateTime? // –î–∞—Ç–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—ñ–∑–∏—Ç—É (–∑ Altegio last_visit_date)
  lastActivityAt         DateTime? // –ö–æ–ª–∏ –±—É–ª–∞ –æ—Å—Ç–∞–Ω–Ω—è ‚Äú—Ä–µ–∞–ª—å–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å‚Äù (—â–æ –ø—ñ–¥–Ω—è–ª–∞ –∫–ª—ñ—î–Ω—Ç–∞ –≤–≥–æ—Ä—É)
  lastActivityKeys       Json?     // –Ø–∫—ñ –ø–æ–ª—è/—Ç—Ä–∏–≥–µ—Ä–∏ –∑–º—ñ–Ω–∏–ª–∏—Å—å –≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
  source                 String    @default("instagram") // –î–∂–µ—Ä–µ–ª–æ: 'instagram' | 'tiktok' | 'other'
  state                  String?   // –°–∏—Å—Ç–µ–º–Ω–∏–π —Å—Ç–∞–Ω: 'lead' | 'client' | 'consultation'
  firstContactDate       DateTime  // –î–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
  statusId               String    // ID —Å—Ç–∞—Ç—É—Å—É (foreign key)
  masterId               String?   // ID –º–∞–π—Å—Ç—Ä–∞ (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π)
  masterManuallySet      Boolean   @default(false) // –ß–∏ –±—É–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –≤–∏–±—Ä–∞–Ω–∏–π –≤—Ä—É—á–Ω—É
  consultationDate       DateTime? // –î–∞—Ç–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó
  visitedSalon           Boolean   @default(false) // –ß–∏ –ø—Ä–∏–π—à–æ–≤ –∫–ª—ñ—î–Ω—Ç –≤ —Å–∞–ª–æ–Ω –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é
  visitDate              DateTime? // –î–∞—Ç–∞ –≤—ñ–∑–∏—Ç—É –≤ —Å–∞–ª–æ–Ω
  signedUpForPaidService Boolean   @default(false) // –ß–∏ –∑–∞–ø–∏—Å–∞–≤—Å—è –Ω–∞ –ø–ª–∞—Ç–Ω—É –ø–æ—Å–ª—É–≥—É
  paidServiceDate        DateTime? // –î–∞—Ç–∞ –∑–∞–ø–∏—Å—É –Ω–∞ –ø–ª–∞—Ç–Ω—É –ø–æ—Å–ª—É–≥—É
  paidServiceAttended    Boolean?  // –ß–∏ –ø—Ä–∏–π—à–æ–≤ –Ω–∞ –ø–ª–∞—Ç–Ω—É –ø–æ—Å–ª—É–≥—É (null = –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, true = –ø—Ä–∏–π—à–æ–≤, false = –Ω–µ –∑'—è–≤–∏–≤—Å—è)
  paidServiceCancelled   Boolean   @default(false) // üö´ –°–∫–∞—Å–æ–≤–∞–Ω–æ –¥–æ –¥–∞—Ç–∏ –∑–∞–ø–∏—Å—É (attendance=-1 –¥–æ –¥–Ω—è –≤—ñ–∑–∏—Ç—É)
  paidServiceDeletedInAltegio Boolean @default(false) // –í—ñ–∑–∏—Ç/–∑–∞–ø–∏—Å –≤–∏–¥–∞–ª–µ–Ω–æ –≤ Altegio (404), –ø–ª–∞—Ç–Ω–∏–π –±–ª–æ–∫ –æ—á–∏—â–µ–Ω–æ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –∑ –≤–µ–±—Ö—É–∫—ñ–≤/sync
  paidServiceTotalCost   Int?      // –°—É–º–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É –Ω–∞ –ø–ª–∞—Ç–Ω—É –ø–æ—Å–ª—É–≥—É (–≥—Ä–Ω, –∑ –≤–µ–±—Ö—É–∫—ñ–≤ Altegio)
  paidServiceVisitId     Int?      // ID –≤—ñ–∑–∏—Ç—É –≤ Altegio (–¥–ª—è breakdown –∑ API)
  paidServiceRecordId   Int?      // ID –∑–∞–ø–∏—Å—É –≤ –≤—ñ–∑–∏—Ç—ñ (–¥–ª—è breakdown —Ç—ñ–ª—å–∫–∏ –ø–æ —Ü—å–æ–º—É record)
  paidServiceVisitBreakdown Json?  // –†–æ–∑–±–∏—Ç—Ç—è —Å—É–º –ø–æ –º–∞–π—Å—Ç—Ä–∞—Ö –∑ API: [{ masterName, sumUAH }]
  signupAdmin            String?   // –•—Ç–æ –∑–∞–ø–∏—Å–∞–≤ (—ñ–º'—è –∞–¥–º—ñ–Ω–∞)
  comment                String?   // –ö–æ–º–µ–Ω—Ç–∞—Ä/–Ω–æ—Ç–∞—Ç–∫–∏
  altegioClientId        Int?      // ID –∫–ª—ñ—î–Ω—Ç–∞ –≤ Altegio (—è–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ)
  lastMessageAt          DateTime? // –û—Å—Ç–∞–Ω–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  consultationBookingDate DateTime? // –î–∞—Ç–∞ –∑–∞–ø–∏—Å—É –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é
  consultationAttended   Boolean?  // –ß–∏ –ø—Ä–∏–π—à–æ–≤ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é (null = –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, true = –ø—Ä–∏–π—à–æ–≤, false = –Ω–µ –∑'—è–≤–∏–≤—Å—è)
  consultationCancelled  Boolean   @default(false) // üö´ –°–∫–∞—Å–æ–≤–∞–Ω–æ –¥–æ –¥–∞—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó (attendance=-1 –¥–æ –¥–Ω—è –≤—ñ–∑–∏—Ç—É)
  consultationDeletedInAltegio Boolean @default(false) // –í—ñ–∑–∏—Ç/–∑–∞–ø–∏—Å –≤–∏–¥–∞–ª–µ–Ω–æ –≤ Altegio (404), –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é –æ—á–∏—â–µ–Ω–æ ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –∑ –≤–µ–±—Ö—É–∫—ñ–≤/sync
  consultationMasterId   String?   // ID –º–∞–π—Å—Ç—Ä–∞, —è–∫–∏–π –ø—Ä–æ–≤—ñ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é
  consultationMasterName String?   // –Ü–º'—è –º–∞–π—Å—Ç—Ä–∞, —è–∫–∏–π –ø—Ä–æ–≤—ñ–≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é
  serviceMasterAltegioStaffId Int? // –ü–æ—Ç–æ—á–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä (Altegio staffId) –∑ —É—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤ (paid/consultation)
  serviceMasterName      String?   // –ü–æ—Ç–æ—á–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä (Altegio staffName) –∑ —É—Å—ñ—Ö –∑–∞–ø–∏—Å—ñ–≤ (paid/consultation)
  serviceMasterHistory   String?   // –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω –º–∞–π—Å—Ç—Ä–∞ (JSON): [{ kyivDay, masterName, source }]
  isOnlineConsultation  Boolean   @default(false) // –ß–∏ —Ü–µ –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è
  signedUpForPaidServiceAfterConsultation Boolean @default(false) // –ó–∞–ø–∏—Å–∞–ª–∞—Å—å –Ω–∞ –ø–æ—Å–ª—É–≥—É –ø—ñ—Å–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó
  telegramNotificationSent Boolean  @default(false) // –ß–∏ –±—É–ª–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π Instagram
  chatStatusId            String?   // –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (–≤–∏–±—ñ—Ä –∞–¥–º—ñ–Ω–∞)
  chatStatusSetAt         DateTime? // –ö–æ–ª–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ä–µ–∞–ª—å–Ω–æ –∑–º—ñ–Ω–∏–≤—Å—è)
  chatStatusCheckedAt     DateTime? // –ö–æ–ª–∏ –∞–¥–º—ñ–Ω –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤ –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Å—Ç–∞—Ç—É—Å –Ω–µ –∑–º—ñ–Ω—é–≤–∞–≤—Å—è)
  chatStatusAnchorMessageId String? // –ù–∞ —è–∫–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–ª–∏ —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (–æ—Å—Ç–∞–Ω–Ω—î –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–º—ñ–Ω–∏)
  chatStatusAnchorMessageReceivedAt DateTime? // receivedAt –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –Ω–∞ —è–∫–æ–º—É –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–ª–∏ —Å—Ç–∞—Ç—É—Å (–¥–ª—è –º–∞—Ç—á—ñ–Ω–≥—É –≤ UI)
  chatStatusAnchorSetAt   DateTime? // –ö–æ–ª–∏ –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–ª–∏ ‚Äú—è–∫—ñ—Ä‚Äù –¥–ª—è —Å—Ç–∞—Ç—É—Å—É –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @default(now()) // –û–Ω–æ–≤–ª—é—î–º–æ –≤—Ä—É—á–Ω—É —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ ‚Äú—Ä–µ–∞–ª—å–Ω—ñ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ‚Äù

  // –ó–≤'—è–∑–æ–∫ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º
  status DirectStatus @relation(fields: [statusId], references: [id], onDelete: Restrict)

  // –ó–≤'—è–∑–æ–∫ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  chatStatus DirectChatStatus? @relation(fields: [chatStatusId], references: [id], onDelete: SetNull)
  
  // –ó–≤'—è–∑–æ–∫ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–º (–º–∞–π—Å—Ç—Ä–æ–º)
  master DirectMaster? @relation(fields: [masterId], references: [id], onDelete: SetNull)

  // –ó–≤'—è–∑–æ–∫ –∑ —ñ—Å—Ç–æ—Ä—ñ—î—é —Å—Ç–∞–Ω—ñ–≤
  stateLogs DirectClientStateLog[]

  // –ó–≤'—è–∑–æ–∫ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏
  messages DirectMessage[]

  // –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  chatStatusLogs DirectClientChatStatusLog[]

  // –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
  @@unique([instagramUsername])
  @@index([statusId])
  @@index([masterId])
  @@index([altegioClientId])
  @@index([lastVisitAt])
  @@index([lastActivityAt])
  @@index([state])
  @@index([source])
  @@index([firstContactDate])
  @@index([createdAt])
  @@index([consultationBookingDate])
  @@index([consultationAttended])
  @@index([consultationMasterId])
  @@index([serviceMasterAltegioStaffId])
  @@index([serviceMasterName])
  @@index([paidServiceCancelled])
  @@index([paidServiceDeletedInAltegio])
  @@index([paidServiceTotalCost])
  @@index([consultationCancelled])
  @@index([consultationDeletedInAltegio])
  @@index([chatStatusId])
  @@index([chatStatusCheckedAt])
  @@index([chatStatusAnchorMessageId])
  @@index([chatStatusAnchorMessageReceivedAt])
  @@map("direct_clients")
}

// –°—Ç–∞—Ç—É—Å–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (–¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–µ—Ä–µ–ø–∏—Å–æ–∫)
model DirectChatStatus {
  id        String   @id @default(uuid())
  name      String   // –î–æ–≤–≥–∞ –Ω–∞–∑–≤–∞ (–≤ UI –±—É–¥–µ tooltip)
  color     String   @default("#6b7280") // –ö–æ–ª—ñ—Ä –±–µ–π–¥–∂–∞ (hex)
  badgeKey  String   @default("badge_1") // –í–∏–±—ñ—Ä –±–µ–π–¥–∂–∞ –∑ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É (10 —à—Ç)
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  clients DirectClient[]
  fromLogs DirectClientChatStatusLog[] @relation("DirectChatStatusFrom")
  toLogs   DirectClientChatStatusLog[] @relation("DirectChatStatusTo")

  @@index([order])
  @@index([isActive])
  @@map("direct_chat_statuses")
}

// –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—ñ–≤ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (–ø–∏—à–µ–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª—å–Ω–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è)
model DirectClientChatStatusLog {
  id           String   @id @default(uuid())
  clientId     String
  fromStatusId String?
  toStatusId   String?
  changedAt    DateTime @default(now())
  changedBy    String?  // –ø–æ–∫–∏ —â–æ: 'admin'
  note         String?

  client     DirectClient @relation(fields: [clientId], references: [id], onDelete: Cascade)
  fromStatus DirectChatStatus? @relation("DirectChatStatusFrom", fields: [fromStatusId], references: [id], onDelete: SetNull)
  toStatus   DirectChatStatus? @relation("DirectChatStatusTo", fields: [toStatusId], references: [id], onDelete: SetNull)

  @@index([clientId])
  @@index([changedAt])
  @@map("direct_client_chat_status_logs")
}

// –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ (–º–∞–π—Å—Ç—Ä–∏ —Ç–∞ –¥—ñ—Ä–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∏)
model DirectMaster {
  id              String   @id @default(uuid())
  name            String   // –Ü–º'—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ–≥–æ
  telegramUsername String? // Telegram username
  telegramChatId  BigInt?  // Telegram chat ID (–¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å) - BigInt –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –≤–µ–ª–∏–∫–∏—Ö ID
  role            String   @default("master") // 'master' | 'direct-manager' | 'admin'
  altegioStaffId  Int?     // ID –º–∞–π—Å—Ç—Ä–∞ –≤ Altegio (—è–∫—â–æ —î)
  isActive        Boolean  @default(true) // –ß–∏ –∞–∫—Ç–∏–≤–Ω–∏–π
  order           Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // –ó–≤'—è–∑–æ–∫ –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏
  clients DirectClient[]

  @@index([role])
  @@index([isActive])
  @@index([order])
  @@index([telegramChatId])
  @@map("direct_masters")
}

// –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞–Ω—ñ–≤ –∫–ª—ñ—î–Ω—Ç—ñ–≤
model DirectClientStateLog {
  id        String   @id @default(uuid())
  clientId  String   // ID –∫–ª—ñ—î–Ω—Ç–∞
  state     String?  // –ù–æ–≤–∏–π —Å—Ç–∞–Ω (–º–æ–∂–µ –±—É—Ç–∏ null –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É)
  previousState String? // –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω
  reason    String?  // –ü—Ä–∏—á–∏–Ω–∞ –∑–º—ñ–Ω–∏ (–Ω–∞–ø—Ä. "webhook", "manual", "cron", "record")
  metadata  String?  // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ (JSON)
  createdAt DateTime @default(now())

  // –ó–≤'—è–∑–æ–∫ –∑ –∫–ª—ñ—î–Ω—Ç–æ–º
  client DirectClient @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([state])
  @@index([createdAt])
  @@map("direct_client_state_logs")
}

// –ó–∞–ø–∏—Å–∏ –∑ Altegio (–¥–ª—è —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—ó –ø–æ—Å–ª—É–≥)
model AltegioRecord {
  id            String   @id @default(uuid())
  visitId       Int?     // ID –≤—ñ–∑–∏—Ç—É –≤ Altegio
  recordId      Int?     // ID –∑–∞–ø–∏—Å—É –≤ Altegio
  altegioClientId Int    // ID –∫–ª—ñ—î–Ω—Ç–∞ –≤ Altegio
  directClientId String? // ID –∫–ª—ñ—î–Ω—Ç–∞ –≤ –Ω–∞—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ (—è–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ)
  status        String?  // –°—Ç–∞—Ç—É—Å: 'create', 'update', 'delete'
  datetime      DateTime // –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –≤—ñ–∑–∏—Ç—É
  receivedAt    DateTime @default(now()) // –ö–æ–ª–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –≤–µ–±—Ö—É–∫
  staffId       Int?     // ID –º–∞–π—Å—Ç—Ä–∞
  staffName     String?  // –Ü–º'—è –º–∞–π—Å—Ç—Ä–∞
  services      String   // JSON –º–∞—Å–∏–≤ –ø–æ—Å–ª—É–≥
  attendance    Int?     // –ß–∏ –ø—Ä–∏–π—à–æ–≤ (0 –∞–±–æ 1)
  rawData       String?  // –ü–æ–≤–Ω—ñ –¥–∞–Ω—ñ –≤–µ–±—Ö—É–∫–∞ (JSON)

  @@index([altegioClientId])
  @@index([directClientId])
  @@index([visitId])
  @@index([recordId])
  @@index([datetime])
  @@index([receivedAt])
  @@map("altegio_records")
}

// –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ManyChat (–≤—Ö—ñ–¥–Ω—ñ —Ç–∞ –≤–∏—Ö—ñ–¥–Ω—ñ)
model DirectMessage {
  id                String   @id @default(uuid())
  clientId          String   // ID –∫–ª—ñ—î–Ω—Ç–∞ (DirectClient)
  direction         String   // 'incoming' | 'outgoing'
  text              String   // –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  messageId         String?  // ID –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ ManyChat (—è–∫—â–æ —î)
  subscriberId      String?  // ID subscriber –≤ ManyChat
  source            String   @default("manychat") // 'manychat' | 'instagram_graph' | 'manual'
  receivedAt        DateTime @default(now()) // –ö–æ–ª–∏ –æ—Ç—Ä–∏–º–∞–Ω–æ/–≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ
  rawData           String?  // –ü–æ–≤–Ω—ñ –¥–∞–Ω—ñ webhook/API response (JSON)
  createdAt         DateTime @default(now())

  // –ó–≤'—è–∑–æ–∫ –∑ –∫–ª—ñ—î–Ω—Ç–æ–º
  client DirectClient @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([direction])
  @@index([receivedAt])
  @@index([messageId])
  @@map("direct_messages")
}
