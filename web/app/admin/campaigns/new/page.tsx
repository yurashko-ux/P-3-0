'use client'
import { useState } from 'react'
export default function NewCampaignPage(){const [form,setForm]=useState({name:'',base_pipeline_id:'',base_status_id:'',v1_field:'text',v1_op:'contains',v1_value:'',v1_to_pipeline_id:'',v1_to_status_id:'',v2_enabled:false,v2_field:'text',v2_op:'contains',v2_value:'',v2_to_pipeline_id:'',v2_to_status_id:'',exp_days:7,exp_to_pipeline_id:'',exp_to_status_id:'',enabled:true,note:''});const [msg,setMsg]=useState('');const u=(k:string,v:any)=>setForm(s=>({...s,[k]:v}));async function save(){setMsg('');const payload:any={name:form.name,base_pipeline_id:form.base_pipeline_id,base_status_id:form.base_status_id,v1_condition:{field:form.v1_field as any,op:form.v1_op as any,value:form.v1_value},v1_to_pipeline_id:form.v1_to_pipeline_id||null,v1_to_status_id:form.v1_to_status_id||null,v2_condition:form.v2_enabled?{field:form.v2_field as any,op:form.v2_op as any,value:form.v2_value}:null,v2_to_pipeline_id:form.v2_enabled?(form.v2_to_pipeline_id||null):null,v2_to_status_id:form.v2_enabled?(form.v2_to_status_id||null):null,exp_days:Number(form.exp_days||0),exp_to_pipeline_id:form.exp_to_pipeline_id||null,exp_to_status_id:form.exp_to_status_id||null,note:form.note||null,enabled:form.enabled};const res=await fetch('/api/campaigns',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const j=await res.json();if(res.ok){location.href='/admin/campaigns'}else{setMsg(j.error||'Помилка')}}return(<div className='space-y-4'><h1 className='text-2xl font-semibold'>Нова кампанія</h1>{msg&&<div className='text-red-600'>{msg}</div>}<div className='grid md:grid-cols-2 gap-4'><div className='card space-y-3'><div><label className='text-sm'>Назва</label><input className='input' value={form.name} onChange={e=>u('name',e.target.value)} /></div><div className='grid grid-cols-2 gap-3'><div><label className='text-sm'>База: pipeline</label><input className='input' value={form.base_pipeline_id} onChange={e=>u('base_pipeline_id',e.target.value)} /></div><div><label className='text-sm'>База: статус</label><input className='input' value={form.base_status_id} onChange={e=>u('base_status_id',e.target.value)} /></div></div><div className='flex items-center gap-3'><input id='enabled' type='checkbox' checked={form.enabled} onChange={e=>u('enabled',e.target.checked)} /><label htmlFor='enabled'>Enabled</label></div><div><label className='text-sm'>Note</label><textarea className='textarea' value={form.note} onChange={e=>u('note',e.target.value)} /></div></div><div className='card space-y-3'><h3 className='font-medium'>Variant #1</h3><div className='grid grid-cols-3 gap-3'><select className='select' value={form.v1_field} onChange={e=>u('v1_field',e.target.value)}><option value='text'>text</option><option value='any'>any</option></select><select className='select' value={form.v1_op} onChange={e=>u('v1_op',e.target.value)}><option value='contains'>contains</option><option value='equals'>equals</option></select><input className='input' placeholder='value' value={form.v1_value} onChange={e=>u('v1_value',e.target.value)} /></div><div className='grid grid-cols-2 gap-3'><input className='input' placeholder='to pipeline' value={form.v1_to_pipeline_id} onChange={e=>u('v1_to_pipeline_id',e.target.value)} /><input className='input' placeholder='to status' value={form.v1_to_status_id} onChange={e=>u('v1_to_status_id',e.target.value)} /></div></div><div className='card space-y-3'><div className='flex items-center justify-between'><h3 className='font-medium'>Variant #2</h3><label className='flex items-center gap-2 text-sm'><input type='checkbox' checked={form.v2_enabled} onChange={e=>u('v2_enabled',e.target.checked)} /> вкл.</label></div><div className='grid grid-cols-3 gap-3'><select className='select' value={form.v2_field} onChange={e=>u('v2_field',e.target.value)}><option value='text'>text</option><option value='any'>any</option></select><select className='select' value={form.v2_op} onChange={e=>u('v2_op',e.target.value)}><option value='contains'>contains</option><option value='equals'>equals</option></select><input className='input' placeholder='value' value={form.v2_value} onChange={e=>u('v2_value',e.target.value)} /></div><div className='grid grid-cols-2 gap-3'><input className='input' placeholder='to pipeline' value={form.v2_to_pipeline_id} onChange={e=>u('v2_to_pipeline_id',e.target.value)} /><input className='input' placeholder='to status' value={form.v2_to_status_id} onChange={e=>u('v2_to_status_id',e.target.value)} /></div></div><div className='card space-y-3'><h3 className='font-medium'>Variant #3 (Expiration)</h3><div className='grid grid-cols-3 gap-3'><div><label className='text-sm'>Днів</label><input className='input' type='number' value={form.exp_days} onChange={e=>u('exp_days',e.target.value)} /></div><input className='input' placeholder='to pipeline' value={form.exp_to_pipeline_id} onChange={e=>u('exp_to_pipeline_id',e.target.value)} /><input className='input' placeholder='to status' value={form.exp_to_status_id} onChange={e=>u('exp_to_status_id',e.target.value)} /></div></div></div><div className='flex gap-3'><button className='btn btn-primary' onClick={save}>Зберегти</button><a href='/admin/campaigns' className='btn btn-outline'>Скасувати</a></div></div>)}
