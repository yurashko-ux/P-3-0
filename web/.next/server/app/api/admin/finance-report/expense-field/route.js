"use strict";(()=>{var e={};e.id=1765,e.ids=[1765],e.modules={5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9434:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>y,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>f,POST:()=>m,dynamic:()=>p});var a=t(9303),s=t(8716),o=t(670),i=t(7070),l=t(7708),u=t(4332);let p="force-dynamic";function c(e){let r=e.nextUrl.searchParams.get("secret"),t=process.env.CRON_SECRET||"";return t&&r&&t===r}function d(e,r,t){return`finance:expenses:${t}:${e}:${r}`}async function f(e){if(!c(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let r=parseInt(e.nextUrl.searchParams.get("year")||"0",10),t=parseInt(e.nextUrl.searchParams.get("month")||"0",10),n=e.nextUrl.searchParams.get("field")||"";if(!r||!t||t<1||t>12||!n)return i.NextResponse.json({error:"Invalid year, month, or field"},{status:400});let a=d(r,t,n),s=await u.kvRead.getRaw(a);if(null===s)return i.NextResponse.json({value:null});let o=null;try{let e=JSON.parse(s);if("number"==typeof e)o=e;else if("object"==typeof e&&null!==e){let r=e.value??e;"number"==typeof r?o=r:"string"==typeof r&&(o=parseFloat(r))}else"string"==typeof e&&(o=parseFloat(e))}catch{o=parseFloat(s)}return i.NextResponse.json({value:Number.isFinite(o)&&o>=0?o:null})}catch(e){return console.error("[admin/finance-report/expense-field] GET error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}async function m(e){if(!c(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let{year:r,month:t,fieldKey:n,value:a}=await e.json();if(!r||!t||t<1||t>12||!n)return i.NextResponse.json({error:"Invalid year, month, or fieldKey"},{status:400});if(null==a)return i.NextResponse.json({error:"Value is required"},{status:400});let s="number"==typeof a?a:parseFloat(String(a));if(!Number.isFinite(s)||s<0)return i.NextResponse.json({error:"Value must be a non-negative number"},{status:400});let o=d(r,t,n),p=JSON.stringify(s);console.log(`[admin/finance-report/expense-field] ðŸ’¾ Saving: key=${o}, value=${s}, fieldKey=${n}, year=${r}, month=${t}`),await u.kvWrite.setRaw(o,p),console.log(`[admin/finance-report/expense-field] âœ… Field saved successfully to KV`);let c=await u.kvRead.getRaw(o);return console.log(`[admin/finance-report/expense-field] ðŸ” Verification read after save:`,{hasValue:null!==c,valueType:typeof c,value:c}),(0,l.revalidatePath)("/admin/finance-report"),i.NextResponse.json({success:!0,year:r,month:t,fieldKey:n,value:s})}catch(e){return console.error("[admin/finance-report/expense-field] POST error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/finance-report/expense-field/route",pathname:"/api/admin/finance-report/expense-field",filename:"route",bundlePath:"app/api/admin/finance-report/expense-field/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/expense-field/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:v}=x,h="/api/admin/finance-report/expense-field/route";function R(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:g})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[8948,5972,7708,4332],()=>t(9434));module.exports=n})();