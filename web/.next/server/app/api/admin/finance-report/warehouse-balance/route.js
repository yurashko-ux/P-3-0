"use strict";(()=>{var e={};e.id=1780,e.ids=[1780],e.modules={5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},713:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>b});var n={};a.r(n),a.d(n,{GET:()=>f,POST:()=>m,dynamic:()=>c});var t=a(9303),o=a(8716),s=a(670),i=a(7070),l=a(7708),u=a(4332);let c="force-dynamic";function p(e){let r=e.nextUrl.searchParams.get("secret"),a=process.env.CRON_SECRET||"";return a&&r&&a===r}function d(e,r){return`finance:warehouse:balance:${e}:${r}`}async function f(e){if(!p(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let r=parseInt(e.nextUrl.searchParams.get("year")||"0",10),a=parseInt(e.nextUrl.searchParams.get("month")||"0",10);if(!r||!a||a<1||a>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});let n=d(r,a),t=await u.kvRead.getRaw(n);if(null===t)return i.NextResponse.json({balance:null});let o=null;try{let e=JSON.parse(t);if("number"==typeof e)o=e;else if("object"==typeof e&&null!==e){let r=e.value??e;"number"==typeof r?o=r:"string"==typeof r&&(o=parseFloat(r))}else"string"==typeof e&&(o=parseFloat(e))}catch{o=parseFloat(t)}return i.NextResponse.json({balance:Number.isFinite(o)&&o>=0?o:null})}catch(e){return console.error("[admin/finance-report/warehouse-balance] GET error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}async function m(e){if(!p(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let{year:r,month:a,balance:n}=await e.json();if(!r||!a||a<1||a>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});if(null==n)return i.NextResponse.json({error:"Balance is required"},{status:400});let t="number"==typeof n?n:parseFloat(String(n));if(!Number.isFinite(t)||t<0)return i.NextResponse.json({error:"Balance must be a non-negative number"},{status:400});let o=d(r,a);console.log(`[admin/finance-report/warehouse-balance] ðŸ’¾ Saving balance: key=${o}, value=${t}, year=${r}, month=${a}`);let s=JSON.stringify(t);console.log(`[admin/finance-report/warehouse-balance] Value to store (JSON): ${s}`),await u.kvWrite.setRaw(o,s),console.log(`[admin/finance-report/warehouse-balance] âœ… Balance saved successfully to KV`);let c=await u.kvRead.getRaw(o);return console.log(`[admin/finance-report/warehouse-balance] ðŸ” Verification read after save:`,{hasValue:null!==c,valueType:typeof c,value:c,valuePreview:c?String(c).slice(0,100):null}),(0,l.revalidatePath)("/admin/finance-report"),console.log(`[admin/finance-report/warehouse-balance] ðŸ”„ Cache invalidated for /admin/finance-report`),i.NextResponse.json({success:!0,year:r,month:a,balance:t})}catch(e){return console.error("[admin/finance-report/warehouse-balance] POST error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}let h=new t.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/finance-report/warehouse-balance/route",pathname:"/api/admin/finance-report/warehouse-balance",filename:"route",bundlePath:"app/api/admin/finance-report/warehouse-balance/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/warehouse-balance/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:b,serverHooks:v}=h,y="/api/admin/finance-report/warehouse-balance/route";function x(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:b})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),n=r.X(0,[8948,5972,7708,4332],()=>a(713));module.exports=n})();