"use strict";(()=>{var e={};e.id=1831,e.ids=[1831],e.modules={5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4626:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var n={};t.r(n),t.d(n,{GET:()=>m,POST:()=>f,dynamic:()=>p});var a=t(9303),s=t(8716),o=t(670),i=t(7070),u=t(7708),c=t(4332);let p="force-dynamic";function l(e){let r=e.nextUrl.searchParams.get("secret"),t=process.env.CRON_SECRET||"";return t&&r&&t===r}function d(e,r){return`finance:exchange-rate:usd:${e}:${r}`}async function m(e){if(!l(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let r=parseInt(e.nextUrl.searchParams.get("year")||"0",10),t=parseInt(e.nextUrl.searchParams.get("month")||"0",10);if(!r||!t||t<1||t>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});let n=d(r,t),a=await c.kvRead.getRaw(n);if(null===a)return i.NextResponse.json({rate:null});let s=null;try{let e=JSON.parse(a);if("number"==typeof e)s=e;else if("object"==typeof e&&null!==e){let r=e.value??e;"number"==typeof r?s=r:"string"==typeof r&&(s=parseFloat(r))}else"string"==typeof e&&(s=parseFloat(e))}catch{s=parseFloat(a)}return i.NextResponse.json({rate:Number.isFinite(s)&&s>0?s:null})}catch(e){return console.error("[admin/finance-report/exchange-rate] GET error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}async function f(e){if(!l(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let{year:r,month:t,rate:n}=await e.json();if(!r||!t||t<1||t>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});if(null==n)return i.NextResponse.json({error:"Rate is required"},{status:400});let a="number"==typeof n?n:parseFloat(String(n));if(!Number.isFinite(a)||a<=0)return i.NextResponse.json({error:"Rate must be a positive number"},{status:400});let s=d(r,t),o=JSON.stringify(a);return console.log(`[admin/finance-report/exchange-rate] ðŸ’¾ Saving: key=${s}, rate=${a}, year=${r}, month=${t}`),await c.kvWrite.setRaw(s,o),console.log(`[admin/finance-report/exchange-rate] âœ… Exchange rate saved successfully to KV`),(0,u.revalidatePath)("/admin/finance-report"),i.NextResponse.json({success:!0,year:r,month:t,rate:a})}catch(e){return console.error("[admin/finance-report/exchange-rate] POST error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/finance-report/exchange-rate/route",pathname:"/api/admin/finance-report/exchange-rate",filename:"route",bundlePath:"app/api/admin/finance-report/exchange-rate/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/exchange-rate/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:y}=x,R="/api/admin/finance-report/exchange-rate/route";function v(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[8948,5972,7708,4332],()=>t(4626));module.exports=n})();