"use strict";(()=>{var e={};e.id=2376,e.ids=[2376],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7231:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var n={};a.r(n),a.d(n,{GET:()=>u,dynamic:()=>d});var r=a(9303),s=a(8716),o=a(670),i=a(7070),c=a(7582),p=a(4044);let d="force-dynamic";async function u(e){if(!function(e){let t=e.nextUrl.searchParams.get("secret"),a=process.env.CRON_SECRET||"";return a&&t&&a===t}(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let t=e.nextUrl.searchParams.get("year"),a=e.nextUrl.searchParams.get("month"),n=new Date,r=t?parseInt(t,10):n.getFullYear(),s=a?parseInt(a,10):n.getMonth()+1;if(!r||!s||s<1||s>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});let o=`${r}-${String(s).padStart(2,"0")}-01`,d=new Date(r,s,0).getDate(),u=`${r}-${String(s).padStart(2,"0")}-${String(d).padStart(2,"0")}`,m=function(){let e=process.env.ALTEGIO_COMPANY_ID?.trim(),t=p.B0.PARTNER_ID||p.B0.APPLICATION_ID,a=e||t;if(!a)throw Error("ALTEGIO_COMPANY_ID is required");return a}(),l=[{name:"POST /company/{id}/finance_transactions/search",method:"POST",path:`/company/${m}/finance_transactions/search`,body:{start_date:o,end_date:u,count:1e4,page:1}},{name:"GET /transactions/{location_id}",method:"GET",path:`/transactions/${m}`,params:new URLSearchParams({start_date:o,end_date:u,count:"10000"})},{name:"GET /finance_transactions/{location_id}",method:"GET",path:`/finance_transactions/${m}`,params:new URLSearchParams({start_date:o,end_date:u,count:"10000"})}],h=[];for(let e of l)try{let t;if("POST"===e.method)t=await (0,c.B)(e.path,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.body)});else{let a=`${e.path}?${e.params.toString()}`;t=await (0,c.B)(a)}let a=Array.isArray(t)?t:t&&"object"==typeof t&&Array.isArray(t.data)?t.data:[],n=new Set;a.forEach(e=>{let t=e.expense?.title||e.expense?.name||e.comment||e.type||"Unknown";n.add(t)});let r=a.slice(0,20).map(e=>({id:e.id,date:e.date,amount:e.amount,expense_id:e.expense_id,expense_title:e.expense?.title,expense_name:e.expense?.name,comment:e.comment,type:e.type,type_id:e.type_id}));h.push({endpoint:e.name,success:!0,transactionCount:a.length,categories:Array.from(n).sort(),sampleTransactions:r})}catch(t){h.push({endpoint:e.name,success:!1,transactionCount:0,categories:[],sampleTransactions:[],error:t?.message||String(t)})}let g=h.filter(e=>e.success),f=g.reduce((e,t)=>t.transactionCount>e.transactionCount?t:e,g[0]||h[0]),y=new Set;return g.forEach(e=>{e.categories.forEach(e=>y.add(e))}),i.NextResponse.json({period:{year:r,month:s,date_from:o,date_to:u},companyId:m,endpoints:h,summary:{totalEndpoints:l.length,successfulEndpoints:g.length,bestEndpoint:f.endpoint,totalTransactions:f.transactionCount,totalUniqueCategories:y.size,allCategories:Array.from(y).sort()},bestResult:{endpoint:f.endpoint,transactionCount:f.transactionCount,categories:f.categories,sampleTransactions:f.sampleTransactions}})}catch(e){return console.error("[admin/finance-report/debug-transactions] GET error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}let m=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/finance-report/debug-transactions/route",pathname:"/api/admin/finance-report/debug-transactions",filename:"route",bundlePath:"app/api/admin/finance-report/debug-transactions/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/debug-transactions/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:g}=m,f="/api/admin/finance-report/debug-transactions/route";function y(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[8948,5972,7582],()=>a(7231));module.exports=n})();