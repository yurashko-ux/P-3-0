"use strict";(()=>{var e={};e.id=870,e.ids=[870],e.modules={5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3090:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>R,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{GET:()=>f,POST:()=>m,dynamic:()=>l});var o=r(9303),s=r(8716),a=r(670),i=r(7070),c=r(7708),u=r(4332);let l="force-dynamic";function p(e){let t=e.nextUrl.searchParams.get("secret"),r=process.env.CRON_SECRET||"";return r&&t&&r===t}function d(e,t){return`finance:goods:cost:${e}:${t}`}async function f(e){if(!p(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let t=parseInt(e.nextUrl.searchParams.get("year")||"0",10),r=parseInt(e.nextUrl.searchParams.get("month")||"0",10);if(!t||!r||r<1||r>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});let n=d(t,r),o=await u.kvRead.getRaw(n);if(null===o)return i.NextResponse.json({cost:null});let s=null;try{let e=JSON.parse(o);if("number"==typeof e)s=e;else if("object"==typeof e&&null!==e){let t=e.value??e;"number"==typeof t?s=t:"string"==typeof t&&(s=parseFloat(t))}else"string"==typeof e&&(s=parseFloat(e))}catch{s=parseFloat(o)}return i.NextResponse.json({cost:Number.isFinite(s)&&s>=0?s:null})}catch(e){return console.error("[admin/finance-report/cost] GET error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}async function m(e){if(!p(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});try{let{year:t,month:r,cost:n}=await e.json();if(!t||!r||r<1||r>12)return i.NextResponse.json({error:"Invalid year or month"},{status:400});if(null==n)return i.NextResponse.json({error:"Cost is required"},{status:400});let o="number"==typeof n?n:parseFloat(String(n));if(!Number.isFinite(o)||o<0)return i.NextResponse.json({error:"Cost must be a non-negative number"},{status:400});let s=d(t,r);console.log(`[admin/finance-report/cost] ðŸ’¾ Saving cost: key=${s}, value=${o}, year=${t}, month=${r}`);let a=JSON.stringify(o);console.log(`[admin/finance-report/cost] Value to store (JSON): ${a}`),await u.kvWrite.setRaw(s,a),console.log(`[admin/finance-report/cost] âœ… Cost saved successfully to KV`);let l=await u.kvRead.getRaw(s);return console.log(`[admin/finance-report/cost] ðŸ” Verification read after save:`,{hasValue:null!==l,valueType:typeof l,value:l,valuePreview:l?String(l).slice(0,100):null}),(0,c.revalidatePath)("/admin/finance-report"),console.log(`[admin/finance-report/cost] ðŸ”„ Cache invalidated for /admin/finance-report`),i.NextResponse.json({success:!0,year:t,month:r,cost:o})}catch(e){return console.error("[admin/finance-report/cost] POST error:",e),i.NextResponse.json({error:String(e?.message||e)},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/finance-report/cost/route",pathname:"/api/admin/finance-report/cost",filename:"route",bundlePath:"app/api/admin/finance-report/cost/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/cost/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:y,serverHooks:x}=g,h="/api/admin/finance-report/cost/route";function R(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:y})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,7708,4332],()=>r(3090));module.exports=n})();