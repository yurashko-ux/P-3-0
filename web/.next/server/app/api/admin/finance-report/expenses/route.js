"use strict";(()=>{var e={};e.id=193,e.ids=[193],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9801:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>R});var r={};t.r(r),t.d(r,{GET:()=>c,POST:()=>x});var n=t(9303),o=t(8716),a=t(670),p=t(7070),u=t(4332);let i=process.env.CRON_SECRET?.trim();function l(e,s){return`finance:expenses:${e}:${s}`}async function c(e){try{let{searchParams:s}=new URL(e.url),t=parseInt(s.get("year")||"0"),r=parseInt(s.get("month")||"0"),n=s.get("secret");if(!t||!r)return p.NextResponse.json({error:"year та month обов'язкові"},{status:400});if(n&&n!==i)return p.NextResponse.json({error:"Невірний CRON_SECRET"},{status:403});let o=l(t,r),a=await u.kvRead.getRaw(o);if(console.log(`[expenses/route] GET key=${o}, hasValue=${!!a}`),null===a)return p.NextResponse.json({expenses:null});let c=null;try{let e=JSON.parse(a);if("number"==typeof e)c=e;else if("object"==typeof e&&null!==e){let s=e.value??e;"number"==typeof s?c=s:"string"==typeof s&&(c=parseFloat(s))}else"string"==typeof e&&(c=parseFloat(e))}catch{c=parseFloat(a)}if(null===c||!Number.isFinite(c)||c<0)return console.log("[expenses/route] Invalid expenses value:",c),p.NextResponse.json({expenses:null});return console.log(`[expenses/route] ✅ Returning expenses:`,c),p.NextResponse.json({expenses:c})}catch(e){return console.error("[expenses/route] GET error:",e),p.NextResponse.json({error:e?.message||"Помилка читання витрат"},{status:500})}}async function x(e){try{let{searchParams:s}=new URL(e.url),t=s.get("secret");if(!t||t!==i)return p.NextResponse.json({error:"Невірний або відсутній CRON_SECRET"},{status:403});let{year:r,month:n,expenses:o}=await e.json();if(!r||!n||"number"!=typeof o||o<0)return p.NextResponse.json({error:"year, month та expenses (невід'ємне число) обов'язкові"},{status:400});let a=l(r,n),c=JSON.stringify(o);console.log(`[expenses/route] POST saving: key=${a}, expenses=${o}`),await u.kvWrite.setRaw(a,c);let x=await u.kvRead.getRaw(a);return console.log("[expenses/route] POST verify read:",x),p.NextResponse.json({success:!0,year:r,month:n,expenses:o,key:a})}catch(e){return console.error("[expenses/route] POST error:",e),p.NextResponse.json({error:e?.message||"Помилка збереження витрат"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/finance-report/expenses/route",pathname:"/api/admin/finance-report/expenses",filename:"route",bundlePath:"app/api/admin/finance-report/expenses/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/finance-report/expenses/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:R,serverHooks:m}=f,g="/api/admin/finance-report/expenses/route";function y(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:R})}}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,5972,4332],()=>t(9801));module.exports=r})();