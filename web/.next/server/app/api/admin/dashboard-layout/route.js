"use strict";(()=>{var e={};e.id=5421,e.ids=[5421],e.modules={5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8519:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var a={};t.r(a),t.d(a,{GET:()=>y,POST:()=>h,dynamic:()=>d});var s=t(9303),o=t(8716),n=t(670),u=t(7070),i=t(7708),l=t(4332);let d="force-dynamic";function c(e){let r=e.nextUrl.searchParams.get("secret"),t=process.env.CRON_SECRET||"";return t&&r&&t===r}function p(e){return`dashboard:layout:${e}`}async function y(e){if(!c(e))return u.NextResponse.json({error:"Unauthorized"},{status:401});try{let r=e.nextUrl.searchParams.get("storageKey")||"";if(!r)return u.NextResponse.json({error:"storageKey is required"},{status:400});let t=p(r),a=await l.kvRead.getRaw(t);if(null===a)return u.NextResponse.json({layout:null});let s=null;try{s=JSON.parse(a)}catch{return u.NextResponse.json({layout:null})}return u.NextResponse.json({layout:s})}catch(e){return console.error("[admin/dashboard-layout] GET error:",e),u.NextResponse.json({error:String(e?.message||e)},{status:500})}}async function h(e){if(!c(e))return u.NextResponse.json({error:"Unauthorized"},{status:401});try{let{storageKey:r,layout:t}=await e.json();if(!r)return u.NextResponse.json({error:"storageKey is required"},{status:400});if(!t||!Array.isArray(t))return u.NextResponse.json({error:"layout must be an array"},{status:400});let a=p(r),s=JSON.stringify(t);console.log(`[admin/dashboard-layout] ðŸ’¾ Saving layout: key=${a}, blocks=${t.length}`),await l.kvWrite.setRaw(a,s),console.log(`[admin/dashboard-layout] âœ… Layout saved successfully to KV`);let o=await l.kvRead.getRaw(a);return console.log(`[admin/dashboard-layout] ðŸ” Verification read after save:`,{hasValue:null!==o}),r.includes("finance-report")&&(0,i.revalidatePath)("/admin/finance-report"),r.includes("photo-reports")&&(0,i.revalidatePath)("/admin/photo-reports"),u.NextResponse.json({success:!0,storageKey:r,blocksCount:t.length})}catch(e){return console.error("[admin/dashboard-layout] POST error:",e),u.NextResponse.json({error:String(e?.message||e)},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/dashboard-layout/route",pathname:"/api/admin/dashboard-layout",filename:"route",bundlePath:"app/api/admin/dashboard-layout/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/admin/dashboard-layout/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:f}=m,R="/api/admin/dashboard-layout/route";function v(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,7708,4332],()=>t(8519));module.exports=a})();