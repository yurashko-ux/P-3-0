"use strict";(()=>{var e={};e.id=5156,e.ids=[5156],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2571:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>A,patchFetch:()=>j,requestAsyncStorage:()=>k,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{GET:()=>g,dynamic:()=>p});var s=a(9303),n=a(8716),i=a(670),o=a(7070);let p="force-dynamic",c=(process.env.KEYCRM_BASE_URL||"https://openapi.keycrm.app/v1").replace(/\/+$/,""),u=process.env.KEYCRM_API_TOKEN||process.env.KEYCRM_BEARER||"";async function l(e){if(!u)return{ok:!1,status:401,json:{error:"KEYCRM token missing"},url:c+e};let t=`${c}${e}`,a=await fetch(t,{headers:{Authorization:`Bearer ${u}`,Accept:"application/json"},cache:"no-store"}).catch(()=>null);if(!a)return{ok:!1,status:502,json:{error:"fetch failed"},url:t};let r=null;try{r=await a.json()}catch{}return{ok:a.ok,status:a.status,json:r,url:t}}function m(e){return Array.isArray(e)?{container:"root[]",items:e}:Array.isArray(e?.data)?{container:"data[]",items:e.data}:Array.isArray(e?.items)?{container:"items[]",items:e.items}:Array.isArray(e?.result)?{container:"result[]",items:e.result}:Array.isArray(e?.data?.items)?{container:"data.items[]",items:e.data.items}:{container:"unknown",items:[]}}function d(e){let t=e?.meta||{};return{raw:t,detected:{total:t.total??t.total_items??null,per_page:t.per_page??t.page_size??null,current_page:t.current_page??t.page?.current??null,last_page:t.last_page??(t.total&&(t.per_page||t.page_size)?Math.ceil(t.total/(t.per_page||t.page_size)):null)},links:e?.links||null}}async function g(e){let t=new URL(e.url),a=(t.searchParams.get("search")||"").trim(),r=(t.searchParams.get("pipeline_id")||"").trim(),s=Number(t.searchParams.get("page")||"1"),n=Number(t.searchParams.get("size")||"5"),i=[];a&&i.push(`search=${encodeURIComponent(a)}`),r&&i.push(`pipeline_id=${encodeURIComponent(r)}`);let p=[`page[number]=${s}`,`page[size]=${n}`,...i].join("&"),u=await l(`/pipelines/cards?${p}`),g=m(u.json),h=d(u.json),k=[`page=${s}`,`per_page=${n}`,...i].join("&"),_=await l(`/pipelines/cards?${k}`),y=m(_.json),A=d(_.json);return o.NextResponse.json({ok:!0,base_url:c,params_used:{search:a||null,pipeline_id:r||null,page:s,size:n},jsonapi:{url:u.url,status:u.status,ok:u.ok,container:g.container,count:g.items.length,sample_keys:g.items[0]?Object.keys(g.items[0]):[],meta:h.detected,meta_raw_exists:!!h.raw},laravel:{url:_.url,status:_.status,ok:_.ok,container:y.container,count:y.items.length,sample_keys:y.items[0]?Object.keys(y.items[0]):[],meta:A.detected,meta_raw_exists:!!A.raw},hint:"Дивись який варіант (jsonapi/laravel) повертає ok:true та ненульовий count. Також зверни увагу на структуру meta.* — ці ключі ми використаємо для пагінації в пошуку."})}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/keycrm/paginate-check/route",pathname:"/api/keycrm/paginate-check",filename:"route",bundlePath:"app/api/keycrm/paginate-check/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/keycrm/paginate-check/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:k,staticGenerationAsyncStorage:_,serverHooks:y}=h,A="/api/keycrm/paginate-check/route";function j(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>a(2571));module.exports=r})();