"use strict";(()=>{var e={};e.id=7079,e.ids=[7079],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2124:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>d,dynamic:()=>p});var a=r(9303),n=r(8716),i=r(670),o=r(7070);let p="force-dynamic",c=process.env.KEYCRM_BASE_URL??"https://openapi.keycrm.app/v1",u=process.env.KEYCRM_API_TOKEN,l=process.env.ADMIN_PASS;async function d(e){try{let t;if(!u)return o.NextResponse.json({ok:!1,error:"Missing KEYCRM_API_TOKEN env"},{status:500});if(!function(e){if(!l)return!0;let t=new URL(e.url),r=e.headers.get("authorization")?.replace(/^Bearer\s+/i,""),s=t.searchParams.get("admin")||t.searchParams.get("token"),a=e.headers.get("x-admin-pass");return r===l||s===l||a===l}(e))return o.NextResponse.json({ok:!1,error:"Unauthorized"},{status:401});let r=new URL(e.url).searchParams,s=r.get("pipeline_id")??r.get("pipelineId")??r.get("id")??void 0,a=new URL(s?`${c}/pipelines/${encodeURIComponent(s)}/cards`:`${c}/pipelines/cards`),n=r.get("page[number]")??r.get("page")??r.get("pageNumber")??void 0,i=r.get("page[size]")??r.get("per_page")??r.get("pageSize")??void 0;a.searchParams.set("page[number]",n??"1"),a.searchParams.set("page[size]",i??"50");let p=r.get("filter[status_id]")??r.get("status_id")??r.get("statusId")??void 0;p&&a.searchParams.set("filter[status_id]",p);let d=r.get("filter[pipeline_id]")??(s?null:r.get("pipeline_id"));d&&a.searchParams.set("filter[pipeline_id]",d);let g=new Set(["contact","contact.client","status","contactCount","statusCount","manager","managerCount","payments","paymentsCount","products","productsCount","products.offer","customFields","customFieldsCount"]),m=r.getAll("include[]").filter(e=>g.has(e)),h=r.getAll("with[]").filter(e=>g.has(e)),f=m.length>0?m:["contact","contact.client","status"];for(let e of f)a.searchParams.append("include[]",e);for(let e of h.length>0?h:f)a.searchParams.append("with[]",e);let P=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${u}`,Accept:"application/json"},cache:"no-store"}),v=await P.text();try{t=JSON.parse(v)}catch{t=v}return o.NextResponse.json({ok:P.ok,status:P.status,url:a.toString(),data:t},{status:P.ok?200:P.status})}catch(e){return o.NextResponse.json({ok:!1,error:e?.message??"failed"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/keycrm/pipelines/cards/route",pathname:"/api/keycrm/pipelines/cards",filename:"route",bundlePath:"app/api/keycrm/pipelines/cards/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/keycrm/pipelines/cards/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f}=g,P="/api/keycrm/pipelines/cards/route";function v(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972],()=>r(2124));module.exports=s})();