"use strict";(()=>{var e={};e.id=5736,e.ids=[5736],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1483:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>b,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var a={};r.r(a),r.d(a,{GET:()=>f,dynamic:()=>u});var s=r(9303),i=r(8716),n=r(670),o=r(7070);let u="force-dynamic",p=process.env.KEYCRM_API_URL?.replace(/\/+$/,"")||"https://openapi.keycrm.app/v1",c=process.env.KEYCRM_BEARER||process.env.KEYCRM_API_TOKEN;async function l(e,t){let r=new URL(`${p}${e}`);t&&Object.entries(t).forEach(([e,t])=>{null!=t&&""!==t&&r.searchParams.set(e,String(t))});let a=await fetch(r.toString(),{headers:{Authorization:`Bearer ${function(){if(!c)throw Error("KEYCRM token is not set (KEYCRM_BEARER або KEYCRM_API_TOKEN)");return c}()}`,"Content-Type":"application/json"},cache:"no-store"}),s=await a.text();if(!a.ok)throw Error(`KeyCRM ${a.status} ${a.statusText} at ${r} :: ${s.slice(0,400)}`);try{return JSON.parse(s)}catch{return s}}async function d(e){return l("/pipelines/cards",e)}async function m(e){return l(`/pipelines/cards/${e}`)}async function f(e){try{let t=new URL(e.url),r=(t.searchParams.get("full_name")||"").trim(),a=t.searchParams.get("pipeline_id")?Number(t.searchParams.get("pipeline_id")):void 0,s=t.searchParams.get("status_id")?Number(t.searchParams.get("status_id")):void 0,i=Number(t.searchParams.get("per_page")||50),n=Number(t.searchParams.get("max_pages")||60);if(!r)return o.NextResponse.json({ok:!1,error:"full_name is required"},{status:400});let u=function(e){let t=e.trim().toLowerCase();return[`чат з ${t}`,`chat with ${t}`,t]}(r),p=1,c=0,l=1,f=0,h=null,y=null;for(;p<=n;){let e=await d({page:p,per_page:i,pipeline_id:a,status_id:s}).catch(()=>null);if(!e)break;for(let t of(l=Number(e.last_page??l),Array.isArray(e.data)?e.data:[])){f++;let e=String(t?.title??"").toLowerCase();if(u.some(t=>e.includes(t))){h=Number(t.id),y={id:t.id,pipeline_id:t.pipeline_id,status_id:t.status_id,title:t.title};break}}if(c++,h||++p>l)break}let _=null;return h&&(_=await m(h).catch(()=>null)),o.NextResponse.json({ok:!0,found_card_id:h,found:_||y,used:{full_name:r,variants:u,pipeline_id:a,status_id:s,per_page:i,max_pages:n},stats:{scanned:f,pages_used:c,last_page:l}})}catch(e){return o.NextResponse.json({ok:!1,error:String(e?.message||e)},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/keycrm/ops/find-by-title/route",pathname:"/api/keycrm/ops/find-by-title",filename:"route",bundlePath:"app/api/keycrm/ops/find-by-title/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/keycrm/ops/find-by-title/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:g}=h,R="/api/keycrm/ops/find-by-title/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(1483));module.exports=a})();