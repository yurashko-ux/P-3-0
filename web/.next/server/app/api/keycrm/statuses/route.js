"use strict";(()=>{var e={};e.id=8953,e.ids=[8953],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2631:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>A,patchFetch:()=>j,requestAsyncStorage:()=>S,routeModule:()=>_,serverHooks:()=>x,staticGenerationAsyncStorage:()=>$});var r={};n.r(r),n.d(r,{GET:()=>v});var i=n(9303),a=n(8716),s=n(670),o=n(7070);let u=process.env.KV_REST_API_URL||"",l=process.env.KV_REST_API_TOKEN||"";async function p(e){if(!u||!l)return null;try{let t=await fetch(`${u}/get/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${l}`},cache:"no-store"});if(!t.ok)return null;let n=await t.json().catch(()=>null);return n&&"string"==typeof n.result?n.result:null}catch{return null}}async function c(e,t,n=600){if(u&&l)try{await fetch(`${u}/set/${encodeURIComponent(e)}`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"content-type":"application/json"},body:JSON.stringify({value:JSON.stringify(t),expiration:n})})}catch{}}function d(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){let t=[e],n=new Set([e]);for(;t.length;)for(let e of Object.values(t.shift())){if(Array.isArray(e))return e;e&&"object"==typeof e&&!n.has(e)&&(n.add(e),t.push(e))}}return[]}function f(e,t){let n=[];for(let r of e){let e=r?.id??r?.status_id??r?.value??r?.key??r?.uuid,i=r?.pipeline_id??r?.pipelineId??r?.pipeline??t??"",a=r?.title??r?.name??r?.label??(null!=e?`#${e}`:"");null!=e&&n.push({id:String(e),pipeline_id:String(i??""),title:String(a)})}return[...new Map(n.map(e=>[e.id,e])).values()]}let h=(process.env.KEYCRM_API_URL||"").replace(/\/+$/,""),y=process.env.KEYCRM_BEARER||"";async function m(e){let t=await fetch(e,{headers:{Authorization:`Bearer ${y}`},cache:"no-store"});if(!t.ok)return null;try{return await t.json()}catch{return null}}async function g(){return h&&y?f(d(await m(`${h}/statuses`))):[]}async function w(e){if(!h||!y)return[];let t=f(d(await m(`${h}/statuses?pipeline_id=${encodeURIComponent(e)}`)));return t.length?t.map(t=>({...t,pipeline_id:t.pipeline_id||e})):f(d(await m(`${h}/pipelines/${encodeURIComponent(e)}/statuses`)),e)}async function R(){if(!h||!y)return[];let e=d(await m(`${h}/pipelines`)),t=[];for(let n of e){let e=n?.id??n?.value??n?.key??n?.uuid,r=n?.title??n?.name??n?.label??(null!=e?`#${e}`:"");null!=e&&t.push({id:String(e),title:String(r)})}return[...new Map(t.map(e=>[e.id,e])).values()]}async function v(e){let t=new URL(e.url).searchParams.get("pipeline_id")||void 0,n="keycrm:statuses";if(t){let e=await w(t);if(e.length)return o.NextResponse.json(e,{status:200});let r=await p(n);if(r)try{let e=JSON.parse(r);return o.NextResponse.json(e.filter(e=>e.pipeline_id===String(t)))}catch{}return o.NextResponse.json([],{status:200})}let r=await g();if(!r.length){let e=await R(),t=[];for(let n of e)for(let e of(await w(n.id)))t.push({...e,pipeline_id:e.pipeline_id||n.id});r=t}if(r.length)await c(n,r,600).catch(()=>{});else{let e=await p(n);if(e)try{let t=JSON.parse(e);return o.NextResponse.json(t)}catch{}}return o.NextResponse.json(r)}let _=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/keycrm/statuses/route",pathname:"/api/keycrm/statuses",filename:"route",bundlePath:"app/api/keycrm/statuses/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/keycrm/statuses/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:S,staticGenerationAsyncStorage:$,serverHooks:x}=_,A="/api/keycrm/statuses/route";function j(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:$})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>n(2631));module.exports=r})();