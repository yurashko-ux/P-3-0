(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[471],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},2298:(e,r,t)=>{"use strict";t.r(r),t.d(r,{ComponentMod:()=>E,default:()=>x});var s={};t.r(s),t.d(s,{GET:()=>h,POST:()=>d,runtime:()=>p});var n={};t.r(n),t.d(n,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>k});var o=t(2680),a=t(5514),u=t(2860),c=t(2113),i=t(5492);let p="edge";async function d(e){if(!function(e){if("1"===e.headers.get("x-vercel-cron"))return!0;let r=e.nextUrl.searchParams.get("secret"),t=process.env.CRON_SECRET||"";return!!t&&!!r&&t===r}(e))return i.xk.json({ok:!1,error:"forbidden"},{status:403});let r=process.env.ADMIN_PASS||"",t=process.env.VERCEL_URL||e.headers.get("x-forwarded-host")||e.headers.get("host");if(!t)return i.xk.json({ok:!1,error:"no vercel url"},{status:500});if(!r)return i.xk.json({ok:!1,error:"missing ADMIN_PASS"},{status:500});let s=`https://${t}`,n=`${s}/api/keycrm/sync?per_page=50&max_pages=3`;try{let e=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${r}`}}),t=await e.json().catch(()=>({}));return i.xk.json({ok:e.ok,status:e.status,sync:t},{status:e.ok?200:e.status})}catch(e){return i.xk.json({ok:!1,error:String(e)},{status:500})}}async function h(e){return d(e)}let l=new a.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/cron/sync/route",pathname:"/api/cron/sync",filename:"route",bundlePath:"app/api/cron/sync/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/cron/sync/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:k,serverHooks:y}=l,_="/api/cron/sync/route";function g(){return(0,c.XH)({serverHooks:y,staticGenerationAsyncStorage:k})}let E=n,x=o.a.wrap(l)}},e=>{var r=r=>e(e.s=r);e.O(0,[90],()=>r(2298));var t=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/cron/sync/route"]=t}]);
//# sourceMappingURL=route.js.map