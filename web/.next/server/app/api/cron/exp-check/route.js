"use strict";(()=>{var e={};e.id=2885,e.ids=[2885,6071],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2336:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>x,patchFetch:()=>k,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{GET:()=>u,POST:()=>m,dynamic:()=>d,runtime:()=>p});var s=a(9303),i=a(8716),n=a(670),o=a(7070),c=a(4332),l=a(363);let p="nodejs",d="force-dynamic";async function u(e){return m(e)}async function m(e){if(console.log("[exp-check] POST request received"),!function(e){if("1"===e.headers.get("x-vercel-cron"))return!0;let t=e.nextUrl.searchParams.get("secret"),a=process.env.CRON_SECRET||"";return!!a&&!!t&&a===t}(e))return console.log("[exp-check] Request forbidden - not a valid cron request"),o.NextResponse.json({ok:!1,error:"forbidden"},{status:403});console.log("[exp-check] Request authorized, starting exp check");try{let{clearCardsCache:e}=await Promise.resolve().then(a.bind(a,363));e();let t=await c.kvRead.listCampaigns();console.log(`[exp-check] Found ${t.length} total campaigns`);let r=[],s=0,i=0,n=[];for(let e of t){if(e.deleted||!1===e.active){console.log(`[exp-check] Skipping campaign ${e.id}: deleted=${e.deleted}, active=${e.active}`);continue}console.log(`[exp-check] Processing campaign ${e.id} (${e.name})`);try{let t=await (0,l.w)(e);r.push(t),s+=t.cardsChecked,i+=t.cardsMoved,n.push(...t.errors),console.log(`[exp-check] Campaign ${e.id} result:`,{cardsChecked:t.cardsChecked,cardsMoved:t.cardsMoved,errors:t.errors.length})}catch(t){console.error(`[exp-check] Error processing campaign ${e.id}:`,t),n.push(`Campaign ${e.id}: ${t instanceof Error?t.message:String(t)}`)}}let p={ok:!0,timestamp:new Date().toISOString(),summary:{campaignsChecked:r.length,totalCardsChecked:s,totalCardsMoved:i,errorsCount:n.length},results:r,errors:n.length>0?n:void 0};return console.log("[exp-check] Exp check completed:",p.summary),o.NextResponse.json(p)}catch(e){return console.error("[exp-check] Fatal error:",e),o.NextResponse.json({ok:!1,error:String(e),timestamp:new Date().toISOString()},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cron/exp-check/route",pathname:"/api/cron/exp-check",filename:"route",bundlePath:"app/api/cron/exp-check/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/cron/exp-check/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y}=h,x="/api/cron/exp-check/route";function k(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},363:(e,t,a)=>{a.d(t,{clearCardsCache:()=>c,w:()=>d});var r=a(1964),s=a(4332),i=a(7756),n=a(6071);let o=new Map;function c(){o.clear(),console.log("[exp-check] Cards cache cleared")}async function l(e,t,a=50,s=20,i=!0){let n=`${e}:${t}`;if(i&&o.has(n))return console.log(`[exp-check] getCardsFromBasePipeline: Using cached result for ${n}`,{cachedCardsCount:o.get(n).length}),o.get(n);let c=[];console.log("[exp-check] getCardsFromBasePipeline: Starting fetch",{pipelineId:e,statusId:t,perPage:a,maxPages:s});for(let i=1;i<=s;i++){let s;i>1&&await new Promise(e=>setTimeout(e,200));let n=new URLSearchParams;for(let r of(n.set("page[number]",String(i)),n.set("page[size]",String(a)),null!=t&&n.set("filter[status_id]",String(t)),null!=e&&n.set("filter[pipeline_id]",String(e)),["contact","contact.client","status"]))n.append("include[]",r),n.append("with[]",r);let o=(0,r.Qv)(`/pipelines/cards?${n.toString()}`);console.log(`[exp-check] getCardsFromBasePipeline: Fetching page ${i}`,{url:o});let l=3,p=null;for(;l>0;)try{if(s=await fetch(o,{headers:(0,r.xD)(),cache:"no-store"}),429===s.status){let e=s.headers.get("Retry-After"),t=e?1e3*parseInt(e,10):2e3;console.log(`[exp-check] getCardsFromBasePipeline: Rate limited, waiting ${t}ms before retry`),await new Promise(e=>setTimeout(e,t)),l--;continue}break}catch(e){p=e instanceof Error?e:Error(String(e)),--l>0&&(console.log("[exp-check] getCardsFromBasePipeline: Request failed, retrying...",{error:p.message}),await new Promise(e=>setTimeout(e,1e3)))}if(!s)throw p||Error("Failed to fetch after retries");if(!s.ok){if(console.log("[exp-check] getCardsFromBasePipeline: API error",{page:i,status:s.status,statusText:s.statusText}),404===s.status||i>1)break;if(429===s.status)throw Error("KeyCRM API rate limit exceeded. Please try again later.");throw Error(`KeyCRM API error: ${s.status} ${s.statusText}`)}let d=await s.json(),u=Array.isArray(d)?d:Array.isArray(d?.data)?d.data:[];if(console.log(`[exp-check] getCardsFromBasePipeline: Page ${i} returned ${u.length} items`),0===u.length)break;let m=0,h=0;for(let e of u){let a=e?.id??e?.card_id;if(a&&"number"==typeof a){let r=e?.status_id??e?.statusId??e?.status?.id??e?.status??e?.pipeline_status_id??e?.pipelineStatusId,s=null;if(null!=r){if("number"==typeof r&&Number.isFinite(r))s=r;else if("string"==typeof r){let e=Number(r);Number.isFinite(e)&&(s=e)}}if(null===s||s!==t){++h<=3&&console.log(`[exp-check] getCardsFromBasePipeline: Skipping card ${a} - status mismatch`,{cardStatusId:r,cardStatusIdNum:s,expectedStatusId:t,hasStatus:null!=r,cardKeys:Object.keys(e)});continue}c.push({id:a,...e}),m++}}if(h>0&&console.log(`[exp-check] getCardsFromBasePipeline: Page ${i} - skipped ${h} cards due to status mismatch`),console.log(`[exp-check] getCardsFromBasePipeline: Page ${i} - filtered ${m} cards (from ${u.length} total), total in cache: ${c.length}`),!(d?.links?.next||d?.next_page_url||(d?.meta?.current_page??d?.current_page??i)<(d?.meta?.last_page??d?.last_page??i)))break}return console.log(`[exp-check] getCardsFromBasePipeline: Total cards found: ${c.length}`),i&&(o.set(n,c),console.log(`[exp-check] getCardsFromBasePipeline: Cached result for ${n}`)),c}async function p(e){let t;let a=3,s=null;for(;a>0;)try{if(t=await fetch((0,r.Qv)(`/pipelines/cards/${e}`),{headers:(0,r.xD)(),cache:"no-store"}),429===t.status){let r=t.headers.get("Retry-After"),s=r?1e3*parseInt(r,10):2e3;console.log(`[exp-check] getCardDetails: Rate limited for card ${e}, waiting ${s}ms before retry`),await new Promise(e=>setTimeout(e,s)),a--;continue}break}catch(e){s=e instanceof Error?e:Error(String(e)),--a>0&&await new Promise(e=>setTimeout(e,1e3))}if(!t)throw s||Error("Failed to fetch card details after retries");if(!t.ok){if(429===t.status)throw Error("KeyCRM API rate limit exceeded. Please try again later.");throw Error(`Failed to get card details: ${t.status}`)}return await t.json()}async function d(e){let t={campaignId:e.id||"",campaignName:e.name||"Unknown",cardsChecked:0,cardsMoved:0,errors:[]};try{let r=e.expDays??e.expireDays??e.exp??e.vexp??e.expire,o="string"==typeof r?Number(r):r;if(console.log(`[exp-check] Campaign ${e.id} (${e.name}): Checking EXP configuration`,{expDays:o,expDaysType:typeof o,expDaysRaw:r,expDaysRawType:typeof r,hasExpDays:"expDays"in e,hasExpireDays:"expireDays"in e,hasExp:"exp"in e,hasVexp:"vexp"in e,hasExpire:"expire"in e,expDaysValue:e.expDays,expValue:e.exp}),null==o||"number"!=typeof o||isNaN(o)||o<0)return console.log(`[exp-check] Campaign ${e.id}: No valid EXP configuration, skipping`,{expDays:o,expDaysType:typeof o,expDaysRaw:r,expDaysRawType:typeof r}),t;let c=e.texp,d=c?.pipelineId||c?.pipeline,u=c?.statusId||c?.status;if(console.log(`[exp-check] Campaign ${e.id}: Checking texp configuration`,{hasTexp:!!c,texpPipelineId:d,texpStatusId:u,texp:c}),!c||!d||!u)return console.log(`[exp-check] Campaign ${e.id}: No valid texp configuration, skipping`,{texp:c,texpPipelineId:d,texpStatusId:u}),t;let m=e.base?.pipelineId||e.base?.pipeline||e.base_pipeline_id,h=e.base?.statusId||e.base?.status||e.base_status_id;if(console.log(`[exp-check] Campaign ${e.id} (${e.name}):`,{expDays:o,hasTexp:!!c,texpPipelineId:c?.pipelineId,texpStatusId:c?.statusId,basePipelineId:m,baseStatusId:h,base:e.base}),!m||!h)return console.log(`[exp-check] Campaign ${e.id}: Missing base pipeline/status`,{basePipelineId:m,baseStatusId:h,base:e.base}),t;let g=Number(m),f=Number(h);if(!Number.isFinite(g)||!Number.isFinite(f))return console.log(`[exp-check] Campaign ${e.id}: Invalid base pipeline/status IDs`,{basePipelineId:m,baseStatusId:h,basePipelineIdNum:g,baseStatusIdNum:f}),t;console.log(`[exp-check] Campaign ${e.id}: Fetching cards from base pipeline`,{basePipelineIdNum:g,baseStatusIdNum:f}),console.log(`[exp-check] Campaign ${e.id}: Fetching cards from base pipeline`,{basePipelineId:g,baseStatusId:f,expDays:o,isImmediate:0===o});let y=await l(g,f);t.cardsChecked=y.length,console.log(`[exp-check] Campaign ${e.id}: Found ${y.length} cards in base pipeline/status`,{basePipelineId:g,baseStatusId:f,expDays:o,isImmediate:0===o});let x=Date.now(),k=0===o,$=864e5*o,w=String(d),v=String(u);for(let a=0;a<y.length;a++){let r=y[a];a>0&&y.length>20&&await new Promise(e=>setTimeout(e,100));try{let a=String(r.id),s=null,o=await (0,n.Jw)(e.id,a);if(o)s=o.timestamp;else if((r.updated_at||r.updatedAt||r.updated)&&(s=(0,n.AK)(r))&&console.log(`[exp-check] Campaign ${e.id}: Using timestamp from card object for card ${a}`),!s)try{let e=await p(r.id);s=(0,n.AK)(e)}catch(r){let e=r instanceof Error?r.message:String(r);t.errors.push(`Card ${a}: failed to get timestamp (${e})`);continue}let l=!1;if(k)l=!0,console.log(`[exp-check] Campaign ${e.id}: EXP=0 - will move card ${a} immediately`);else{if(!s)continue;x-s>=$&&(l=!0)}if(l)try{let r=await (0,i.$j)({cardId:a,pipelineId:w,statusId:v,pipelineStatusId:c.pipelineStatusId?String(c.pipelineStatusId):null,statusAliases:Array.isArray(c.statusAliases)?c.statusAliases.map(String):[]});r.ok?(t.cardsMoved++,console.log(`[exp-check] Campaign ${e.id}: Successfully moved card ${a} to EXP target`),await (0,n.Kq)(e.id,a)):t.errors.push(`Card ${a}: move failed (status ${r.status})`)}catch(e){t.errors.push(`Card ${a}: move error - ${e instanceof Error?e.message:String(e)}`)}}catch(e){t.errors.push(`Card ${r.id}: check error - ${e instanceof Error?e.message:String(e)}`)}}if(t.cardsMoved>0)try{let r=[s.campaignKeys.ITEM_KEY(e.id),s.campaignKeys.CMP_ITEM_KEY(e.id),s.campaignKeys.LEGACY_ITEM_KEY(e.id)],i=null,n=null;for(let t of r){let a=await s.kvRead.getRaw(t);if(a)try{let r=JSON.parse(a);if(r&&(r.id===e.id||r.name)){i=r,n=t,console.log(`[exp-check] Campaign ${e.id}: Found campaign data in key ${t}`);break}}catch{}}if(!i)return console.warn(`[exp-check] Campaign ${e.id}: Campaign not found in any KV key for counter update`),t;let o="number"==typeof i.exp_count?i.exp_count:0,c=o+t.cardsMoved;i.exp_count=c;let l=i.counters?.v1||i.v1_count||0,p=i.counters?.v2||i.v2_count||0,d=i.exp_count;i.counters||(i.counters={v1:0,v2:0,exp:0}),i.counters.exp=d,i.counters.v1=l,i.counters.v2=p,i.movedTotal=l+p+d,i.movedV1=l,i.movedV2=p,i.movedExp=d,console.log(`[exp-check] Campaign ${e.id}: Updated counters after moving ${t.cardsMoved} cards`,{oldExpCount:o,newExpCount:c,expCount:d,movedTotal:i.movedTotal,cardsMoved:t.cardsMoved,foundKey:n});let u=r.map(async t=>{try{await s.kvWrite.setRaw(t,JSON.stringify(i)),console.log(`[exp-check] Campaign ${e.id}: Saved to key ${t}`)}catch(a){console.warn(`[exp-check] Campaign ${e.id}: Failed to save to key ${t}`,a)}});await Promise.all(u);try{let{kv:e}=await Promise.all([a.e(242),a.e(7560)]).then(a.bind(a,7560));for(let t of r)try{await e.set(t,i)}catch{}}catch{}console.log(`[exp-check] Campaign ${e.id}: Saved updated campaign to all KV keys`)}catch(a){console.error(`[exp-check] Campaign ${e.id}: Error updating exp_count`,a),t.errors.push(`Failed to update counters: ${a instanceof Error?a.message:String(a)}`)}}catch(e){t.errors.push(`Campaign check error: ${e instanceof Error?e.message:String(e)}`)}return t}},6071:(e,t,a)=>{a.d(t,{AK:()=>o,Jw:()=>i,Kq:()=>n,saveExpTracking:()=>s});var r=a(4332);async function s(e,t,a,s){try{let i=r.expTrackingKeys.TRACK_KEY(e,t),n={timestamp:Date.now(),campaignId:e,cardId:t,basePipelineId:a,baseStatusId:s};await r.kvWrite.setRaw(i,JSON.stringify(n))}catch(e){}}async function i(e,t){try{let a=r.expTrackingKeys.TRACK_KEY(e,t),s=await r.kvRead.getRaw(a);if(!s)return null;let i=JSON.parse(s);if("number"==typeof i.timestamp&&i.campaignId&&i.cardId)return i;return null}catch{return null}}async function n(e,t){try{let a=r.expTrackingKeys.TRACK_KEY(e,t);await r.kvWrite.setRaw(a,"").catch(()=>{})}catch{}}function o(e){if(!e||"object"!=typeof e)return null;for(let t of["updated_at","updatedAt","updated","created_at","createdAt","created"]){let a=e[t];if(null!=a){if("number"==typeof a)return a<1e12?1e3*a:a;if("string"==typeof a){let e=Date.parse(a);if(!isNaN(e))return e}}}return null}},7756:(e,t,a)=>{a.d(t,{$j:()=>m,kg:()=>o,st:()=>n});var r=a(1964);let s=(e,t)=>`${e.replace(/\/+$/,"")}/${t.replace(/^\/+/,"")}`,i=e=>{let t=new Set,a=[];for(let r of e)t.has(r)||(t.add(r),a.push(r));return a},n=e=>{if(!e)return[];let t=e.trim().replace(/\s+/g,""),a=[],r=e=>{e&&a.push(e.replace(/\/+$/,""))},s=(e,t)=>{let a=t.replace(/\/+$/,"");a?(a.startsWith("/")||(a=`/${a}`),/\/api$/i.test(a)?a=`${a}/v1`:/\/v\d+$/i.test(a)||(a=`${a}/v1`)):a="/v1",r(`${e}${a}`),/\/api\/v\d+$/i.test(a)?r(`${e}${a.replace(/\/api(\/v\d+)$/i,"$1")}`):/\/v\d+$/i.test(a)&&r(`${e}/api${a}`)};try{let e=new URL(t);s(e.origin,e.pathname)}catch{try{let e=new URL(`https://${t}`);s(e.origin,e.pathname)}catch{r(`${t.replace(/\/+$/,"")}/v1`),r(`${t.replace(/\/+$/,"")}/api/v1`)}}return i(a)},o=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return String(e);if("string"==typeof e){let t=e.trim();return t.length?t:null}return null},c=e=>{let t=Number(e);return Number.isFinite(t)?t:e},l=e=>{let t=Array.isArray(e?.data)?e?.data[0]:e?.data??(Array.isArray(e)?e[0]:e),a=t&&"object"==typeof t&&"attributes"in t?t.attributes:t,r=t&&"object"==typeof t&&"relationships"in t?t.relationships:void 0;return{pipelineId:o(a?.pipeline_id)??o(a?.pipelineId)??o(a?.pipeline?.id)??o(t?.pipeline_id)??o(t?.pipelineId)??o(t?.pipeline?.id)??o(r?.pipeline?.data?.id)??o(r?.pipelines?.data?.id),statusId:o(a?.status_id)??o(a?.pipeline_status_id)??o(a?.statusId)??o(a?.status?.id)??o(t?.status_id)??o(t?.pipeline_status_id)??o(t?.statusId)??o(t?.status?.id)??o(r?.status?.data?.id)??o(r?.pipeline_status?.data?.id)??o(r?.pipeline_statuses?.data?.id),raw:e}},p=async(e,t,a)=>{let r=[`/pipelines/cards/${encodeURIComponent(a)}`,`/crm/deals/${encodeURIComponent(a)}`],i=["with[]=status&with[]=pipeline&include[]=status&include[]=pipeline",""];for(let a of r)for(let r of i){let i=r?`${a}${a.includes("?")?"&":"?"}${r}`:a;try{let a=await fetch(s(e,i),{headers:{Authorization:t,Accept:"application/json"},cache:"no-store"});if(!a.ok)continue;let r=await a.text();if(!r)return{pipelineId:null,statusId:null,raw:null};try{let e=JSON.parse(r);return l(e)}catch{return{pipelineId:null,statusId:null,raw:r}}}catch{continue}}return null},d=e=>new Promise(t=>setTimeout(t,e)),u=(e,t,a,r)=>{e.push({step:t,info:a??null,data:r,timestamp:Date.now()})};async function m({cardId:e,pipelineId:t,statusId:a,pipelineStatusId:i=null,statusAliases:l=[]}){let m=[],h=Error("moveKeycrmCard trace").stack??null;u(m,"moveKeycrmCard:start",null,{cardId:e,pipelineId:t,statusId:a,pipelineStatusId:i,statusAliases:l});let g=(0,r.SJ)("KEYCRM_API_URL","KEYCRM_API_BASE","KEYCRM_BASE_URL")??(0,r.Rv)(),f=(0,r.SJ)("KEYCRM_API_TOKEN","KEYCRM_TOKEN")??(0,r.Ls)(),y=(0,r.SJ)("KEYCRM_BEARER","KEYCRM_API_BEARER")??(0,r.Ls)(),x="";x=y?y.toLowerCase().startsWith("bearer ")?y:`Bearer ${y}`:f?`Bearer ${f}`:(0,r.hC)();let k=n(g);if(u(m,"moveKeycrmCard:credentials",null,{hasBase:!!g,baseCandidates:k,hasToken:!!(f||y),authorizationLength:x.length,authorizationPrefix:x.substring(0,20)+"..."}),!x||0===k.length)throw Object.assign(Error("KeyCRM credentials are missing"),{code:"keycrm_not_configured",details:{base:!!g,token:!!(f||y),baseCandidate:g,tokenCandidate:f?"***":null,bearerCandidate:y?"***":null}});x.includes(r.Nd.API_TOKEN)&&(console.warn("[keycrm-move] ⚠️ Використовується дефолтний токен KeyCRM! Перевірте змінні середовища KEYCRM_API_TOKEN або KEYCRM_BEARER в Vercel"),u(m,"moveKeycrmCard:warning","default_token_used",{message:"Використовується дефолтний токен, який може бути недійсним"}));let $=o(e);if(!$)throw Object.assign(Error("card_id required"),{code:"card_id_missing"});let w=o(t),v=o(a),b=o(i),C=Array.isArray(l)?Array.from(new Set([b,...l.map(e=>o(e))].filter(e=>!!e))):[];if(!w&&!v)throw Object.assign(Error("to_pipeline_id or to_status_id required"),{code:"target_missing"});let _=w?c(w):void 0,R=b?c(b):void 0,E=v?c(v):void 0,S=C.find(e=>e!==v),P=null!=S?c(S):void 0,I=E??P;c($);let A=[],K=async(e,t)=>{let a=s(t,e.path),r={Authorization:x,Accept:"application/json","Content-Type":e.contentType},i=JSON.stringify(e.body);u(m,"performAttempt:start",e.attempt,{base:t,url:a,method:e.method,headers:r,body:e.body});let n=await fetch(a,{method:e.method,headers:r,body:i,cache:"no-store"}),o=await n.text(),c=null;if(o)try{c=JSON.parse(o)}catch{c=o}let l=[];if(u(m,"performAttempt:response",e.attempt,{status:n.status,ok:n.ok,raw:o}),n.ok)for(let a=0;a<20;a+=1){0===a?await d(300):await d(500);let r=await p(t,x,$),s=!w||r?.pipelineId===w,i=[b,v,...C],n=0===i.length||i.some(e=>r?.statusId===e);if(l.push({snapshot:r,pipelineMatches:s,statusMatches:n}),u(m,"performAttempt:verification",e.attempt,{attempt:a+1,pipelineMatches:s,statusMatches:n,snapshot:r}),s&&n)break}let h=n.ok&&l.some(e=>e.pipelineMatches&&e.statusMatches),g=e.body;return A.push({attempt:e.attempt,status:n.status,ok:h,body:c,sent:g,verification:l,url:a,method:e.method,requestHeaders:r,requestBodyRaw:i,responseRaw:o||null}),{ok:h,status:n.status,body:c,sent:g,verification:l,url:a,method:e.method,requestHeaders:r,requestBodyRaw:i,responseRaw:o||null}},T=[],M={};void 0!==_&&(M.pipeline_id=_,M.to_pipeline_id=_),void 0!==R&&(M.pipeline_status_id=R),void 0!==I&&(M.status_id=I,M.to_status_id=I),T.push({attempt:"pipelines/cards/{id} PUT",method:"PUT",path:`/pipelines/cards/${encodeURIComponent($)}`,contentType:"application/json",body:M});let N=null;for(let e of k){let t=e.replace(/\/+$/,"");for(let e of T)try{let a=await K(e,t);if(N={...a,attemptName:e.attempt,base:t},A.push({attempt:e.attempt,status:a.status,ok:a.ok,body:a.body,sent:e.body,verification:a.verification,url:a.url,method:e.method,requestHeaders:a.requestHeaders,requestBodyRaw:a.requestBodyRaw,responseRaw:a.responseRaw}),a.ok)return u(m,"moveKeycrmCard:success",e.attempt,{status:a.status,base:t}),{ok:!0,status:a.status,response:{attempt:e.attempt,body:a.body,history:A},sent:e.body,attempts:a.verification,requestUrl:a.url,requestMethod:e.method,baseUrl:t,requestHeaders:a.requestHeaders,requestBodyRaw:a.requestBodyRaw,responseRaw:a.responseRaw,trace:m,stack:h};if(401===a.status){u(m,"moveKeycrmCard:unauthorized",e.attempt,{status:a.status,base:t});continue}}catch(a){u(m,"performAttempt:error",e.attempt,{base:t,error:a instanceof Error?a.message:String(a)}),A.push({attempt:e.attempt,status:0,ok:!1,body:null,sent:e.body,verification:[],url:s(t,e.path),method:e.method,error:a instanceof Error?a.message:String(a)})}}let F=N?.base??k[0]?.replace(/\/+$/,"")??"",q=N?.sent??T[0]?.body??M,B=N?.status??0,O=N?.body??null,j=A.at(-1)?.attempt??N?.attemptName??T[0]?.attempt??"unknown",D=N?.verification??[],U=N?.url??s(F,T[0]?.path??""),Y=N?.method??T[0]?.method??"POST",J=N?.requestHeaders??null,L=N?.requestBodyRaw??null,V=N?.responseRaw??null;return u(m,"moveKeycrmCard:failure",j,{status:B,base:F,url:U}),{ok:!1,status:B,response:{attempt:j,body:O,history:A},sent:q,attempts:D,requestUrl:U,requestMethod:Y,baseUrl:F,requestHeaders:J,requestBodyRaw:L,responseRaw:V,trace:m,stack:h}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,4332],()=>a(2336));module.exports=r})();