"use strict";(()=>{var e={};e.id=4211,e.ids=[4211],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6235:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h});var a={};s.r(a),s.d(a,{GET:()=>u,dynamic:()=>l,runtime:()=>d});var r=s(9303),o=s(8716),i=s(670),n=s(7070);let l="force-dynamic",d="nodejs";async function u(e){try{let t=e.nextUrl.searchParams.get("instagram")||"mykolayyurashko",s=t.startsWith("@")?t.slice(1):t,a=process.env.MANYCHAT_API_KEY||process.env.ManyChat_API_Key||process.env.MANYCHAT_API_TOKEN||process.env.MC_API_KEY||process.env.MANYCHAT_APIKEY;if(!a)return n.NextResponse.json({ok:!1,error:"ManyChat API Key not configured",availableEnvVars:["MANYCHAT_API_KEY","ManyChat_API_Key","MANYCHAT_API_TOKEN","MC_API_KEY","MANYCHAT_APIKEY"]});let r={length:a.length,startsWith:a.substring(0,10)+"...",hasColon:a.includes(":"),parts:a.split(":").length},o=[];try{console.log("[test-detailed] ===== TEST 1: findByName (GET) ====="),console.log(`[test-detailed] Instagram: ${s}`),console.log(`[test-detailed] API Key length: ${a.length}`);let e=`https://api.manychat.com/fb/subscriber/findByName?name=${encodeURIComponent(s)}`;console.log(`[test-detailed] URL: ${e}`),console.log("[test-detailed] Headers:",{Authorization:`Bearer ${a.substring(0,10)}...`});let t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`}}),r=await t.text();console.log(`[test-detailed] Response status: ${t.status}`);let i={};t.headers.forEach((e,t)=>{i[t]=e}),console.log("[test-detailed] Response headers:",i),console.log("[test-detailed] Response text (first 500 chars):",r.substring(0,500));let n=null;try{n=JSON.parse(r),console.log("[test-detailed] Response JSON:",JSON.stringify(n,null,2))}catch(e){console.log("[test-detailed] Response is not JSON:",e),n=r}let l=n?.data?.subscriber_id||n?.subscriber_id||n?.subscriber?.id||n?.data?.id||n?.id;o.push({method:"findByName",status:t.status,statusText:t.statusText,ok:t.ok,request:{url:e,method:"GET"},response:{raw:r,parsed:n,subscriberId:l},headers:(()=>{let e={};return t.headers.forEach((t,s)=>{e[s]=t}),e})()})}catch(e){console.error("[test-detailed] findByName error:",e),o.push({method:"findByName",error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0})}try{console.log("[test-detailed] ===== TEST 2: getCustomFields =====");let e="https://api.manychat.com/fb/subscriber/getCustomFields";console.log(`[test-detailed] URL: ${e}`);let t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),s=await t.text();console.log(`[test-detailed] Response status: ${t.status}`),console.log("[test-detailed] Response text (first 1000 chars):",s.substring(0,1e3));let r=null;try{r=JSON.parse(s),console.log("[test-detailed] Response JSON:",JSON.stringify(r,null,2))}catch(e){r=s}let i=r?.data?.fields||r?.fields||[],n=i.filter(e=>e.name?.toLowerCase().includes("instagram")||e.field_id?.toLowerCase().includes("instagram")||e.label?.toLowerCase().includes("instagram")||e.id?.toString().includes("instagram"));o.push({method:"getCustomFields",status:t.status,statusText:t.statusText,ok:t.ok,response:{raw:s,parsed:r,totalFields:i.length,instagramFields:n}})}catch(e){console.error("[test-detailed] getCustomFields error:",e),o.push({method:"getCustomFields",error:e instanceof Error?e.message:String(e)})}let i=o.find(e=>"getCustomFields"===e.method&&e.ok);if(i&&i.response?.instagramFields){let e=i.response.instagramFields;for(let t of(console.log("[test-detailed] ===== TEST 3: findByCustomField with real fields ====="),console.log(`[test-detailed] Found ${e.length} Instagram-related fields`),e)){let e=t.field_id||t.id||t.name;try{console.log(`[test-detailed] Testing field: ${JSON.stringify(t,null,2)}`);let r="https://api.manychat.com/fb/subscriber/findByCustomField",i={field_id:e,field_value:s};console.log("[test-detailed] Request body:",JSON.stringify(i,null,2));let n=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await n.text();console.log(`[test-detailed] Response status: ${n.status}`),console.log("[test-detailed] Response text:",l.substring(0,500));let d=null;try{d=JSON.parse(l)}catch{d=l}let u=d?.data?.subscriber_id||d?.subscriber_id||d?.subscriber?.id;o.push({method:`findByCustomField (${e})`,status:n.status,statusText:n.statusText,ok:n.ok,request:{url:r,body:i,field:t},response:{raw:l,parsed:d,subscriberId:u}})}catch(t){console.error(`[test-detailed] findByCustomField error for ${e}:`,t),o.push({method:`findByCustomField (${e})`,error:t instanceof Error?t.message:String(t)})}}}try{console.log("[test-detailed] ===== TEST 4: findByName with full name (GET) =====");let e=`https://api.manychat.com/fb/subscriber/findByName?name=${encodeURIComponent("Микола Юрашко")}`;console.log(`[test-detailed] URL: ${e}`);let t=await fetch(e,{method:"GET",headers:{Authorization:`Bearer ${a}`}}),s=await t.text();console.log(`[test-detailed] Response status: ${t.status}`),console.log("[test-detailed] Response text:",s.substring(0,500));let r=null;try{r=JSON.parse(s)}catch{r=s}let i=r?.data?.subscriber_id||r?.subscriber_id||r?.subscriber?.id;o.push({method:"findByName (full name)",status:t.status,statusText:t.statusText,ok:t.ok,request:{url:e,method:"GET"},response:{raw:s,parsed:r,subscriberId:i}})}catch(e){console.error("[test-detailed] findByName (full name) error:",e),o.push({method:"findByName (full name)",error:e instanceof Error?e.message:String(e)})}let l=o.filter(e=>e.ok&&e.response?.subscriberId),d=l.length>0;return n.NextResponse.json({ok:!0,instagram:s,apiKeyInfo:r,found:d,successfulResults:l.map(e=>({method:e.method,subscriberId:e.response?.subscriberId})),allResults:o,summary:{totalTests:o.length,successful:l.length,failed:o.filter(e=>!e.ok||e.error).length},recommendations:d?[]:["1. Перевір, чи @"+s+" взаємодіяв з ManyChat ботом (написав повідомлення)","2. Перевір в ManyChat Dashboard → Contacts, чи є там цей контакт","3. Якщо контакт є, перевір, як саме збережений Instagram username в ManyChat","4. Можливо, потрібно використати числовий field_id замість назви поля","5. Перевір логи Vercel для детальної інформації про всі запити"]})}catch(e){return console.error("[test-detailed] Error:",e),n.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0},{status:500})}}let c=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/altegio/reminders/test-manychat-detailed/route",pathname:"/api/altegio/reminders/test-manychat-detailed",filename:"route",bundlePath:"app/api/altegio/reminders/test-manychat-detailed/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/reminders/test-manychat-detailed/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:p}=c,g="/api/altegio/reminders/test-manychat-detailed/route";function f(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>s(6235));module.exports=a})();