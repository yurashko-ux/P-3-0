"use strict";(()=>{var e={};e.id=2679,e.ids=[2679],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4390:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>l,staticGenerationAsyncStorage:()=>h});var t={};r.r(t),r.d(t,{GET:()=>b,dynamic:()=>c,runtime:()=>u});var a=r(9303),i=r(8716),o=r(670),n=r(7070);let c="force-dynamic",u="nodejs";async function d(e,s){let r=[],t=e.startsWith("@")?e.slice(1):e;try{for(let e=1;e<=3;e++){let a=`https://api.manychat.com/fb/subscriber/getSubscribers?page=${e}&limit=100`,i=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(i.ok){let s=await i.json(),a=s?.data||[],o=a.find(e=>e.ig_username?.toLowerCase().trim()===t.toLowerCase().trim());if(o){let s=o.id||o.subscriber_id;r.push({method:`getSubscribers (page ${e})`,success:!0,data:o,subscriberId:s});break}if(a.length<100)break}else{let s=await i.text();r.push({method:`getSubscribers (page ${e})`,success:!1,error:`${i.status}: ${s}`});break}}}catch(e){r.push({method:"getSubscribers",success:!1,error:e instanceof Error?e.message:String(e)})}for(let e of["ig_username","instagram_username","instagram","username","Instagram Username","Instagram"]){if(r.some(e=>e.success&&e.subscriberId))break;try{let a=await fetch("https://api.manychat.com/fb/subscriber/findByCustomField",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({field_id:e,field_value:t})});if(a.ok){let s=await a.json(),t=s?.data?.subscriber_id||s?.subscriber_id||s?.subscriber?.id;if(t){r.push({method:`findByCustomField (${e})`,success:!0,data:s,subscriberId:t});break}}else{let s=await a.text();404!==a.status&&r.push({method:`findByCustomField (${e})`,success:!1,error:`${a.status}: ${s}`})}}catch(e){}}return r}async function b(e){try{let s=e.nextUrl.searchParams.get("instagram")||"mykolayyurashko",r=s.startsWith("@")?s.slice(1):s,t=process.env.MANYCHAT_API_KEY||process.env.ManyChat_API_Key||process.env.MANYCHAT_API_TOKEN||process.env.MC_API_KEY||process.env.MANYCHAT_APIKEY;if(!t)return n.NextResponse.json({ok:!1,error:"ManyChat API Key not configured",diagnostics:{checkedVariables:["MANYCHAT_API_KEY","ManyChat_API_Key","MANYCHAT_API_TOKEN","MC_API_KEY","MANYCHAT_APIKEY"]}});let a=await d(r,t),i=a.some(e=>e.success&&e.subscriberId),o=a.find(e=>e.success&&e.subscriberId)?.subscriberId;return n.NextResponse.json({ok:!0,instagram:r,found:i,subscriberId:o||null,results:a,instructions:i?{status:"✅ Subscriber знайдено!",message:`Subscriber ID: ${o}. Тепер можна відправляти повідомлення.`}:{status:"❌ Subscriber не знайдено",message:"Користувач не взаємодіяв з ManyChat ботом. Потрібно:",steps:[`1. Відкрий Instagram на акаунті @${r}`,"2. Знайди ManyChat бот (або сторінку, яка використовує ManyChat)","3. Напиши будь-яке повідомлення боту","4. Або натисни на кнопку в автоматизації ManyChat","5. Після цього спробуй перевірити знову"]}})}catch(e){return console.error("[check-subscriber] Error:",e),n.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/altegio/reminders/check-subscriber/route",pathname:"/api/altegio/reminders/check-subscriber",filename:"route",bundlePath:"app/api/altegio/reminders/check-subscriber/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/reminders/check-subscriber/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:l}=m,g="/api/altegio/reminders/check-subscriber/route";function f(){return(0,o.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:h})}}};var s=require("../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[8948,5972],()=>r(4390));module.exports=t})();