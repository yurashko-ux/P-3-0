"use strict";(()=>{var e={};e.id=1577,e.ids=[1577],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7895:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{GET:()=>l,dynamic:()=>d,runtime:()=>u});var a=r(9303),s=r(8716),n=r(670),o=r(7070),m=r(4332);let d="force-dynamic",u="nodejs";async function l(e){try{let t=e.nextUrl.searchParams.get("limit"),r=t?Math.min(Math.max(parseInt(t,10)||50,1),200):50,i=await m.kvRead.getRaw("altegio:reminder:sent:log"),a=[];if(i)try{let e;if("string"==typeof i)try{e=JSON.parse(i)}catch{e=i}else e=i;if(e&&"object"==typeof e&&!Array.isArray(e)){let t=e.value??e.result??e.data;if(void 0!==t){if("string"==typeof t)try{e=JSON.parse(t)}catch{e=t}else e=t}}Array.isArray(e)&&(a=e)}catch(e){console.warn("[reminders/sent] Failed to parse log:",e),a=[]}let s=a.slice(0,r).map(e=>({timestamp:e.timestamp,timestampFormatted:new Date(e.timestamp).toLocaleString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),jobId:e.jobId,visitId:e.visitId,instagram:e.instagram,clientName:e.clientName,message:e.message,visitDateTime:e.visitDateTime,visitDateTimeFormatted:new Date(e.visitDateTime).toLocaleString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),ruleId:e.ruleId,success:e.result?.success??!0,messageId:e.result?.messageId,error:e.result?.error}));return o.NextResponse.json({ok:!0,count:s.length,total:a.length,logs:s})}catch(e){return console.error("[reminders/sent] Error:",e),o.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/altegio/reminders/sent/route",pathname:"/api/altegio/reminders/sent",filename:"route",bundlePath:"app/api/altegio/reminders/sent/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/reminders/sent/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:y}=p,h="/api/altegio/reminders/sent/route";function v(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,4332],()=>r(7895));module.exports=i})();