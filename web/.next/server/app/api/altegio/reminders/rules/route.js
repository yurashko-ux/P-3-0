"use strict";(()=>{var e={};e.id=4409,e.ids=[4409],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5310:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>R,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>j,staticGenerationAsyncStorage:()=>x});var a={};t.r(a),t.d(a,{GET:()=>y,POST:()=>g,dynamic:()=>d,runtime:()=>l});var s=t(9303),n=t(8716),o=t(670),i=t(7070),u=t(4332);let d="force-dynamic",l="nodejs",p="altegio:reminder:rules",c=[{id:"before_7d",daysBefore:7,active:!0,channel:"instagram_dm",template:"Нагадуємо про ваш візит {date} о {time} у Home of Beauty. Чекаємо вас! ❤️"},{id:"before_3d",daysBefore:3,active:!0,channel:"instagram_dm",template:"Через {daysLeft} дні(в) у вас запис {date} о {time}. Підготуйтеся до візиту!"},{id:"before_1d",daysBefore:1,active:!0,channel:"instagram_dm",template:"Завтра у вас візит {date} о {time}. Чекаємо вас! ❤️"}];async function m(){let e=await u.kvRead.getRaw(p);if(!e)return c;try{let r;if("string"==typeof e)try{r=JSON.parse(e)}catch{r=e}else r=e;if(r&&"object"==typeof r&&!Array.isArray(r)){let e=r.value??r.result??r.data;if(void 0!==e){if("string"==typeof e)try{r=JSON.parse(e)}catch{r=e}else r=e}}if(Array.isArray(r)&&r.length>0)return r}catch(e){console.warn("[reminders/rules] Failed to parse rules from KV:",e)}return c}async function f(e){await u.kvWrite.setRaw(p,JSON.stringify(e))}async function y(e){try{let e=await m();return i.NextResponse.json({ok:!0,rules:e})}catch(e){return console.error("[reminders/rules] Error:",e),i.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}async function g(e){try{let{rules:r}=await e.json();if(!Array.isArray(r))return i.NextResponse.json({ok:!1,error:"rules must be an array"},{status:400});for(let e of r)if(!e.id||!e.template||"number"!=typeof e.daysBefore)return i.NextResponse.json({ok:!1,error:`Invalid rule: ${JSON.stringify(e)}`},{status:400});return await f(r),i.NextResponse.json({ok:!0,message:`Updated ${r.length} reminder rules`,rules:r})}catch(e){return console.error("[reminders/rules] Error:",e),i.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/altegio/reminders/rules/route",pathname:"/api/altegio/reminders/rules",filename:"route",bundlePath:"app/api/altegio/reminders/rules/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/reminders/rules/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:j}=h,k="/api/altegio/reminders/rules/route";function R(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:x})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,4332],()=>t(5310));module.exports=a})();