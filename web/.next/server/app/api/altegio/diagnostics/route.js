"use strict";(()=>{var e={};e.id=5554,e.ids=[5554],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8891:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>P,requestAsyncStorage:()=>N,routeModule:()=>R,serverHooks:()=>I,staticGenerationAsyncStorage:()=>A});var n={};r.r(n),r.d(n,{GET:()=>l,dynamic:()=>E,runtime:()=>p});var o=r(9303),a=r(8716),i=r(670),s=r(7070),T=r(4044);let E="force-dynamic",p="nodejs";async function l(e){try{let e=process.env.ALTEGIO_COMPANY_ID||"1169323",t=(0,T.ZN)(),r=(0,T.oU)(`/company/${e}/clients`),n="not set";if(t.Authorization){let e=t.Authorization;if(e.includes("User ")){let t=e.split("User ");if(2===t.length){let e=t[1],r=e.length>14?`${e.substring(0,10)}...${e.substring(e.length-4)}`:e.substring(0,10)+"...";n=`${t[0]}User ${r}`}else n=e.substring(0,100)+"..."}else n=e.substring(0,100)+"..."}let o={timestamp:new Date().toISOString(),environment:{hasUserToken:!!T.B0.USER_TOKEN,userTokenLength:T.B0.USER_TOKEN?.length||0,userTokenPreview:T.B0.USER_TOKEN?`${T.B0.USER_TOKEN.substring(0,10)}...${T.B0.USER_TOKEN.substring(T.B0.USER_TOKEN.length-4)}`:"not set",hasPartnerToken:!!T.B0.PARTNER_TOKEN,partnerTokenLength:T.B0.PARTNER_TOKEN?.length||0,partnerTokenPreview:T.B0.PARTNER_TOKEN?`${T.B0.PARTNER_TOKEN.substring(0,10)}...${T.B0.PARTNER_TOKEN.substring(T.B0.PARTNER_TOKEN.length-4)}`:"not set",partnerTokenFull:T.B0.PARTNER_TOKEN||"not set",hasApplicationId:!!T.B0.APPLICATION_ID,applicationId:T.B0.APPLICATION_ID||"not set",hasPartnerId:!!T.B0.PARTNER_ID,partnerId:T.B0.PARTNER_ID||"not set",companyId:e,apiUrl:T.B0.API_URL},headers:{accept:t.Accept,contentType:t["Content-Type"],authorization:n,authorizationFormat:t.Authorization?t.Authorization.includes("User ")?"Bearer <PARTNER_TOKEN>, User <USER_TOKEN>":"Bearer <USER_TOKEN>":"not set",xPartnerId:t["X-Partner-ID"]||"not set",xApplicationId:t["X-Application-ID"]||"not set",partnerId:t["Partner-ID"]||"not set",allHeaderKeys:Object.keys(t)},tokenExplanation:{partnerToken:T.B0.PARTNER_TOKEN?`Bearer token (${T.B0.PARTNER_TOKEN}) - це ALTEGIO_PARTNER_TOKEN з environment variables`:"PARTNER_TOKEN не встановлено",userToken:T.B0.USER_TOKEN?`User token (${T.B0.USER_TOKEN.substring(0,10)}...${T.B0.USER_TOKEN.substring(T.B0.USER_TOKEN.length-4)}) - це ALTEGIO_USER_TOKEN з environment variables`:"USER_TOKEN не встановлено",note:"USER_TOKEN показується частково для безпеки, але він використовується в Authorization header"},testRequest:{url:r,method:"POST",endpoint:`/company/${e}/clients`},recommendations:["Перевірте, чи USER_TOKEN має права доступу до компанії в Altegio",T.B0.APPLICATION_ID?`Перевірте, чи Application ID (${T.B0.APPLICATION_ID}) правильний для вашої непублічної програми`:"Перевірте, чи Application ID встановлено в environment variables","1169323"!==e||T.B0.PARTNER_ID?`Перевірте, чи Company ID (${e}) та Partner ID (${T.B0.PARTNER_ID||"not set"}) правильні для вашої філії`:"Перевірте, чи Company ID та Partner ID правильні для вашої філії","Можливо, потрібно надати додаткові права користувачу в Altegio","Спробуйте перегенерувати USER_TOKEN в Altegio Marketplace"]};return s.NextResponse.json({ok:!0,diagnostics:o,note:"Ця інформація може бути корисна для техпідтримки Altegio"})}catch(e){return s.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let R=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/altegio/diagnostics/route",pathname:"/api/altegio/diagnostics",filename:"route",bundlePath:"app/api/altegio/diagnostics/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/diagnostics/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:N,staticGenerationAsyncStorage:A,serverHooks:I}=R,_="/api/altegio/diagnostics/route";function P(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:A})}},4044:(e,t,r)=>{r.d(t,{B0:()=>n,ZN:()=>a,cC:()=>o,oU:()=>i});let n={API_URL:process.env.ALTEGIO_API_URL?.trim()||"https://api.alteg.io/api/v1",USER_TOKEN:process.env.ALTEGIO_USER_TOKEN?.trim()||"",PARTNER_TOKEN:process.env.ALTEGIO_PARTNER_TOKEN?.trim()||"",PARTNER_ID:process.env.ALTEGIO_PARTNER_ID?.trim()||"",APPLICATION_ID:process.env.ALTEGIO_APPLICATION_ID?.trim()||""};function o(){if(!n.API_URL)throw Error("Missing env ALTEGIO_API_URL");if(!n.USER_TOKEN&&!n.PARTNER_TOKEN)throw Error("Missing env ALTEGIO_USER_TOKEN or ALTEGIO_PARTNER_TOKEN")}function a(e=!0){if(o(),!n.USER_TOKEN)throw Error("ALTEGIO_USER_TOKEN is required. Please set it in environment variables.");if(console.log("[altegio/env] Token check:",{hasUserToken:!!n.USER_TOKEN,userTokenLength:n.USER_TOKEN?.length||0,hasPartnerToken:!!n.PARTNER_TOKEN,partnerTokenLength:n.PARTNER_TOKEN?.length||0,hasApplicationId:!!n.APPLICATION_ID,applicationId:n.APPLICATION_ID||"not set",hasPartnerId:!!n.PARTNER_ID,partnerId:n.PARTNER_ID||"not set"}),n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.PARTNER_TOKEN}, User ${n.USER_TOKEN}`,t={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e},r=n.APPLICATION_ID||"",o=r||n.PARTNER_ID||"";return o&&(t["X-Partner-ID"]=o,t["Partner-ID"]=o,t["X-Partner-Id"]=o,t["X-PartnerId"]=o,r&&(t["X-Application-ID"]=r,t["Application-ID"]=r)),console.log("[altegio/env] Authorization header (with Partner Token - may be non-public):",{format:"Bearer <partner_token>, User <user_token>",programType:"Non-public (with Partner Token)",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:o||"not set",userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(t),note:"Using Partner Token with User Token (may be for non-public program)"}),t}if(!n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.USER_TOKEN}`,t=n.APPLICATION_ID||"",r=n.PARTNER_ID,o=t||r,a={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e};if(o){let e=`Bearer ${o}, User ${n.USER_TOKEN}`;a["X-Partner-ID"]=o,a["Partner-ID"]=o,a["X-Partner-Id"]=o,a["X-PartnerId"]=o,a.Authorization=e,console.log("[altegio/env] Authorization header (Non-public program - trying public format):",{format:"Bearer <application_id>, User <user_token>",programType:"Non-public",applicationId:t||"not set",partnerId:r||"not set",usingAsPartnerId:o,userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(a),note:"Trying public program format: Bearer <application_id>, User <token>"})}else console.log("[altegio/env] Authorization header (Non-public program - USER_TOKEN only):",{format:"Bearer <user_token>",programType:"Non-public",userTokenLength:n.USER_TOKEN.length,note:"Partner ID not provided - may need ALTEGIO_PARTNER_ID (Application ID)"});return a}if(n.PARTNER_TOKEN){let t=n.PARTNER_ID||n.PARTNER_TOKEN,r=[`Bearer ${n.PARTNER_TOKEN}`];e&&n.USER_TOKEN&&r.push(`User ${n.USER_TOKEN}`),t&&t!==n.PARTNER_TOKEN&&r.push(`Partner ${t}`);let o=r.join(", ");console.log("[altegio/env] Authorization header:",{format:"Bearer <partner_token>, User <user_token>",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:t,partnerIdLength:t.length,userTokenLength:n.USER_TOKEN.length,authHeaderPreview:o.substring(0,50)+"..."});let a={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:o};return t&&(a["X-Partner-ID"]=t,a["Partner-ID"]=t,a["X-Partner-Id"]=t,a["X-PartnerId"]=t,a.PartnerId=t),console.log("[altegio/env] Headers with Partner ID:",{authorization:o.substring(0,80)+"...",partnerIdHeaders:{"X-Partner-ID":a["X-Partner-ID"],"Partner-ID":a["Partner-ID"],"X-Partner-Id":a["X-Partner-Id"]},allHeaderKeys:Object.keys(a)}),a}throw Error("No valid Altegio token configured")}function i(e){let t=n.API_URL.replace(/\/+$/,""),r=e.replace(/^\/+/,"");return`${t}/${r}`}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(8891));module.exports=n})();