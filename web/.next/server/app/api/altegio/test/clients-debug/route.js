"use strict";(()=>{var e={};e.id=2388,e.ids=[2388],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},260:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>P,requestAsyncStorage:()=>T,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>E});var n={};r.r(n),r.d(n,{GET:()=>u,dynamic:()=>p,runtime:()=>c});var o=r(9303),a=r(8716),s=r(670),i=r(7070),l=r(4044);let p="force-dynamic",c="nodejs";async function u(e){try{(0,l.cC)();let e=process.env.ALTEGIO_COMPANY_ID||"1169323",t=parseInt(e,10),r=[];console.log(`[altegio/test/clients-debug] Testing company ${t}...`);try{let e=(0,l.oU)(`/company/${t}`),n=await fetch(e,{method:"GET",headers:(0,l.ZN)()}),o=await n.json().catch(()=>({}));r.push({test:"GET /company/{id}",url:e,status:n.status,statusText:n.statusText,success:n.ok,data:o}),console.log("[altegio/test/clients-debug] Company test:",{status:n.status,ok:n.ok,hasData:!!o})}catch(e){r.push({test:"GET /company/{id}",error:e instanceof Error?e.message:String(e)})}for(let e of[{name:"GET /company/{id}/clients",method:"GET",url:`/company/${t}/clients`,body:void 0},{name:"GET /clients?company_id={id}",method:"GET",url:`/clients?company_id=${t}`,body:void 0},{name:"POST /clients with company_id in body",method:"POST",url:"/clients",body:JSON.stringify({company_id:t})},{name:"POST /company/{id}/clients with empty body",method:"POST",url:`/company/${t}/clients`,body:JSON.stringify({})},{name:"GET /clients (without company_id)",method:"GET",url:"/clients",body:void 0}])try{let t;let n=(0,l.oU)(e.url),o=(0,l.ZN)(),a={method:e.method,headers:{...o,"Content-Type":"application/json"}};e.body&&(a.body=e.body),console.log(`[altegio/test/clients-debug] Testing: ${e.name}`,{url:n,method:e.method,hasBody:!!e.body});let s=await fetch(n,a),i=await s.text();try{t=JSON.parse(i)}catch{t=i}let p={};s.headers.forEach((e,t)=>{p[t]=e}),r.push({test:e.name,url:n,method:e.method,status:s.status,statusText:s.statusText,success:s.ok,headers:p,body:e.body,response:t}),console.log(`[altegio/test/clients-debug] Result for ${e.name}:`,{status:s.status,ok:s.ok,responseKeys:t&&"object"==typeof t?Object.keys(t):[]})}catch(t){r.push({test:e.name,url:e.url,error:t instanceof Error?t.message:String(t)})}return i.NextResponse.json({ok:!0,companyId:t,results:r,summary:{totalTests:r.length,successful:r.filter(e=>e.success).length,failed:r.filter(e=>!e.success&&!e.error).length,errors:r.filter(e=>e.error).length}})}catch(e){return console.error("[altegio/test/clients-debug] Error:",e),i.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/altegio/test/clients-debug/route",pathname:"/api/altegio/test/clients-debug",filename:"route",bundlePath:"app/api/altegio/test/clients-debug/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/test/clients-debug/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:T,staticGenerationAsyncStorage:E,serverHooks:g}=d,h="/api/altegio/test/clients-debug/route";function P(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:E})}},4044:(e,t,r)=>{r.d(t,{B0:()=>n,ZN:()=>a,cC:()=>o,oU:()=>s});let n={API_URL:process.env.ALTEGIO_API_URL?.trim()||"https://api.alteg.io/api/v1",USER_TOKEN:process.env.ALTEGIO_USER_TOKEN?.trim()||"",PARTNER_TOKEN:process.env.ALTEGIO_PARTNER_TOKEN?.trim()||"",PARTNER_ID:process.env.ALTEGIO_PARTNER_ID?.trim()||"",APPLICATION_ID:process.env.ALTEGIO_APPLICATION_ID?.trim()||""};function o(){if(!n.API_URL)throw Error("Missing env ALTEGIO_API_URL");if(!n.USER_TOKEN&&!n.PARTNER_TOKEN)throw Error("Missing env ALTEGIO_USER_TOKEN or ALTEGIO_PARTNER_TOKEN")}function a(e=!0){if(o(),!n.USER_TOKEN)throw Error("ALTEGIO_USER_TOKEN is required. Please set it in environment variables.");if(console.log("[altegio/env] Token check:",{hasUserToken:!!n.USER_TOKEN,userTokenLength:n.USER_TOKEN?.length||0,hasPartnerToken:!!n.PARTNER_TOKEN,partnerTokenLength:n.PARTNER_TOKEN?.length||0,hasApplicationId:!!n.APPLICATION_ID,applicationId:n.APPLICATION_ID||"not set",hasPartnerId:!!n.PARTNER_ID,partnerId:n.PARTNER_ID||"not set"}),n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.PARTNER_TOKEN}, User ${n.USER_TOKEN}`,t={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e},r=n.APPLICATION_ID||"",o=r||n.PARTNER_ID||"";return o&&(t["X-Partner-ID"]=o,t["Partner-ID"]=o,t["X-Partner-Id"]=o,t["X-PartnerId"]=o,r&&(t["X-Application-ID"]=r,t["Application-ID"]=r)),console.log("[altegio/env] Authorization header (with Partner Token - may be non-public):",{format:"Bearer <partner_token>, User <user_token>",programType:"Non-public (with Partner Token)",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:o||"not set",userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(t),note:"Using Partner Token with User Token (may be for non-public program)"}),t}if(!n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.USER_TOKEN}`,t=n.APPLICATION_ID||"",r=n.PARTNER_ID,o=t||r,a={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e};if(o){let e=`Bearer ${o}, User ${n.USER_TOKEN}`;a["X-Partner-ID"]=o,a["Partner-ID"]=o,a["X-Partner-Id"]=o,a["X-PartnerId"]=o,a.Authorization=e,console.log("[altegio/env] Authorization header (Non-public program - trying public format):",{format:"Bearer <application_id>, User <user_token>",programType:"Non-public",applicationId:t||"not set",partnerId:r||"not set",usingAsPartnerId:o,userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(a),note:"Trying public program format: Bearer <application_id>, User <token>"})}else console.log("[altegio/env] Authorization header (Non-public program - USER_TOKEN only):",{format:"Bearer <user_token>",programType:"Non-public",userTokenLength:n.USER_TOKEN.length,note:"Partner ID not provided - may need ALTEGIO_PARTNER_ID (Application ID)"});return a}if(n.PARTNER_TOKEN){let t=n.PARTNER_ID||n.PARTNER_TOKEN,r=[`Bearer ${n.PARTNER_TOKEN}`];e&&n.USER_TOKEN&&r.push(`User ${n.USER_TOKEN}`),t&&t!==n.PARTNER_TOKEN&&r.push(`Partner ${t}`);let o=r.join(", ");console.log("[altegio/env] Authorization header:",{format:"Bearer <partner_token>, User <user_token>",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:t,partnerIdLength:t.length,userTokenLength:n.USER_TOKEN.length,authHeaderPreview:o.substring(0,50)+"..."});let a={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:o};return t&&(a["X-Partner-ID"]=t,a["Partner-ID"]=t,a["X-Partner-Id"]=t,a["X-PartnerId"]=t,a.PartnerId=t),console.log("[altegio/env] Headers with Partner ID:",{authorization:o.substring(0,80)+"...",partnerIdHeaders:{"X-Partner-ID":a["X-Partner-ID"],"Partner-ID":a["Partner-ID"],"X-Partner-Id":a["X-Partner-Id"]},allHeaderKeys:Object.keys(a)}),a}throw Error("No valid Altegio token configured")}function s(e){let t=n.API_URL.replace(/\/+$/,""),r=e.replace(/^\/+/,"");return`${t}/${r}`}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>r(260));module.exports=n})();