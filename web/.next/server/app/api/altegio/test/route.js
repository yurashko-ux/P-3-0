"use strict";(()=>{var e={};e.id=6481,e.ids=[6481,9668],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2811:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>A,patchFetch:()=>d,requestAsyncStorage:()=>I,routeModule:()=>_,serverHooks:()=>E,staticGenerationAsyncStorage:()=>u});var o={};n.r(o),n.d(o,{GET:()=>g,dynamic:()=>c,runtime:()=>T});var r=n(9303),a=n(8716),s=n(670),i=n(7070),l=n(9668),p=n(4044);let c="force-dynamic",T="nodejs";async function g(e){try{let e=!!process.env.ALTEGIO_PARTNER_TOKEN,t=!!process.env.ALTEGIO_USER_TOKEN,o={apiUrl:process.env.ALTEGIO_API_URL||"https://api.alteg.io/api/v1",programType:e?"Public (with Partner Token)":"Non-public (User Token only)",hasUserToken:t,userTokenLength:process.env.ALTEGIO_USER_TOKEN?.length||0,hasPartnerToken:e,partnerTokenValue:process.env.ALTEGIO_PARTNER_TOKEN?String(process.env.ALTEGIO_PARTNER_TOKEN).substring(0,10)+"...":"not set",partnerTokenLength:process.env.ALTEGIO_PARTNER_TOKEN?.length||0,hasApplicationId:!!process.env.ALTEGIO_APPLICATION_ID,applicationIdValue:process.env.ALTEGIO_APPLICATION_ID||"not set",applicationIdLength:process.env.ALTEGIO_APPLICATION_ID?.length||0,hasPartnerId:!!process.env.ALTEGIO_PARTNER_ID,partnerIdValue:process.env.ALTEGIO_PARTNER_ID||"not set",partnerIdLength:process.env.ALTEGIO_PARTNER_ID?.length||0};console.log("[altegio/test] Environment check:",o),(0,p.cC)();let r=process.env.ALTEGIO_COMPANY_ID,a=[];if(r){let e=parseInt(r,10);if(!isNaN(e))try{let{getCompany:t,getCompaniesByGroup:o}=await Promise.resolve().then(n.bind(n,9668)),s=await t(e);if(s){let e=s.business_group_id||s.main_group_id,t=s.public_title||s.title||s.name||"Без назви",n=s.active,o=!0===n||1===n?"активна":"неактивна";console.log(`[altegio/test] Company ${r} details:`,{id:s.id,name:t,business_group_id:s.business_group_id,main_group_id:s.main_group_id,groupId:e,active:n,activeStatus:o}),a=[s],console.log(`[altegio/test] ✅ Showing company by ALTEGIO_COMPANY_ID ${r}: ${t} (${o})`)}else console.warn(`[altegio/test] Company with ID ${r} not found, falling back to list`)}catch(e){console.warn(`[altegio/test] Failed to get company by ID ${r}, falling back to list:`,e)}}return 0===a.length&&(a=await (0,l.a)(),console.log(`[altegio/test] Got ${a.length} companies ${r?`(ALTEGIO_COMPANY_ID ${r} not found)`:"(ALTEGIO_COMPANY_ID not set)"}`)),i.NextResponse.json({ok:!0,companies:a,count:a.length,message:"Altegio API connection successful",env:o})}catch(p){console.error("[altegio/test] Error:",p);let e=p instanceof Error?p.message:String(p),t=!!process.env.ALTEGIO_PARTNER_TOKEN,n=!!process.env.ALTEGIO_USER_TOKEN,o=!!process.env.ALTEGIO_PARTNER_ID,r=t?"Public (with Partner Token)":"Non-public (User Token only)",a={programType:r,hasUserToken:n,hasPartnerToken:t,partnerTokenValue:process.env.ALTEGIO_PARTNER_TOKEN?String(process.env.ALTEGIO_PARTNER_TOKEN).substring(0,10)+"...":"not set",partnerTokenLength:process.env.ALTEGIO_PARTNER_TOKEN?.length||0,hasApplicationId:!!process.env.ALTEGIO_APPLICATION_ID,applicationIdValue:process.env.ALTEGIO_APPLICATION_ID||"not set",applicationIdLength:process.env.ALTEGIO_APPLICATION_ID?.length||0,hasPartnerId:o,partnerIdValue:process.env.ALTEGIO_PARTNER_ID||"not set",partnerIdLength:process.env.ALTEGIO_PARTNER_ID?.length||0},s=e.includes("Partner ID")||e.includes("partner")||e.includes("401"),l=t&&(!n||s)?"Для публічних програм потрібні обидва токени: ALTEGIO_PARTNER_TOKEN та ALTEGIO_USER_TOKEN. Переконайтеся, що обидва встановлені правильно.":null;return i.NextResponse.json({ok:!1,error:e,hint:l||(s?t?"Для публічних програм потрібні ALTEGIO_PARTNER_TOKEN та ALTEGIO_USER_TOKEN. Перевірте, чи обидва встановлені правильно.":"Потрібен ALTEGIO_PARTNER_TOKEN (для публічних програм) або видаліть його (для непублічних програм). Перевірте, чи змінна додана для правильного середовища (Production/Preview) та чи перезапущено деплой.":"Перевірте, чи правильно налаштовано ALTEGIO_USER_TOKEN у змінних середовища Vercel."),programType:r,needsPartnerToken:s&&!t,recommendation:s&&!o&&n&&!t?"Для непублічної програми: додайте ALTEGIO_PARTNER_ID (ID вашої філії/салону в Alteg.io, наприклад: 1169323) в Vercel environment variables":t&&s&&n?"Для непублічної програми: видаліть ALTEGIO_PARTNER_TOKEN з Vercel і використовуйте тільки ALTEGIO_USER_TOKEN + ALTEGIO_PARTNER_ID":null,env:a,debug:{partnerTokenInEnv:t,partnerTokenLength:process.env.ALTEGIO_PARTNER_TOKEN?.length||0,partnerIdInEnv:o,partnerIdValue:process.env.ALTEGIO_PARTNER_ID?String(process.env.ALTEGIO_PARTNER_ID).substring(0,15)+"...":"not set",partnerIdLength:process.env.ALTEGIO_PARTNER_ID?.length||0,userTokenInEnv:n,userTokenLength:process.env.ALTEGIO_USER_TOKEN?.length||0}},{status:500})}}let _=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/altegio/test/route",pathname:"/api/altegio/test",filename:"route",bundlePath:"app/api/altegio/test/route"},resolvedPagePath:"/Users/mykolay/P-3-0/web/app/api/altegio/test/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:I,staticGenerationAsyncStorage:u,serverHooks:E}=_,A="/api/altegio/test/route";function d(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:u})}},9668:(e,t,n)=>{n.d(t,{a:()=>r,getCompaniesByGroup:()=>s,getCompany:()=>a});var o=n(7582);async function r(e){try{if(e){let t="string"==typeof e?parseInt(e,10):e;if(!isNaN(t))try{let e=await a(t);return e?[e]:[]}catch(e){console.warn(`[altegio/companies] Failed to get specific company ${t}, falling back to list:`,e)}}let t=await (0,o.B)("/companies"),n=[];if(Array.isArray(t)?n=t:t&&"object"==typeof t&&"data"in t&&(n=t.data||[]),e&&n.length>0){let t="string"==typeof e?e:String(e),o=n.filter(n=>{let o=String(n.id||n.company_id||"");return o===t||o===String(e)});if(o.length>0)return console.log(`[altegio/companies] Filtered companies by ID ${e}: found ${o.length} out of ${n.length}`),o;console.warn(`[altegio/companies] Company with ID ${e} not found in list. Total companies: ${n.length}`)}return n}catch(e){throw console.error("[altegio/companies] Failed to get companies:",e),e}}async function a(e){try{let t=await (0,o.B)(`/company/${e}`);if(t&&"object"==typeof t){if("id"in t)return t;if("data"in t&&t.data)return t.data}return null}catch(t){return console.error(`[altegio/companies] Failed to get company ${e}:`,t),null}}async function s(e){try{let t=String(e);for(let n of[`/companies?business_group_id=${t}`,`/companies?main_group_id=${t}`,`/companies?group_id=${t}`,`/business_groups/${t}/companies`,`/groups/${t}/companies`])try{let t=await (0,o.B)(n),r=[];if(Array.isArray(t)?r=t:t&&"object"==typeof t&&"data"in t&&(r=Array.isArray(t.data)?t.data:[]),r.length>0)return console.log(`[altegio/companies] Found ${r.length} companies by group ID ${e} using ${n}`),r}catch(e){console.log(`[altegio/companies] Endpoint ${n} failed, trying next...`);continue}return[]}catch(t){return console.error(`[altegio/companies] Failed to get companies by group ID ${e}:`,t),[]}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[8948,5972,7582],()=>n(2811));module.exports=o})();