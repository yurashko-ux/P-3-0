(()=>{var e={};e.id=3205,e.ids=[3205],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6184:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>c,originalPathname:()=>u,pages:()=>p,routeModule:()=>m,tree:()=>o}),s(5903),s(5866),s(2675);var a=s(3191),i=s(8716),n=s(7922),l=s.n(n),r=s(5231),d={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>r[e]);s.d(t,d);let o=["",{children:["(admin)",{children:["admin",{children:["campaigns",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5903)),"/Users/mykolay/P-3-0/web/app/(admin)/admin/campaigns/new/page.tsx"]}]},{}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2675)),"/Users/mykolay/P-3-0/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],p=["/Users/mykolay/P-3-0/web/app/(admin)/admin/campaigns/new/page.tsx"],u="/(admin)/admin/campaigns/new/page",c={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(admin)/admin/campaigns/new/page",pathname:"/admin/campaigns/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4033:(e,t,s)=>{Promise.resolve().then(s.bind(s,5929))},6847:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},5800:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,4064,23))},5929:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(326),i=s(7577),n=s(5047);function l({title:e,children:t}){return(0,a.jsxs)("div",{className:"rounded-xl border bg-white px-4 py-4 sm:px-5 sm:py-5",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold tracking-tight",children:e}),a.jsx("div",{className:"grid gap-3 sm:gap-4",children:t})]})}function r({children:e}){return a.jsx("div",{className:"text-sm text-slate-600 mb-1",children:e})}function d(e){let t=[];return(e.pipelineStatusId&&t.push(`PS:${e.pipelineStatusId}`),e.statusId&&e.statusId!==e.pipelineStatusId&&t.push(`S:${e.statusId}`),t.length)?`${e.name} (${t.join(" \xb7 ")})`:e.name}function o({target:e}){return e.pipeline&&e.status?e.pipelineStatusId?(0,a.jsxs)("p",{className:"text-xs text-slate-500 leading-relaxed",children:["pipeline_status_id: ",e.pipelineStatusId,e.statusId&&e.statusId!==e.pipelineStatusId?` \xb7 status_id: ${e.statusId}`:""]}):(0,a.jsxs)("p",{className:"text-xs text-red-600 leading-relaxed",children:["KeyCRM не повернув ",a.jsx("code",{children:"pipeline_status_id"})," для обраного статусу. Оновіть довідник на сторінці \xabDebug\xbb або оберіть інший статус у цій воронці."]}):null}let p={pipeline:"",status:""};function u(e){return!!(e?.pipeline&&e?.status&&!e?.pipelineStatusId)}function c(e){let t=[];return u(e.base)&&t.push("База"),u(e.t1)&&t.push("Варіант №1"),u(e.t2)&&t.push("Варіант №2"),u(e.texp)&&t.push("Expire"),t}function m(){let e=(0,n.useRouter)(),[t,s]=(0,i.useState)([]),[u,m]=(0,i.useState)({}),[h,g]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),[y,v]=(0,i.useState)(null),[j,w]=(0,i.useState)({name:"",base:{...p},v1:"1",v2:"2",expDays:7,t1:{...p},t2:{...p},texp:{...p}}),P=async e=>{if(e&&!u[e])try{let t=await fetch(`/api/keycrm/statuses/${encodeURIComponent(e)}`,{cache:"no-store"}),s=await t.json();if(!s?.ok)throw Error("Не вдалося завантажити статуси");let a=Array.isArray(s.data)?s.data.map(e=>({id:String(e?.id??""),name:String(e?.name??`Статус #${e?.id??""}`),pipelineStatusId:e?.pipelineStatusId!=null&&""!==e.pipelineStatusId?String(e.pipelineStatusId):e?.pipeline_status_id!=null&&""!==e.pipeline_status_id?String(e.pipeline_status_id):null,statusId:e?.statusId!=null&&""!==e.statusId?String(e.statusId):e?.status_id!=null&&""!==e.status_id?String(e.status_id):null})):[];m(t=>({...t,[e]:a}))}catch(e){}},N=(0,i.useMemo)(()=>j.base.pipeline&&u[j.base.pipeline]||[],[j.base.pipeline,u]),S=(0,i.useMemo)(()=>j.t1.pipeline&&u[j.t1.pipeline]||[],[j.t1.pipeline,u]),_=(0,i.useMemo)(()=>j.t2.pipeline&&u[j.t2.pipeline]||[],[j.t2.pipeline,u]),I=(0,i.useMemo)(()=>j.texp.pipeline&&u[j.texp.pipeline]||[],[j.texp.pipeline,u]),R=(e,s)=>{w(a=>{let i={...a[e],...s};if(void 0!==s.pipeline&&(s.pipeline&&P(s.pipeline),i.status="",i.statusId=void 0,i.pipelineStatusId=void 0,i.statusName="",i.pipelineName=t.find(e=>e.id===s.pipeline)?.name||""),void 0!==s.status&&s.status){let e=(i.pipeline&&u[i.pipeline]?u[i.pipeline]:[]).find(e=>e.id===s.status);i.status=s.status,i.statusName=e?.name||"",i.pipelineStatusId=e?.pipelineStatusId??void 0,i.statusId=e?.statusId??e?.pipelineStatusId??s.status}return{...a,[e]:i}})},k=async t=>{if(t.preventDefault(),!j.name.trim()){v("Назва обовʼязкова");return}let s=c(j);if(s.length){v(`Не вдалось зберегти: KeyCRM не повернув pipeline_status_id для секцій ${s.join(", ")}. Оновіть довідник статусів у розділі Debug або оберіть інші статуси.`);return}f(!0),v(null);let a={name:j.name.trim(),v1:j.v1||void 0,v2:j.v2||void 0,expDays:""===j.expDays?void 0:Number.isFinite(Number(j.expDays))?Number(j.expDays):void 0,base:x(j.base),t1:x(j.t1),t2:x(j.t2),texp:x(j.texp)};try{let t=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok){let e=await t.text().catch(()=>"");throw Error(e||"Не вдалося зберегти кампанію")}e.push("/admin/campaigns"),e.refresh()}catch(e){v(e?.message||"Помилка збереження")}finally{f(!1)}},C=h||b,D=(0,i.useMemo)(()=>c(j),[j]),M=D.length>0;return(0,a.jsxs)("div",{className:"mx-auto max-w-4xl p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"mb-3 sm:mb-4 flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold tracking-tight",children:"Нова кампанія"}),a.jsx("button",{type:"button",onClick:()=>e.push("/admin/campaigns"),className:"rounded-lg border px-3 py-1.5 text-sm shadow-sm",children:"Скасувати"})]}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4 sm:space-y-5",children:[a.jsx(l,{title:"База",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Назва кампанії"}),a.jsx("input",{value:j.name,onChange:e=>w(t=>({...t,name:e.target.value})),className:"w-full rounded-lg border px-3 py-2",placeholder:"Назва",disabled:C})]}),(0,a.jsxs)("div",{className:"sm:col-span-3",children:[a.jsx(r,{children:"Базова воронка"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.base.pipeline||"",onChange:e=>R("base",{pipeline:e.target.value}),disabled:C,children:[a.jsx("option",{value:"",children:"—"}),t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"sm:col-span-4",children:[a.jsx(r,{children:"Базовий статус"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.base.status||"",onChange:e=>R("base",{status:e.target.value}),disabled:C||!j.base.pipeline,children:[a.jsx("option",{value:"",children:"—"}),N.map(e=>a.jsx("option",{value:e.id,children:d(e)},e.id))]}),a.jsx(o,{target:j.base})]})]})}),a.jsx(l,{title:"Варіант №1",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[a.jsx(r,{children:"Значення"}),a.jsx("input",{className:"w-full rounded-lg border px-3 py-2",value:j.v1,onChange:e=>w(t=>({...t,v1:e.target.value})),disabled:C,placeholder:"1"})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Воронка"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.t1.pipeline||"",onChange:e=>R("t1",{pipeline:e.target.value}),disabled:C,children:[a.jsx("option",{value:"",children:"—"}),t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Статус"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.t1.status||"",onChange:e=>R("t1",{status:e.target.value}),disabled:C||!j.t1.pipeline,children:[a.jsx("option",{value:"",children:"—"}),S.map(e=>a.jsx("option",{value:e.id,children:d(e)},e.id))]}),a.jsx(o,{target:j.t1})]})]})}),a.jsx(l,{title:"Варіант №2",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[a.jsx(r,{children:"Значення"}),a.jsx("input",{className:"w-full rounded-lg border px-3 py-2",value:j.v2,onChange:e=>w(t=>({...t,v2:e.target.value})),disabled:C,placeholder:"2"})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Воронка"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.t2.pipeline||"",onChange:e=>R("t2",{pipeline:e.target.value}),disabled:C,children:[a.jsx("option",{value:"",children:"—"}),t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Статус"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.t2.status||"",onChange:e=>R("t2",{status:e.target.value}),disabled:C||!j.t2.pipeline,children:[a.jsx("option",{value:"",children:"—"}),_.map(e=>a.jsx("option",{value:e.id,children:d(e)},e.id))]}),a.jsx(o,{target:j.t2})]})]})}),a.jsx(l,{title:"Expire",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[a.jsx(r,{children:"Кількість днів до експірації"}),a.jsx("input",{type:"number",min:0,className:"w-full rounded-lg border px-3 py-2",value:j.expDays??"",onChange:e=>w(t=>({...t,expDays:""===e.target.value?"":Number(e.target.value)})),disabled:C,placeholder:"7"})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Воронка"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.texp.pipeline||"",onChange:e=>R("texp",{pipeline:e.target.value}),disabled:C,children:[a.jsx("option",{value:"",children:"—"}),t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"sm:col-span-5",children:[a.jsx(r,{children:"Статус"}),(0,a.jsxs)("select",{className:"w-full rounded-lg border px-3 py-2",value:j.texp.status||"",onChange:e=>R("texp",{status:e.target.value}),disabled:C||!j.texp.pipeline,children:[a.jsx("option",{value:"",children:"—"}),I.map(e=>a.jsx("option",{value:e.id,children:d(e)},e.id))]}),a.jsx(o,{target:j.texp})]})]})}),M&&(0,a.jsxs)("div",{className:"rounded-lg border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:["KeyCRM не повернув ",a.jsx("code",{children:"pipeline_status_id"})," для секцій ",D.join(", "),". Оновіть довідник статусів у розділі \xabDebug\xbb або оберіть інші статуси перед збереженням."]}),y&&a.jsx("div",{className:"rounded-lg border border-red-300 bg-red-50 px-3 py-2 text-sm text-red-700",children:y}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{type:"submit",disabled:C||M,className:"rounded-lg bg-blue-600 text-white px-4 py-2 font-medium shadow hover:bg-blue-700 disabled:opacity-60",children:b?"Збереження…":"Зберегти"}),a.jsx("button",{type:"button",onClick:()=>e.push("/admin/campaigns"),className:"rounded-lg border px-4 py-2 shadow-sm",children:"Скасувати"})]})]})]})}function x(e){if(!e?.pipeline&&!e?.status)return;let t={};return e.pipeline&&(t.pipeline=e.pipeline),e.statusId?t.status=e.statusId:e.pipelineStatusId?t.status=e.pipelineStatusId:e.status&&(t.status=e.status),e.pipelineStatusId&&(t.pipelineStatusId=e.pipelineStatusId),e.pipelineName&&(t.pipelineName=e.pipelineName),e.statusName&&(t.statusName=e.statusName),t}},5047:(e,t,s)=>{"use strict";var a=s(7389);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},5903:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>n,default:()=>r});var a=s(8570);let i=(0,a.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/(admin)/admin/campaigns/new/page.tsx`),{__esModule:n,$$typeof:l}=i;i.default;let r=(0,a.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/(admin)/admin/campaigns/new/page.tsx#default`)},2675:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p,metadata:()=>o});var a=s(9510),i=s(18),n=s.n(i);s(7272);var l=s(9720);function r(e=globalThis){let t=(e,t)=>{if("get"in e||"set"in e){let s=e.get?e.get.bind(t):void 0,a=e.set?e.set.bind(t):void 0;return{configurable:e.configurable,enumerable:e.enumerable??!1,get:s,set:a}}if("function"==typeof e.value){let s=e.value.bind(t);return{configurable:e.configurable,enumerable:e.enumerable??!1,writable:e.writable??!1,value:s}}return e},s=(e,t,s,a)=>{let i=t?.enumerable??!1;if(t&&("get"in t||"set"in t)){let n=t.get?t.get.bind(a):void 0,l=t.set?t.set.bind(a):void 0;return{configurable:!0,enumerable:i,get:()=>s.has(e)?void 0:n?n():void 0,set:t=>{s.delete(e),l&&l(t)}}}let n=t?t.value:void 0;return{configurable:!0,enumerable:i,get:()=>s.has(e)?void 0:n,set:t=>{s.delete(e),n=t}}};if(!e||e.__p30SymbolGuarded)return;let a=(e=>{let t=e.Symbol;return"function"==typeof t?t:void 0})(e);if(!a){e.__p30SymbolGuarded=!0;return}let i=new Set(["dispose","asyncDispose"]);a.dispose&&i.add(a.dispose),a.asyncDispose&&i.add(a.asyncDispose);let n=new Set,l=function(e){return a(e)};try{Reflect.defineProperty(l,"name",{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}try{Reflect.defineProperty(l,"length",{configurable:!0,enumerable:!1,writable:!1,value:0})}catch{}try{Reflect.defineProperty(l,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:a.prototype})}catch{}for(let e of Reflect.ownKeys(a)){let r=Reflect.getOwnPropertyDescriptor(a,e);if(r){if(i.has(e)){try{Reflect.defineProperty(l,e,s(e,r,n,a))}catch{}continue}try{Reflect.defineProperty(l,e,t(r,a))}catch{}}}Object.defineProperty(l,"__p30ProxyGuard",{configurable:!1,enumerable:!1,writable:!1,value:!0});try{Object.defineProperty(l,Symbol.toStringTag,{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}let r=e=>!!i.has(e)&&(n.add(e),!0),d=new Proxy(l,{apply:(e,t,s)=>Reflect.apply(a,t,s),deleteProperty(e,t){if(r(t)){try{Reflect.deleteProperty(e,t)}catch{}return!0}try{return Reflect.deleteProperty(a,t)}catch{return!1}},get(e,t,s){if("__p30ProxyGuard"===t)return!0;if(i.has(t)){let a=Reflect.getOwnPropertyDescriptor(e,t);return a?"get"in a&&a.get?a.get.call(s):a.value:void 0}let n=Reflect.get(e,t,s);if("function"==typeof n)try{return n.bind(a)}catch{}return n},has:(e,t)=>i.has(t)?!n.has(t)&&Reflect.has(e,t):Reflect.has(e,t)||Reflect.has(a,t),ownKeys(e){let t=[];for(let s of Reflect.ownKeys(e))!(i.has(s)&&n.has(s))&&("string"!=typeof s&&"symbol"!=typeof s||t.includes(s)||t.push(s));return t},getOwnPropertyDescriptor(e,t){if(i.has(t)){if(n.has(t))return;let s=Reflect.getOwnPropertyDescriptor(e,t);return s&&(s.configurable=!0),s}return Reflect.getOwnPropertyDescriptor(e,t)},set:(e,t,s,a)=>(i.has(t)&&n.delete(t),Reflect.set(e,t,s,a)),defineProperty(e,t,l){if(i.has(t)){n.delete(t);let i=s(t,l,n,a);return Reflect.defineProperty(e,t,i)}return Reflect.defineProperty(e,t,l)}});try{Object.defineProperty(e,"Symbol",{configurable:!0,enumerable:!1,writable:!0,value:d})}catch{e.Symbol=d}let o=function(){};try{Object.defineProperty(e,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{e.lockdown=o}let p=e.ses;if(p)try{Object.defineProperty(p,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{p.lockdown=o}"function"!=typeof e.harden&&(e.harden=e=>e),e.__p30SymbolGuarded=!0}let d=`;(${r.toString()})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : undefined);`;r();let o={title:"P-3-0",description:"Admin console"};function p({children:e}){return(0,a.jsxs)("html",{lang:"uk",className:n().className,children:[a.jsx("head",{children:a.jsx(l.default,{id:"p30-lockdown-guard",strategy:"beforeInteractive",dangerouslySetInnerHTML:{__html:d}})}),a.jsx("body",{children:e})]})}},7272:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,4818],()=>s(6184));module.exports=a})();