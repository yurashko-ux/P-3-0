(()=>{var e={};e.id=9336,e.ids=[9336],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1326:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(5413),r(5866),r(2675);var n=r(3191),a=r(8716),s=r(7922),l=r.n(s),i=r(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let d=["",{children:["(admin)",{children:["campaigns",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5413)),"/Users/mykolay/P-3-0/web/app/(admin)/campaigns/new/page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,2675)),"/Users/mykolay/P-3-0/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/mykolay/P-3-0/web/app/(admin)/campaigns/new/page.tsx"],u="/(admin)/campaigns/new/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(admin)/campaigns/new/page",pathname:"/campaigns/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3516:(e,t,r)=>{Promise.resolve().then(r.bind(r,89))},6847:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},5800:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,4064,23))},89:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var n=r(326),a=r(7577),s=r(5047);function l(e,t){document.cookie=`${e}=${encodeURIComponent(t)}; path=/; SameSite=Lax`}function i(){let e=(0,s.useRouter)(),[t,r]=a.useState(null),[i,o]=a.useState(!1),[d,c]=a.useState(""),[u,m]=a.useState(!1),[p,b]=a.useState(null),[f,h]=a.useState("UI-created"),[y,x]=a.useState(111),[g,v]=a.useState(222),[P,w]=a.useState("contains"),[j,N]=a.useState("ціна"),[S,_]=a.useState("equals"),[k,R]=a.useState("привіт");async function C(){if(!d.trim()){b("Введи адмін-токен (ENV ADMIN_PASS на Vercel).");return}try{await fetch("/api/auth/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:d.trim()})}).catch(()=>{})}finally{l("admin_token",d.trim()),r(d.trim()),o(!1),b("Токен збережено. Можеш створювати кампанію.")}}async function O(r){if(r.preventDefault(),b(null),!t){b("Немає адмін-токена. Введи токен вище."),o(!0);return}if(!f.trim()){b("Назва обовʼязкова.");return}if(""===y||""===g){b("Потрібні ID воронки та статусу.");return}m(!0);try{let r={name:f.trim(),base_pipeline_id:Number(y),base_status_id:Number(g),rules:{v1:{op:P,value:j??""},v2:{op:S,value:k??""}}},n=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Token":t},body:JSON.stringify(r)});if(!n.ok){let e=await n.text().catch(()=>"");throw Error(e||`HTTP ${n.status}`)}b("Кампанію створено ✅"),setTimeout(()=>e.push("/admin/campaigns"),300)}catch(t){console.error(t);let e=String(t?.message||t);e.includes("401")?(b("401 Unauthorized — адмін-токен неправильний або відсутній."),o(!0)):e.includes("failed to parse")||e.includes("WRONGTYPE")?b("Помилка KV. Спробуй ще раз або очисти тестові ключі через /api/debug/kv."):b(`Помилка створення: ${e}`)}finally{m(!1)}}return a.useEffect(()=>{let e=function(e){if("undefined"==typeof document)return null;for(let t of document.cookie.split(";")){let r=t.trim();if(!r)continue;let n=r.indexOf("=");if(-1===n)continue;let a=r.slice(0,n),s=r.slice(n+1);if(a===e)return decodeURIComponent(s)}return null}("admin_token");r(e),o(!e)},[]),(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[n.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Створити кампанію"}),!t&&(0,n.jsxs)("div",{className:"mb-4 rounded-lg border p-3 bg-yellow-50",children:[n.jsx("div",{className:"font-medium",children:"Немає адмін-токена"}),(0,n.jsxs)("div",{className:"text-sm",children:["Введи значення ENV ",n.jsx("code",{children:"ADMIN_PASS"})," (напр. ",n.jsx("code",{children:"11111"}),") нижче і збережи."]})]}),i&&(0,n.jsxs)("div",{className:"mb-6 rounded-xl border p-4",children:[n.jsx("label",{className:"block text-sm mb-1",children:"Admin token"}),n.jsx("input",{className:"w-full border rounded-md px-3 py-2",placeholder:"встав тут свій ADMIN_PASS",value:d,onChange:e=>c(e.target.value)}),(0,n.jsxs)("div",{className:"mt-2 flex gap-2",children:[n.jsx("button",{type:"button",onClick:C,className:"px-3 py-2 rounded-md border bg-black text-white disabled:opacity-60",children:"Зберегти токен"}),n.jsx("button",{type:"button",onClick:()=>{l("admin_token",""),r(null),o(!0),b("Токен очищено")},className:"px-3 py-2 rounded-md border",children:"Очистити токен"})]})]}),p&&n.jsx("div",{className:"mb-4 rounded-lg border p-3 bg-slate-50 whitespace-pre-wrap",children:p}),(0,n.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm mb-1",children:"Назва"}),n.jsx("input",{className:"w-full border rounded-md px-3 py-2",value:f,onChange:e=>h(e.target.value),placeholder:"My Campaign"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm mb-1",children:"Base pipeline ID"}),n.jsx("input",{type:"number",className:"w-full border rounded-md px-3 py-2",value:y,onChange:e=>x(""===e.target.value?"":Number(e.target.value))})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm mb-1",children:"Base status ID"}),n.jsx("input",{type:"number",className:"w-full border rounded-md px-3 py-2",value:g,onChange:e=>v(""===e.target.value?"":Number(e.target.value))})]})]}),(0,n.jsxs)("div",{className:"rounded-xl border p-4",children:[n.jsx("div",{className:"font-medium mb-3",children:"Правила"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm mb-1",children:"V1 — оператор"}),(0,n.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:P,onChange:e=>w(e.target.value),children:[n.jsx("option",{value:"contains",children:"contains"}),n.jsx("option",{value:"equals",children:"equals"})]}),n.jsx("label",{className:"block text-sm mt-3 mb-1",children:"V1 — значення"}),n.jsx("input",{className:"w-full border rounded-md px-3 py-2",value:j,onChange:e=>N(e.target.value),placeholder:"напр. ціна"})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"block text-sm mb-1",children:"V2 — оператор"}),(0,n.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:S,onChange:e=>_(e.target.value),children:[n.jsx("option",{value:"contains",children:"contains"}),n.jsx("option",{value:"equals",children:"equals"})]}),n.jsx("label",{className:"block text-sm mt-3 mb-1",children:"V2 — значення"}),n.jsx("input",{className:"w-full border rounded-md px-3 py-2",value:k,onChange:e=>R(e.target.value),placeholder:"напр. привіт"})]})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[n.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 rounded-md border bg-black text-white disabled:opacity-60",children:u?"Зберігаю…":"Створити"}),n.jsx("button",{type:"button",className:"px-4 py-2 rounded-md border",onClick:()=>e.push("/admin/campaigns"),children:"До списку"})]})]})]})}},5047:(e,t,r)=>{"use strict";var n=r(7389);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},5413:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>l,__esModule:()=>s,default:()=>i});var n=r(8570);let a=(0,n.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/(admin)/campaigns/new/page.tsx`),{__esModule:s,$$typeof:l}=a;a.default;let i=(0,n.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/(admin)/campaigns/new/page.tsx#default`)},2675:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>d});var n=r(9510),a=r(18),s=r.n(a);r(7272);var l=r(9720);function i(e=globalThis){let t=(e,t)=>{if("get"in e||"set"in e){let r=e.get?e.get.bind(t):void 0,n=e.set?e.set.bind(t):void 0;return{configurable:e.configurable,enumerable:e.enumerable??!1,get:r,set:n}}if("function"==typeof e.value){let r=e.value.bind(t);return{configurable:e.configurable,enumerable:e.enumerable??!1,writable:e.writable??!1,value:r}}return e},r=(e,t,r,n)=>{let a=t?.enumerable??!1;if(t&&("get"in t||"set"in t)){let s=t.get?t.get.bind(n):void 0,l=t.set?t.set.bind(n):void 0;return{configurable:!0,enumerable:a,get:()=>r.has(e)?void 0:s?s():void 0,set:t=>{r.delete(e),l&&l(t)}}}let s=t?t.value:void 0;return{configurable:!0,enumerable:a,get:()=>r.has(e)?void 0:s,set:t=>{r.delete(e),s=t}}};if(!e||e.__p30SymbolGuarded)return;let n=(e=>{let t=e.Symbol;return"function"==typeof t?t:void 0})(e);if(!n){e.__p30SymbolGuarded=!0;return}let a=new Set(["dispose","asyncDispose"]);n.dispose&&a.add(n.dispose),n.asyncDispose&&a.add(n.asyncDispose);let s=new Set,l=function(e){return n(e)};try{Reflect.defineProperty(l,"name",{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}try{Reflect.defineProperty(l,"length",{configurable:!0,enumerable:!1,writable:!1,value:0})}catch{}try{Reflect.defineProperty(l,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:n.prototype})}catch{}for(let e of Reflect.ownKeys(n)){let i=Reflect.getOwnPropertyDescriptor(n,e);if(i){if(a.has(e)){try{Reflect.defineProperty(l,e,r(e,i,s,n))}catch{}continue}try{Reflect.defineProperty(l,e,t(i,n))}catch{}}}Object.defineProperty(l,"__p30ProxyGuard",{configurable:!1,enumerable:!1,writable:!1,value:!0});try{Object.defineProperty(l,Symbol.toStringTag,{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}let i=e=>!!a.has(e)&&(s.add(e),!0),o=new Proxy(l,{apply:(e,t,r)=>Reflect.apply(n,t,r),deleteProperty(e,t){if(i(t)){try{Reflect.deleteProperty(e,t)}catch{}return!0}try{return Reflect.deleteProperty(n,t)}catch{return!1}},get(e,t,r){if("__p30ProxyGuard"===t)return!0;if(a.has(t)){let n=Reflect.getOwnPropertyDescriptor(e,t);return n?"get"in n&&n.get?n.get.call(r):n.value:void 0}let s=Reflect.get(e,t,r);if("function"==typeof s)try{return s.bind(n)}catch{}return s},has:(e,t)=>a.has(t)?!s.has(t)&&Reflect.has(e,t):Reflect.has(e,t)||Reflect.has(n,t),ownKeys(e){let t=[];for(let r of Reflect.ownKeys(e))!(a.has(r)&&s.has(r))&&("string"!=typeof r&&"symbol"!=typeof r||t.includes(r)||t.push(r));return t},getOwnPropertyDescriptor(e,t){if(a.has(t)){if(s.has(t))return;let r=Reflect.getOwnPropertyDescriptor(e,t);return r&&(r.configurable=!0),r}return Reflect.getOwnPropertyDescriptor(e,t)},set:(e,t,r,n)=>(a.has(t)&&s.delete(t),Reflect.set(e,t,r,n)),defineProperty(e,t,l){if(a.has(t)){s.delete(t);let a=r(t,l,s,n);return Reflect.defineProperty(e,t,a)}return Reflect.defineProperty(e,t,l)}});try{Object.defineProperty(e,"Symbol",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{e.Symbol=o}let d=function(){};try{Object.defineProperty(e,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:d})}catch{e.lockdown=d}let c=e.ses;if(c)try{Object.defineProperty(c,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:d})}catch{c.lockdown=d}"function"!=typeof e.harden&&(e.harden=e=>e),e.__p30SymbolGuarded=!0}let o=`;(${i.toString()})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : undefined);`;i();let d={title:"P-3-0",description:"Admin console"};function c({children:e}){return(0,n.jsxs)("html",{lang:"uk",className:s().className,children:[n.jsx("head",{children:n.jsx(l.default,{id:"p30-lockdown-guard",strategy:"beforeInteractive",dangerouslySetInnerHTML:{__html:o}})}),n.jsx("body",{children:e})]})}},7272:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,4818],()=>r(1326));module.exports=n})();