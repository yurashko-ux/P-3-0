(()=>{var e={};e.id=4161,e.ids=[4161,9668],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5729:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>r.a,__next_app__:()=>g,originalPathname:()=>d,pages:()=>u,routeModule:()=>y,tree:()=>c}),a(6669),a(2675),a(5866);var o=a(3191),n=a(8716),s=a(7922),r=a.n(s),l=a(5231),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);a.d(t,i);let c=["",{children:["admin",{children:["finance-report",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6669)),"/Users/mykolay/P-3-0/web/app/admin/finance-report/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2675)),"/Users/mykolay/P-3-0/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/mykolay/P-3-0/web/app/admin/finance-report/page.tsx"],d="/admin/finance-report/page",g={require:a,loadChunk:()=>Promise.resolve()},y=new o.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/admin/finance-report/page",pathname:"/admin/finance-report",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9358:(e,t,a)=>{Promise.resolve().then(a.bind(a,3886)),Promise.resolve().then(a.bind(a,3057)),Promise.resolve().then(a.bind(a,8014))},3057:(e,t,a)=>{"use strict";a.d(t,{FinanceReportClient:()=>i});var o=a(326),n=a(7577),s=a(38),r=a(7127);let l=[{i:"block-1",x:0,y:0,w:6,h:100},{i:"block-2",x:6,y:0,w:6,h:100},{i:"block-3",x:0,y:100,w:6,h:80},{i:"block-4",x:6,y:100,w:6,h:80},{i:"block-5",x:0,y:180,w:12,h:60}];function i({children:e}){let{editMode:t}=(0,r.W)(),a=(0,n.useRef)(l);return o.jsx(s.R,{storageKey:"finance-report-dashboard-layout",layoutVersion:"7",defaultLayout:l,editMode:t,onSave:e=>{a.current=e},children:{"block-1":e.block1,"block-2":e.block2,"block-3":e.block3,"block-4":e.block4,"block-5":e.block5}})}},8014:(e,t,a)=>{"use strict";a.d(t,{FinanceReportPageClient:()=>l});var o=a(326),n=a(7127),s=a(8478);function r(){let{editMode:e,setEditMode:t}=(0,n.W)();return o.jsx("div",{className:"p-3 bg-blue-50 border-2 border-blue-300 rounded-lg shadow-md",children:o.jsx(s.G,{storageKey:"finance-report-dashboard-layout",onEditModeChange:t,onSave:e=>{}})})}function l({children:e,summaryContent:t}){return o.jsx(n.S,{children:(0,o.jsxs)("div",{className:"mx-auto max-w-6xl px-2 py-2 space-y-2",children:[e,t&&(0,o.jsxs)(o.Fragment,{children:[o.jsx(r,{}),t]})]})})}},7127:(e,t,a)=>{"use strict";a.d(t,{S:()=>r,W:()=>l});var o=a(326),n=a(7577);let s=(0,n.createContext)(void 0);function r({children:e}){let[t,a]=(0,n.useState)(!1);return o.jsx(s.Provider,{value:{editMode:t,setEditMode:a},children:e})}function l(){let e=(0,n.useContext)(s);if(!e)throw Error("useLayoutEdit must be used within LayoutEditProvider");return e}},3886:(e,t,a)=>{"use strict";a.d(t,{EditableCostCell:()=>r});var o=a(326),n=a(7577),s=a(5047);function r({year:e,month:t,currentCost:a}){let r=(0,s.useRouter)(),[l,i]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[d,g]=(0,n.useState)(""),[y,m]=(0,n.useState)(String(a)),[p,f]=(0,n.useTransition)(),[h,b]=(0,n.useState)(null),[x,_]=(0,n.useState)(null),C=()=>{let a=parseFloat(y);if(isNaN(a)||a<0){b("–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –Ω–µ–≤—ñ–¥'—î–º–Ω–∏–º —á–∏—Å–ª–æ–º");return}b(null),f(async()=>{try{let o=await fetch(`/api/admin/finance-report/cost?secret=${encodeURIComponent(d)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:e,month:t,cost:a})});if(!o.ok){let e=await o.json();throw Error(e.error||"–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è")}let n=await o.json();console.log("[EditableCostCell] Saved cost:",n),_(`–ó–±–µ—Ä–µ–∂–µ–Ω–æ`),b(null),m(String(a)),i(!1),u(!1),g(""),r.refresh(),setTimeout(()=>{_(null)},2e3)}catch(e){console.error("[EditableCostCell] Save error:",e),b(e.message||"–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è")}})},w=()=>{m(String(a)),i(!1),u(!1),g(""),b(null)};return l?(0,o.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,o.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[o.jsx("input",{type:"number",value:y,onChange:e=>m(e.target.value),placeholder:"–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å",className:"input input-bordered input-xs w-24 text-right",min:"0",step:"0.01",disabled:p,autoFocus:!0,onKeyDown:e=>{"Enter"===e.key?C():"Escape"===e.key&&w()}}),o.jsx("span",{className:"text-xs text-gray-600",children:"–≥—Ä–Ω."}),o.jsx("button",{onClick:C,className:"btn btn-xs btn-primary",disabled:p,title:"–ó–±–µ—Ä–µ–≥—Ç–∏",children:p?"...":"\uD83D\uDCBE"}),o.jsx("button",{onClick:w,className:"btn btn-xs btn-ghost",disabled:p,title:"–°–∫–∞—Å—É–≤–∞—Ç–∏",children:"‚úï"})]}),h&&o.jsx("div",{className:"text-xs text-error",children:h}),x&&o.jsx("div",{className:"text-xs text-success",children:x})]}):(0,o.jsxs)("span",{className:"text-xs font-bold whitespace-nowrap",children:[Math.round(a).toLocaleString("uk-UA",{minimumFractionDigits:0,maximumFractionDigits:0})," –≥—Ä–Ω.",o.jsx("button",{onClick:()=>{if(l){i(!1),m(String(a)),u(!1),g(""),b(null);return}let o=prompt("–í–≤–µ–¥—ñ—Ç—å CRON_SECRET –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ:");o&&fetch(`/api/admin/finance-report/cost?secret=${encodeURIComponent(o)}&year=${e}&month=${t}`).then(e=>{e.ok?(u(!0),g(o),i(!0)):alert("–ù–µ–≤—ñ—Ä–Ω–∏–π CRON_SECRET")}).catch(e=>{console.error("Failed to verify secret:",e),alert("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ–∫—Ä–µ—Ç—É")})},className:"btn btn-xs btn-ghost p-0.5 opacity-60 hover:opacity-100 ml-1 inline-flex items-center",title:"–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å (–ø–æ—Ç—Ä—ñ–±–µ–Ω CRON_SECRET)",children:"‚úèÔ∏è"})]})}},6669:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O,dynamic:()=>S});var o=a(9510);a(1159);var n=a(4044),s=a(7582);function r(e){if("number"==typeof e)return e;if("string"==typeof e){let t=Number(e.replace(",","."));return Number.isFinite(t)?t:0}return 0}async function l(e){let{date_from:t,date_to:a}=e,o=new URLSearchParams({date_from:t,date_to:a}),l=process.env.ALTEGIO_COMPANY_ID?.trim()||n.B0.PARTNER_ID||n.B0.APPLICATION_ID;if(!l)throw Error("ALTEGIO_COMPANY_ID is required (optionally can fall back to ALTEGIO_PARTNER_ID / ALTEGIO_APPLICATION_ID)");let i=`/company/${l}/analytics/overall`,c=`?${o.toString()}`,[u,d]=await Promise.all([(0,s.B)(`${i}${c}`),(0,s.B)(`${i}/charts/income_daily${c}`)]),g=(u&&"object"==typeof u&&"data"in u?u.data:u)??{},y=g?.income_total_stats?.currency?.symbol||g?.income_services_stats?.currency?.symbol||g?.income_goods_stats?.currency?.symbol||"‚Ç¥",m={total:r(g?.income_total_stats?.current_sum),services:r(g?.income_services_stats?.current_sum),goods:r(g?.income_goods_stats?.current_sum),avgCheck:g?.income_average_stats?r(g.income_average_stats.current_sum):null},p=d?.find(e=>(e.label||"").toLowerCase().includes("revenue"))||d?.[0];return{range:{date_from:t,date_to:a},currency:y,totals:m,incomeDaily:p?.data?.map(([e,t])=>({date:e,value:Number(t)||0}))??[]}}function i(){let e=process.env.ALTEGIO_COMPANY_ID?.trim(),t=n.B0.PARTNER_ID||n.B0.APPLICATION_ID,a=e||t;if(!a)throw Error("ALTEGIO_COMPANY_ID is required to fetch inventory transactions (optionally can fall back to ALTEGIO_PARTNER_ID / ALTEGIO_APPLICATION_ID)");return a}async function c(e){let{date:t}=e,a=i();try{console.log(`[altegio/inventory] Fetching warehouse balance for date ${t} using GET /goods/${a}`);let e=`/goods/${a}`,o=[];try{let t=await (0,s.B)(e);if(o=Array.isArray(t)?t:t&&"object"==typeof t&&Array.isArray(t.data)?t.data:t&&"object"==typeof t&&Array.isArray(t.goods)?t.goods:t&&"object"==typeof t&&Array.isArray(t.items)?t.items:[],console.log(`[altegio/inventory] ‚úÖ Fetched ${o.length} goods from GET /goods/${a}`),o.length>0){let e=o[0];console.log("[altegio/inventory] Sample good structure:",{id:e.id,title:e.title||e.name,hasActualAmounts:Array.isArray(e.actual_amounts),actualAmountsLength:Array.isArray(e.actual_amounts)?e.actual_amounts.length:0,defaultCostPerUnit:e.default_cost_per_unit,costPerUnit:e.cost_per_unit,allKeys:Object.keys(e).slice(0,20)}),Array.isArray(e.actual_amounts)&&e.actual_amounts.length>0&&console.log("[altegio/inventory] Sample actual_amounts:",JSON.stringify(e.actual_amounts[0],null,2))}}catch(e){for(let t of(console.error(`[altegio/inventory] ‚ùå Failed to fetch from GET /goods/${a}:`,e?.message||String(e)),[`/storages/${a}/goods`,`/company/${a}/goods`]))try{console.log(`[altegio/inventory] Trying fallback: ${t}`);let e=await (0,s.B)(t);if((o=Array.isArray(e)?e:e&&"object"==typeof e&&Array.isArray(e.data)?e.data:e&&"object"==typeof e&&Array.isArray(e.goods)?e.goods:[]).length>0){console.log(`[altegio/inventory] ‚úÖ Fetched ${o.length} goods from ${t}`);break}}catch(e){console.log(`[altegio/inventory] ‚ùå Failed to fetch from ${t}:`,e?.message)}}if(0===o.length){console.log(`[altegio/inventory] ‚ö†Ô∏è No goods found from direct API, calculating balance from transactions...`);let e=new URLSearchParams({start_date:"2000-01-01",end_date:t}),o=`/storages/transactions/${a}?${e.toString()}`,n=await (0,s.B)(o),r=Array.isArray(n)?n:n&&"object"==typeof n&&Array.isArray(n.data)?n.data:[],l=r.reduce((e,t)=>{let a=Number(t.type_id),o=Math.abs(Number(t.amount)||0),n=Number(t.cost_per_unit)||0;if(o>0&&n>0){let t=o*n;return e+(1===a?-t:t)}return e},0);return console.log(`[altegio/inventory] Warehouse balance on ${t} (calculated from transactions): ${l} (from ${r.length} transactions)`),l}let n=0,r=0,l=0;for(let e of o){let t=Number(e.default_cost_per_unit)||Number(e.cost_per_unit)||Number(e.cost)||Number(e.purchase_price)||Number(e.wholesale_price)||0;if(t<=0)continue;let a=0;if(Array.isArray(e.actual_amounts)&&e.actual_amounts.length>0&&(a=e.actual_amounts.reduce((e,t)=>{let a="object"==typeof t&&null!==t?Math.abs(Number(t.amount)||Number(t.quantity)||Number(t.count)||0):Math.abs(Number(t)||0);return e+a},0)),0===a&&(a=Math.abs(Number(e.amount)||Number(e.quantity)||Number(e.count)||Number(e.qty)||Number(e.balance)||Number(e.stock)||Number(e.total_amount)||0)),a>0&&t>0){let e=a*t;n+=e,r++}else l++}return console.log(`[altegio/inventory] ‚úÖ Warehouse balance on ${t}: ${n} UAH`),console.log(`[altegio/inventory]   - Goods with stock: ${r}`),console.log(`[altegio/inventory]   - Goods without stock/cost: ${l}`),console.log(`[altegio/inventory]   - Total goods processed: ${o.length}`),n}catch(e){return console.error(`[altegio/inventory] ‚ùå Failed to get warehouse balance:`,e?.message||String(e)),0}}async function u(e){let{date_from:t,date_to:o}=e,n=i(),r=null;try{let e=new Date(t),o=e.getFullYear(),n=e.getMonth()+1,s=`finance:goods:cost:${o}:${n}`;console.log(`[altegio/inventory] Checking for manual cost: key=${s}, year=${o}, month=${n}`);let l=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(l&&"function"==typeof l.getRaw){let e=await l.getRaw(s);if(console.log(`[altegio/inventory] KV read result for ${s}:`,{hasValue:null!==e,valueType:typeof e,valuePreview:e?String(e).slice(0,100):null}),null!==e&&"string"==typeof e){let t=null;try{let a=JSON.parse(e);if(console.log("[altegio/inventory] Parsed JSON:",{parsed:a,type:typeof a}),"number"==typeof a)t=a;else if("object"==typeof a&&null!==a){let e=a.value??a;t="number"==typeof e?e:"string"==typeof e?parseFloat(e):parseFloat(String(e))}else t="string"==typeof a?parseFloat(a):parseFloat(String(a))}catch{console.log("[altegio/inventory] Not JSON, trying parseFloat:",e),t=parseFloat(e)}console.log("[altegio/inventory] Parsed cost value:",{costValue:t,isFinite:Number.isFinite(t),isNonNegative:null!==t&&t>=0}),null!==t&&Number.isFinite(t)&&t>=0?(r=t,console.log(`[altegio/inventory] ‚úÖ Using manual cost for ${o}-${n}: ${r}`)):console.log(`[altegio/inventory] ‚ö†Ô∏è Invalid cost value: ${t} (not finite or negative)`)}else console.log(`[altegio/inventory] ‚ö†Ô∏è No raw value found or wrong type for ${s}`)}else console.warn(`[altegio/inventory] ‚ö†Ô∏è kvReadModule.getRaw is not a function`)}catch(e){console.error(`[altegio/inventory] ‚ùå Failed to check manual cost:`,e?.message||String(e),e?.stack)}let l=new URLSearchParams({start_date:t,end_date:o}),c=`/storages/transactions/${n}?${l.toString()}`,u=await (0,s.B)(c),d=Array.isArray(u)?u:u&&"object"==typeof u&&Array.isArray(u.data)?u.data:[];if(console.log(`[altegio/inventory] Fetched ${d.length} transactions`),d.length>0){let e=d[0];console.log("[altegio/inventory] Sample transaction structure:",{id:e.id,type_id:e.type_id,amount:e.amount,cost:e.cost,cost_per_unit:e.cost_per_unit,allKeys:Object.keys(e),possibleCostFields:Object.keys(e).filter(e=>e.toLowerCase().includes("cost")||e.toLowerCase().includes("price")||e.toLowerCase().includes("purchase")||e.toLowerCase().includes("wholesale")||e.toLowerCase().includes("buy"))}),console.log("[altegio/inventory] Full sample transaction:",JSON.stringify(e,null,2).substring(0,2e3))}let g=d.filter(e=>1===Number(e.type_id)),y=d.filter(e=>2===Number(e.type_id));if(console.log(`[altegio/inventory] filtered sales (type_id=1): ${g.length} items, purchases (type_id=2): ${y.length} items`),y.length>0){let e=y[0];console.log("[altegio/inventory] Sample purchase transaction (type_id=2):",{id:e.id,type_id:e.type_id,amount:e.amount,cost:e.cost,cost_per_unit:e.cost_per_unit,allKeys:Object.keys(e)})}let m=g.reduce((e,t)=>{let a=Math.abs(Number(t.cost)||0);return a>0?e+a:e+Math.abs(Number(t.amount)||0)*(Number(t.cost_per_unit)||0)},0),p=g.reduce((e,t)=>e+Math.abs(Number(t.amount)||0),0);console.log(`[altegio/inventory] üìä Sales transactions analysis:`),console.log(`  - Total sales transactions: ${g.length}`),console.log(`  - Total items sold (sum of amounts from transactions): ${p}`),g.length>0&&console.log("[altegio/inventory] Sample sales transactions:",JSON.stringify(g.slice(0,5).map(e=>({id:e.id,amount:e.amount,amount_abs:Math.abs(Number(e.amount)||0),good_id:e.good_id,good_title:e.good?.title||"N/A"})),null,2));let f=p,h=null,b=0,x=0,_=[],C=new Map;if(g.length>0)try{console.log(`[altegio/inventory] üîç Fetching sale documents to get default_cost_per_unit...`);let e=0,t=0,a=0,o=!1;for(let r=0;r<g.length;r+=10){let l=g.slice(r,r+10),i=l.map(async e=>{let a=e.document_id||e.id,r=Math.abs(Number(e.amount)||0);if(!a)return null;try{let l=`/company/${n}/sale/${a}`,i=await (0,s.B)(l),c=0;if(Array.isArray(i.items)&&(0===t&&(console.log(`[altegio/inventory] üìã Sample sale document items structure:`,JSON.stringify(i.items.slice(0,3),null,2)),console.log(`[altegio/inventory] üìã Full sale document keys:`,Object.keys(i))),c=i.items.reduce((e,a)=>{let o=Math.abs(Number(a.amount)||Number(a.quantity)||Number(a.count)||Number(a.qty)||Number(a.amount_sold)||0);return 0===t&&0===e&&console.log(`[altegio/inventory] üìã Sample item structure:`,JSON.stringify(a,null,2)),e+o},0),0===c&&i.items.length>0)){let e=i.items.reduce((e,t)=>{let a=Math.abs(Number(t.quantity)||Number(t.qty)||Number(t.count)||Number(t.amount)||1);return e+a},0);e>0?(c=e,console.log(`[altegio/inventory] ‚úÖ Calculated itemsCount from items array: ${c}`)):(c=i.items.length,console.log(`[altegio/inventory] ‚ö†Ô∏è Items array has no amount/quantity, using items.length: ${c}`))}if(0===c&&Array.isArray(i.goods)&&(c=i.goods.reduce((e,t)=>{let a=Math.abs(Number(t.amount)||Number(t.quantity)||Number(t.count)||Number(t.qty)||0);return e+a},0),0===c&&i.goods.length>0&&(c=i.goods.length)),0===c){let e=Math.abs(Number(i.quantity)||Number(i.total_quantity)||0);e>0&&(c=e)}0===c&&r>0&&(c=r),t<3&&console.log(`[altegio/inventory] üìÑ Sale document ${a}: itemsCount=${c}, hasItems=${Array.isArray(i.items)}, hasGoods=${Array.isArray(i.goods)}, docKeys=${Object.keys(i).slice(0,10).join(", ")}`);let u=null;if("number"==typeof i.default_cost_per_unit&&(u=i.default_cost_per_unit),Array.isArray(i.items)&&i.items.length>0)for(let e of i.items){let t=e.good_id||e.good?.id||e.id,a=e.good?.title||e.good?.name||e.title||e.name||`–¢–æ–≤–∞—Ä #${t||"N/A"}`,o=Math.abs(Number(e.amount)||Number(e.quantity)||Number(e.count)||Number(e.qty)||1),n=e.default_cost_per_unit||u||0;if(o>0){let e=t||a,s=C.get(e);s?(s.quantity+=o,n>0&&(0===s.costPerUnit?s.costPerUnit=n:s.costPerUnit=(s.costPerUnit*(s.quantity-o)+n*o)/s.quantity,s.totalCost=s.costPerUnit*s.quantity)):C.set(e,{goodId:t,title:a,quantity:o,costPerUnit:n,totalCost:n*o})}}else if(c>0){let t=e.good_id,a=e.good?.title||e.good?.name||`–¢–æ–≤–∞—Ä #${t||e.id||"N/A"}`,o=t||a,n=C.get(o);n?(n.quantity+=c,u&&u>0&&(0===n.costPerUnit?n.costPerUnit=u:n.costPerUnit=(n.costPerUnit*(n.quantity-c)+u*c)/n.quantity,n.totalCost=n.costPerUnit*n.quantity)):C.set(o,{goodId:t,title:a,quantity:c,costPerUnit:u||0,totalCost:(u||0)*c})}if(null===u&&Array.isArray(i.items)){let t=i.items.find(t=>t.good_id===e.good_id||t.good?.id===e.good_id||t.id===e.good_id)||i.items[0];t&&"number"==typeof t.default_cost_per_unit&&(u=t.default_cost_per_unit)}if(null===u&&Array.isArray(i.goods)){let t=i.goods.find(t=>t.id===e.good_id||t.good_id===e.good_id)||i.goods[0];t&&"number"==typeof t.default_cost_per_unit&&(u=t.default_cost_per_unit)}if((!Array.isArray(i.items)||0===i.items.length)&&c>0){let t=e.good_id,a=e.good?.title||e.good?.name||`–¢–æ–≤–∞—Ä #${t||e.id||"N/A"}`,o=t||a,n=C.get(o);n?(n.quantity+=c,u&&u>0&&(0===n.costPerUnit?n.costPerUnit=u:n.costPerUnit=(n.costPerUnit*(n.quantity-c)+u*c)/n.quantity,n.totalCost=n.costPerUnit*n.quantity)):C.set(o,{goodId:t,title:a,quantity:c,costPerUnit:u||0,totalCost:(u||0)*c})}if(null!==u&&u>0){let e=u*c;return console.log(`[altegio/inventory] ‚úÖ Sale document ${a}: default_cost_per_unit=${u}, items=${c}, cost=${e}`),{cost:e,amount:c,itemsCount:c}}if(c>0)return{cost:0,amount:c,itemsCount:c};return o||(o=!0,console.log(`[altegio/inventory] ‚ö†Ô∏è Sale document ${a}: default_cost_per_unit not found. Document structure:`,JSON.stringify(i,null,2).substring(0,1e3))),null}catch(e){return console.log(`[altegio/inventory] ‚ö†Ô∏è Failed to fetch sale document ${a}:`,e?.message||String(e)),null}}),c=await Promise.all(i),u=c.filter(e=>null!==e&&"object"==typeof e&&"itemsCount"in e);_.push(...u);let d=u.filter(e=>e.cost>0);for(let t of(e+=d.reduce((e,t)=>e+t.cost,0),b+=d.reduce((e,t)=>e+t.amount,0),x+=d.length,l.filter((e,t)=>null===c[t]))){let e=Math.abs(Number(t.amount)||0);if(e>0){let a=t.good_id,o=t.good?.title||t.good?.name||`–¢–æ–≤–∞—Ä #${a||t.id||"N/A"}`,n=a||o,s=C.get(n);s?(s.quantity+=e,s.totalCost=s.costPerUnit*s.quantity):C.set(n,{goodId:a,title:o,quantity:e,costPerUnit:0,totalCost:0}),_.push({cost:0,amount:e,itemsCount:e})}}t+=u.length,a+=c.length-u.length,r+10<g.length&&await new Promise(e=>setTimeout(e,100))}if(_.length>0?(f=_.reduce((e,t)=>e+t.itemsCount,0),console.log(`[altegio/inventory] üì¶ Total items sold from sale documents: ${f} (from ${_.length} documents, fallback was ${p})`)):console.log(`[altegio/inventory] ‚ö†Ô∏è No sale documents retrieved, using fallback: ${p} items from transactions`),0===C.size&&g.length>0){for(let e of(console.log(`[altegio/inventory] ‚ö†Ô∏è No goods collected from sale documents, collecting from storage transactions...`),g)){let t=Math.abs(Number(e.amount)||0);if(t>0){let a=e.good_id,o=e.good?.title||e.good?.name||`–¢–æ–≤–∞—Ä #${a||e.id||"N/A"}`,n=a||o,s=C.get(n);s?(s.quantity+=t,s.totalCost=s.costPerUnit*s.quantity):C.set(n,{goodId:a,title:o,quantity:t,costPerUnit:0,totalCost:0})}}console.log(`[altegio/inventory] üì¶ Collected ${C.size} goods from storage transactions`)}e>0?(h=e,console.log(`[altegio/inventory] ‚úÖ Calculated cost from sale documents (default_cost_per_unit): ${h} (transactions: ${x}/${g.length}, items: ${b}, failed: ${a})`)):console.log(`[altegio/inventory] ‚ö†Ô∏è No cost found from sale documents (successful: ${t}, failed: ${a})`)}catch(e){console.warn(`[altegio/inventory] ‚ö†Ô∏è Failed to fetch cost from sale documents:`,e?.message||String(e))}if(null===h&&y.length>0){let e=y.reduce((e,t)=>{let a=Number(t.cost_per_unit)||0,o=Math.abs(Number(t.amount)||0);if(a>0&&o>0)return e+a*o;let n=Math.abs(Number(t.cost)||0);return n>0?e+n:e},0);e>0&&(h=e,console.log(`[altegio/inventory] ‚úÖ Calculated cost from purchase transactions: ${h}`))}if(null===h&&g.length>0){let e=Object.keys(g[0]);console.log("[altegio/inventory] All keys in sales transaction:",e);let t=e.filter(e=>e.toLowerCase().includes("wholesale")||e.toLowerCase().includes("purchase")||e.toLowerCase().includes("buy")||e.toLowerCase().includes("cost")&&!e.toLowerCase().includes("per")&&!e.toLowerCase().includes("total"));if(t.length>0){console.log("[altegio/inventory] Found possible cost fields in sales:",t);let e=g.reduce((e,a)=>{for(let o of t){let t=Number(a[o])||0;if(t>0){let n=Math.abs(Number(a.amount)||0);if(o.toLowerCase().includes("per")||o.toLowerCase().includes("unit"))return e+t*n;return e+Math.abs(t)}}return e},0);e>0&&(h=e,console.log(`[altegio/inventory] ‚úÖ Calculated cost from sales transactions (fields: ${t.join(", ")}): ${h}`))}if(null===h&&y.length>0){console.log(`[altegio/inventory] üîç Trying to match sales with purchases by good_id...`);let e=new Map;for(let t of[...y].sort((e,t)=>{let a=new Date(e.create_date||0).getTime();return new Date(t.create_date||0).getTime()-a})){let a=t.good_id||t.good?.id;if(a&&!e.has(a)){let o=Number(t.cost_per_unit)||0,n=Math.abs(Number(t.cost)||0),s=Math.abs(Number(t.amount)||0),r=0;o>0?r=o:n>0&&s>0&&(r=n/s),r>0&&(e.set(a,r),console.log(`[altegio/inventory] Mapped good_id ${a} to purchase price: ${r}`))}}if(e.size>0){let t=g.reduce((t,a)=>{let o=a.good_id||a.good?.id,n=Math.abs(Number(a.amount)||0);return o&&e.has(o)&&n>0?t+e.get(o)*n:t},0);t>0&&(h=t,console.log(`[altegio/inventory] ‚úÖ Calculated cost by matching sales with purchases: ${h} (matched ${e.size} goods)`))}}if(null===h){let e=g.reduce((e,t)=>{let a=Number(t.cost_per_unit)||0,o=Math.abs(Number(t.amount)||0);return a>0&&o>0?e+a*o:e},0);e>0&&(h=e,console.log(`[altegio/inventory] ‚ö†Ô∏è Using cost_per_unit as cost (may be incorrect if it's sale price): ${h}`))}}if(null===h)try{console.log(`[altegio/inventory] üîç Trying Payments API for cost data...`);let e=`/transactions/${n}?start_date=${t}&end_date=${o}&real_money=1&deleted=0&count=1000`,a=await (0,s.B)(e),r=(Array.isArray(a)?a:a&&"object"==typeof a&&Array.isArray(a.data)?a.data:[]).filter(e=>{let t=e.expense?.title||e.expense?.name||"";return t.toLowerCase().includes("purchase")||t.toLowerCase().includes("product purchase")||t.toLowerCase().includes("–∑–∞–∫—É–ø–∫–∞")||"purchase"===e.type});if(r.length>0){console.log(`[altegio/inventory] Found ${r.length} purchase transactions in Payments API`);let e=r.reduce((e,t)=>{let a=Math.abs(Number(t.amount)||0);return e+a},0);e>0&&(h=e,console.log(`[altegio/inventory] ‚úÖ Calculated cost from Payments API purchase transactions: ${h}`))}}catch(e){console.warn(`[altegio/inventory] ‚ö†Ô∏è Failed to fetch cost from Payments API:`,e?.message||String(e))}let w=null!==r?r:0;null!==r?console.log(`[altegio/inventory] ‚úÖ Using manual cost: ${r}`):(console.log(`[altegio/inventory] ‚ö†Ô∏è No manual cost found, using 0. Please enter cost manually.`),null!==h&&console.log(`[altegio/inventory] ‚ÑπÔ∏è Calculated cost from API (not used): ${h}`));let $=m-w;console.log(`[altegio/inventory] Profit = revenue - cost: ${$} (revenue: ${m}, cost: ${w})`);let N=Array.from(C.values()).sort((e,t)=>e.title.localeCompare(t.title,"uk-UA"));return console.log(`[altegio/inventory] üì¶ Collected ${N.length} unique goods from sale documents`),{range:{date_from:t,date_to:o},revenue:m,cost:w,profit:$,itemsCount:g.length,totalItemsSold:f,costItemsCount:b>0?b:void 0,costTransactionsCount:x>0?x:void 0,goodsList:N.length>0?N:void 0}}function d(){let e=process.env.ALTEGIO_COMPANY_ID?.trim(),t=n.B0.PARTNER_ID||n.B0.APPLICATION_ID,a=e||t;if(!a)throw Error("ALTEGIO_COMPANY_ID is required to fetch expenses (optionally can fall back to ALTEGIO_PARTNER_ID / ALTEGIO_APPLICATION_ID)");return a}async function g(){let e=d();for(let t of["/expenses",`/expenses/${e}`,`/company/${e}/expenses`,`/expenses?company_id=${e}`,`/company/${e}/expense_categories`,`/expense_categories/${e}`,`/expense_categories?company_id=${e}`])try{console.log(`[altegio/expenses] üîç Fetching categories: ${t}`);let e=await (0,s.B)(t);console.log("[altegio/expenses] Raw response type:",typeof e),console.log("[altegio/expenses] Raw response keys:",e&&"object"==typeof e?Object.keys(e):"not an object");let a=[];if(Array.isArray(e)?a=e:e&&"object"==typeof e&&(Array.isArray(e.data)?a=e.data:Array.isArray(e.expenses)?a=e.expenses:Array.isArray(e.categories)?a=e.categories:Array.isArray(e.items)?a=e.items:e.success&&Array.isArray(e.data)&&(a=e.data)),a.length>0)return console.log(`[altegio/expenses] ‚úÖ Got ${a.length} expense categories using ${t}`),console.log("[altegio/expenses] Sample category:",a[0]),a;console.log(`[altegio/expenses] ‚ö†Ô∏è No categories found in response from ${t}`)}catch(e){console.warn(`[altegio/expenses] ‚ùå Failed to fetch categories from ${t}:`,e?.message||String(e));continue}return console.warn(`[altegio/expenses] ‚ö†Ô∏è No expense categories found from any endpoint`),[]}async function y(e,t){try{let o=`finance:expenses:${e}:${t}`;console.log(`[altegio/expenses] Checking for manual expenses: key=${o}, year=${e}, month=${t}`);let n=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(n&&"function"==typeof n.getRaw){let a=await n.getRaw(o);if(console.log(`[altegio/expenses] KV read result for ${o}:`,{hasValue:null!==a,valueType:typeof a,valuePreview:a?String(a).slice(0,100):null}),null!==a&&"string"==typeof a){let o=null;try{let e=JSON.parse(a);if(console.log("[altegio/expenses] Parsed JSON:",{parsed:e,type:typeof e}),"number"==typeof e)o=e;else if("object"==typeof e&&null!==e){let t=e.value??e;o="number"==typeof t?t:"string"==typeof t?parseFloat(t):parseFloat(String(t))}else o="string"==typeof e?parseFloat(e):parseFloat(String(e))}catch{o=parseFloat(a)}if(null!==o&&Number.isFinite(o)&&o>=0)return console.log(`[altegio/expenses] ‚úÖ Using manual expenses for ${e}-${t}: ${o}`),o}}}catch(e){console.error(`[altegio/expenses] ‚ùå Failed to check manual expenses:`,e?.message||String(e))}return null}async function m(e){let{date_from:t,date_to:a}=e,o=d(),n=new Date(t),r=n.getFullYear(),l=n.getMonth()+1,i=await y(r,l),c=[],u=new Map;try{for(let e of c=await g()){let t=e.name||e.title||e.category||`–ö–∞—Ç–µ–≥–æ—Ä—ñ—è ${e.id}`;u.set(e.id,t)}}catch(e){console.log(`[altegio/expenses] ‚ö†Ô∏è Could not fetch categories, will extract from transactions`)}let m=[{name:"POST /company/{id}/finance_transactions/search (NO FILTERS)",method:"POST",path:`/company/${o}/finance_transactions/search`,body:{start_date:t,end_date:a,count:1e4,page:1}},{name:"POST /company/{id}/finance_transactions/search (minimal filters)",method:"POST",path:`/company/${o}/finance_transactions/search`,body:{start_date:t,end_date:a,deleted:!1,count:1e4,page:1}},{name:"GET /transactions/{location_id} (NO FILTERS)",method:"GET",path:`/transactions/${o}`,params:new URLSearchParams({start_date:t,end_date:a,count:"10000"})},{name:"GET /transactions/{location_id} (minimal filters)",method:"GET",path:`/transactions/${o}`,params:new URLSearchParams({start_date:t,end_date:a,deleted:"0",count:"10000"})},{name:"GET /finance_transactions/{location_id} (NO FILTERS)",method:"GET",path:`/finance_transactions/${o}`,params:new URLSearchParams({start_date:t,end_date:a,count:"10000"})},{name:"GET /finance_transactions/{location_id} (minimal filters)",method:"GET",path:`/finance_transactions/${o}`,params:new URLSearchParams({start_date:t,end_date:a,deleted:"0",count:"10000"})},{name:"GET /transactions/{location_id} (date_from/date_to)",method:"GET",path:`/transactions/${o}`,params:new URLSearchParams({date_from:t,date_to:a,real_money:"1",deleted:"0",count:"1000"})},{name:"GET /company/{id}/analytics/expenses",method:"GET",path:`/company/${o}/analytics/expenses`,params:new URLSearchParams({date_from:t,date_to:a})},{name:"GET /company/{id}/analytics/overall (check for expenses)",method:"GET",path:`/company/${o}/analytics/overall`,params:new URLSearchParams({date_from:t,date_to:a})},{name:"GET /finance_transactions with location_id",method:"GET",path:"/finance_transactions",params:new URLSearchParams({location_id:o,start_date:t,end_date:a,real_money:"1",deleted:"0",count:"1000"})},{name:"GET /finance_transactions with location_id (date_from/date_to)",method:"GET",path:"/finance_transactions",params:new URLSearchParams({location_id:o,date_from:t,date_to:a,real_money:"1",deleted:"0",count:"1000"})},{name:"GET /company/{id}/finance_transactions with start_date/end_date",method:"GET",path:`/company/${o}/finance_transactions`,params:new URLSearchParams({start_date:t,end_date:a,real_money:"1",deleted:"0",count:"1000"})},{name:"GET /company/{id}/finance_transactions with date_from/date_to",method:"GET",path:`/company/${o}/finance_transactions`,params:new URLSearchParams({date_from:t,date_to:a,real_money:"1",deleted:"0",count:"1000"})},{name:"POST /company/{id}/finance_transactions/search",method:"POST",path:`/company/${o}/finance_transactions/search`,body:{start_date:t,end_date:a,real_money:!0,deleted:!1,count:1e3}},{name:"GET /company/{id}/payments",method:"GET",path:`/company/${o}/payments`,params:new URLSearchParams({start_date:t,end_date:a,count:"1000"})},{name:"GET /finance_transactions/{id} (fallback)",method:"GET",path:`/finance_transactions/${o}`,params:new URLSearchParams({date_from:t,date_to:a,count:"1000"})}],p=[],f=null;for(let e of m)try{let t=e.path;e.params&&(t=`${e.path}?${e.params.toString()}`),console.log(`[altegio/expenses] üîç Trying ${e.name}: ${t} (${e.method})`);let a=await (0,s.B)("POST"===e.method?e.path:t,"POST"===e.method?{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.body||{})}:{});if(console.log("[altegio/expenses] Response type:",typeof a),console.log("[altegio/expenses] Response is array:",Array.isArray(a)),a&&"object"==typeof a){if(console.log("[altegio/expenses] Response keys:",Object.keys(a)),e.path.includes("/transactions/")||e.path.includes("/finance_transactions/")){if(a.data,console.log(`[altegio/expenses] ${e.path.includes("/finance_transactions/")?"Financial Operations":"Payments"} API response structure:`,{hasSuccess:!!a.success,hasData:Array.isArray(a.data),dataLength:Array.isArray(a.data)?a.data.length:0,hasMeta:!!a.meta,sampleTransaction:Array.isArray(a.data)&&a.data.length>0?JSON.stringify(a.data[0],null,2).substring(0,1e3):null}),Array.isArray(a.data)&&a.data.length>0){let t=a.data[0];console.log(`[altegio/expenses] Sample ${e.path.includes("/finance_transactions/")?"Financial Operations":"Payments"} transaction:`,{id:t.id,expense_id:t.expense_id,expense:t.expense,amount:t.amount,type:t.type,type_id:t.type_id,date:t.date,comment:t.comment,allKeys:Object.keys(t)})}}else if(e.path.includes("analytics/overall")){let e=a.data||a;console.log("[altegio/expenses] Analytics overall data keys:",e&&"object"==typeof e?Object.keys(e):"not an object");let t=Object.keys(e||{}).filter(e=>e.toLowerCase().includes("expense")||e.toLowerCase().includes("outcome")||e.toLowerCase().includes("cost")||e.toLowerCase().includes("spending"));t.length>0&&(console.log("[altegio/expenses] Found possible expense keys:",t),t.forEach(t=>{console.log(`[altegio/expenses] ${t}:`,JSON.stringify(e[t],null,2).substring(0,500))}))}}let o=[];if(Array.isArray(a))o=a;else if(a&&"object"==typeof a){if(Array.isArray(a.data))o=a.data;else if(Array.isArray(a.transactions))o=a.transactions;else if(a.success&&Array.isArray(a.data))o=a.data;else if(a.expenses&&Array.isArray(a.expenses))o=a.expenses;else if(a.totals&&a.totals.expenses&&Array.isArray(a.totals.expenses))o=a.totals.expenses;else if(a.expenses_data&&Array.isArray(a.expenses_data))o=a.expenses_data;else if(e.path.includes("analytics/overall")){let e=a.data||a;e&&"object"==typeof e&&(Array.isArray(e.expenses)?o=e.expenses:Array.isArray(e.expense_transactions)?o=e.expense_transactions:e.expense_stats&&Array.isArray(e.expense_stats.items)&&(o=e.expense_stats.items),o.length>0&&console.log(`[altegio/expenses] ‚úÖ Found ${o.length} expenses in analytics/overall`))}}if(o.length>0){p=o,console.log(`[altegio/expenses] ‚úÖ Got ${p.length} transactions using ${e.name}`);let t=p.filter(e=>{let t=e.expense?.title||e.expense?.name||"",a=e.comment||"";return t.toLowerCase().includes("–ø–æ–¥–∞—Ç")||t.toLowerCase().includes("tax")||a.toLowerCase().includes("–ø–æ–¥–∞—Ç")||a.toLowerCase().includes("–Ω–∞–ª–º–Ω")});t.length>0?console.log(`[altegio/expenses] ‚úÖ Found ${t.length} tax-related transactions:`,t.map(e=>({id:e.id,amount:e.amount,expense_title:e.expense?.title,comment:e.comment}))):console.log(`[altegio/expenses] ‚ö†Ô∏è No tax-related transactions found in ${p.length} transactions`);let a=new Set;p.forEach(e=>{let t=e.expense?.title||e.expense?.name||e.comment||"Unknown";a.add(t)}),console.log(`[altegio/expenses] Unique expense categories found (${a.size}):`,Array.from(a).slice(0,20));break}}catch(t){f=t instanceof Error?t:Error(String(t)),console.warn(`[altegio/expenses] Failed with ${e.name}:`,f.message);continue}if(0===p.length)return(f?console.error(`[altegio/expenses] ‚ùå All attempts failed, last error:`,f):console.warn(`[altegio/expenses] ‚ö†Ô∏è No transactions found, but no errors occurred`),null!==i&&i>0)?(console.log(`[altegio/expenses] ‚úÖ Using manual expenses: ${i}`),{range:{date_from:t,date_to:a},total:i,byCategory:{"–†—É—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏":i},transactions:[],categories:c}):{range:{date_from:t,date_to:a},total:0,byCategory:{},transactions:[],categories:c};console.log(`[altegio/expenses] Processing ${p.length} finance transactions`),p.length>0&&(console.log("[altegio/expenses] Sample transaction:",JSON.stringify(p[0],null,2)),console.log(`[altegio/expenses] Total transactions: ${p.length} (NO FILTERING)`));let h=p.filter(e=>e.expense_id||e.expense).length,b=p.length-h;console.log(`[altegio/expenses] Transactions with expense: ${h}, without expense: ${b}`);let x=p;console.log(`[altegio/expenses] ‚úÖ Including ALL ${x.length} transactions (NO FILTERING)`);let _=new Set;x.forEach(e=>{let t=e.expense?.title||e.expense?.name||e.comment||e.type||"Unknown";_.add(t)}),console.log(`[altegio/expenses] üìä ALL RAW CATEGORIES FROM API (${_.size} total):`,Array.from(_).sort()),x.slice(0,20).forEach((e,t)=>{let a=e.expense_id||e.expense?.id,o=e.expense?.title||e.expense?.name||"",n=e.comment||"";console.log(`[altegio/expenses] Transaction ${t+1}/${x.length} (ID: ${e.id}):`,{expense_id:a,expense_title:o,expense_name:e.expense?.name,type:e.type,type_id:e.type_id,amount:e.amount,comment:n.substring(0,100),hasExpense:!!(e.expense_id||e.expense),date:e.date})});let C={},w=0;function $(e){let t=e.trim();if(!t)return"–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏";let a=t.toLowerCase();return a.includes("–ø–æ–¥–∞—Ç")||a.includes("tax")||a.includes("–∑–±–æ—Ä")||a.includes("fee")?"–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏":a.includes("–∑–∞—Ä–ø–ª–∞—Ç")||a.includes("salary")||"–∑–ø"===a||a.includes("team salaries")?"–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º":a.includes("–æ—Ä–µ–Ω–¥")||a.includes("rent")?"–û—Ä–µ–Ω–¥–∞":a.includes("–±—É—Ö–≥–∞–ª—Ç–µ—Ä")||a.includes("accounting")?"–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—è":a.includes("–º–∞—Ä–∫–µ—Ç–∏–Ω–≥")||a.includes("marketing")?"–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥":a.includes("—Ä–µ–∫–ª–∞–º")||a.includes("advertising")||a.includes("—Ä–µ–∫–ª–∞–º–∞, –±—é–¥–∂–µ—Ç")?"–†–µ–∫–ª–∞–º–∞, –ë—é–¥–∂–µ—Ç, –§–ë":a.includes("–¥—ñ—Ä–µ–∫—Ç")||a.includes("direct")?"–î—ñ—Ä–µ–∫—Ç":a.includes("–µ–∫–≤–∞–π—Ä–∏–Ω–≥")||a.includes("acquiring")?"–ï–∫–≤–∞–π—Ä–∏–Ω–≥":(a.includes("–¥–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤")||a.includes("–¥–æ—Å—Ç–∞–≤–∫–∞"))&&(a.includes("–Ω–æ–≤–∞ –ø–æ—à—Ç–∞")||a.includes("nova poshta")||a.includes("–Ω–ø")||a.includes("–∫–∞—Å–∞ –Ω–æ–≤–∞ –ø–æ—à—Ç–∞"))?"–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–ù–æ–≤–∞ –ü–æ—à—Ç–∞)":(a.includes("—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç")||a.includes("internet")||a.includes("—ñ–Ω—Ç–µ—Ä–µ–Ω–µ—Ç"))&&(a.includes("crm")||a.includes("ip")||a.includes("—ñ—Ä")||a.includes("–∫–æ–º—É–Ω–∞–ª—å–Ω—ñ"))||a.includes("—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç")||a.includes("internet")||a.includes("—ñ–Ω—Ç–µ—Ä–µ–Ω–µ—Ç")?"–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç, CRM —ñ —Ç –¥.":a.includes("service payments")||a.includes("product sales")||a.includes("–ø—Ä–æ–¥–∞–∂ –ø–æ—Å–ª—É–≥")||a.includes("–Ω–∞–¥–∞–Ω–Ω—è –ø–æ—Å–ª—É–≥")?"Service payments":t}for(let e of x){let t=Math.abs(function(e){if("number"==typeof e)return e;if("string"==typeof e){let t=Number(e.replace(",","."));return Number.isFinite(t)?t:0}return 0}(e.amount));w+=t;let a="–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏";if(e.expense?.title)a=$(e.expense.title);else if(e.expense?.name)a=$(e.expense.name);else if(e.expense_id&&u.has(e.expense_id))a=$(u.get(e.expense_id));else if(e.expense?.category)a=$(e.expense.category);else if(e.comment&&e.comment.trim().length>0){let t=e.comment.toLowerCase();a=t.includes("–ø–æ–¥–∞—Ç")||t.includes("tax")||t.includes("–Ω–∞–ª–º–Ω")?"–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏":e.comment.length>50?e.comment.substring(0,50)+"...":e.comment}else e.type&&(a=`–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è (${e.type})`);C[a]=(C[a]||0)+t}console.log("[altegio/expenses] Categories found:",Object.keys(C)),C["–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏"]?console.log(`[altegio/expenses] ‚úÖ Found "–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏": ${C["–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏"]} –≥—Ä–Ω.`):console.log(`[altegio/expenses] ‚ö†Ô∏è "–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏" category NOT found in ${Object.keys(C).length} categories`);let N=w;return null!==i&&i>0&&(w>0?(C["–†—É—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏"]=(C["–†—É—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏"]||0)+i,N=w+i):(N=i,C["–†—É—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏"]=i),console.log(`[altegio/expenses] Added manual expenses: ${i}, final total: ${N}`)),console.log(`[altegio/expenses] Total expenses: ${N}, Categories: ${Object.keys(C).length}`),{range:{date_from:t,date_to:a},total:N,byCategory:C,transactions:x,categories:c}}a(9668),a(1756),a(9512),a(8630);var p=a(8570);let f=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/_components/EditableCostCell.tsx`),{__esModule:h,$$typeof:b}=f;f.default;let x=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/_components/EditableCostCell.tsx#EditableCostCell`);var _=a(7708);let C=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/FinanceReportClient.tsx`),{__esModule:w,$$typeof:$}=C;C.default;let N=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/FinanceReportClient.tsx#FinanceReportClient`),A=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/FinanceReportPageClient.tsx`),{__esModule:v,$$typeof:P}=A;A.default;let j=(0,p.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/finance-report/FinanceReportPageClient.tsx#FinanceReportPageClient`),S="force-dynamic";function F(e){return e.toISOString().slice(0,10)}function k(e){return new Date(e).toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"})}function T(e){return new Intl.NumberFormat("uk-UA",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(e))}function E(e,t){let a=new Date(e,t-1,1),o=new Date(e,t,0);return{from:F(a),to:F(o)}}async function L(e,t,o){try{let n=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(n&&"function"==typeof n.getRaw){let a=`finance:expenses:${o}:${e}:${t}`,s=await n.getRaw(a);if(null!==s&&"string"==typeof s)try{let e=JSON.parse(s),t=e?.value??e,a="number"==typeof t?t:parseFloat(String(t));if(Number.isFinite(a)&&a>=0)return a}catch{let e=parseFloat(s);if(Number.isFinite(e)&&e>=0)return e}}}catch(e){console.error(`[finance-report] Failed to read manual expense field ${o}:`,e)}return 0}async function R(e,t){let{from:o,to:n}=E(e,t),s=null;try{let o=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(o&&"function"==typeof o.getRaw){let a=`finance:expenses:${e}:${t}`,n=await o.getRaw(a);if(null!==n&&"string"==typeof n)try{let e=JSON.parse(n),t=e?.value??e,a="number"==typeof t?t:parseFloat(String(t));Number.isFinite(a)&&a>=0&&(s=a)}catch{let e=parseFloat(n);Number.isFinite(e)&&e>=0&&(s=e)}}}catch(e){console.error("[finance-report] Failed to read manual expenses:",e)}let r={};for(let a of["salary","rent","accounting","direct","taxes_extra","acquiring","consultations_count","new_paid_clients"])r[a]=await L(e,t,a);let i=0;try{let o=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(o&&"function"==typeof o.getRaw){let a=`finance:exchange-rate:usd:${e}:${t}`,n=await o.getRaw(a);if(null!==n&&"string"==typeof n)try{let e=JSON.parse(n),t=e?.value??e,a="number"==typeof t?t:parseFloat(String(t));Number.isFinite(a)&&a>0&&(i=a)}catch{let e=parseFloat(n);Number.isFinite(e)&&e>0&&(i=e)}}}catch(e){console.error("[finance-report] Failed to read exchange rate:",e)}async function d(e,t){let o=0,n=null;try{let o=(await a.e(4332).then(a.bind(a,4332))).kvRead;if(o&&"function"==typeof o.getRaw){let a=`finance:warehouse:balance:${e}:${t}`,s=await o.getRaw(a);if(null!==s&&"string"==typeof s)try{let e=JSON.parse(s),t=e?.value??e,a="number"==typeof t?t:parseFloat(String(t));Number.isFinite(a)&&a>=0&&(n=a)}catch{let e=parseFloat(s);Number.isFinite(e)&&e>=0&&(n=e)}}}catch(a){console.error(`[finance-report] Failed to read manual warehouse balance for ${e}-${t}:`,a)}if(null!==n)o=n;else try{let a=E(e,t);o=await c({date:a.to})}catch(a){console.error(`[finance-report] Failed to get warehouse balance for ${e}-${t}:`,a)}return o}let g=await d(e,t),y=1===t?12:t-1,p=1===t?e-1:e,f=g-await d(p,y);try{let[e,t,a]=await Promise.all([l({date_from:o,date_to:n}),u({date_from:o,date_to:n}),m({date_from:o,date_to:n})]),c=t&&t.cost>0?1e4*Math.ceil(t.cost/1e4):0,d=t?.cost||0,y=a?.byCategory["Product purchase"]||a?.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä—É"]||a?.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–∏–π —Ç–æ–≤–∞—Ä"]||0,p=a?.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó –≤ —Å–∞–ª–æ–Ω"]||a?.byCategory["–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–∞–ª–æ–Ω"]||a?.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó"]||0,h=a?.byCategory["–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è"]||a?.byCategory["–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"]||0,b=e?.totals.services||0,x=e&&t?e.totals.goods-t.cost:0,_=b+x,C=a?.byCategory["–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º"]||a?.byCategory["Team salaries"]||0,w=a?.byCategory["–û—Ä–µ–Ω–¥–∞"]||a?.byCategory.Rent||0,$=r.rent||0,N=a?.byCategory["–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"]||a?.byCategory.Marketing||0,A=a?.byCategory["–¢–∞—Ä–≥–µ—Ç –æ–ø–ª–∞—Ç–∞ —Ä–æ–±–æ—Ç–∏ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥—ñ–≤"]||0,v=a?.byCategory["–†–µ–∫–ª–∞–º–∞, –ë—é–¥–∂–µ—Ç, –§–ë"]||0,P=a?.byCategory["–î—ñ—Ä–µ–∫—Ç"]||a?.byCategory.Direct||0,j=r.direct||0,S=a?.byCategory["–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏"]||a?.byCategory["Taxes and fees"]||0,F=r.taxes_extra||0,k=a?.byCategory["Miscellaneous expenses"]||a?.byCategory["–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏"]||0,T=a?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–ù–æ–≤–∞ –ü–æ—à—Ç–∞)"]||a?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–ö–∞—Å–∞ –ù–æ–≤–∞ –ü–æ—à—Ç–∞)"]||a?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤"]||0,E=a?.byCategory["Consumables purchase"]||a?.byCategory["–ó–∞–∫—É–ø—ñ–≤–ª—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤"]||0,L=a?.byCategory["–ö–∞–Ω—Ü–µ–ª—è—Ä—Å—å–∫—ñ, –º–∏—é—á—ñ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ –∑–∞—Å–æ–±–∏"]||0,R=a?.byCategory["–ü—Ä–æ–¥—É–∫—Ç–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π"]||0,O=a?.byCategory["–ï–∫–≤–∞–π—Ä–∏–Ω–≥"]||a?.byCategory.Acquiring||0,I=r.acquiring||0,U=a?.byCategory["–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç, CRM —ñ —Ç –¥."]||a?.byCategory["–Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, CRM, IP —ñ —Ç. –¥."]||a?.byCategory["–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ, –Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, –Ü–† —ñ —Ç. –¥."]||a?.byCategory["–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ, –Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, IP —ñ —Ç. –¥."]||0,M=a?.byCategory["–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—è"]||a?.byCategory.Accounting||0,q=r.accounting||0,G=C+((w>0?w:$)+(N+A+v+(P>0?P:j))+(S+F)+(k+T+E+L+R+(O>0?O:I)+U)+(M>0?M:q)),D=_-G,B=D-h,J=0;if(a?.transactions&&Array.isArray(a.transactions)&&(J=a.transactions.filter(e=>{let t=(e.account?.title||"").toLowerCase(),a=(e.account?.name||"").toLowerCase(),o=(e.comment||"").toLowerCase(),n=(e.expense?.title||e.expense?.name||"").toLowerCase();if(t.includes("—Ñ–æ–ø –æ—Ä–µ—Ö–æ–≤—Å—å–∫–∞")||t.includes("—Ñ–æ–ø –æ—Ä–µ—Ö–æ–≤—Å–∫–∞—è")||t.includes("–æ—Ä–µ—Ö–æ–≤—Å—å–∫–∞")||t.includes("–æ—Ä–µ—Ö–æ–≤—Å–∫–∞—è"))return!0;let s=a+" "+o+" "+n;return s.includes("–æ—Ä–µ—Ö–æ–≤—Å—å–∫–∞")||s.includes("–æ—Ä–µ—Ö–æ–≤—Å–∫–∞—è")||s.includes("—Ñ–æ–ø –æ—Ä–µ—Ö–æ–≤—Å—å–∫–∞")||s.includes("—Ñ–æ–ø –æ—Ä–µ—Ö–æ–≤—Å–∫–∞—è")}).reduce((e,t)=>{let a=Math.abs(Number(t.amount)||0);return e+a},0))>0){let e=a.transactions.filter(e=>{let t=(e.account?.title||"").toLowerCase();return t.includes("–æ—Ä–µ—Ö–æ–≤—Å—å–∫–∞")||t.includes("–æ—Ä–µ—Ö–æ–≤—Å–∫–∞—è")});console.log(`[finance-report] ‚úÖ Found ${e.length} transactions with –§–û–ü –û—Ä–µ—Ö–æ–≤—Å—å–∫–∞ account, total: ${J} –≥—Ä–Ω.`)}let Y=d+B-y-p+J,K=a?.byCategory["Product purchase"]||a?.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä—É"]||a?.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–∏–π —Ç–æ–≤–∞—Ä"]||0,z=a?.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó –≤ —Å–∞–ª–æ–Ω"]||a?.byCategory["–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–∞–ª–æ–Ω"]||a?.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó"]||0;return console.log(`[finance-report] üìä –Ü–Ω–∫–∞—Å–∞—Ü—ñ—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:`,{cost:d,ownerProfit:B,productPurchase:y,productPurchaseValue:K,investments:p,investmentsValue:z,fopOrekhovskaPayments:J,totalExpenses:G,totalIncome:_,profit:D,management:h,encashment:Y,calculation:`${d} + ${B} - ${y} - ${p} + ${J}`,expected:d+B-y-p+J,actual:Y,ownerProfitCalculation:`${D} - ${h} = ${B}`,profitCalculation:`${_} - ${G} = ${D}`,allCategories:a?.byCategory?Object.keys(a.byCategory).sort():[],productPurchaseCategories:a?.byCategory?Object.keys(a.byCategory).filter(e=>e.toLowerCase().includes("product")||e.toLowerCase().includes("–∑–∞–∫—É–ø")||e.toLowerCase().includes("purchase")):[],investmentCategories:a?.byCategory?Object.keys(a.byCategory).filter(e=>e.toLowerCase().includes("—ñ–Ω–≤–µ—Å—Ç")||e.toLowerCase().includes("–∏–Ω–≤–µ—Å—Ç")||e.toLowerCase().includes("investment")):[],productPurchaseFromCategory:a?.byCategory?{"Product purchase":a.byCategory["Product purchase"],"–ó–∞–∫—É–ø–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä—É":a.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–æ —Ç–æ–≤–∞—Ä—É"],"–ó–∞–∫—É–ø–ª–µ–Ω–∏–π —Ç–æ–≤–∞—Ä":a.byCategory["–ó–∞–∫—É–ø–ª–µ–Ω–∏–π —Ç–æ–≤–∞—Ä"]}:{},investmentsFromCategory:a?.byCategory?{"–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó –≤ —Å–∞–ª–æ–Ω":a.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó –≤ —Å–∞–ª–æ–Ω"],"–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–∞–ª–æ–Ω":a.byCategory["–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–∞–ª–æ–Ω"],–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó:a.byCategory["–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó"]}:{}}),{summary:e,goods:t,expenses:a,manualExpenses:s,manualFields:r,exchangeRate:i,warehouseBalance:g,warehouseBalanceDiff:f,hairPurchaseAmount:c,encashment:Y,fopOrekhovskaPayments:J,ownerProfit:B,encashmentComponents:{cost:d,ownerProfit:B,productPurchase:y,investments:p,fopPayments:J},error:null}}catch(e){return{summary:null,goods:null,expenses:null,manualExpenses:null,manualFields:{},exchangeRate:0,warehouseBalance:0,warehouseBalanceDiff:0,hairPurchaseAmount:0,encashment:0,fopOrekhovskaPayments:0,ownerProfit:0,encashmentComponents:{cost:0,ownerProfit:0,productPurchase:0,investments:0,fopPayments:0},error:String(e?.message||e)}}}async function O({searchParams:e}){(0,_.unstable_noStore)();let t=new Date,a=function(e){let t=new Date(e.getFullYear(),e.getMonth(),1);return t.setMonth(t.getMonth()-1),{year:t.getFullYear(),month:t.getMonth()+1}}(t),n=e?.year?Number(e.year):a.year,s=e?.month?Number(e.month):a.month,r=function(e){let t=[],a=e.getFullYear(),o=new Intl.DateTimeFormat("uk-UA",{month:"long"});for(let e=1;e<=12;e++){let n=new Date(a,e-1,1),s=o.format(n),r=s.charAt(0).toUpperCase()+s.slice(1);t.push({month:e,label:r})}return t}(t),l=t.getFullYear(),{summary:i,goods:c,expenses:u,manualExpenses:d,manualFields:g,exchangeRate:y,warehouseBalance:m,warehouseBalanceDiff:p,hairPurchaseAmount:f,encashment:h,fopOrekhovskaPayments:b,ownerProfit:C,encashmentComponents:w,error:$}=await R(n,s),A=i?.totals.services||0,v=i?.totals.goods||0,P=c?.cost||0,S=A+(i&&c?v-P:0),F=u?.byCategory["–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞–º"]||u?.byCategory["Team salaries"]||0,E=u?.byCategory["–û—Ä–µ–Ω–¥–∞"]||u?.byCategory.Rent||0,L=g.rent||0,O=u?.byCategory["–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—ñ—è"]||u?.byCategory.Accounting||0,I=g.accounting||0,U=u?.byCategory["–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥"]||u?.byCategory.Marketing||0,M=u?.byCategory["–¢–∞—Ä–≥–µ—Ç –æ–ø–ª–∞—Ç–∞ —Ä–æ–±–æ—Ç–∏ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥—ñ–≤"]||0,q=u?.byCategory["–†–µ–∫–ª–∞–º–∞, –ë—é–¥–∂–µ—Ç, –§–ë"]||0,G=u?.byCategory["–î—ñ—Ä–µ–∫—Ç"]||u?.byCategory.Direct||0,D=g.direct||0,B=u?.byCategory["–ü–æ–¥–∞—Ç–∫–∏ —Ç–∞ –∑–±–æ—Ä–∏"]||u?.byCategory["Taxes and fees"]||0,J=g.taxes_extra||0,Y=u?.byCategory["Miscellaneous expenses"]||u?.byCategory["–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏"]||0,K=u?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–ù–æ–≤–∞ –ü–æ—à—Ç–∞)"]||u?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤ (–ö–∞—Å–∞ –ù–æ–≤–∞ –ü–æ—à—Ç–∞)"]||u?.byCategory["–î–æ—Å—Ç–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤"]||0,z=u?.byCategory["Consumables purchase"]||u?.byCategory["–ó–∞–∫—É–ø—ñ–≤–ª—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤"]||0,V=u?.byCategory["–ö–∞–Ω—Ü–µ–ª—è—Ä—Å—å–∫—ñ, –º–∏—é—á—ñ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ –∑–∞—Å–æ–±–∏"]||0,W=u?.byCategory["–ü—Ä–æ–¥—É–∫—Ç–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π"]||0,H=u?.byCategory["–ï–∫–≤–∞–π—Ä–∏–Ω–≥"]||u?.byCategory.Acquiring||0,X=g.acquiring||0,Q=F+((E>0?E:L)+(U+M+q+(G>0?G:D))+(B+J)+(Y+K+z+V+W+(H>0?H:X)+(u?.byCategory["–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç, CRM —ñ —Ç –¥."]||u?.byCategory["–Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, CRM, IP —ñ —Ç. –¥."]||u?.byCategory["–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ, –Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, –Ü–† —ñ —Ç. –¥."]||u?.byCategory["–ö–æ–º—É–Ω–∞–ª—å–Ω—ñ, –Ü–Ω—Ç–µ—Ä–µ–Ω–µ—Ç, IP —ñ —Ç. –¥."]||0))+(O>0?O:I)),Z=S-Q,ee=r.find(e=>e.month===s)?.label||"";return(0,o.jsxs)(j,{summaryContent:i?o.jsx(N,{children:{block1:(0,o.jsxs)("section",{className:"card bg-base-100 shadow-sm relative h-full",children:[o.jsx("div",{className:"drag-handle absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-bold z-10 cursor-move",children:"1"}),o.jsx("div",{className:"card-body p-1.5",children:(0,o.jsxs)("table",{className:"table table-xs w-full border-collapse",children:[(0,o.jsxs)("colgroup",{children:[o.jsx("col",{className:"w-auto"}),o.jsx("col",{className:"w-40"}),o.jsx("col",{className:"w-20"})]}),o.jsx("thead",{children:o.jsx("tr",{className:"bg-yellow-300",children:(0,o.jsxs)("th",{className:"text-center text-xs font-semibold px-2 py-1",colSpan:3,children:[ee," ",n]})})}),(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs bg-blue-50",children:"–û–±–æ—Ä–æ—Ç (–í–∏—Ä—É—á–∫–∞)"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right font-semibold",children:T(i.totals.total)}),o.jsx("td",{className:"px-2 py-1 text-xs text-right",children:"100.0%"})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs pl-4",children:"–ü–æ—Å–ª—É–≥–∏"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right",children:T(i.totals.services)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right",children:[(i.totals.services/i.totals.total*100).toFixed(1),"%"]})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs pl-4",children:"–¢–æ–≤–∞—Ä–∏"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right",children:T(i.totals.goods)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right",children:[(i.totals.goods/i.totals.total*100).toFixed(1),"%"]})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs bg-red-50",children:o.jsx(x,{year:n,month:s,currentCost:c?.cost||0})}),o.jsx("td",{className:"px-2 py-1 text-xs text-right font-semibold",children:T(c?.cost||0)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right",children:[((c?.cost||0)/i.totals.total*100).toFixed(1),"%"]})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs bg-blue-50",children:"–î–æ—Ö—ñ–¥ (–ø–æ—Å–ª—É–≥–∏+—Ç–æ–≤–∞—Ä)"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right font-semibold",children:T(S)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right",children:[(S/i.totals.total*100).toFixed(1),"%"]})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs bg-red-50",children:"–†–æ–∑—Ö—ñ–¥"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right font-semibold",children:T(Q)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right",children:[(Q/i.totals.total*100).toFixed(1),"%"]})]}),(0,o.jsxs)("tr",{children:[o.jsx("td",{className:"px-2 py-1 text-xs bg-green-50 font-semibold",children:"–ü—Ä–∏–±—É—Ç–æ–∫ —Å–∞–ª–æ–Ω—É"}),o.jsx("td",{className:"px-2 py-1 text-xs text-right font-bold",children:T(Z)}),(0,o.jsxs)("td",{className:"px-2 py-1 text-xs text-right font-semibold",children:[(Z/i.totals.total*100).toFixed(1),"%"]})]})]})]})})]}),block2:null,block3:null,block4:null,block5:null}}):null,children:[(0,o.jsxs)("div",{className:"flex flex-col gap-1 md:flex-row md:items-end md:justify-between",children:[(0,o.jsxs)("div",{children:[o.jsx("h1",{className:"text-lg font-semibold",children:"–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç (Altegio)"}),i&&(0,o.jsxs)("p",{className:"text-xs text-gray-500",children:["–ü–µ—Ä—ñ–æ–¥:"," ",k(i.range.date_from)," ‚Äî"," ",k(i.range.date_to)]})]}),(0,o.jsxs)("form",{className:"flex flex-wrap items-center gap-2 text-sm",method:"GET",children:[(0,o.jsxs)("label",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gray-600",children:"–ú—ñ—Å—è—Ü—å:"}),o.jsx("select",{name:"month",defaultValue:String(s),className:"select select-bordered select-sm",children:r.map(e=>o.jsx("option",{value:e.month,children:e.label},e.month))})]}),(0,o.jsxs)("label",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gray-600",children:"–†—ñ–∫:"}),o.jsx("select",{name:"year",defaultValue:String(n),className:"select select-bordered select-sm",children:[l,l-1,l-2].map(e=>o.jsx("option",{value:e,children:e},e))})]}),o.jsx("button",{type:"submit",className:"btn btn-sm btn-primary",children:"–ü–æ–∫–∞–∑–∞—Ç–∏"})]})]}),$&&o.jsx("div",{className:"alert alert-error max-w-xl",children:(0,o.jsxs)("span",{children:["–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ Altegio: ",$]})})]})}},9668:(e,t,a)=>{"use strict";a.d(t,{a:()=>n,getCompaniesByGroup:()=>r,getCompany:()=>s});var o=a(7582);async function n(e){try{if(e){let t="string"==typeof e?parseInt(e,10):e;if(!isNaN(t))try{let e=await s(t);return e?[e]:[]}catch(e){console.warn(`[altegio/companies] Failed to get specific company ${t}, falling back to list:`,e)}}let t=await (0,o.B)("/companies"),a=[];if(Array.isArray(t)?a=t:t&&"object"==typeof t&&"data"in t&&(a=t.data||[]),e&&a.length>0){let t="string"==typeof e?e:String(e),o=a.filter(a=>{let o=String(a.id||a.company_id||"");return o===t||o===String(e)});if(o.length>0)return console.log(`[altegio/companies] Filtered companies by ID ${e}: found ${o.length} out of ${a.length}`),o;console.warn(`[altegio/companies] Company with ID ${e} not found in list. Total companies: ${a.length}`)}return a}catch(e){throw console.error("[altegio/companies] Failed to get companies:",e),e}}async function s(e){try{let t=await (0,o.B)(`/company/${e}`);if(t&&"object"==typeof t){if("id"in t)return t;if("data"in t&&t.data)return t.data}return null}catch(t){return console.error(`[altegio/companies] Failed to get company ${e}:`,t),null}}async function r(e){try{let t=String(e);for(let a of[`/companies?business_group_id=${t}`,`/companies?main_group_id=${t}`,`/companies?group_id=${t}`,`/business_groups/${t}/companies`,`/groups/${t}/companies`])try{let t=await (0,o.B)(a),n=[];if(Array.isArray(t)?n=t:t&&"object"==typeof t&&"data"in t&&(n=Array.isArray(t.data)?t.data:[]),n.length>0)return console.log(`[altegio/companies] Found ${n.length} companies by group ID ${e} using ${a}`),n}catch(e){console.log(`[altegio/companies] Endpoint ${a} failed, trying next...`);continue}return[]}catch(t){return console.error(`[altegio/companies] Failed to get companies by group ID ${e}:`,t),[]}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),o=t.X(0,[8948,4818,7708,7582,1756,6114,7493],()=>a(5729));module.exports=o})();