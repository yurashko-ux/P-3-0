(()=>{var e={};e.id=8164,e.ids=[8164],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7118:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>p,tree:()=>o}),s(8369),s(2675),s(5866);var a=s(3191),l=s(8716),r=s(7922),n=s.n(r),d=s(5231),i={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>d[e]);s.d(t,i);let o=["",{children:["admin",{children:["photo-reports",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8369)),"/Users/mykolay/P-3-0/web/app/admin/photo-reports/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2675)),"/Users/mykolay/P-3-0/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/mykolay/P-3-0/web/app/admin/photo-reports/page.tsx"],x="/admin/photo-reports/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/admin/photo-reports/page",pathname:"/admin/photo-reports",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8881:(e,t,s)=>{Promise.resolve().then(s.bind(s,1324))},1324:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(326),l=s(7577),r=s(38),n=s(8478);function d(){let[e,t]=(0,l.useState)(null),[s,d]=(0,l.useState)(!1),[i,o]=(0,l.useState)("Mykolay007"),[c,x]=(0,l.useState)(null),[m,p]=(0,l.useState)(!1),[h,u]=(0,l.useState)(null),[b,j]=(0,l.useState)(!1),[g,f]=(0,l.useState)(null),[N,y]=(0,l.useState)([]),[v,w]=(0,l.useState)("prod"),[k,S]=(0,l.useState)(!1),C=async()=>{d(!0),t(null);try{let e=await fetch("/api/telegram/test-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegramUsername:i,clientName:"Тестовий клієнт",serviceName:"Тестова послуга",minutesUntilEnd:15})}),s=await e.json();t(s)}catch(e){t({ok:!1,error:e instanceof Error?e.message:String(e)})}finally{d(!1)}},P=async()=>{p(!0);try{let e=await fetch("/api/telegram/debug"),t=await e.json();if(t.ok&&t.recentReports){let e={};t.recentReports.forEach(t=>{e[t.masterId]=(e[t.masterId]||0)+1}),x({totalReports:t.recentReports.length,reportsByMaster:e,recentReports:t.recentReports.slice(0,20)})}}catch(e){console.error("Failed to load analytics:",e)}finally{p(!1)}},M=async()=>{j(!0),f(null);try{let e=await fetch(`/api/photo-reports/services-stats?daysBack=30&includeFuture=${"test"===v?"true":"false"}`),t=await e.json();if(console.log("[photo-reports] Services stats response:",t),t.ok&&t.statsByMaster)u(t),f(null);else{let e=t.error||"Невідома помилка";f(e),console.error("Failed to load services stats:",t)}}catch(e){f(e instanceof Error?e.message:String(e)),console.error("Failed to load services stats:",e)}finally{j(!1)}},_=async()=>{if(!confirm("Ви впевнені, що хочете очистити всі фото-звіти? Цю дію неможливо скасувати."))return;let e=prompt("Введіть секретний ключ для підтвердження:");if(e){S(!0);try{let t=await fetch(`/api/photo-reports/clear?secret=${encodeURIComponent(e)}`,{method:"POST"}),s=await t.json();s.ok?(alert(`✅ Очищено ${s.deletedCount} фото-звітів`),await P()):alert(`❌ Помилка: ${s.error}`)}catch(e){alert(`❌ Помилка: ${e instanceof Error?e.message:String(e)}`)}finally{S(!1)}}},D=e=>{let t=e.id.toLowerCase(),s=e.name.toLowerCase(),a=(e.telegramUsername||"").toLowerCase();return t.includes("test")||s.includes("тест")||a.includes("test")||a.includes("mykolay007")},[$,A]=(0,l.useState)(!1),E="photo-reports-dashboard-layout",I=e=>{};return(0,a.jsxs)("main",{className:"mx-auto max-w-7xl px-6 py-8",children:[a.jsx("header",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Фото-звіти"}),a.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Тестування нагадувань та аналітика по майстрах."})]}),a.jsx(n.G,{storageKey:E,onEditModeChange:A,onSave:I})]})}),a.jsx(r.R,{storageKey:E,layoutVersion:"7",defaultLayout:[{i:"test-section",x:0,y:0,w:12,h:80},{i:"analytics",x:0,y:80,w:12,h:120},{i:"masters",x:0,y:200,w:12,h:60}],editMode:$,onSave:I,children:{"test-section":(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm h-full",children:[(0,a.jsxs)("div",{className:"drag-handle mb-4 flex cursor-move items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"\uD83E\uDDEA Тестове нагадування"}),a.jsx("span",{className:"text-xs text-slate-400",children:"Перетягніть за заголовок"})]}),a.jsx("p",{className:"mb-4 text-sm text-slate-600",children:"Відправ тестове нагадування про фото-звіт в Telegram. Користувач має бути зареєстрований (надіслати /start боту)."}),(0,a.jsxs)("div",{className:"mb-4 flex gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("label",{htmlFor:"username",className:"mb-2 block text-sm font-medium text-slate-700",children:"Telegram Username"}),a.jsx("input",{id:"username",type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"Mykolay007",className:"w-full rounded-lg border border-slate-300 px-4 py-2 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:C,disabled:s||!i,className:"rounded-lg bg-blue-600 px-6 py-2 font-semibold text-white shadow-md transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:s?"Відправка...":"Відправити тест"})})]}),e&&a.jsx("div",{className:`rounded-lg border p-4 ${e.ok?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:e.ok?(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-semibold text-green-800",children:"✅ Успішно!"}),a.jsx("p",{className:"mt-1 text-sm text-green-700",children:e.message}),e.chatId&&(0,a.jsxs)("p",{className:"mt-1 text-xs text-green-600",children:["Chat ID: ",e.chatId]})]}):(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-semibold text-red-800",children:"❌ Помилка"}),a.jsx("p",{className:"mt-1 text-sm text-red-700",children:e.error||"Невідома помилка"}),e.error?.includes("chatId not found")&&a.jsx("p",{className:"mt-2 text-xs text-red-600",children:"\uD83D\uDCA1 Підказка: Надішли /start боту в Telegram, щоб зареєструватися"})]})})]}),analytics:(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm h-full",children:[(0,a.jsxs)("div",{className:"drag-handle mb-4 flex cursor-move items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"\uD83D\uDCCA Аналітика по майстрах"}),a.jsx("span",{className:"text-xs text-slate-400",children:"Перетягніть за заголовок"})]}),a.jsx("div",{className:"mb-4 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs",children:[a.jsx("button",{onClick:()=>w("prod"),className:`rounded-full px-3 py-1 font-medium transition-colors ${"prod"===v?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Робочий режим"}),a.jsx("button",{onClick:()=>w("test"),className:`rounded-full px-3 py-1 font-medium transition-colors ${"test"===v?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:"Тестовий"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:M,disabled:b,className:"rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 transition-colors hover:bg-slate-200 disabled:cursor-not-allowed disabled:opacity-50",children:b?"Завантаження...":"Завантажити послуги"}),a.jsx("button",{onClick:P,disabled:m,className:"rounded-lg bg-slate-100 px-4 py-2 text-sm font-medium text-slate-700 transition-colors hover:bg-slate-200 disabled:cursor-not-allowed disabled:opacity-50",children:m?"Завантаження...":"Оновити звіти"}),a.jsx("button",{onClick:_,disabled:k,className:"rounded-lg bg-red-100 px-4 py-2 text-sm font-medium text-red-700 transition-colors hover:bg-red-200 disabled:cursor-not-allowed disabled:opacity-50",children:k?"Очищення...":"Очистити фото-звіти"})]})]})}),g&&(0,a.jsxs)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-4",children:[a.jsx("p",{className:"font-semibold text-red-800",children:"❌ Помилка завантаження послуг"}),a.jsx("p",{className:"mt-1 text-sm text-red-700",children:g}),a.jsx("p",{className:"mt-2 text-xs text-red-600",children:"Перевір логи в консолі браузера (F12) або логи Vercel для деталей."})]}),c?(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"rounded-lg bg-slate-50 p-4",children:h&&(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-slate-500",children:"Виконані послуги"}),a.jsx("p",{className:"mt-1 text-xl font-bold text-green-600",children:h.statsByMaster.reduce((e,t)=>e+(t.count||0),0)})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-slate-500",children:"Планові послуги"}),a.jsx("p",{className:"mt-1 text-xl font-bold text-slate-600",children:h.statsByMaster.reduce((e,t)=>e+(t.plannedCount||0),0)})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-slate-500",children:"Всього фото-звітів"}),a.jsx("p",{className:"mt-1 text-xl font-bold text-blue-600",children:"prod"===v?N.filter(e=>"master"===e.role&&!D(e)).reduce((e,t)=>e+(c.reportsByMaster[t.id]||0),0):c.totalReports})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs text-slate-500",children:"% фото-звітів"}),(()=>{let e=h.statsByMaster.reduce((e,t)=>e+(t.count||0),0),t=h.statsByMaster.reduce((e,t)=>e+(c.reportsByMaster[t.masterId]||0),0),s=e>0?Math.round(t/e*100):0;return(0,a.jsxs)("p",{className:`mt-1 text-xl font-bold ${s>=80?"text-green-600":s>=50?"text-yellow-600":"text-red-600"}`,children:[s,"%"]})})()]})]})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"mb-2 text-base font-semibold text-slate-800",children:"По майстрах"}),h&&(0,a.jsxs)("p",{className:"mb-2 text-xs text-slate-600",children:['Всього послуг "Нарощування волосся": ',h.hairExtensionAppointments,h.completedAppointments>0&&(0,a.jsxs)("span",{className:"ml-1 text-slate-400",children:["(з ",h.completedAppointments," завершених)"]})]}),a.jsx("div",{className:"space-y-1.5",children:N.filter(e=>"master"===e.role).filter(e=>"prod"!==v||!D(e)).map(e=>{let t=c.reportsByMaster[e.id]||0,s=h?.statsByMaster.find(t=>t.masterId===e.id),l=s?.count||0,r=s?.plannedCount||0,n=l>0?Math.round(t/l*100):0;return(0,a.jsxs)("div",{className:"rounded border border-slate-200 bg-white p-2",children:[a.jsx("div",{className:"mb-1.5 flex items-center justify-between",children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold text-slate-800",children:e.name}),a.jsx("p",{className:"text-[10px] text-slate-400",children:e.telegramUsername||"—"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-lg font-bold text-green-600",children:[l,(0,a.jsxs)("span",{className:"text-sm font-normal text-slate-400",children:["/",r]})]}),a.jsx("p",{className:"text-[10px] text-slate-500",children:"послуг"})]}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"text-lg font-bold text-blue-600",children:t}),a.jsx("p",{className:"text-[10px] text-slate-500",children:"фото"})]}),l>0?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:`text-sm font-bold ${n>=80?"text-green-600":n>=50?"text-yellow-600":"text-red-600"}`,children:[n,"%"]}),a.jsx("p",{className:"text-[10px] text-slate-500",children:"покриття"}),a.jsx("div",{className:"mt-0.5 h-1 w-full overflow-hidden rounded-full bg-slate-200",children:a.jsx("div",{className:`h-full transition-all ${n>=80?"bg-green-500":n>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${n}%`}})})]}):(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm font-bold text-slate-400",children:"—"}),a.jsx("p",{className:"text-[10px] text-slate-400",children:"покриття"})]})]})]},e.id)})})]}),c.recentReports.length>0&&(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"mb-3 text-lg font-semibold text-slate-800",children:"Останні звіти"}),a.jsx("div",{className:"space-y-2",children:c.recentReports.map(e=>a.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-slate-800",children:[e.clientName," • ",e.serviceName]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[e.masterName," •"," ",new Date(e.createdAt).toLocaleString("uk-UA")]})]}),(0,a.jsxs)("div",{className:"text-xs text-slate-500",children:[e.telegramFileIds?.length||0," фото"]})]})},e.id))})]})]}):a.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-8 text-center",children:a.jsx("p",{className:"text-slate-500",children:'Натисни "Оновити", щоб завантажити аналітику'})})]}),masters:(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm h-full",children:[(0,a.jsxs)("div",{className:"drag-handle mb-4 flex cursor-move items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"\uD83D\uDC65 Зареєстровані майстри"}),a.jsx("span",{className:"text-xs text-slate-400",children:"Перетягніть за заголовок"})]}),a.jsx("div",{className:"space-y-2",children:N.map(e=>a.jsx("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-slate-50 p-3",children:(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium text-slate-800",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[e.telegramUsername||"—"," • ",e.role,e.altegioStaffId&&(0,a.jsxs)("span",{children:[" • Altegio ID: ",e.altegioStaffId]})]})]})},e.id))})]})}})]})}},8369:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>d});var a=s(8570);let l=(0,a.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/photo-reports/page.tsx`),{__esModule:r,$$typeof:n}=l;l.default;let d=(0,a.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/photo-reports/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,4818,6114],()=>s(7118));module.exports=a})();