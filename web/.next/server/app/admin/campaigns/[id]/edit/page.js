(()=>{var e={};e.id=1870,e.ids=[1870],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1629:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>s.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>o}),a(7395),a(9057),a(95),a(2675),a(5866);var i=a(3191),r=a(8716),n=a(7922),s=a.n(n),l=a(5231),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);a.d(t,d);let o=["",{children:["admin",{children:["campaigns",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,7395)),"/Users/mykolay/P-3-0/web/app/admin/campaigns/[id]/edit/page.tsx"]}]},{}]},{}]},{error:[()=>Promise.resolve().then(a.bind(a,9057)),"/Users/mykolay/P-3-0/web/app/admin/campaigns/error.tsx"],loading:[()=>Promise.resolve().then(a.bind(a,95)),"/Users/mykolay/P-3-0/web/app/admin/campaigns/loading.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,2675)),"/Users/mykolay/P-3-0/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/mykolay/P-3-0/web/app/admin/campaigns/[id]/edit/page.tsx"],u="/admin/campaigns/[id]/edit/page",p={require:a,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/campaigns/[id]/edit/page",pathname:"/admin/campaigns/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},2240:(e,t,a)=>{Promise.resolve().then(a.bind(a,7237))},9941:(e,t,a)=>{Promise.resolve().then(a.bind(a,473))},6847:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},5800:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,4064,23))},5303:()=>{},7237:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p,dynamic:()=>s});var i=a(326),r=a(7577),n=a(5047);let s="force-dynamic";function l({title:e,children:t}){return(0,i.jsxs)("div",{className:"rounded-2xl border p-4 md:p-6",children:[i.jsx("h2",{className:"mb-3 text-lg font-semibold",children:e}),t]})}function d({label:e,children:t}){return(0,i.jsxs)("label",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:"text-sm text-gray-600",children:e}),t]})}function o(e){return i.jsx("input",{...e,className:`rounded-lg border px-3 py-2 text-sm outline-none ${e.className||""}`})}function c(e){return i.jsx("select",{...e,className:`rounded-lg border px-3 py-2 text-sm outline-none ${e.className||""}`})}function u(e,t){for(let a of t){let t=e?.[a];if(Array.isArray(t))return t}return Array.isArray(e)?e:[]}function p(){let{id:e}=(0,n.useParams)(),t=(0,n.useRouter)(),[a,s]=(0,r.useState)(!0),[p,m]=(0,r.useState)(!1),[x,h]=(0,r.useState)(null),[g,v]=(0,r.useState)([]),[b,f]=(0,r.useState)({}),[y,_]=(0,r.useState)(null),[j,P]=(0,r.useState)(null);async function w(){_(null);try{let e=await fetch("/api/keycrm/pipelines",{credentials:"include",cache:"no-store"}),t=await e.json().catch(()=>({})),a=u(t,["items","data","pipelines","result"]).map(e=>({id:String(e.id??e.ID??e.value??""),name:String(e.name??e.title??e.label??"")})).filter(e=>e.id&&e.name);!a.length&&t?.error&&_(`pipelines: ${t.error}`),v(a)}catch(e){_(`pipelines: ${String(e?.message||e)}`),v([])}}async function N(e){if(e&&!b[e])try{var t;let a=await fetch(`/api/keycrm/statuses?pipeline_id=${encodeURIComponent(e)}`,{credentials:"include",cache:"no-store"}),i=(t=await a.json().catch(()=>({})),u(t,["items","data","statuses","result"]).map(e=>({id:String(e.id??e.ID??e.value??""),name:String(e.name??e.title??e.label??""),pipeline_id:String(e.pipeline_id??e.pipelineId??e.pid??"")})).filter(e=>e.id&&e.name));f(t=>({...t,[e]:i}))}catch{f(t=>({...t,[e]:[]}))}}let S=e=>b[String(e||"")]||[],k=(e,t)=>P(a=>a?{...a,[e]:t}:a);function R(e,t,a){k(e,a),k(t,""),N(a)}async function C(e){if(e.preventDefault(),j){m(!0),h(null);try{let e={...j,updated_at:new Date().toISOString(),v1_field:"text",v2_field:"text",v2_enabled:!!j.v2_enabled&&!!j.v2_value?.trim()},a=await fetch("/api/campaigns",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await a.json();if(!i?.ok)throw Error(i?.error||"save failed");t.push("/admin/campaigns?updated=1")}catch(e){h(String(e?.message||e))}finally{m(!1)}}}return a?i.jsx("div",{className:"mx-auto max-w-4xl px-4 py-6",children:i.jsx("div",{className:"text-gray-600",children:"Завантаження…"})}):x||!j?(0,i.jsxs)("div",{className:"mx-auto max-w-4xl px-4 py-6",children:[(0,i.jsxs)("div",{className:"mb-3 text-red-600",children:["Помилка: ",x||"Не знайдено"]}),i.jsx("a",{href:"/admin/campaigns",className:"rounded-full border px-3 py-1.5 text-sm",children:"← До списку"})]}):(0,i.jsxs)("div",{className:"mx-auto max-w-4xl px-4 py-6",children:[(0,i.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[i.jsx("h1",{className:"text-2xl font-bold",children:"Редагувати кампанію"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx("a",{href:"/admin/campaigns",className:"rounded-full border px-3 py-1.5 text-sm",children:"← До списку"}),i.jsx("button",{type:"button",onClick:()=>{w().then(()=>{j.base_pipeline_id&&N(j.base_pipeline_id),j.v1_to_pipeline_id&&N(j.v1_to_pipeline_id),j.v2_to_pipeline_id&&N(j.v2_to_pipeline_id),j.exp_to_pipeline_id&&N(j.exp_to_pipeline_id)})},className:"rounded-full border px-3 py-1.5 text-sm",title:"Оновити довідники",children:"Оновити довідники"})]})]}),y&&i.jsx("div",{className:"mb-4 rounded-lg border border-amber-400 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:y}),(0,i.jsxs)("form",{onSubmit:C,className:"grid gap-6",children:[i.jsx(l,{title:"Загальні",children:(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Назва",children:i.jsx(o,{value:j.name||"",onChange:e=>k("name",e.target.value),placeholder:"Назва кампанії",required:!0})}),i.jsx(d,{label:"Увімкнено",children:(0,i.jsxs)(c,{value:j.enabled?"1":"0",onChange:e=>k("enabled","1"===e.target.value),children:[i.jsx("option",{value:"1",children:"yes"}),i.jsx("option",{value:"0",children:"no"})]})}),i.jsx("div",{})]})}),i.jsx(l,{title:"База",children:(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Воронка (base_pipeline_id)",children:(0,i.jsxs)(c,{value:j.base_pipeline_id||"",onChange:e=>R("base_pipeline_id","base_status_id",e.target.value),required:!0,children:[i.jsx("option",{value:"",children:"—"}),g.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx(d,{label:"Статус (base_status_id)",children:(0,i.jsxs)(c,{value:j.base_status_id||"",onChange:e=>k("base_status_id",e.target.value),required:!0,children:[i.jsx("option",{value:"",children:"—"}),S(j.base_pipeline_id).map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx("div",{})]})}),(0,i.jsxs)(l,{title:"Варіант V1 (обов’язковий)",children:[(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Оператор",children:(0,i.jsxs)(c,{value:j.v1_op,onChange:e=>k("v1_op",e.target.value),children:[i.jsx("option",{value:"contains",children:"contains"}),i.jsx("option",{value:"equals",children:"equals"})]})}),i.jsx(d,{label:"Значення (v1_value)",children:i.jsx(o,{value:j.v1_value||"",onChange:e=>k("v1_value",e.target.value),placeholder:"ключове слово"})}),i.jsx("div",{})]}),(0,i.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Воронка призначення (v1)",children:(0,i.jsxs)(c,{value:j.v1_to_pipeline_id||"",onChange:e=>R("v1_to_pipeline_id","v1_to_status_id",e.target.value),children:[i.jsx("option",{value:"",children:"—"}),g.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx(d,{label:"Статус призначення (v1)",children:(0,i.jsxs)(c,{value:j.v1_to_status_id||"",onChange:e=>k("v1_to_status_id",e.target.value),children:[i.jsx("option",{value:"",children:"—"}),S(j.v1_to_pipeline_id).map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx("div",{})]})]}),(0,i.jsxs)(l,{title:"Варіант V2 (опційний)",children:[i.jsx("div",{className:"mb-2 flex items-center gap-2",children:(0,i.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[i.jsx("input",{type:"checkbox",checked:!!j.v2_enabled,onChange:e=>k("v2_enabled",e.target.checked)}),"Увімкнути V2"]})}),(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Оператор",children:(0,i.jsxs)(c,{value:j.v2_op,onChange:e=>k("v2_op",e.target.value),disabled:!j.v2_enabled,children:[i.jsx("option",{value:"contains",children:"contains"}),i.jsx("option",{value:"equals",children:"equals"})]})}),i.jsx(d,{label:"Значення (v2_value)",children:i.jsx(o,{value:j.v2_value||"",onChange:e=>k("v2_value",e.target.value),placeholder:"ключове слово",disabled:!j.v2_enabled})}),i.jsx("div",{})]}),(0,i.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Воронка призначення (v2)",children:(0,i.jsxs)(c,{value:j.v2_to_pipeline_id||"",onChange:e=>R("v2_to_pipeline_id","v2_to_status_id",e.target.value),disabled:!j.v2_enabled,children:[i.jsx("option",{value:"",children:"—"}),g.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx(d,{label:"Статус призначення (v2)",children:(0,i.jsxs)(c,{value:j.v2_to_status_id||"",onChange:e=>k("v2_to_status_id",e.target.value),disabled:!j.v2_enabled,children:[i.jsx("option",{value:"",children:"—"}),S(j.v2_to_pipeline_id).map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx("div",{})]})]}),(0,i.jsxs)(l,{title:"EXP (експірація)",children:[(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Днів у базі (exp_days)",children:i.jsx(o,{type:"number",inputMode:"numeric",min:0,value:String(j.exp_days??0),onChange:e=>k("exp_days",Number(e.target.value)||0)})}),i.jsx("div",{}),i.jsx("div",{})]}),(0,i.jsxs)("div",{className:"mt-3 grid gap-3 md:grid-cols-3",children:[i.jsx(d,{label:"Воронка призначення (exp)",children:(0,i.jsxs)(c,{value:j.exp_to_pipeline_id||"",onChange:e=>R("exp_to_pipeline_id","exp_to_status_id",e.target.value),children:[i.jsx("option",{value:"",children:"—"}),g.map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx(d,{label:"Статус призначення (exp)",children:(0,i.jsxs)(c,{value:j.exp_to_status_id||"",onChange:e=>k("exp_to_status_id",e.target.value),children:[i.jsx("option",{value:"",children:"—"}),S(j.exp_to_pipeline_id).map(e=>i.jsx("option",{value:String(e.id),children:e.name},e.id))]})}),i.jsx("div",{})]})]}),x&&i.jsx("div",{className:"text-sm text-red-600",children:x}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx("button",{type:"submit",disabled:p,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 disabled:opacity-60",children:"Зберегти"}),i.jsx("a",{href:"/admin/campaigns",className:"rounded-lg border px-4 py-2 text-sm",children:"Скасувати"})]})]})]})}},473:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var i=a(326);function r({error:e,reset:t}){return(0,i.jsxs)("div",{className:"mx-auto max-w-3xl p-6 space-y-4",children:[i.jsx("h1",{className:"text-2xl font-semibold",children:"Помилка на сторінці \xabКампанії\xbb"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Можна спробувати ще раз або створити нову кампанію."}),e?.digest&&i.jsx("code",{className:"text-xs",children:e.digest}),(0,i.jsxs)("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:()=>t(),className:"rounded-xl px-4 py-2 border",children:"Оновити"}),i.jsx("a",{href:"/admin/campaigns/new",className:"rounded-xl px-4 py-2 border bg-blue-600 text-white",children:"Нова кампанія"})]})]})}},5047:(e,t,a)=>{"use strict";var i=a(7389);a.o(i,"useParams")&&a.d(t,{useParams:function(){return i.useParams}}),a.o(i,"useRouter")&&a.d(t,{useRouter:function(){return i.useRouter}}),a.o(i,"useSearchParams")&&a.d(t,{useSearchParams:function(){return i.useSearchParams}})},7395:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>s,__esModule:()=>n,default:()=>d,dynamic:()=>l});var i=a(8570);let r=(0,i.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/campaigns/[id]/edit/page.tsx`),{__esModule:n,$$typeof:s}=r;r.default;let l=(0,i.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/campaigns/[id]/edit/page.tsx#dynamic`),d=(0,i.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/campaigns/[id]/edit/page.tsx#default`)},9057:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>s,__esModule:()=>n,default:()=>l});var i=a(8570);let r=(0,i.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/campaigns/error.tsx`),{__esModule:n,$$typeof:s}=r;r.default;let l=(0,i.createProxy)(String.raw`/Users/mykolay/P-3-0/web/app/admin/campaigns/error.tsx#default`)},95:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var i=a(9510);function r(){return(0,i.jsxs)("div",{className:"mx-auto max-w-6xl p-6 space-y-6",children:[i.jsx("div",{className:"h-8 w-40 rounded-xl bg-gray-100"}),i.jsx("div",{className:"grid grid-cols-1 gap-5",children:Array.from({length:3}).map((e,t)=>(0,i.jsxs)("div",{className:"rounded-2xl border p-5",children:[i.jsx("div",{className:"h-5 w-64 rounded bg-gray-100 mb-3"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3",children:Array.from({length:8}).map((e,t)=>(0,i.jsxs)("div",{className:"rounded-xl border p-3",children:[i.jsx("div",{className:"h-3 w-16 rounded bg-gray-100 mb-2"}),i.jsx("div",{className:"h-5 w-10 rounded bg-gray-100"})]},t))})]},t))})]})}},2675:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c,metadata:()=>o});var i=a(9510),r=a(18),n=a.n(r);a(7272);var s=a(9720);function l(e=globalThis){let t=(e,t)=>{if("get"in e||"set"in e){let a=e.get?e.get.bind(t):void 0,i=e.set?e.set.bind(t):void 0;return{configurable:e.configurable,enumerable:e.enumerable??!1,get:a,set:i}}if("function"==typeof e.value){let a=e.value.bind(t);return{configurable:e.configurable,enumerable:e.enumerable??!1,writable:e.writable??!1,value:a}}return e},a=(e,t,a,i)=>{let r=t?.enumerable??!1;if(t&&("get"in t||"set"in t)){let n=t.get?t.get.bind(i):void 0,s=t.set?t.set.bind(i):void 0;return{configurable:!0,enumerable:r,get:()=>a.has(e)?void 0:n?n():void 0,set:t=>{a.delete(e),s&&s(t)}}}let n=t?t.value:void 0;return{configurable:!0,enumerable:r,get:()=>a.has(e)?void 0:n,set:t=>{a.delete(e),n=t}}};if(!e||e.__p30SymbolGuarded)return;let i=(e=>{let t=e.Symbol;return"function"==typeof t?t:void 0})(e);if(!i){e.__p30SymbolGuarded=!0;return}let r=new Set(["dispose","asyncDispose"]);i.dispose&&r.add(i.dispose),i.asyncDispose&&r.add(i.asyncDispose);let n=new Set,s=function(e){return i(e)};try{Reflect.defineProperty(s,"name",{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}try{Reflect.defineProperty(s,"length",{configurable:!0,enumerable:!1,writable:!1,value:0})}catch{}try{Reflect.defineProperty(s,"prototype",{configurable:!1,enumerable:!1,writable:!1,value:i.prototype})}catch{}for(let e of Reflect.ownKeys(i)){let l=Reflect.getOwnPropertyDescriptor(i,e);if(l){if(r.has(e)){try{Reflect.defineProperty(s,e,a(e,l,n,i))}catch{}continue}try{Reflect.defineProperty(s,e,t(l,i))}catch{}}}Object.defineProperty(s,"__p30ProxyGuard",{configurable:!1,enumerable:!1,writable:!1,value:!0});try{Object.defineProperty(s,Symbol.toStringTag,{configurable:!0,enumerable:!1,writable:!1,value:"Symbol"})}catch{}let l=e=>!!r.has(e)&&(n.add(e),!0),d=new Proxy(s,{apply:(e,t,a)=>Reflect.apply(i,t,a),deleteProperty(e,t){if(l(t)){try{Reflect.deleteProperty(e,t)}catch{}return!0}try{return Reflect.deleteProperty(i,t)}catch{return!1}},get(e,t,a){if("__p30ProxyGuard"===t)return!0;if(r.has(t)){let i=Reflect.getOwnPropertyDescriptor(e,t);return i?"get"in i&&i.get?i.get.call(a):i.value:void 0}let n=Reflect.get(e,t,a);if("function"==typeof n)try{return n.bind(i)}catch{}return n},has:(e,t)=>r.has(t)?!n.has(t)&&Reflect.has(e,t):Reflect.has(e,t)||Reflect.has(i,t),ownKeys(e){let t=[];for(let a of Reflect.ownKeys(e))!(r.has(a)&&n.has(a))&&("string"!=typeof a&&"symbol"!=typeof a||t.includes(a)||t.push(a));return t},getOwnPropertyDescriptor(e,t){if(r.has(t)){if(n.has(t))return;let a=Reflect.getOwnPropertyDescriptor(e,t);return a&&(a.configurable=!0),a}return Reflect.getOwnPropertyDescriptor(e,t)},set:(e,t,a,i)=>(r.has(t)&&n.delete(t),Reflect.set(e,t,a,i)),defineProperty(e,t,s){if(r.has(t)){n.delete(t);let r=a(t,s,n,i);return Reflect.defineProperty(e,t,r)}return Reflect.defineProperty(e,t,s)}});try{Object.defineProperty(e,"Symbol",{configurable:!0,enumerable:!1,writable:!0,value:d})}catch{e.Symbol=d}let o=function(){};try{Object.defineProperty(e,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{e.lockdown=o}let c=e.ses;if(c)try{Object.defineProperty(c,"lockdown",{configurable:!0,enumerable:!1,writable:!0,value:o})}catch{c.lockdown=o}"function"!=typeof e.harden&&(e.harden=e=>e),e.__p30SymbolGuarded=!0}let d=`;(${l.toString()})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : undefined);`;l();let o={title:"P-3-0",description:"Admin console"};function c({children:e}){return(0,i.jsxs)("html",{lang:"uk",className:n().className,children:[i.jsx("head",{children:i.jsx(s.default,{id:"p30-lockdown-guard",strategy:"beforeInteractive",dangerouslySetInnerHTML:{__html:d}})}),i.jsx("body",{children:e})]})}},7272:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[8948,4818],()=>a(1629));module.exports=i})();