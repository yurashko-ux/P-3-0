"use strict";exports.id=1756,exports.ids=[1756],exports.modules={1756:(e,t,i)=>{i.d(t,{Z:()=>n,s:()=>o});var l=i(7582);async function n(e,t){let n=[{name:"POST /company/{id}/clients/search with custom_fields",method:"POST",url:`/company/${e}/clients/search`,body:JSON.stringify({page:1,page_size:t||10,fields:["id","name","phone","email","custom_fields"],order_by:"last_visit_date",order_by_direction:"desc"})},{name:"POST /company/{id}/clients/search without fields (all fields)",method:"POST",url:`/company/${e}/clients/search`,body:JSON.stringify({page:1,page_size:t||10,order_by:"last_visit_date",order_by_direction:"desc"})},{name:"POST /company/{id}/clients with custom_fields (fallback)",method:"POST",url:`/company/${e}/clients?include[]=custom_fields&with[]=custom_fields&fields[]=custom_fields`,body:JSON.stringify({...t?{limit:t}:{},include:["custom_fields"],with:["custom_fields"]})},{name:"POST /company/{id}/clients with fields and include",method:"POST",url:`/company/${e}/clients?fields[]=*&include[]=*&with[]=*`,body:JSON.stringify({...t?{limit:t}:{}})},{name:"POST /company/{id}/clients with fields in body",method:"POST",url:`/company/${e}/clients`,body:JSON.stringify({fields:["*"],include:["*"],with:["*"],...t?{limit:t}:{}})},{name:"POST /company/{id}/clients with explicit fields",method:"POST",url:`/company/${e}/clients`,body:JSON.stringify({fields:["id","name","phone","email","custom_fields"],include:["custom_fields"],...t?{limit:t}:{}})},{name:"POST /company/{id}/clients with query fields",method:"POST",url:`/company/${e}/clients?fields=id,name,phone,email,custom_fields&include[]=custom_fields`,body:JSON.stringify({...t?{limit:t}:{}})},{name:"POST /company/{id}/clients (fallback - IDs only)",method:"POST",url:`/company/${e}/clients`,body:JSON.stringify({})},{name:"POST /clients empty body",method:"POST",url:"/clients",body:JSON.stringify({})},{name:"POST /company/{id}/clients with pagination",method:"POST",url:`/company/${e}/clients`,body:JSON.stringify({page:1,per_page:t||100})}],s=null;for(let i of n)try{console.log(`[altegio/clients] Trying ${i.name} for company ${e}...`);let n={method:i.method};i.body?n.body=i.body:void 0===i.body&&"POST"===i.method&&(n.body=JSON.stringify({}));let s=await (0,l.B)(i.url,n),c=[];if(console.log(`[altegio/clients] Raw response structure from ${i.name}:`,{isArray:Array.isArray(s),responseType:typeof s,responseKeys:s&&"object"==typeof s?Object.keys(s):[],responseSample:JSON.stringify(s).substring(0,500)}),Array.isArray(s)?c=s:s&&"object"==typeof s&&("data"in s&&Array.isArray(s.data)?c=s.data:"clients"in s&&Array.isArray(s.clients)?c=s.clients:"items"in s&&Array.isArray(s.items)?c=s.items:"results"in s&&Array.isArray(s.results)&&(c=s.results)),console.log(`[altegio/clients] Response from ${i.name}:`,{isArray:Array.isArray(s),responseType:typeof s,responseKeys:s&&"object"==typeof s?Object.keys(s):[],clientsCount:c.length,firstClientKeys:c[0]?Object.keys(c[0]):[],firstClientSample:c[0]||null,clientsWithNames:c.filter(e=>e.name&&e.name.trim()).length,clientsWithPhones:c.filter(e=>e.phone&&e.phone.trim()).length,clientsWithOnlyId:c.filter(e=>1===Object.keys(e).length&&"id"in e).length}),0===c.length)continue;let a=c.filter(e=>!e.deleted_at&&!1!==e.active&&0!==e.active);if(a.length<c.length&&(console.log(`[altegio/clients] Filtered ${c.length-a.length} inactive/deleted clients`),c=a),c.length>0){t&&c.length>t&&(c=c.slice(0,t));let l=c[0],n=c.length>0&&c.every(e=>{let t=Object.keys(e);return 1===t.length&&"id"===t[0]&&"number"==typeof e.id}),s=l&&(void 0!==l.name||void 0!==l.phone||Object.keys(l).length>1&&!n);if(console.log(`[altegio/clients] ✅ Got ${c.length} clients using ${i.name}`,{hasFullInfo:s,hasOnlyIds:n,firstClientKeys:l?Object.keys(l):[],firstClientSample:l}),n&&c.length>0){console.log(`[altegio/clients] ⚠️ Only IDs received, fetching full client details for ${c.length} clients...`);let i=[],l=0;for(let n of c.slice(0,t||10)){try{let t=await o(e,n.id);t?t.name||t.phone||t.email?(i.push(t),console.log(`[altegio/clients] ✅ Got full info for client ${n.id}: name="${t.name||"none"}", phone="${t.phone||"none"}"`)):(l++,console.log(`[altegio/clients] ⚠️ Client ${n.id} has no data (no name, phone, email) - skipping`)):(l++,console.log(`[altegio/clients] ⚠️ Client ${n.id} not found or has no data - skipping`))}catch(e){l++,console.warn(`[altegio/clients] Failed to get full info for client ${n.id}:`,e)}await new Promise(e=>setTimeout(e,100))}if(console.log(`[altegio/clients] Summary: ${i.length} clients with data, ${l} skipped (no data or not found)`),0===i.length){console.warn(`[altegio/clients] ⚠️ No clients with data found! All ${c.length} clients appear to be deleted/inactive or have no data.`);continue}return i}if(s)return c;continue}}catch(t){let e=t instanceof Error?t.message:String(t);console.log(`[altegio/clients] ❌ ${i.name} failed:`,e),s=t instanceof Error?t:Error(String(t)),e.includes("403")||e.includes("No company management rights");continue}if(s){console.warn(`[altegio/clients] All direct attempts failed for company ${e}, trying to get clients via appointments...`);try{let{getUpcomingAppointments:l}=await i.e(9512).then(i.bind(i,9512)),n=await l(e,90,!0),o=new Map;for(let e of n)if(e.client&&e.client.id){let t=e.client.id;o.has(t)||o.set(t,e.client)}let s=Array.from(o.values());if(s.length>0){if(console.log(`[altegio/clients] ✅ Got ${s.length} unique clients via appointments`),t&&s.length>t)return s.slice(0,t);return s}console.warn("[altegio/clients] No clients found via appointments either")}catch(e){console.error("[altegio/clients] Failed to get clients via appointments:",e)}throw console.error(`[altegio/clients] All attempts failed for company ${e}`),s}return console.log(`[altegio/clients] No clients found for company ${e}`),[]}async function o(e,t){try{let i=[{method:"GET",url:`/company/${e}/client/${t}?fields[]=id&fields[]=name&fields[]=phone&fields[]=email&fields[]=custom_fields`},{method:"GET",url:`/company/${e}/client/${t}?include[]=custom_fields&with[]=custom_fields&fields[]=custom_fields`},{method:"GET",url:`/company/${e}/client/${t}?fields[]=*&include[]=*`},{method:"GET",url:`/company/${e}/clients/${t}?include[]=custom_fields`},{method:"POST",url:`/company/${e}/clients/search`,body:JSON.stringify({filters:[{field:"id",operation:"equals",value:t}],fields:["id","name","phone","email","custom_fields"]})},{method:"GET",url:`/company/${e}/client/${t}`}],n=null;for(let e of i)try{let i={method:e.method};e.body&&(i.body=e.body);let n=await (0,l.B)(e.url,i);if(n&&"object"==typeof n){let i=null;if("id"in n?i=n:"data"in n&&n.data&&(i=n.data),i&&i.id){if(console.log(`[altegio/clients] Client ${t} structure from ${e.method} ${e.url}:`,{keys:Object.keys(i),hasCustomFields:"custom_fields"in i,customFields:i.custom_fields||null,customFieldsKeys:i.custom_fields?Object.keys(i.custom_fields):[],hasInstagramField:Object.keys(i).some(e=>e.toLowerCase().includes("instagram")),fullResponse:JSON.stringify(i,null,2).substring(0,500)}),i.custom_fields)return console.log(`[altegio/clients] ✅ Got custom_fields for client ${t} using ${e.method} ${e.url}:`,Object.keys(i.custom_fields)),i;console.log(`[altegio/clients] ⚠️ No custom_fields in response from ${e.method} ${e.url}, trying next...`)}}}catch(e){n=e instanceof Error?e:Error(String(e));continue}return n&&console.error(`[altegio/clients] All attempts failed for client ${t}:`,n),null}catch(i){return console.error(`[altegio/clients] Failed to get client ${t} for company ${e}:`,i),null}}}};