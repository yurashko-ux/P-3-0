"use strict";exports.id=7493,exports.ids=[7493,9512],exports.modules={9512:(e,t,a)=>{a.d(t,{B:()=>s,getUpcomingAppointments:()=>i});var r=a(7582);async function s(e,t={}){try{let a={};t.dateFrom&&(a.date_from=t.dateFrom),t.dateTo&&(a.date_to=t.dateTo),t.status&&(a.status=t.status),t.clientId&&(a.client_id=t.clientId),t.staffId&&(a.staff_id=t.staffId),t.serviceId&&(a.service_id=t.serviceId),t.serviceIds&&t.serviceIds.length>0&&(a.service_ids=t.serviceIds,a.service_id=t.serviceIds);let s=[];t.includeClient&&s.push("client"),t.includeService&&s.push("service"),t.includeStaff&&s.push("staff");let i=[{name:"POST /company/{id}/appointments/search (recommended)",method:"POST",path:`/company/${e}/appointments/search`,body:{page:1,page_size:500,...a,...s.length?{include:s}:{}}},{name:"GET /company/{id}/appointments",method:"GET",path:`/company/${e}/appointments`,useQuery:!0},{name:"GET /location/{id}/timetable_event_schedules/days/events (Schedule Events API)",method:"GET",path:`/location/${e}/timetable_event_schedules/days/events`,useQuery:!0},{name:"GET /schedule/events (Schedule API, fallback)",method:"GET",path:"/schedule/events",useQuery:!0},{name:"POST /appointments/search",method:"POST",path:"/appointments/search",body:{location_id:e,page:1,page_size:500,...a,...s.length?{include:s}:{}}},{name:"GET /appointments?location_id=...",method:"GET",path:"/appointments",useQuery:!0}],n=null;for(let o of i){let i=o.path;try{let n=new URLSearchParams;o.useQuery&&(a.date_from&&n.set("date_from",a.date_from),a.date_to&&n.set("date_to",a.date_to),a.status&&n.set("status",a.status),a.client_id&&n.set("client_id",String(a.client_id)),a.staff_id&&n.set("staff_id",String(a.staff_id)),s.length&&s.forEach(e=>{n.append("include[]",e)}),"/appointments"===o.path?n.set("location_id",String(e)):"/schedule/events"===o.path?n.set("location_id",String(e)):o.path.includes("/timetable_event_schedules/days/events")&&(n.set("location_id",String(e)),a.date_from&&n.set("date_from",a.date_from),a.date_to&&n.set("date_to",a.date_to)));let d=o.useQuery&&n.toString()?`${o.path}?${n.toString()}`:o.path;i=d,console.log(`[altegio/appointments] Trying ${o.name} → ${i}`);let c=await (0,r.B)(d,{method:o.method,..."POST"===o.method?{body:JSON.stringify(o.body??{})}:{}}),m=[];if(Array.isArray(c))m=c;else if(c&&"object"==typeof c&&(Array.isArray(c.data)?m=c.data:Array.isArray(c.appointments)?m=c.appointments:Array.isArray(c.items)?m=c.items:Array.isArray(c.results)&&(m=c.results),!m.length&&!0===c.success&&Array.isArray(c.data?.events)&&(m=c.data.events),!m.length&&Array.isArray(c.data)&&c.data.length>0)){let e=c.data[0];e&&(e.datetime||e.start_datetime||e.service_id)&&(m=c.data)}if(console.log(`[altegio/appointments] Response from ${o.name}: count=${m.length}`),0===m.length)continue;if(!t.dateFrom){let e=new Date;m=m.filter(t=>{let a=t.datetime||t.start_datetime||t.date;return!!a&&new Date(a)>=e})}return m.sort((e,t)=>{let a=e.datetime||e.start_datetime||e.date||"",r=t.datetime||t.start_datetime||t.date||"";return new Date(a).getTime()-new Date(r).getTime()}),console.log(`[altegio/appointments] ✅ Got ${m.length} appointments for company ${e} using ${o.name}`),m}catch(a){let t=a instanceof Error?a:Error("string"==typeof a?a:JSON.stringify(a));t.message=`[${o.name}] ${i} :: ${t.message}`,n=t,console.warn(`[altegio/appointments] ❌ ${o.name} failed for company ${e}:`,t.message);continue}}if(n)throw n;return console.warn(`[altegio/appointments] No appointments found for company ${e}`),[]}catch(t){throw console.error(`[altegio/appointments] Failed to get appointments for company ${e}:`,t),t}}async function i(e,t=30,a=!0){let r=new Date,i=new Date(r);return i.setDate(i.getDate()+t),s(e,{dateFrom:r.toISOString().split("T")[0],dateTo:i.toISOString().split("T")[0],includeClient:a})}},8630:(e,t,a)=>{a.d(t,{s1:()=>s});var r=a(7582);async function s(e,t={}){try{let a=[{name:"GET /visit/details/{salon_id} (try to get list)",method:"GET",url:`/visit/details/${e}`,queryParams:new URLSearchParams},{name:"GET /company/{id}/visit/details (list)",method:"GET",url:`/company/${e}/visit/details`,queryParams:new URLSearchParams},{name:"GET /dashboard_records/{id} (from web interface)",method:"GET",url:`/dashboard_records/${e}`,queryParams:new URLSearchParams},{name:"GET /company/{id}/records",method:"GET",url:`/company/${e}/records`,queryParams:new URLSearchParams},{name:"GET /records?company_id={id}",method:"GET",url:"/records",queryParams:new URLSearchParams},{name:"GET /company/{id}/visits (list)",method:"GET",url:`/company/${e}/visits`,queryParams:new URLSearchParams},{name:"GET /visits?company_id={id}",method:"GET",url:"/visits",queryParams:new URLSearchParams},{name:"GET /company/{id}/visit (list)",method:"GET",url:`/company/${e}/visit`,queryParams:new URLSearchParams}];t.dateFrom&&a.forEach(e=>{e.url.includes("dashboard_records")?e.queryParams.append("start_date",t.dateFrom):e.queryParams.append("date_from",t.dateFrom)}),t.dateTo&&a.forEach(e=>{e.url.includes("dashboard_records")?e.queryParams.append("end_date",t.dateTo):e.queryParams.append("date_to",t.dateTo)}),t.status&&a.forEach(e=>e.queryParams.append("status",t.status)),t.clientId&&a.forEach(e=>e.queryParams.append("client_id",String(t.clientId))),t.staffId&&a.forEach(e=>e.queryParams.append("staff_id",String(t.staffId))),t.serviceId&&a.forEach(e=>e.queryParams.append("service_id",String(t.serviceId))),t.serviceIds&&t.serviceIds.length>0&&t.serviceIds.forEach(e=>{a.forEach(t=>t.queryParams.append("service_id[]",String(e)))}),t.includeClient&&a.forEach(e=>{e.queryParams.append("include[]","client"),e.queryParams.append("with[]","client")}),t.includeService&&a.forEach(e=>{e.queryParams.append("include[]","service"),e.queryParams.append("with[]","service")}),t.includeStaff&&a.forEach(e=>{e.queryParams.append("include[]","staff"),e.queryParams.append("with[]","staff")}),t.includePayment&&a.forEach(e=>{e.queryParams.append("include[]","payment"),e.queryParams.append("include[]","transactions")}),a.forEach((t,a)=>{t.url.includes(`/${e}/`)||t.url.includes(`/${e}`)||t.queryParams.append("company_id",String(e))});let s=null;for(let e of a)try{let t=e.queryParams.toString(),a=t?`${e.url}?${t}`:e.url;console.log(`[altegio/visits] Trying ${e.name}: ${a}`);let s=await (0,r.B)(a,{method:e.method}),i=[];if(Array.isArray(s)?i=s:s&&"object"==typeof s&&("data"in s&&Array.isArray(s.data)?i=s.data:"visits"in s&&Array.isArray(s.visits)?i=s.visits:"items"in s&&Array.isArray(s.items)&&(i=s.items)),i.length>0)return console.log(`[altegio/visits] ✅ Got ${i.length} visits using ${e.name}`),i}catch(t){s=t instanceof Error?t:Error(String(t)),console.warn(`[altegio/visits] ❌ Failed with ${e.name}:`,s.message);continue}if(s)throw s;return[]}catch(t){throw console.error(`[altegio/visits] Failed to get visits for company ${e}:`,t),t}}}};