"use strict";exports.id=9512,exports.ids=[9512],exports.modules={9512:(e,t,a)=>{a.d(t,{B:()=>s,getUpcomingAppointments:()=>i});var n=a(7582);async function s(e,t={}){try{let a={};t.dateFrom&&(a.date_from=t.dateFrom),t.dateTo&&(a.date_to=t.dateTo),t.status&&(a.status=t.status),t.clientId&&(a.client_id=t.clientId),t.staffId&&(a.staff_id=t.staffId),t.serviceId&&(a.service_id=t.serviceId),t.serviceIds&&t.serviceIds.length>0&&(a.service_ids=t.serviceIds,a.service_id=t.serviceIds);let s=[];t.includeClient&&s.push("client"),t.includeService&&s.push("service"),t.includeStaff&&s.push("staff");let i=[{name:"POST /company/{id}/appointments/search (recommended)",method:"POST",path:`/company/${e}/appointments/search`,body:{page:1,page_size:500,...a,...s.length?{include:s}:{}}},{name:"GET /company/{id}/appointments",method:"GET",path:`/company/${e}/appointments`,useQuery:!0},{name:"GET /location/{id}/timetable_event_schedules/days/events (Schedule Events API)",method:"GET",path:`/location/${e}/timetable_event_schedules/days/events`,useQuery:!0},{name:"GET /schedule/events (Schedule API, fallback)",method:"GET",path:"/schedule/events",useQuery:!0},{name:"POST /appointments/search",method:"POST",path:"/appointments/search",body:{location_id:e,page:1,page_size:500,...a,...s.length?{include:s}:{}}},{name:"GET /appointments?location_id=...",method:"GET",path:"/appointments",useQuery:!0}],o=null;for(let r of i){let i=r.path;try{let o=new URLSearchParams;r.useQuery&&(a.date_from&&o.set("date_from",a.date_from),a.date_to&&o.set("date_to",a.date_to),a.status&&o.set("status",a.status),a.client_id&&o.set("client_id",String(a.client_id)),a.staff_id&&o.set("staff_id",String(a.staff_id)),s.length&&s.forEach(e=>{o.append("include[]",e)}),"/appointments"===r.path?o.set("location_id",String(e)):"/schedule/events"===r.path?o.set("location_id",String(e)):r.path.includes("/timetable_event_schedules/days/events")&&(o.set("location_id",String(e)),a.date_from&&o.set("date_from",a.date_from),a.date_to&&o.set("date_to",a.date_to)));let d=r.useQuery&&o.toString()?`${r.path}?${o.toString()}`:r.path;i=d,console.log(`[altegio/appointments] Trying ${r.name} → ${i}`);let l=await (0,n.B)(d,{method:r.method,..."POST"===r.method?{body:JSON.stringify(r.body??{})}:{}}),m=[];if(Array.isArray(l))m=l;else if(l&&"object"==typeof l&&(Array.isArray(l.data)?m=l.data:Array.isArray(l.appointments)?m=l.appointments:Array.isArray(l.items)?m=l.items:Array.isArray(l.results)&&(m=l.results),!m.length&&!0===l.success&&Array.isArray(l.data?.events)&&(m=l.data.events),!m.length&&Array.isArray(l.data)&&l.data.length>0)){let e=l.data[0];e&&(e.datetime||e.start_datetime||e.service_id)&&(m=l.data)}if(console.log(`[altegio/appointments] Response from ${r.name}: count=${m.length}`),0===m.length)continue;if(!t.dateFrom){let e=new Date;m=m.filter(t=>{let a=t.datetime||t.start_datetime||t.date;return!!a&&new Date(a)>=e})}return m.sort((e,t)=>{let a=e.datetime||e.start_datetime||e.date||"",n=t.datetime||t.start_datetime||t.date||"";return new Date(a).getTime()-new Date(n).getTime()}),console.log(`[altegio/appointments] ✅ Got ${m.length} appointments for company ${e} using ${r.name}`),m}catch(a){let t=a instanceof Error?a:Error("string"==typeof a?a:JSON.stringify(a));t.message=`[${r.name}] ${i} :: ${t.message}`,o=t,console.warn(`[altegio/appointments] ❌ ${r.name} failed for company ${e}:`,t.message);continue}}if(o)throw o;return console.warn(`[altegio/appointments] No appointments found for company ${e}`),[]}catch(t){throw console.error(`[altegio/appointments] Failed to get appointments for company ${e}:`,t),t}}async function i(e,t=30,a=!0){let n=new Date,i=new Date(n);return i.setDate(i.getDate()+t),s(e,{dateFrom:n.toISOString().split("T")[0],dateTo:i.toISOString().split("T")[0],includeClient:a})}}};