"use strict";exports.id=7582,exports.ids=[7582],exports.modules={7582:(e,t,r)=>{r.d(t,{B:()=>o});var n=r(4044);class a extends Error{constructor(e,t,r,n){let a=`Altegio ${e} ${t}`.trim();super(r?`${a}: ${r}`:a),this.name="AltegioHttpError",this.status=e,this.responseBody=r,this.retryAfter=n}}async function o(e,t={},r=3,o=200){let i=(0,n.oU)(e);console.log(`[altegio/client] Initial URL: ${i}, path: ${e}`);let s=!!n.B0.PARTNER_TOKEN,l=n.B0.APPLICATION_ID||"",p=n.B0.PARTNER_ID||l||(s?n.B0.PARTNER_TOKEN:""),c=/\/company\/\d+/.test(e);if(!p||i.includes("partner_id=")||i.includes("partnerId=")||c)console.log(`[altegio/client] Skipped partner_id: hasCompanyIdInPath=${c}, url already has partner_id=${i.includes("partner_id=")}`);else{let e=i.includes("?")?"&":"?";i=`${i}${e}partner_id=${encodeURIComponent(p)}`,console.log(`[altegio/client] Added partner_id to URL: ${i}`)}let T=(0,n.ZN)(),I={...T,...t.headers,Accept:T.Accept||"application/vnd.api.v2+json",Authorization:T.Authorization||T.Authorization},E=null;for(let e=0;e<=r;e++)try{e>0&&await new Promise(t=>setTimeout(t,o*e)),console.log("[altegio/client] Making request:",{url:i,programType:s?"Public (with Partner Token)":"Non-public (User Token only)",urlWithParams:i.includes("partner_id")?"✅ Partner ID in URL":"❌ No Partner ID in URL (OK for non-public)",headers:Object.keys(I),acceptHeader:I.Accept||"❌ MISSING!",hasAcceptHeader:!!I.Accept,hasPartnerToken:s,hasPartnerId:!!p,partnerIdValue:p?p.substring(0,10)+"...":"not set (OK for non-public)",authorizationHeader:I.Authorization?.substring(0,80)+"...",partnerIdHeaders:{"X-Partner-ID":I["X-Partner-ID"],"Partner-ID":I["Partner-ID"],"X-Partner-Id":I["X-Partner-Id"],"X-PartnerId":I["X-PartnerId"],Authorization:I.Authorization?.includes("Partner")?"Contains Partner ID":"No Partner ID in Auth"}});let n=await fetch(i,{...t,headers:I,cache:"no-store"});if(429===n.status){let e=n.headers.get("Retry-After"),t=e?1e3*parseInt(e,10):5e3;console.warn(`[altegio] Rate limited, waiting ${t}ms`),await new Promise(e=>setTimeout(e,t));continue}if(!n.ok){let t=await n.text().catch(()=>"");if(E=new a(n.status,n.statusText,t,n.headers.get("retry-after")),n.status<500&&429!==n.status)throw E;if(e<r)continue;throw E}return await n.json().catch(()=>({}))}catch(t){if(t instanceof a){if(E=t,e<r&&(t.status>=500||429===t.status))continue;throw t}if(e<r){E=new a(0,"Network Error",String(t),null);continue}throw t}throw E||Error("Failed to fetch after retries")}},4044:(e,t,r)=>{r.d(t,{B0:()=>n,ZN:()=>o,cC:()=>a,oU:()=>i});let n={API_URL:process.env.ALTEGIO_API_URL?.trim()||"https://api.alteg.io/api/v1",USER_TOKEN:process.env.ALTEGIO_USER_TOKEN?.trim()||"",PARTNER_TOKEN:process.env.ALTEGIO_PARTNER_TOKEN?.trim()||"",PARTNER_ID:process.env.ALTEGIO_PARTNER_ID?.trim()||"",APPLICATION_ID:process.env.ALTEGIO_APPLICATION_ID?.trim()||""};function a(){if(!n.API_URL)throw Error("Missing env ALTEGIO_API_URL");if(!n.USER_TOKEN&&!n.PARTNER_TOKEN)throw Error("Missing env ALTEGIO_USER_TOKEN or ALTEGIO_PARTNER_TOKEN")}function o(e=!0){if(a(),!n.USER_TOKEN)throw Error("ALTEGIO_USER_TOKEN is required. Please set it in environment variables.");if(console.log("[altegio/env] Token check:",{hasUserToken:!!n.USER_TOKEN,userTokenLength:n.USER_TOKEN?.length||0,hasPartnerToken:!!n.PARTNER_TOKEN,partnerTokenLength:n.PARTNER_TOKEN?.length||0,hasApplicationId:!!n.APPLICATION_ID,applicationId:n.APPLICATION_ID||"not set",hasPartnerId:!!n.PARTNER_ID,partnerId:n.PARTNER_ID||"not set"}),n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.PARTNER_TOKEN}, User ${n.USER_TOKEN}`,t={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e},r=n.APPLICATION_ID||"",a=r||n.PARTNER_ID||"";return a&&(t["X-Partner-ID"]=a,t["Partner-ID"]=a,t["X-Partner-Id"]=a,t["X-PartnerId"]=a,r&&(t["X-Application-ID"]=r,t["Application-ID"]=r)),console.log("[altegio/env] Authorization header (with Partner Token - may be non-public):",{format:"Bearer <partner_token>, User <user_token>",programType:"Non-public (with Partner Token)",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:a||"not set",userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(t),note:"Using Partner Token with User Token (may be for non-public program)"}),t}if(!n.PARTNER_TOKEN&&n.USER_TOKEN){let e=`Bearer ${n.USER_TOKEN}`,t=n.APPLICATION_ID||"",r=n.PARTNER_ID,a=t||r,o={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:e};if(a){let e=`Bearer ${a}, User ${n.USER_TOKEN}`;o["X-Partner-ID"]=a,o["Partner-ID"]=a,o["X-Partner-Id"]=a,o["X-PartnerId"]=a,o.Authorization=e,console.log("[altegio/env] Authorization header (Non-public program - trying public format):",{format:"Bearer <application_id>, User <user_token>",programType:"Non-public",applicationId:t||"not set",partnerId:r||"not set",usingAsPartnerId:a,userTokenLength:n.USER_TOKEN.length,authorizationHeader:e.substring(0,80)+"...",allHeaders:Object.keys(o),note:"Trying public program format: Bearer <application_id>, User <token>"})}else console.log("[altegio/env] Authorization header (Non-public program - USER_TOKEN only):",{format:"Bearer <user_token>",programType:"Non-public",userTokenLength:n.USER_TOKEN.length,note:"Partner ID not provided - may need ALTEGIO_PARTNER_ID (Application ID)"});return o}if(n.PARTNER_TOKEN){let t=n.PARTNER_ID||n.PARTNER_TOKEN,r=[`Bearer ${n.PARTNER_TOKEN}`];e&&n.USER_TOKEN&&r.push(`User ${n.USER_TOKEN}`),t&&t!==n.PARTNER_TOKEN&&r.push(`Partner ${t}`);let a=r.join(", ");console.log("[altegio/env] Authorization header:",{format:"Bearer <partner_token>, User <user_token>",partnerTokenLength:n.PARTNER_TOKEN.length,partnerId:t,partnerIdLength:t.length,userTokenLength:n.USER_TOKEN.length,authHeaderPreview:a.substring(0,50)+"..."});let o={Accept:"application/vnd.api.v2+json","Content-Type":"application/json",Authorization:a};return t&&(o["X-Partner-ID"]=t,o["Partner-ID"]=t,o["X-Partner-Id"]=t,o["X-PartnerId"]=t,o.PartnerId=t),console.log("[altegio/env] Headers with Partner ID:",{authorization:a.substring(0,80)+"...",partnerIdHeaders:{"X-Partner-ID":o["X-Partner-ID"],"Partner-ID":o["Partner-ID"],"X-Partner-Id":o["X-Partner-Id"]},allHeaderKeys:Object.keys(o)}),o}throw Error("No valid Altegio token configured")}function i(e){let t=n.API_URL.replace(/\/+$/,""),r=e.replace(/^\/+/,"");return`${t}/${r}`}}};