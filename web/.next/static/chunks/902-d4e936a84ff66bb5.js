"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[902],{9260:function(e,t,r){r.d(t,{R:function(){return s}});var n=r(7437),a=r(2265);function s(e){let{storageKey:t,layoutVersion:r,defaultLayout:s,children:o,cols:l=12,minHeight:i=20,containerPadding:u=48,editMode:c=!1,onSave:h}=e,[d,m]=(0,a.useState)(s),[f,x]=(0,a.useState)(1200),[g,b]=(0,a.useState)(null),[y,p]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),[S,N]=(0,a.useState)({x:0,y:0}),[E,j]=(0,a.useState)({x:0,y:0,w:0,h:0}),C=(0,a.useRef)(null),R=(0,a.useRef)({}),D=f/l,k=(0,a.useCallback)(e=>{let t=[...e].sort((e,t)=>e.y-t.y),r=[];return t.forEach((e,t)=>{if(0===t)r.push(e);else{let t=r.filter(t=>{let r=e.x+e.w,n=t.x+t.w;return!(r<=t.x||e.x>=n)});if(t.length>0){let n=Math.max(...t.map(e=>e.y+e.h)),a=Math.max(e.y,n);r.push({...e,y:a})}else r.push(e)}}),r},[]);(0,a.useEffect)(()=>{if(localStorage.getItem("".concat(t,"-version"))!==r){localStorage.removeItem(t),localStorage.setItem("".concat(t,"-version"),r),m(s);return}let e=localStorage.getItem(t);if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.length>0?m(t):m(s)}catch(e){m(s)}else m(s);let n=()=>{C.current&&x(C.current.clientWidth-u)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[t,r,s,u]);let z=(0,a.useCallback)(e=>{m(e),c&&(localStorage.setItem(t,JSON.stringify(e)),h&&h(e))},[t,c,h]),M=(0,a.useRef)(d);(0,a.useEffect)(()=>{M.current=d},[d]);let I=(e,t,r)=>{if(!C.current)return;let n=C.current.getBoundingClientRect(),a=M.current.find(e=>e.i===t);if(a){if("drag"===r){b(t);let r={left:a.x*D,top:a.y};N({x:e.clientX-n.left-r.left,y:e.clientY-n.top-r.top})}else p(t),w("resize-height"===r?"height":"resize-width"===r?"width":"both"),j({x:e.clientX,y:e.clientY,w:a.w,h:a.h});e.preventDefault(),e.stopPropagation()}};return(0,a.useEffect)(()=>{if(!g&&!y)return;let e=e=>{if(!C.current)return;let t=C.current.getBoundingClientRect(),r=M.current;if(r.find(e=>e.i===(g||y))){if(g){let n=Math.max(0,Math.floor((e.clientX-t.left-S.x)/D)),a=Math.max(0,e.clientY-t.top-S.y),s=r.map(e=>e.i===g?{...e,x:Math.min(n,l-e.w),y:a}:e);m(s=k(s))}else if(y){let t=e.clientX-E.x,n=e.clientY-E.y,a=r.map(e=>{if(e.i!==y)return e;let r={...e};if(("height"===v||"both"===v)&&(r.h=Math.max(i,E.h+n)),"width"===v||"both"===v){let e=Math.floor(t/D);r.w=Math.max(1,Math.min(l-r.x,E.w+e))}return r});("height"===v||"both"===v)&&(a=k(a)),m(a)}}},t=()=>{let e=M.current;(g||y)&&z(e),b(null),p(null),w(null)};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[g,y,v,S,E,D,l,i,z,k]),(0,a.useEffect)(()=>{let e=new ResizeObserver(e=>{m(r=>{let n=[...r],a=!1;return(e.forEach(e=>{let t=Object.keys(R.current).find(t=>R.current[t]===e.target);if(!t)return;let r=n.find(e=>e.i===t);if(!r)return;let s=Math.max(i,e.contentRect.height+24);if(Math.abs(r.h-s)>5){let e=n.findIndex(e=>e.i===t);n[e]={...r,h:s},a=!0}}),a)?(n=k(n),setTimeout(()=>{localStorage.setItem(t,JSON.stringify(n))},100),n):r})}),r=setTimeout(()=>{Object.values(R.current).forEach(t=>{t&&e.observe(t)})},100);return()=>{clearTimeout(r),e.disconnect()}},[d,t,i,k]),(0,n.jsx)("div",{ref:C,className:"relative",style:{width:"100%",minHeight:"100vh"},children:d.map(e=>{let t=o[e.i];return t?(0,n.jsxs)("div",{className:"absolute",style:{left:"".concat(e.x*D,"px"),top:"".concat(e.y,"px"),width:"".concat(e.w*D,"px"),height:"".concat(e.h,"px"),zIndex:g===e.i||y===e.i?1e3:1},children:[c&&(0,n.jsx)("div",{className:"drag-handle absolute top-0 left-0 right-0 h-6 bg-blue-500 bg-opacity-10 cursor-move flex items-center justify-center text-xs text-gray-500 hover:bg-opacity-20 z-10",onMouseDown:t=>I(t,e.i,"drag"),children:"⋮⋮ Перетягніть"}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"absolute bottom-0 right-0 w-6 h-6 cursor-se-resize z-10",onMouseDown:t=>I(t,e.i,"resize-both"),style:{background:"linear-gradient(-45deg, transparent 30%, rgba(59, 130, 246, 0.3) 30%, rgba(59, 130, 246, 0.3) 50%, transparent 50%)"}}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-3 cursor-s-resize z-10",onMouseDown:t=>I(t,e.i,"resize-height"),style:{background:"linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.2))"}}),(0,n.jsx)("div",{className:"absolute top-0 bottom-0 right-0 w-3 cursor-e-resize z-10",onMouseDown:t=>I(t,e.i,"resize-width"),style:{background:"linear-gradient(to right, transparent, rgba(59, 130, 246, 0.2))"}})]}),(0,n.jsx)("div",{ref:t=>{t&&(R.current[e.i]=t)},className:"h-full overflow-auto ".concat(c?"pt-6":""),style:{minHeight:"100%"},children:t})]},e.i):null})})}},6246:function(e,t,r){r.d(t,{G:function(){return o}});var n=r(7437),a=r(2265),s=r(6463);function o(e){let{storageKey:t,onEditModeChange:r,onSave:o}=e,l=(0,s.useRouter)(),[i,u]=(0,a.useState)(!1),[c,h]=(0,a.useState)(""),[d,m]=(0,a.useTransition)(),[f,x]=(0,a.useState)(null),[g,b]=(0,a.useState)(null),y=(0,a.useCallback)(e=>{c&&(x(null),m(async()=>{try{let r=await fetch("/api/admin/dashboard-layout?secret=".concat(encodeURIComponent(c)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storageKey:t,layout:e})});if(!r.ok){let e=await r.json();throw Error(e.error||"Помилка збереження")}let n=await r.json();console.log("[EditLayoutButton] Saved layout:",n),b("✅ Layout збережено (".concat(e.length," блоків)")),x(null),o&&o(e),l.refresh(),setTimeout(()=>{b(null)},3e3)}catch(e){console.error("[EditLayoutButton] Save error:",e),x(e.message||"Помилка збереження")}}))},[c,t,o,l]);return(0,n.jsxs)("div",{className:"space-y-2",children:[i?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>{u(!1),h(""),r(!1),x(null),b(null)},className:"btn btn-sm btn-ghost text-xs",disabled:d,children:"\uD83D\uDD12 Заблокувати"}),(0,n.jsx)("span",{className:"text-xs text-green-600 font-semibold",children:"✓ Режим редагування активний"})]}),(0,n.jsx)("button",{onClick:()=>{let e=localStorage.getItem(t);if(e)try{let t=JSON.parse(e);y(t)}catch(e){x("Помилка читання layout з localStorage")}else x("Layout не знайдено в localStorage")},className:"btn btn-sm btn-primary text-xs font-semibold",disabled:d,children:d?"Збереження...":"\uD83D\uDCBE Зберегти layout"})]}):(0,n.jsx)("button",{onClick:()=>{let e=prompt("Введіть CRON_SECRET для редагування layout дашборду:");e&&fetch("/api/admin/dashboard-layout?secret=".concat(encodeURIComponent(e),"&storageKey=").concat(encodeURIComponent(t))).then(t=>{t.ok?(u(!0),h(e),r(!0)):alert("Невірний CRON_SECRET")}).catch(e=>{console.error("Failed to verify secret:",e),alert("Помилка перевірки секрету")})},className:"btn btn-sm btn-outline text-xs font-semibold",title:"Розблокувати для редагування layout (потрібен CRON_SECRET)",children:"\uD83D\uDD13 Редагувати layout"}),f&&(0,n.jsx)("div",{className:"text-xs text-error bg-error/10 p-1 rounded",children:f}),g&&(0,n.jsx)("div",{className:"text-xs text-success bg-success/10 p-1 rounded",children:g}),i&&(0,n.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:'\uD83D\uDCA1 Перемістіть та змініть розмір блоків, потім натисніть "Зберегти layout"'})]})}},6463:function(e,t,r){var n=r(1169);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}}]);