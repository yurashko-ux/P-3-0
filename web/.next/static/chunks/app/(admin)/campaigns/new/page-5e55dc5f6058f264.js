(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[336],{9610:function(e,s,a){Promise.resolve().then(a.bind(a,4435))},4435:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return i}});var t=a(7437),l=a(2265),n=a(6463);function r(e,s){document.cookie="".concat(e,"=").concat(encodeURIComponent(s),"; path=/; SameSite=Lax")}function i(){let e=(0,n.useRouter)(),[s,a]=l.useState(null),[i,d]=l.useState(!1),[c,u]=l.useState(""),[o,m]=l.useState(!1),[p,x]=l.useState(null),[b,h]=l.useState("UI-created"),[f,v]=l.useState(111),[N,j]=l.useState(222),[g,y]=l.useState("contains"),[S,k]=l.useState("ціна"),[w,C]=l.useState("equals"),[_,P]=l.useState("привіт");async function I(){if(!c.trim()){x("Введи адмін-токен (ENV ADMIN_PASS на Vercel).");return}try{await fetch("/api/auth/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:c.trim()})}).catch(()=>{})}finally{r("admin_token",c.trim()),a(c.trim()),d(!1),x("Токен збережено. Можеш створювати кампанію.")}}async function T(a){if(a.preventDefault(),x(null),!s){x("Немає адмін-токена. Введи токен вище."),d(!0);return}if(!b.trim()){x("Назва обовʼязкова.");return}if(""===f||""===N){x("Потрібні ID воронки та статусу.");return}m(!0);try{let a={name:b.trim(),base_pipeline_id:Number(f),base_status_id:Number(N),rules:{v1:{op:g,value:null!=S?S:""},v2:{op:w,value:null!=_?_:""}}},t=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Token":s},body:JSON.stringify(a)});if(!t.ok){let e=await t.text().catch(()=>"");throw Error(e||"HTTP ".concat(t.status))}x("Кампанію створено ✅"),setTimeout(()=>e.push("/admin/campaigns"),300)}catch(s){console.error(s);let e=String((null==s?void 0:s.message)||s);e.includes("401")?(x("401 Unauthorized — адмін-токен неправильний або відсутній."),d(!0)):e.includes("failed to parse")||e.includes("WRONGTYPE")?x("Помилка KV. Спробуй ще раз або очисти тестові ключі через /api/debug/kv."):x("Помилка створення: ".concat(e))}finally{m(!1)}}return l.useEffect(()=>{let e=function(e){if("undefined"==typeof document)return null;for(let s of document.cookie.split(";")){let a=s.trim();if(!a)continue;let t=a.indexOf("=");if(-1===t)continue;let l=a.slice(0,t),n=a.slice(t+1);if(l===e)return decodeURIComponent(n)}return null}("admin_token");a(e),d(!e)},[]),(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Створити кампанію"}),!s&&(0,t.jsxs)("div",{className:"mb-4 rounded-lg border p-3 bg-yellow-50",children:[(0,t.jsx)("div",{className:"font-medium",children:"Немає адмін-токена"}),(0,t.jsxs)("div",{className:"text-sm",children:["Введи значення ENV ",(0,t.jsx)("code",{children:"ADMIN_PASS"})," (напр. ",(0,t.jsx)("code",{children:"11111"}),") нижче і збережи."]})]}),i&&(0,t.jsxs)("div",{className:"mb-6 rounded-xl border p-4",children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"Admin token"}),(0,t.jsx)("input",{className:"w-full border rounded-md px-3 py-2",placeholder:"встав тут свій ADMIN_PASS",value:c,onChange:e=>u(e.target.value)}),(0,t.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:I,className:"px-3 py-2 rounded-md border bg-black text-white disabled:opacity-60",children:"Зберегти токен"}),(0,t.jsx)("button",{type:"button",onClick:()=>{r("admin_token",""),a(null),d(!0),x("Токен очищено")},className:"px-3 py-2 rounded-md border",children:"Очистити токен"})]})]}),p&&(0,t.jsx)("div",{className:"mb-4 rounded-lg border p-3 bg-slate-50 whitespace-pre-wrap",children:p}),(0,t.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"Назва"}),(0,t.jsx)("input",{className:"w-full border rounded-md px-3 py-2",value:b,onChange:e=>h(e.target.value),placeholder:"My Campaign"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"Base pipeline ID"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded-md px-3 py-2",value:f,onChange:e=>v(""===e.target.value?"":Number(e.target.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"Base status ID"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded-md px-3 py-2",value:N,onChange:e=>j(""===e.target.value?"":Number(e.target.value))})]})]}),(0,t.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,t.jsx)("div",{className:"font-medium mb-3",children:"Правила"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"V1 — оператор"}),(0,t.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:g,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"contains",children:"contains"}),(0,t.jsx)("option",{value:"equals",children:"equals"})]}),(0,t.jsx)("label",{className:"block text-sm mt-3 mb-1",children:"V1 — значення"}),(0,t.jsx)("input",{className:"w-full border rounded-md px-3 py-2",value:S,onChange:e=>k(e.target.value),placeholder:"напр. ціна"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"V2 — оператор"}),(0,t.jsxs)("select",{className:"w-full border rounded-md px-3 py-2",value:w,onChange:e=>C(e.target.value),children:[(0,t.jsx)("option",{value:"contains",children:"contains"}),(0,t.jsx)("option",{value:"equals",children:"equals"})]}),(0,t.jsx)("label",{className:"block text-sm mt-3 mb-1",children:"V2 — значення"}),(0,t.jsx)("input",{className:"w-full border rounded-md px-3 py-2",value:_,onChange:e=>P(e.target.value),placeholder:"напр. привіт"})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{type:"submit",disabled:o,className:"px-4 py-2 rounded-md border bg-black text-white disabled:opacity-60",children:o?"Зберігаю…":"Створити"}),(0,t.jsx)("button",{type:"button",className:"px-4 py-2 rounded-md border",onClick:()=>e.push("/admin/campaigns"),children:"До списку"})]})]})]})}},6463:function(e,s,a){"use strict";var t=a(1169);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=9610)}),_N_E=e.O()}]);