(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[675],{8232:function(e,n,i){Promise.resolve().then(i.bind(i,3786))},3786:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return d}});var o=i(7437),t=i(231),r=i.n(t),s=i(2265);function d(){var e,n,i,t,d,a,c,g,p,h,u,m,f,x,j,y,b,v,k,D,S,C,I,w,T,A,R,E,z,B,W,P,N,O,_,F,L,M,U,K,H,J,V,Y,G,X,q,Q,Z,$,ee,en,ei,eo,et,er,es,ed,el,ea,ec,eg,ep,eh,eu,em,ef,ex,ej,ey;let[eb,ev]=(0,s.useState)({loading:!1,ok:null}),[ek,eD]=(0,s.useState)({loading:!1,ok:null}),[eS,eC]=(0,s.useState)({loading:!1,ok:null}),[eI,ew]=(0,s.useState)({loading:!1,ok:null}),[eT,eA]=(0,s.useState)({loading:!1,ok:null}),[eR,eE]=(0,s.useState)({loading:!1,ok:null}),[ez,eB]=(0,s.useState)({loading:!1,ok:null}),[eW,eP]=(0,s.useState)({loading:!1,ok:null}),[eN,eO]=(0,s.useState)(""),[e_,eF]=(0,s.useState)(!1),[eL,eM]=(0,s.useState)(null),[eU,eK]=(0,s.useState)(!1),[eH,eJ]=(0,s.useState)(null),[eV,eY]=(0,s.useState)(!1),[eG,eX]=(0,s.useState)({open:!1,title:"",content:""}),[eq,eQ]=(0,s.useState)(null),[eZ,e$]=(0,s.useState)(!1),[e0,e1]=(0,s.useState)(""),[e8,e2]=(0,s.useState)({loading:!1,ok:null});async function e6(){eN&&(await navigator.clipboard.writeText(eN),eF(!0),setTimeout(()=>eF(!1),2e3))}async function e5(){ev({loading:!0,ok:null});try{let e=await fetch("/api/altegio/test",{cache:"no-store"}),n=await e.json();ev({loading:!1,ok:!0===n.ok,message:n.message||n.error,companiesCount:n.count,companies:n.companies||[],error:n.error,env:n.env,debug:n.debug,programType:n.programType,recommendation:n.recommendation})}catch(e){ev({loading:!1,ok:!1,message:"Помилка з'єднання",error:e instanceof Error?e.message:"Невідома помилка"})}}async function e4(){eM(null);try{let e=await fetch("/api/altegio/diagnostics",{cache:"no-store"}),n=await e.json();n.ok&&n.diagnostics&&eM(n.diagnostics)}catch(e){console.error("Failed to get diagnostics:",e)}}async function e3(){if(eL){let e=JSON.stringify(eL,null,2);await navigator.clipboard.writeText(e),eK(!0),setTimeout(()=>eK(!1),2e3)}}async function e9(){eD({loading:!0,ok:null});try{let e=await fetch("/api/altegio/test/clients",{cache:"no-store"}),n=await e.json();eD({loading:!1,ok:!0===n.ok,message:n.message||n.error,clientsCount:n.clientsCount,clients:n.clients||[],firstClientStructure:n.firstClientStructure,instagramFieldFound:n.instagramFieldFound,instagramFieldName:n.instagramFieldName,instagramFieldValue:n.instagramFieldValue,allKeys:n.allKeys,customFields:n.customFields,error:n.error})}catch(e){eD({loading:!1,ok:!1,message:"Помилка з'єднання",error:e instanceof Error?e.message:"Невідома помилка"})}}async function e7(){eY(!0),eJ(null);try{let e=await fetch("/api/altegio/test/clients-debug",{cache:"no-store"}),n=await e.json();eJ(n)}catch(e){eJ({ok:!1,error:e instanceof Error?e.message:"Невідома помилка"})}finally{eY(!1)}}async function ne(e){e$(!0),eQ(null);try{let n=await fetch("/api/altegio/test/clients/".concat(e),{cache:"no-store"}),i=await n.json();eQ(i)}catch(e){eQ({ok:!1,error:e instanceof Error?e.message:"Невідома помилка"})}finally{e$(!1)}}async function nn(){if(e0.trim()){e2({loading:!0,ok:null});try{let e=await fetch("/api/altegio/test/clients/by-instagram?instagram=".concat(encodeURIComponent(e0.trim())),{cache:"no-store"}),n=await e.json();n.ok&&n.client?e2({loading:!1,ok:!0,client:n.client}):e2({loading:!1,ok:!1,error:n.error||"Клієнт не знайдено",diagnostics:n.diagnostics,similarMatches:n.similarMatches,sampleEmails:n.sampleEmails})}catch(e){e2({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка"})}}}async function ni(){eC({loading:!0,ok:null});try{let e=await fetch("/api/altegio/test/appointments?days=30",{cache:"no-store"}),n=await e.json();eC({loading:!1,ok:!0===n.ok,message:n.message||n.error,appointmentsCount:n.appointmentsCount,appointmentsWithInstagram:n.appointmentsWithInstagram,appointments:n.appointments||[],days:n.days,error:n.error})}catch(e){eC({loading:!1,ok:!1,message:"Помилка з'єднання з API записів",error:e instanceof Error?e.message:"Невідома помилка"})}}async function no(){ew({loading:!0,ok:null});try{let e=await fetch("/api/altegio/test/appointments/full-week",{cache:"no-store"}),n=await e.json();ew({loading:!1,ok:!0===n.ok,data:n,error:n.error})}catch(e){ew({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка"})}}async function nt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pending";eA({loading:!0,ok:null});try{let n=await fetch("/api/altegio/reminders/queue?status=".concat(e,"&limit=50"),{cache:"no-store"}),i=await n.json();eA({loading:!1,ok:!0===i.ok,jobs:i.jobs||[],debug:i.debug,error:i.error})}catch(e){eA({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка"})}}async function nr(){eE({loading:!0,ok:null,data:void 0,error:void 0});try{let e=await fetch("/api/altegio/reminders/debug",{cache:"no-store"});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let n=await e.json();eE({loading:!1,ok:!0===n.ok,data:n.diagnostics,error:n.error})}catch(e){console.error("[loadRemindersDebug] Error:",e),eE({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка",data:void 0})}}async function ns(){eB({loading:!0,ok:null,logs:void 0,error:void 0});try{let e=await fetch("/api/altegio/reminders/sent?limit=50",{cache:"no-store"}),n=await e.json();eB({loading:!1,ok:!0===n.ok,logs:n.logs||[],total:n.total||0,error:n.error})}catch(e){eB({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка",logs:void 0})}}async function nd(){eP({loading:!0,ok:null,rules:void 0,error:void 0});try{let e=await fetch("/api/altegio/reminders/rules",{cache:"no-store"}),n=await e.json();eP({loading:!1,ok:!0===n.ok,rules:n.rules||[],error:n.error})}catch(e){eP({loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка",rules:void 0})}}async function nl(){if(eW.rules){eP({...eW,loading:!0});try{let e=await fetch("/api/altegio/reminders/rules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rules:eW.rules})}),n=await e.json();n.ok?(eP({loading:!1,ok:!0,rules:n.rules||eW.rules,error:void 0}),alert("✅ Шаблони повідомлень збережено!")):(eP({...eW,loading:!1,ok:!1,error:n.error}),alert("❌ Помилка: ".concat(n.error)))}catch(e){eP({...eW,loading:!1,ok:!1,error:e instanceof Error?e.message:"Невідома помилка"}),alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}}}return(0,s.useEffect)(()=>{eO("https://p-3-0.vercel.app/api/altegio/webhook")},[]),(0,o.jsxs)("main",{style:{maxWidth:960,margin:"48px auto",padding:"0 20px"},children:[(0,o.jsxs)("header",{style:{marginBottom:28},children:[(0,o.jsx)("h1",{style:{fontSize:40,fontWeight:800,letterSpacing:-.5,margin:0},children:"Альтеджіо \xb7 аналітика"}),(0,o.jsx)("p",{style:{marginTop:10,color:"rgba(0,0,0,0.55)"},children:"Модуль у розробці: синхронізація Alteg.io, план/факт, склад волосся, нагадування."})]}),(0,o.jsxs)("section",{style:{display:"grid",gap:18},children:[(0,o.jsxs)(l,{title:"Підключення до API",emoji:"\uD83D\uDD0C",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:"Перевірка підключення до Alteg.io API з використанням USER_TOKEN."}),(0,o.jsx)("button",{onClick:e5,disabled:eb.loading,style:{padding:"10px 20px",background:"#2a6df5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eb.loading?"not-allowed":"pointer",opacity:eb.loading?.6:1},children:eb.loading?"Перевірка...":"Тестувати підключення"})]}),(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#f3f5f9",borderRadius:8},children:[(0,o.jsx)("p",{style:{margin:0,marginBottom:8,fontWeight:600},children:"URL для webhook в налаштуваннях Alteg.io:"}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:8},children:[(0,o.jsx)("code",{style:{flex:1,padding:"8px 12px",background:"#fff",borderRadius:6,border:"1px solid #e8ebf0",fontSize:"0.9em",wordBreak:"break-all",display:"block"},children:eN||"/api/altegio/webhook"}),(0,o.jsx)("button",{onClick:e6,style:{padding:"8px 16px",background:e_?"#22c55e":"#2a6df5",color:"#fff",border:"none",borderRadius:6,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",transition:"background 0.2s"},children:e_?"✓ Скопійовано":"Скопіювати"})]}),(0,o.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",color:"rgba(0,0,0,0.6)"},children:["Скопіюйте цю адресу та вкажіть її в полі ",(0,o.jsx)("strong",{children:'"Адреса для надсилання повідомлень"'}),' в налаштуваннях маркетплейсу Alteg.io (розділ "Налаштування для розробки").']})]}),null!==eb.ok&&(0,o.jsxs)("div",{style:{padding:12,borderRadius:8,background:eb.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(eb.ok?"#86efac":"#fca5a5"),color:eb.ok?"#166534":"#991b1b"},children:[(0,o.jsxs)("strong",{children:[eb.ok?"✅ Успішно":"❌ Помилка",":"]})," ",eb.message,void 0!==eb.companiesCount&&(0,o.jsxs)("div",{style:{marginTop:8},children:["Знайдено компаній: ",(0,o.jsx)("strong",{children:eb.companiesCount})]}),eb.ok&&eb.companies&&eb.companies.length>0&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:12},children:"\uD83D\uDCCB Список компаній (філій/салонів):"}),(0,o.jsxs)("div",{style:{maxHeight:"400px",overflowY:"auto",fontSize:"0.9em"},children:[(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #e0e7ef",textAlign:"left"},children:[(0,o.jsx)("th",{style:{padding:"8px 12px",fontWeight:600},children:"ID"}),(0,o.jsx)("th",{style:{padding:"8px 12px",fontWeight:600},children:"Назва"}),(0,o.jsx)("th",{style:{padding:"8px 12px",fontWeight:600},children:"Статус"})]})}),(0,o.jsx)("tbody",{children:eb.companies.slice(0,50).map((e,n)=>(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #f0f0f0",backgroundColor:n%2==0?"#fff":"#fafafa"},children:[(0,o.jsx)("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"0.85em"},children:e.id||e.company_id||"N/A"}),(0,o.jsx)("td",{style:{padding:"8px 12px"},children:e.name||e.public_title||e.title||"Без назви"}),(0,o.jsx)("td",{style:{padding:"8px 12px"},children:void 0!==e.active?!0===e.active||1===e.active?(0,o.jsx)("span",{style:{color:"#22c55e",fontWeight:600},children:"✅ Активна"}):(0,o.jsx)("span",{style:{color:"#ef4444",fontWeight:600},children:"❌ Неактивна"}):(0,o.jsx)("span",{style:{color:"#6b7280"},children:"—"})})]},e.id||n))})]}),eb.companies.length>50&&(0,o.jsxs)("p",{style:{marginTop:12,fontSize:"0.85em",color:"#6b7280",textAlign:"center"},children:["Показано перші 50 з ",eb.companies.length," компаній"]})]}),eb.companiesCount&&eb.companiesCount!==eb.companies.length&&(0,o.jsxs)("p",{style:{marginTop:8,fontSize:"0.85em",color:"#6b7280"},children:["⚠️ Увага: API повернув ",eb.companies.length," компаній, але count = ",eb.companiesCount]}),eb.companies&&eb.companies.length>1&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCA1 Якщо серед компаній є ваш салон:"}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em"},children:"Якщо ви бачите тут більше компаній, ніж очікували, це означає, що API повертає всі компанії, до яких має доступ ваш User Token."}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",fontWeight:600},children:"Щоб показувати тільки ваш салон:"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsx)("li",{children:"Знайдіть ID вашого салону в таблиці вище"}),(0,o.jsxs)("li",{children:["Додайте змінну ",(0,o.jsx)("code",{children:"ALTEGIO_COMPANY_ID"})," в Vercel з ID вашого салону"]}),(0,o.jsx)("li",{children:"Або відфільтруйте компанії за назвою в налаштуваннях"})]}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.85em",fontStyle:"italic",color:"#6b7280"},children:'Partner ID (784) - це не ID компанії, а ID в маркетплейсі Alteg.io. ID вашої компанії (салону) - це числове значення з колонки "ID" вище.'})]})]}),eb.debug&&(0,o.jsxs)("div",{style:{marginTop:8,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd",fontSize:"0.85em"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDD0D Діагностика:"}),(0,o.jsxs)("ul",{style:{margin:"4px 0 0 0",paddingLeft:20},children:[(0,o.jsxs)("li",{children:["Тип програми: ",(0,o.jsx)("code",{children:eb.programType||"Unknown"})]}),(0,o.jsxs)("li",{children:["User Token в env: ",(0,o.jsx)("code",{children:eb.debug.userTokenInEnv?"✅ Так":"❌ Ні"})]}),eb.debug.userTokenInEnv&&(0,o.jsxs)("li",{children:["Довжина User Token: ",(0,o.jsx)("code",{children:eb.debug.userTokenLength||0})]}),(0,o.jsxs)("li",{children:["Partner Token в env: ",(0,o.jsx)("code",{children:eb.debug.partnerTokenInEnv?"✅ Так":"❌ Ні (OK for non-public)"})]}),eb.debug.partnerTokenInEnv&&(0,o.jsxs)("li",{children:["Довжина Partner Token: ",(0,o.jsx)("code",{children:eb.debug.partnerTokenLength||0})]}),(0,o.jsxs)("li",{children:["Partner ID в env: ",(0,o.jsx)("code",{children:eb.debug.partnerIdInEnv?"✅ Так":"❌ Ні"})]}),eb.debug.partnerIdInEnv&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("li",{children:["Значення Partner ID: ",(0,o.jsx)("code",{children:eb.debug.partnerIdValue||"not set"})]}),(0,o.jsxs)("li",{children:["Довжина Partner ID: ",(0,o.jsx)("code",{children:eb.debug.partnerIdLength||0})]})]})]}),eb.debug.partnerTokenInEnv&&eb.error&&eb.error.includes("Partner ID")&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107"},children:[(0,o.jsx)("strong",{children:"⚠️ Важливо:"}),(0,o.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em"},children:["Partner Token все ще знайдено в environment variables, але для ",(0,o.jsx)("strong",{children:"непублічної програми"})," він не потрібен."]}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",fontWeight:600},children:"Якщо ви видалили ALTEGIO_PARTNER_TOKEN з Vercel, але діагностика все ще показує його:"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsx)("li",{children:"Перевірте, чи видалено змінну для правильного середовища (Production/Preview)"}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ОБОВ'ЯЗКОВО перезапустіть деплой"})," в Vercel (Redeploy)"]}),(0,o.jsx)("li",{children:"Зачекайте 1-2 хвилини після перезапуску"})]})]}),!eb.debug.partnerTokenInEnv&&"Non-public (User Token only)"===eb.programType&&(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",color:"#22c55e",fontWeight:600},children:"✅ Правильна конфігурація для непублічної програми: тільки User Token"})]}),eb.error&&(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.9em",opacity:.9},children:[(0,o.jsx)("div",{style:{marginBottom:8},children:eb.error}),eb.recommendation&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCA1 Рекомендація:"}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em"},children:eb.recommendation})]}),(eb.error.includes("Partner ID")||eb.error.includes("partner")||eb.error.includes("401"))&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCA1 Як знайти Partner ID:"}),(0,o.jsxs)("p",{style:{margin:"8px 0",fontSize:"0.9em"},children:["Для ",(0,o.jsx)("strong",{children:"непублічних програм"})," Partner ID - це ID вашої філії/салону в Alteg.io (наприклад, 1169323). API використовує Partner ID, щоб знати, з якої філії брати дані."]}),(0,o.jsx)("p",{style:{margin:"8px 0",fontSize:"0.9em",fontWeight:600},children:"Для публічних програм Partner ID - це Application ID або Partner Token."}),(0,o.jsx)("p",{style:{margin:"8px 0",fontSize:"0.9em",fontWeight:600},children:"Варіант 1: ID філії/салону з вашої адмінки Alteg.io (для непублічних програм)"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:20},children:[(0,o.jsx)("li",{children:"Відкрийте вашу адмінку Alteg.io (https://app.alteg.io або https://alteg.io)"}),(0,o.jsx)("li",{children:"Перейдіть в налаштування філії/салону"}),(0,o.jsxs)("li",{children:["Знайдіть ",(0,o.jsx)("strong",{children:"ID філії"})," (може бути в URL або в налаштуваннях)"]}),(0,o.jsx)("li",{children:"ID філії зазвичай виглядає як числовий ID (наприклад: 1169323)"}),(0,o.jsxs)("li",{children:["Скопіюйте його та додайте як змінну середовища ",(0,o.jsx)("code",{children:"ALTEGIO_PARTNER_ID"})," в Vercel"]})]}),(0,o.jsx)("p",{style:{margin:"12px 0 8px 0",fontSize:"0.9em",fontWeight:600},children:"Варіант 2: Application ID з налаштувань додатку (для публічних програм)"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:20},children:[(0,o.jsxs)("li",{children:["Відкрийте ",(0,o.jsx)("a",{href:"https://marketplace.alteg.io",target:"_blank",rel:"noopener noreferrer",style:{color:"#2a6df5"},children:"Alteg.io Marketplace"})]}),(0,o.jsx)("li",{children:'Перейдіть в "Мої програми" → ваш додаток'}),(0,o.jsxs)("li",{children:["Відкрийте розділ ",(0,o.jsx)("strong",{children:'"Загальна інформація"'})]}),(0,o.jsxs)("li",{children:["Знайдіть ",(0,o.jsx)("strong",{children:"Application ID"})," (наприклад: 1193)"]}),(0,o.jsxs)("li",{children:["Скопіюйте його та додайте як змінну середовища ",(0,o.jsx)("code",{children:"ALTEGIO_PARTNER_ID"})," або ",(0,o.jsx)("code",{children:"ALTEGIO_PARTNER_TOKEN"})," в Vercel"]})]}),(0,o.jsx)("p",{style:{margin:"12px 0 8px 0",fontSize:"0.9em",fontWeight:600},children:"Варіант 2: Partner Token з налаштувань акаунта"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:20},children:[(0,o.jsx)("li",{children:'Натисніть на "Налаштування облікового запису" (праворуч вгорі)'}),(0,o.jsx)("li",{children:'Перейдіть в розділ "Акаунт розробника"'}),(0,o.jsx)("li",{children:'Знайдіть поле "Токен партнера" (Partner Token)'}),(0,o.jsx)("li",{children:"Якщо є - скопіюйте його"})]}),(0,o.jsx)("p",{style:{margin:"12px 0 0 0",fontSize:"0.85em",fontStyle:"italic",background:"#e7f3ff",padding:8,borderRadius:4},children:'\uD83D\uDCA1 Зазвичай Partner Token = Application ID з розділу "Загальна інформація". Наприклад, якщо Application ID = 1193, то Partner Token = "1193".'}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.85em"},children:"Після додавання змінної середовища перезапустіть деплой або зачекайте 1-2 хвилини."})]})]})]})]}),(0,o.jsxs)(l,{title:"Пошук клієнта за Instagram",emoji:"\uD83D\uDD0D",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:"Введіть Instagram username для пошуку клієнта. Система шукає в полі email (формат: instagram_username@gmail.com)."}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",flexWrap:"wrap"},children:[(0,o.jsx)("input",{type:"text",value:e0,onChange:e=>e1(e.target.value),placeholder:"Наприклад: mv_valeria або @mv_valeria",onKeyPress:e=>{"Enter"===e.key&&e0.trim()&&nn()},style:{flex:"1 1 300px",padding:"10px 16px",border:"1px solid #e0e7ef",borderRadius:8,fontSize:"1em",minWidth:"200px"}}),(0,o.jsx)("button",{onClick:nn,disabled:e8.loading||!e0.trim(),style:{padding:"10px 24px",background:e8.loading||!e0.trim()?"#9ca3af":"#2a6df5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:e8.loading||!e0.trim()?"not-allowed":"pointer",opacity:e8.loading||!e0.trim()?.6:1,whiteSpace:"nowrap"},children:e8.loading?"Пошук...":"Знайти"})]})]}),null!==e8.ok&&(0,o.jsx)("div",{style:{padding:16,borderRadius:8,background:e8.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(e8.ok?"#86efac":"#fca5a5"),color:e8.ok?"#166534":"#991b1b"},children:e8.ok&&e8.client?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[(0,o.jsx)("span",{style:{fontSize:"1.5em"},children:"✅"}),(0,o.jsx)("strong",{style:{fontSize:"1.1em"},children:"Клієнт знайдено!"})]}),(0,o.jsx)("div",{style:{background:"#fff",padding:16,borderRadius:8,border:"1px solid #d1d5db"},children:(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:16},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4,color:"#6b7280",fontSize:"0.9em"},children:"Ім'я та прізвище:"}),(0,o.jsx)("div",{style:{fontSize:"1.1em",fontWeight:600,color:"#1f2937"},children:e8.client.name||"—"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4,color:"#6b7280",fontSize:"0.9em"},children:"Номер телефону:"}),(0,o.jsx)("div",{style:{fontSize:"1.1em",fontFamily:"monospace",color:"#1f2937"},children:e8.client.phone||"—"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4,color:"#6b7280",fontSize:"0.9em"},children:"Email:"}),(0,o.jsx)("div",{style:{fontSize:"1em",color:"#1f2937",wordBreak:"break-all"},children:e8.client.email||"—"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4,color:"#6b7280",fontSize:"0.9em"},children:"Instagram:"}),(0,o.jsxs)("div",{style:{fontSize:"1em",fontFamily:"monospace",color:"#22c55e",fontWeight:600},children:["@",e8.client.instagramUsername||"—"]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4,color:"#6b7280",fontSize:"0.9em"},children:"ID клієнта:"}),(0,o.jsx)("div",{style:{fontSize:"1em",fontFamily:"monospace",color:"#6b7280"},children:e8.client.id})]})]})})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:8},children:"❌ Клієнт не знайдено"}),(0,o.jsx)("div",{style:{fontSize:"0.9em",opacity:.9,marginBottom:12},children:e8.error||"Клієнт з таким Instagram username не знайдено в системі."}),e8.diagnostics&&(0,o.jsxs)("div",{style:{padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd",fontSize:"0.85em",marginTop:12},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4},children:"\uD83D\uDCCA Діагностика:"}),(0,o.jsxs)("ul",{style:{margin:"4px 0 0 0",paddingLeft:20},children:[(0,o.jsxs)("li",{children:["Перевірено клієнтів: ",(0,o.jsx)("strong",{children:e8.diagnostics.searchedClients})]}),(0,o.jsxs)("li",{children:["Клієнтів з email: ",(0,o.jsx)("strong",{children:e8.diagnostics.clientsWithEmail})]}),(0,o.jsxs)("li",{children:["Клієнтів без email: ",(0,o.jsx)("strong",{children:e8.diagnostics.clientsWithoutEmail})]})]})]}),e8.similarMatches&&e8.similarMatches.length>0&&(0,o.jsxs)("div",{style:{padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107",fontSize:"0.85em",marginTop:12},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:4},children:"\uD83D\uDD0D Схожі збіги:"}),(0,o.jsx)("ul",{style:{margin:"4px 0 0 0",paddingLeft:20},children:e8.similarMatches.map((e,n)=>(0,o.jsxs)("li",{children:[e.name||"Без імені"," - ",e.email," (Instagram: @",e.instagramPart,")"]},n))})]}),e8.sampleEmails&&e8.sampleEmails.length>0&&(0,o.jsxs)("details",{style:{marginTop:12},children:[(0,o.jsx)("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:"0.9em"},children:"\uD83D\uDCCB Приклади email в системі (перші 10)"}),(0,o.jsx)("div",{style:{marginTop:8,padding:12,background:"#f8fafc",borderRadius:6,fontSize:"0.85em"},children:(0,o.jsx)("ul",{style:{margin:0,paddingLeft:20},children:e8.sampleEmails.map((e,n)=>(0,o.jsxs)("li",{style:{marginBottom:4},children:[e.name||"Без імені"," - ",(0,o.jsx)("code",{children:e.email})," (Instagram: ",(0,o.jsxs)("code",{children:["@",e.instagramPart]}),")"]},n))})})]})]})})]}),(0,o.jsxs)(l,{title:"Тестування клієнтів",emoji:"\uD83D\uDC65",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:'Перевірка отримання клієнтів та кастомного поля "Instagram user name" через API.'}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,o.jsx)("button",{onClick:e9,disabled:ek.loading,style:{padding:"10px 20px",background:"#2a6df5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:ek.loading?"not-allowed":"pointer",opacity:ek.loading?.6:1},children:ek.loading?"Перевірка...":"Отримати клієнтів"}),(0,o.jsx)("button",{onClick:e7,disabled:eV,style:{padding:"10px 20px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eV?"not-allowed":"pointer",opacity:eV?.6:1},children:eV?"Тестування...":"\uD83D\uDD27 Діагностика API"}),(0,o.jsx)("button",{onClick:e4,style:{padding:"10px 20px",background:"#6b7280",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD0D Діагностика для підтримки"})]})]}),eL&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#f0f9ff",borderRadius:8,border:"1px solid #bae6fd"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCCB Діагностична інформація для техпідтримки Altegio:"}),(0,o.jsx)("button",{onClick:e3,style:{padding:"6px 12px",background:eU?"#22c55e":"#3b82f6",color:"#fff",border:"none",borderRadius:6,fontWeight:600,cursor:"pointer",fontSize:"0.85em"},children:eU?"✓ Скопійовано":"Скопіювати JSON"})]}),(0,o.jsx)("div",{style:{padding:12,background:"#fff",borderRadius:6,fontSize:"0.85em",maxHeight:"400px",overflowY:"auto"},children:(0,o.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(eL,null,2)})}),(0,o.jsx)("p",{style:{marginTop:12,fontSize:"0.9em",color:"#6b7280"},children:"Скопіюйте цю інформацію та надішліть її в техпідтримку Altegio для діагностики проблеми з правами доступу."})]}),null!==ek.ok&&(0,o.jsxs)("div",{style:{padding:12,borderRadius:8,background:ek.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(ek.ok?"#86efac":"#fca5a5"),color:ek.ok?"#166534":"#991b1b"},children:[(0,o.jsxs)("strong",{children:[ek.ok?"✅ Успішно":"❌ Помилка",":"]})," ",ek.message,void 0!==ek.clientsCount&&(0,o.jsxs)("div",{style:{marginTop:8},children:["Знайдено клієнтів: ",(0,o.jsx)("strong",{children:ek.clientsCount})]}),ek.ok&&ek.clients&&ek.clients.length>0&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:12},children:"\uD83D\uDC65 Список клієнтів:"}),(0,o.jsx)("div",{style:{overflowX:"auto"},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9em"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{style:{borderBottom:"2px solid #bae6fd",textAlign:"left"},children:[(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"ID"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Ім'я"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Телефон"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Email"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Instagram"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Card Number"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Note"})]})}),(0,o.jsx)("tbody",{children:ek.clients.map((e,n)=>(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #e0e7ef",backgroundColor:n%2==0?"#fff":"#fafafa"},children:[(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em"},children:e.id||"N/A"}),(0,o.jsx)("td",{style:{padding:"8px",fontWeight:500},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("span",{children:e.name||"—"}),e.id&&(0,o.jsx)("button",{onClick:()=>ne(e.id),disabled:eZ,style:{padding:"4px 8px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:4,fontSize:"0.75em",cursor:eZ?"not-allowed":"pointer",opacity:eZ?.6:1},title:"Отримати повну структуру клієнта",children:eZ&&(null==eq?void 0:eq.clientId)===e.id?"...":"\uD83D\uDD0D"})]})}),(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em"},children:e.phone||"—"}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em"},children:e.email||"—"}),(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em"},children:e.instagram&&"—"!==e.instagram?(0,o.jsxs)("span",{style:{color:"#22c55e",fontWeight:600},children:["@",e.instagram]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"—"})}),(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em",color:e.cardNumber&&"—"!==e.cardNumber?"#166534":"#6b7280"},children:e.cardNumber||"—"}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em",color:e.note&&"—"!==e.note?"#166534":"#6b7280",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"},children:e.note||"—"})]},e.id||n))})]})})]}),ek.ok&&ek.firstClientStructure&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:12},children:"\uD83D\uDCCB Структура першого клієнта:"}),ek.instagramFieldFound?(0,o.jsxs)("div",{style:{padding:12,background:"#dcfce7",borderRadius:6,border:"1px solid #86efac",marginBottom:12},children:[(0,o.jsx)("strong",{style:{color:"#166534"},children:"✅ Instagram поле знайдено!"}),(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.9em"},children:[(0,o.jsx)("strong",{children:"Назва поля:"})," ",(0,o.jsx)("code",{children:ek.instagramFieldName}),(0,o.jsx)("br",{}),(0,o.jsx)("strong",{children:"Значення:"})," ",(0,o.jsx)("code",{children:ek.instagramFieldValue})]})]}):(0,o.jsxs)("div",{style:{padding:12,background:"#fef3c7",borderRadius:6,border:"1px solid #fcd34d",marginBottom:12},children:[(0,o.jsx)("strong",{style:{color:"#92400e"},children:"⚠️ Instagram поле не знайдено"}),(0,o.jsx)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em"},children:"Перевірте всі можливі варіанти назв поля в структурі нижче."})]}),(0,o.jsxs)("div",{style:{marginTop:12},children:[(0,o.jsx)("strong",{children:"Основні поля:"}),(0,o.jsxs)("ul",{style:{margin:"4px 0 0 0",paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsxs)("li",{children:["ID: ",(0,o.jsx)("code",{children:ek.firstClientStructure.id})]}),(0,o.jsxs)("li",{children:["Ім'я: ",(0,o.jsx)("code",{children:ek.firstClientStructure.name})]}),ek.firstClientStructure.phone&&(0,o.jsxs)("li",{children:["Телефон: ",(0,o.jsx)("code",{children:ek.firstClientStructure.phone})]}),ek.firstClientStructure.email&&(0,o.jsxs)("li",{children:["Email: ",(0,o.jsx)("code",{children:ek.firstClientStructure.email})]})]})]}),ek.customFields&&ek.customFields.length>0&&(0,o.jsxs)("div",{style:{marginTop:12},children:[(0,o.jsxs)("strong",{children:["Всі поля клієнта (",(null===(e=ek.allKeys)||void 0===e?void 0:e.length)||0,"):"]}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"200px",overflowY:"auto"},children:(0,o.jsx)("code",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(ek.firstClientStructure.customFieldsData,null,2)})})]}),ek.firstClientStructure.custom_fields&&(0,o.jsxs)("div",{style:{marginTop:12},children:[(0,o.jsx)("strong",{children:"Custom fields об'єкт:"}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"150px",overflowY:"auto"},children:(0,o.jsx)("code",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(ek.firstClientStructure.custom_fields,null,2)})})]}),ek.firstClientStructure.rawStructure&&(0,o.jsx)("div",{style:{marginTop:12},children:(0,o.jsxs)("details",{children:[(0,o.jsx)("summary",{style:{cursor:"pointer",fontWeight:600,marginBottom:8},children:"\uD83D\uDD0D Повна raw структура першого клієнта (для діагностики)"}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.8em",maxHeight:"400px",overflowY:"auto",border:"1px solid #e0e7ef"},children:(0,o.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:ek.firstClientStructure.rawStructure})})]})})]}),ek.error&&(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.9em",opacity:.9},children:[ek.error,(ek.error.includes("No company management rights")||ek.error.includes("403"))&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107",color:"#856404"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCA1 Важливо! Після надання прав потрібно згенерувати новий USER_TOKEN:"}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:22},children:[(0,o.jsx)("li",{children:"Перейдіть в кабінет Altegio → Маркетплейс → Ваш додаток"}),(0,o.jsx)("li",{children:'Відкрийте розділ "Доступ до API" (API Access)'}),(0,o.jsxs)("li",{children:["Переконайтеся, що права надані:",(0,o.jsxs)("ul",{style:{marginTop:4,paddingLeft:18},children:[(0,o.jsx)("li",{children:'✅ "Клієнтська база" (Client base) - всі права'}),(0,o.jsx)("li",{children:'✅ "Журнал запису" (Record log) - всі права'})]})]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"ВАЖЛИВО:"})," Після надання прав ",(0,o.jsx)("strong",{children:"необхідно згенерувати новий USER_TOKEN"}),":",(0,o.jsxs)("ul",{style:{marginTop:4,paddingLeft:18},children:[(0,o.jsx)("li",{children:'Скопіюйте новий токен з поля "User Token"'}),(0,o.jsxs)("li",{children:["Оновіть змінну середовища ",(0,o.jsx)("code",{children:"ALTEGIO_USER_TOKEN"})," в Vercel"]}),(0,o.jsx)("li",{children:"Старий токен може не мати нових прав, навіть якщо права надані!"})]})]}),(0,o.jsx)("li",{children:"Після оновлення токена зачекайте 1-2 хвилини або перезапустіть деплой"})]}),(0,o.jsxs)("p",{style:{margin:"12px 0 0 0",padding:8,background:"#ffe69c",borderRadius:4,fontSize:"0.9em"},children:["⚠️ ",(0,o.jsx)("strong",{children:"Поточна помилка:"})," Навіть якщо права надані, старий USER_TOKEN не має цих прав. Потрібно згенерувати новий токен!"]})]})]})]}),eq&&(0,o.jsxs)("div",{style:{marginTop:24,padding:16,background:"#f0f9ff",borderRadius:8,border:"1px solid #bae6fd"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,o.jsxs)("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:8},children:[(0,o.jsx)("span",{style:{fontSize:"1.2em"},children:"\uD83D\uDD0D"})," Повна структура клієнта ",eq.clientId]}),(0,o.jsx)("button",{onClick:()=>eQ(null),style:{padding:"6px 12px",background:"#6b7280",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontSize:"0.85em"},children:"✕ Закрити"})]}),eq.ok&&eq.rawStructure&&(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{marginBottom:12,padding:12,background:"#fff",borderRadius:6,border:"1px solid #e0e7ef"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:8},children:"\uD83D\uDCCB Повна raw структура:"}),(0,o.jsx)("pre",{style:{margin:0,padding:12,background:"#f8fafc",borderRadius:4,fontSize:"0.85em",maxHeight:"500px",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:eq.rawStructure})]}),eq.customFieldsData&&(0,o.jsxs)("div",{style:{marginBottom:12,padding:12,background:"#dcfce7",borderRadius:6,border:"1px solid #86efac"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:8,color:"#166534"},children:"✅ Custom Fields:"}),(0,o.jsx)("pre",{style:{margin:0,padding:12,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"300px",overflow:"auto",whiteSpace:"pre-wrap"},children:JSON.stringify(eq.customFieldsData,null,2)})]}),(null===(n=eq.client)||void 0===n?void 0:n._meta)&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff",borderRadius:6,border:"1px solid #e0e7ef"},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:8},children:"\uD83D\uDCCA Мета-інформація:"}),(0,o.jsxs)("ul",{style:{margin:0,paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsxs)("li",{children:["Всього полів: ",(null===(i=eq.client._meta.allKeys)||void 0===i?void 0:i.length)||0]}),(0,o.jsxs)("li",{children:["Кастомні поля: ",(null===(t=eq.client._meta.customFields)||void 0===t?void 0:t.length)||0]}),(0,o.jsxs)("li",{children:["Має custom_fields: ",eq.client._meta.hasCustomFields?"✅ Так":"❌ Ні"]}),eq.client._meta.customFieldsKeys&&eq.client._meta.customFieldsKeys.length>0&&(0,o.jsxs)("li",{children:["Ключі custom_fields: ",eq.client._meta.customFieldsKeys.join(", ")]})]})]})]}),!eq.ok&&eq.error&&(0,o.jsxs)("div",{style:{padding:12,background:"#fef2f2",borderRadius:6,border:"1px solid #fca5a5",color:"#991b1b"},children:[(0,o.jsx)("strong",{children:"❌ Помилка:"})," ",eq.error]})]})]}),eH&&(0,o.jsx)(l,{title:"\uD83D\uDD27 Діагностика API клієнтів",emoji:"\uD83D\uDD27",children:(0,o.jsxs)("div",{style:{padding:16},children:[eH.ok&&eH.results&&(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{marginBottom:16,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd"},children:[(0,o.jsx)("strong",{children:"\uD83D\uDCCA Підсумок тестування:"}),(0,o.jsxs)("ul",{style:{margin:"8px 0 0 0",paddingLeft:22},children:[(0,o.jsxs)("li",{children:["Всього тестів: ",(0,o.jsx)("strong",{children:(null===(d=eH.summary)||void 0===d?void 0:d.totalTests)||0})]}),(0,o.jsxs)("li",{children:["Успішних: ",(0,o.jsx)("strong",{style:{color:"#16a34a"},children:(null===(a=eH.summary)||void 0===a?void 0:a.successful)||0})]}),(0,o.jsxs)("li",{children:["Помилок: ",(0,o.jsx)("strong",{style:{color:"#dc2626"},children:(null===(c=eH.summary)||void 0===c?void 0:c.failed)||0})]}),(0,o.jsxs)("li",{children:["Винятків: ",(0,o.jsx)("strong",{style:{color:"#dc2626"},children:(null===(g=eH.summary)||void 0===g?void 0:g.errors)||0})]})]})]}),(0,o.jsxs)("div",{style:{marginTop:16},children:[(0,o.jsx)("strong",{children:"Детальні результати:"}),(0,o.jsx)("div",{style:{marginTop:12},children:eH.results.map((e,n)=>(0,o.jsxs)("div",{style:{marginBottom:12,padding:12,background:e.success?"#f0fdf4":e.error?"#fef2f2":"#fef3c7",borderRadius:6,border:"1px solid ".concat(e.success?"#86efac":e.error?"#fca5a5":"#fcd34d")},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,o.jsxs)("strong",{style:{color:e.success?"#166534":e.error?"#991b1b":"#92400e"},children:[e.success?"✅":e.error?"❌":"⚠️"," ",e.test]}),e.status&&(0,o.jsxs)("span",{style:{fontSize:"0.9em",color:e.success?"#16a34a":"#dc2626"},children:[e.status," ",e.statusText]})]}),e.url&&(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.85em",color:"#6b7280"},children:[(0,o.jsx)("strong",{children:"URL:"})," ",(0,o.jsx)("code",{style:{wordBreak:"break-all"},children:e.url})]}),e.method&&(0,o.jsxs)("div",{style:{marginTop:4,fontSize:"0.85em",color:"#6b7280"},children:[(0,o.jsx)("strong",{children:"Method:"})," ",(0,o.jsx)("code",{children:e.method})]}),e.response&&(0,o.jsxs)("details",{style:{marginTop:8,cursor:"pointer"},children:[(0,o.jsx)("summary",{style:{fontWeight:600,fontSize:"0.9em"},children:"Відповідь API"}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"300px",overflowY:"auto"},children:(0,o.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(e.response,null,2)})})]}),e.error&&(0,o.jsxs)("div",{style:{marginTop:8,padding:8,background:"#fee2e2",borderRadius:4,color:"#991b1b",fontSize:"0.85em"},children:[(0,o.jsx)("strong",{children:"Помилка:"})," ",e.error]})]},n))})]})]}),!eH.ok&&eH.error&&(0,o.jsxs)("div",{style:{padding:12,background:"#fef2f2",borderRadius:6,border:"1px solid #fca5a5",color:"#991b1b"},children:[(0,o.jsx)("strong",{children:"❌ Помилка:"})," ",eH.error]})]})}),(0,o.jsxs)(l,{title:"Календар записів",emoji:"\uD83D\uDCC5",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:"Отримання майбутніх записів з календаря (на наступні 30 днів). Перевірка наявності Instagram username у клієнтів."}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,o.jsx)("button",{onClick:ni,disabled:eS.loading,style:{padding:"10px 20px",background:"#2a6df5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eS.loading?"not-allowed":"pointer",opacity:eS.loading?.6:1},children:eS.loading?"Завантаження...":"Отримати майбутні записи"}),(0,o.jsx)("button",{onClick:no,disabled:eI.loading,style:{padding:"10px 20px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eI.loading?"not-allowed":"pointer",opacity:eI.loading?.6:1},children:eI.loading?"Завантаження...":"\uD83D\uDCCA Отримати записи за тиждень (всі поля)"})]})]}),null!==eS.ok&&(0,o.jsxs)("div",{style:{padding:12,borderRadius:8,background:eS.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(eS.ok?"#86efac":"#fca5a5"),color:eS.ok?"#166534":"#991b1b"},children:[(0,o.jsxs)("strong",{children:[eS.ok?"✅ Успішно":"❌ Помилка",":"]})," ",eS.message,eS.ok&&void 0!==eS.appointmentsCount&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd",color:"#0c4a6e"},children:[(0,o.jsx)("div",{style:{marginBottom:8},children:(0,o.jsx)("strong",{children:"\uD83D\uDCCA Статистика:"})}),(0,o.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:22},children:[(0,o.jsxs)("li",{children:["Всього майбутніх записів: ",(0,o.jsx)("strong",{children:eS.appointmentsCount})]}),(0,o.jsxs)("li",{children:["Записів з Instagram username: ",(0,o.jsx)("strong",{children:eS.appointmentsWithInstagram||0})]}),(0,o.jsxs)("li",{children:["Період: ",(0,o.jsxs)("strong",{children:["наступні ",eS.days||30," днів"]})]})]})]}),eS.ok&&eS.appointments&&eS.appointments.length>0&&(0,o.jsxs)("div",{style:{marginTop:16},children:[(0,o.jsxs)("strong",{style:{display:"block",marginBottom:12},children:["\uD83D\uDCCB Список записів (",eS.appointments.slice(0,10).length," з ",eS.appointments.length,"):"]}),(0,o.jsxs)("div",{style:{maxHeight:"400px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:6,padding:8},children:[eS.appointments.slice(0,10).map((e,n)=>(0,o.jsxs)("div",{style:{padding:10,marginBottom:8,background:"#fff",borderRadius:6,border:"1px solid #e5e7eb",fontSize:"0.9em"},children:[(0,o.jsxs)("div",{style:{fontWeight:600,marginBottom:4},children:[e.client_name||"Без імені",e.instagram_username&&(0,o.jsxs)("span",{style:{marginLeft:8,color:"#22c55e",fontSize:"0.85em"},children:["\uD83D\uDCF1 @",e.instagram_username]})]}),(0,o.jsxs)("div",{style:{color:"#6b7280",fontSize:"0.85em"},children:[e.datetime?new Date(e.datetime).toLocaleString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Дата не вказана",e.status&&(0,o.jsxs)("span",{style:{marginLeft:8},children:["• Статус: ",e.status]})]})]},e.id||n)),eS.appointments.length>10&&(0,o.jsxs)("div",{style:{textAlign:"center",padding:8,color:"#6b7280",fontSize:"0.85em"},children:["... та ще ",eS.appointments.length-10," записів"]})]})]}),eS.error&&(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.9em",opacity:.9},children:[eS.error,eS.error.includes("No company management rights")&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#fff3cd",borderRadius:6,border:"1px solid #ffc107",color:"#856404"},children:[(0,o.jsx)("strong",{children:'\uD83D\uDCA1 Як вирішити помилку "No company management rights":'}),(0,o.jsxs)("ol",{style:{margin:"8px 0 0 0",paddingLeft:22},children:[(0,o.jsx)("li",{children:"Перейдіть в кабінет Altegio → Маркетплейс → Ваш додаток"}),(0,o.jsx)("li",{children:'Відкрийте розділ "Доступ до API" (API Access)'}),(0,o.jsxs)("li",{children:["Переконайтеся, що у вашому USER_TOKEN включені права:",(0,o.jsxs)("ul",{style:{marginTop:4,paddingLeft:18},children:[(0,o.jsx)("li",{children:"✅ Читання клієнтів (Read clients)"}),(0,o.jsx)("li",{children:"✅ Читання записів (Read appointments)"}),(0,o.jsx)("li",{children:"✅ Управління компанією (Company management)"})]})]}),(0,o.jsx)("li",{children:"Якщо права не налаштовані, оновіть токен або створіть новий з необхідними правами"}),(0,o.jsx)("li",{children:"Після оновлення прав оновіть ALTEGIO_USER_TOKEN в Vercel environment variables"})]})]})]})]}),null!==eI.ok&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,borderRadius:8,background:eI.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(eI.ok?"#86efac":"#fca5a5"),color:eI.ok?"#166534":"#991b1b"},children:[(0,o.jsxs)("strong",{children:[eI.ok?"✅ Успішно (записи за тиждень)":"❌ Помилка (записи за тиждень)",":"]})," ",(null===(p=eI.data)||void 0===p?void 0:p.message)||eI.error,eI.ok&&eI.data&&(0,o.jsxs)("div",{style:{marginTop:12,padding:12,background:"#f0f9ff",borderRadius:6,border:"1px solid #bae6fd",color:"#0c4a6e"},children:[(0,o.jsx)("div",{style:{marginBottom:8},children:(0,o.jsx)("strong",{children:"\uD83D\uDCCA Статистика за тиждень:"})}),(0,o.jsxs)("ul",{style:{margin:"8px 0",paddingLeft:22,fontSize:"0.9em"},children:[(0,o.jsxs)("li",{children:["Всього записів (appointments + visits):"," ",(0,o.jsx)("strong",{children:null!==(em=null!==(eu=null===(h=eI.data.summary)||void 0===h?void 0:h.total)&&void 0!==eu?eu:eI.data.totalAppointments)&&void 0!==em?em:"—"})]}),(0,o.jsxs)("li",{children:["Минулі записи:"," ",(0,o.jsx)("strong",{children:null!==(ex=null!==(ef=null===(u=eI.data.summary)||void 0===u?void 0:u.past)&&void 0!==ef?ef:eI.data.pastAppointmentsCount)&&void 0!==ex?ex:"—"})]}),(0,o.jsxs)("li",{children:["Майбутні записи:"," ",(0,o.jsx)("strong",{children:null!==(ey=null!==(ej=null===(m=eI.data.summary)||void 0===m?void 0:m.future)&&void 0!==ej?ej:eI.data.upcomingAppointmentsCount)&&void 0!==ey?ey:"—"})]})]})]})]})]}),(0,o.jsxs)(l,{title:"Шаблони повідомлень",emoji:"✏️",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsxs)("p",{style:{marginBottom:12},children:["Налаштуйте шаблони повідомлень для нагадувань. Використовуйте плейсхолдери: ","{date}",", ","{time}",", ","{clientName}",", ","{daysLeft}",", ","{service}",", ","{master}","."]}),(0,o.jsx)("button",{onClick:nd,disabled:eW.loading,style:{padding:"10px 20px",background:"#3b82f6",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eW.loading?"not-allowed":"pointer",opacity:eW.loading?.6:1,marginBottom:12},children:eW.loading?"Завантаження...":"Завантажити шаблони"})]}),null!==eW.ok&&(0,o.jsx)("div",{children:eW.ok&&eW.rules?(0,o.jsxs)("div",{children:[eW.rules.map((e,n)=>(0,o.jsxs)("div",{style:{marginBottom:20,padding:16,background:"#f8fafc",borderRadius:8,border:"1px solid #e2e8f0"},children:[(0,o.jsxs)("div",{style:{marginBottom:12,display:"flex",alignItems:"center",gap:12},children:[(0,o.jsxs)("strong",{style:{fontSize:"1.1em"},children:["За ",e.daysBefore," ",1===e.daysBefore?"день":e.daysBefore<5?"дні":"днів"," до візиту"]}),(0,o.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6,marginLeft:"auto"},children:[(0,o.jsx)("input",{type:"checkbox",checked:e.active,onChange:e=>{let i=[...eW.rules];i[n].active=e.target.checked,eP({...eW,rules:i})},style:{width:18,height:18}}),(0,o.jsx)("span",{style:{fontSize:"0.9em"},children:"Активне"})]})]}),(0,o.jsx)("textarea",{value:e.template,onChange:e=>{let i=[...eW.rules];i[n].template=e.target.value,eP({...eW,rules:i})},style:{width:"100%",minHeight:80,padding:12,border:"1px solid #cbd5e1",borderRadius:6,fontSize:"0.95em",fontFamily:"inherit",resize:"vertical"},placeholder:"Введіть шаблон повідомлення..."}),(0,o.jsxs)("div",{style:{marginTop:8,fontSize:"0.85em",color:"#64748b"},children:["Доступні плейсхолдери: ","{date}",", ","{time}",", ","{clientName}",", ","{daysLeft}",", ","{service}",", ","{master}",", ","{instagram}"]})]},e.id)),(0,o.jsx)("button",{onClick:nl,disabled:eW.loading,style:{padding:"12px 24px",background:"#22c55e",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eW.loading?"not-allowed":"pointer",opacity:eW.loading?.6:1,fontSize:"1em"},children:eW.loading?"Збереження...":"\uD83D\uDCBE Зберегти шаблони"})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"❌ Помилка:"})," ",eW.error||"Не вдалося завантажити шаблони"]})})]}),(0,o.jsxs)(l,{title:"Черга нагадувань",emoji:"\uD83D\uDCEC",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:"Клієнти, які очікують на відправку нагадувань про майбутні візити. Нагадування створюються автоматично при створенні/оновленні записів у Altegio."}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,o.jsx)("button",{onClick:()=>nt("pending"),disabled:eT.loading,style:{padding:"10px 20px",background:"#2a6df5",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eT.loading?"not-allowed":"pointer",opacity:eT.loading?.6:1},children:eT.loading?"Завантаження...":"Оновити чергу"}),(0,o.jsx)("button",{onClick:()=>nt("all"),disabled:eT.loading,style:{padding:"10px 20px",background:"#6b7280",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eT.loading?"not-allowed":"pointer",opacity:eT.loading?.6:1},children:eT.loading?"Завантаження...":"Всі job'и"}),(0,o.jsx)("button",{onClick:nr,disabled:eR.loading,style:{padding:"10px 20px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:eR.loading?"not-allowed":"pointer",opacity:eR.loading?.6:1},children:eR.loading?"Завантаження...":"\uD83D\uDD0D Діагностика"}),(0,o.jsx)("button",{onClick:async()=>{let e=new Date;e.setDate(e.getDate()+7),e.setHours(15,0,0,0);try{let n=await fetch("/api/altegio/reminders/test-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitId:999999999,datetime:e.toISOString(),instagram:"mykolayyurashko",clientName:"Микола Юрашко (тест)"})}),i=await n.json();i.ok?(alert("✅ Створено ".concat(i.jobsCreated.length," job'ів! Тепер оновіть чергу.")),nt()):alert("❌ Помилка: ".concat(i.error))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"10px 20px",background:"#10b981",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83E\uDDEA Тест створення job'ів"}),(0,o.jsx)("button",{onClick:async()=>{var e,n,i,o;if(eT.jobs&&eT.jobs.length>0){let i=eT.jobs[0];if(!confirm("Відправити тестове повідомлення для:\n\n"+"Клієнт: ".concat(i.clientName,"\n")+"Instagram: ".concat(i.instagram||"—","\n")+"Дата візиту: ".concat(new Date(i.visitDateTime).toLocaleString("uk-UA"),"\n\n")+"Продовжити?"))return;let o=prompt("Відправити тестове повідомлення для:\n\n"+"Клієнт: ".concat(i.clientName,"\n")+"Instagram: ".concat(i.instagram||"—","\n")+"Дата візиту: ".concat(new Date(i.visitDateTime).toLocaleString("uk-UA"),"\n\n")+"Якщо знаєш Subscriber ID з ManyChat Dashboard, введи його (або залиш порожнім для автоматичного пошуку):");if(null===o)return;try{let t=await fetch("/api/altegio/reminders/test-send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:i.id,subscriberId:(null==o?void 0:o.trim())||void 0})}),r=await t.json();if(r.ok){let i=(null===(e=r.method)||void 0===e?void 0:e.includes("симуляція"))?"⚠️ ".concat(r.method,"\n\n\uD83D\uDCA1 Для реальної відправки:\n1. Додай MANYCHAT_API_KEY в Vercel\n2. Переконайся, що @").concat(r.job.instagram," взаємодіяв з ManyChat ботом"):"✅ ".concat(r.method);alert("".concat((null===(n=r.method)||void 0===n?void 0:n.includes("симуляція"))?"⚠️":"✅"," Повідомлення відправлено!\n\n")+"Метод: ".concat(i,"\n")+"Instagram: ".concat(r.job.instagram,"\n")+"Message ID: ".concat(r.result.messageId||"—","\n\n")+(r.diagnostics?"Діагностика:\n- ManyChat API: ".concat(r.diagnostics.manychatApiKeyConfigured?"✅ Налаштовано":"❌ Не налаштовано","\n- Instagram API: ").concat(r.diagnostics.instagramTokenConfigured?"✅ Налаштовано":"❌ Не налаштовано"):"")),ns()}else alert("❌ Помилка відправки:\n".concat(r.error||"Невідома помилка"))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}}else{if(!confirm("Відправити тестове повідомлення для тестового клієнта @mykolayyurashko?\n\n(Якщо ManyChat API не налаштовано, буде симуляція)"))return;try{let e=await fetch("/api/altegio/reminders/test-send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({instagram:"mykolayyurashko"})}),n=await e.json();if(n.ok){let e=(null===(i=n.method)||void 0===i?void 0:i.includes("симуляція"))?"⚠️ ".concat(n.method,"\n\n\uD83D\uDCA1 Для реальної відправки:\n1. Додай MANYCHAT_API_KEY в Vercel\n2. Переконайся, що @").concat(n.job.instagram," взаємодіяв з ManyChat ботом"):"✅ ".concat(n.method);alert("".concat((null===(o=n.method)||void 0===o?void 0:o.includes("симуляція"))?"⚠️":"✅"," Повідомлення відправлено!\n\n")+"Метод: ".concat(e,"\n")+"Instagram: ".concat(n.job.instagram,"\n")+"Message ID: ".concat(n.result.messageId||"—","\n\n")+(n.diagnostics?"Діагностика:\n- ManyChat API: ".concat(n.diagnostics.manychatApiKeyConfigured?"✅ Налаштовано":"❌ Не налаштовано","\n- Instagram API: ").concat(n.diagnostics.instagramTokenConfigured?"✅ Налаштовано":"❌ Не налаштовано"):"")),ns()}else alert("❌ Помилка відправки:\n".concat(n.error||"Невідома помилка"))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}}},style:{padding:"10px 20px",background:"#8b5cf6",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDCE4 Тест відправки"}),(0,o.jsx)("button",{onClick:async()=>{try{let n=await fetch("/api/altegio/reminders/check-subscriber?instagram=mykolayyurashko",{method:"GET"}),i=await n.json();if(i.ok){let e=i.instagram.startsWith("@")?i.instagram:"@".concat(i.instagram);i.found?alert("✅ Subscriber знайдено в ManyChat!\n\n"+"Instagram: ".concat(e,"\n")+"Subscriber ID: ".concat(i.subscriberId,"\n\n")+"Тепер можна відправляти повідомлення."):alert("❌ Subscriber не знайдено в ManyChat\n\n"+"Instagram: ".concat(e,"\n\n")+"Що робити:\n"+"1. Відкрий Instagram на акаунті ".concat(e,"\n")+"2. Знайди ManyChat бот (або сторінку, яка використовує ManyChat)\n3. Напиши будь-яке повідомлення боту\n4. Або натисни на кнопку в автоматизації ManyChat\n5. Після цього спробуй перевірити знову")}else{var e;alert("❌ Помилка перевірки:\n".concat(i.error||"Невідома помилка","\n\n").concat(i.diagnostics?"Перевірені змінні: ".concat(null===(e=i.diagnostics.checkedVariables)||void 0===e?void 0:e.join(", ")):""))}}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"10px 20px",background:"#06b6d4",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD0D Перевірити subscriber"}),(0,o.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/altegio/reminders/test-manychat-api?instagram=mykolayyurashko",{method:"GET"}),n=await e.json();if(n.ok){let e=n.successfulResults||[],i=n.allResults||[],o="\uD83D\uDD0D Діагностика ManyChat API\n\n";o+="Instagram: ".concat(n.instagram,"\n")+"Знайдено: ".concat(n.found?"✅ Так":"❌ Ні","\n\n")+"Успішні тести: ".concat(e.length,"\n")+"Всього тестів: ".concat(i.length,"\n\n"),e.length>0?(o+="✅ Знайдено через:\n",e.forEach(e=>{o+="- ".concat(e.method,": Subscriber ID ").concat(e.subscriberId,"\n")})):(o+="❌ Не знайдено жодним методом:\n\n",i.forEach(e=>{if(o+="".concat(e.method,":\n")+"  Status: ".concat(e.status||"N/A","\n"),e.error)o+="  Error: ".concat(e.error,"\n");else if(e.response){let n="string"==typeof e.response?e.response:JSON.stringify(e.response).substring(0,200);o+="  Response: ".concat(n,"\n")}o+="\n"}),n.recommendations&&n.recommendations.length>0&&(o+="\n\uD83D\uDCA1 Рекомендації:\n",n.recommendations.forEach(e=>{o+="".concat(e,"\n")}))),eX({open:!0,title:"\uD83D\uDD2C Діагностика ManyChat API",content:o,jsonData:n})}else eX({open:!0,title:"❌ Помилка",content:"Помилка: ".concat(n.error||"Невідома помилка"),jsonData:n})}catch(e){eX({open:!0,title:"❌ Помилка",content:"Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка")})}},style:{padding:"10px 20px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD2C Діагностика ManyChat API"}),(0,o.jsx)("button",{onClick:async()=>{try{let n=await fetch("/api/altegio/reminders/test-manychat-detailed?instagram=mykolayyurashko",{method:"GET"}),i=await n.json();if(i.ok){var e;let n=i.successfulResults||[],o=i.allResults||[],t="\uD83D\uDD0D ДЕТАЛЬНА ДІАГНОСТИКА ManyChat API\n\n";t+="Instagram: ".concat(i.instagram,"\n")+"API Key: ".concat((null===(e=i.apiKeyInfo)||void 0===e?void 0:e.length)||"N/A"," символів\n")+"Знайдено: ".concat(i.found?"✅ Так":"❌ Ні","\n\n")+"Успішні тести: ".concat(n.length,"\n")+"Всього тестів: ".concat(o.length,"\n\n"),n.length>0?(t+="✅ Знайдено через:\n",n.forEach(e=>{t+="- ".concat(e.method,": Subscriber ID ").concat(e.subscriberId,"\n")})):(t+="❌ Не знайдено жодним методом\n\nДетальні результати:\n",o.forEach(e=>{if(t+="\n".concat(e.method,":\n")+"  Status: ".concat(e.status||"N/A"," ").concat(e.statusText||"","\n"),e.error)t+="  Error: ".concat(e.error,"\n");else if(e.response){if(e.response.parsed)t+="  Response: ".concat(JSON.stringify(e.response.parsed).substring(0,300),"...\n");else{var n;t+="  Response: ".concat((null===(n=e.response.raw)||void 0===n?void 0:n.substring(0,300))||"N/A","...\n")}}}),i.recommendations&&i.recommendations.length>0&&(t+="\n\n\uD83D\uDCA1 Рекомендації:\n",i.recommendations.forEach(e=>{t+="".concat(e,"\n")}))),console.log("[ManyChat Detailed Test]",i),eX({open:!0,title:"\uD83D\uDD0D ДЕТАЛЬНА ДІАГНОСТИКА ManyChat API",content:t,jsonData:i})}else alert("❌ Помилка: ".concat(i.error||"Невідома помилка"))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"10px 20px",background:"#8b5cf6",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD2C Детальна діагностика ManyChat API"}),(0,o.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/altegio/reminders/fix-index",{method:"POST"}),n=await e.json();n.ok?(alert("✅ ".concat(n.message,"\n").concat(n.oldType?"Старий тип: ".concat(n.oldType):"","\n").concat(n.count?"Кількість: ".concat(n.count):"")),nt(),nr()):alert("❌ Помилка: ".concat(n.error))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"10px 20px",background:"#ef4444",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD27 Виправити індекс"}),(0,o.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/altegio/reminders/check-webhook",{method:"GET"}),n=await e.json();if(n.ok){let e=n.lastRecordEvents||[];if(0===e.length)alert("❌ Немає останніх подій по записах. Перевір, чи налаштований webhook в Altegio.");else{let n=e[0],i="Знайдено ".concat(e.length," останніх подій по записах.\n\nОстання подія:\n- Дата: ").concat(new Date(n.receivedAt).toLocaleString("uk-UA"),"\n- Статус: ").concat(n.status,"\n- Visit ID: ").concat(n.visitId,"\n- Дата візиту: ").concat(n.datetime||"—","\n- Клієнт: ").concat(n.clientName||"—","\n- Instagram: ").concat(n.instagram?"@"+n.instagram:"—","\n\n").concat("mykolayyurashko"===n.instagram?"✅ Це тестовий клієнт!":"❌ Це не тестовий клієнт");if("mykolayyurashko"===n.instagram&&n.datetime){if(confirm(i+"\n\nСтворити job'и для цього запису?"))try{let e=await fetch("/api/altegio/reminders/check-webhook",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitId:n.visitId,datetime:n.datetime,instagram:n.instagram,clientName:n.clientName,companyId:1169323,clientId:n.clientId})}),i=await e.json();i.ok?(alert("✅ Створено ".concat(i.jobsCreated.length," job'ів! Тепер оновіть чергу.")),nt()):alert("❌ Помилка створення job'ів: ".concat(i.error))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}}else alert(i)}}else alert("❌ Помилка: ".concat(n.error))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"10px 20px",background:"#8b5cf6",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"\uD83D\uDD0D Перевірити webhook"})]})]}),null!==eT.ok&&(0,o.jsx)("div",{style:{padding:12,borderRadius:8,background:eT.ok?"#f0fdf4":"#fef2f2",border:"1px solid ".concat(eT.ok?"#86efac":"#fca5a5"),color:eT.ok?"#166534":"#991b1b"},children:eT.ok&&void 0!==eT.jobs?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{style:{marginBottom:12,fontWeight:600},children:["Знайдено нагадувань: ",(0,o.jsx)("strong",{children:eT.jobs.length}),eT.debug&&(0,o.jsxs)("div",{style:{fontSize:"0.85em",color:"#6b7280",marginTop:4,fontWeight:400},children:["(В індексі: ",eT.debug.indexTotal,", Після фільтру: ",eT.debug.jobsAfterFilter,")"]})]}),0===eT.jobs.length?(0,o.jsx)("p",{style:{margin:0,color:"#6b7280"},children:"Черга порожня. Нагадування будуть створюватися автоматично при створенні/оновленні записів у Altegio."}):(0,o.jsx)("div",{style:{maxHeight:"500px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:6,padding:8},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9em"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{style:{borderBottom:"2px solid #bae6fd",textAlign:"left"},children:[(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Клієнт"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Instagram"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Дата візиту"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Відправка"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Днів до візиту"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Дії"})]})}),(0,o.jsx)("tbody",{children:eT.jobs.map((e,n)=>(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #e0e7ef",backgroundColor:n%2==0?"#fff":"#fafafa"},children:[(0,o.jsx)("td",{style:{padding:"8px",fontWeight:500},children:e.clientName||"—"}),(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em"},children:e.instagram?(0,o.jsxs)("span",{style:{color:"#22c55e",fontWeight:600},children:["@",e.instagram]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"—"})}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em"},children:new Date(e.visitDateTime).toLocaleString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em",color:"#6b7280"},children:e.dueAtFormatted}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em",fontWeight:600},children:e.daysUntilVisit>0?(0,o.jsxs)("span",{style:{color:"#f59e0b"},children:[e.daysUntilVisit," дн."]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"Сьогодні"})}),(0,o.jsx)("td",{style:{padding:"8px"},children:e.instagram?(0,o.jsx)("button",{onClick:async()=>{if(confirm("Відправити тестове повідомлення для @".concat(e.instagram,"?")))try{let r=await fetch("/api/altegio/reminders/test-send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:e.id})}),s=await r.json();if(s.ok){var n,i,o,t;let e=(null===(n=s.method)||void 0===n?void 0:n.includes("симуляція"))?"⚠️ ".concat(s.method,"\n\n\uD83D\uDCA1 Для реальної відправки:\n1. Додай MANYCHAT_API_KEY в Vercel\n2. Переконайся, що @").concat(s.job.instagram," взаємодіяв з ManyChat ботом"):"✅ ".concat(s.method);alert("".concat((null===(i=s.method)||void 0===i?void 0:i.includes("симуляція"))?"⚠️":"✅"," Повідомлення відправлено!\n\n")+"Метод: ".concat(e,"\n")+"Instagram: ".concat(s.job.instagram,"\n")+"Message ID: ".concat((null===(o=s.result)||void 0===o?void 0:o.messageId)||"—","\n\n")+(s.diagnostics?"Діагностика:\n- ManyChat API: ".concat(s.diagnostics.manychatApiKeyConfigured?"✅ Налаштовано":"❌ Не налаштовано","\n- Instagram API: ").concat(s.diagnostics.instagramTokenConfigured?"✅ Налаштовано":"❌ Не налаштовано"):"")+((null===(t=s.result)||void 0===t?void 0:t.error)?"\n\nПомилка: ".concat(s.result.error):"")),ns()}else alert("❌ Помилка: ".concat(s.error))}catch(e){alert("❌ Помилка: ".concat(e instanceof Error?e.message:"Невідома помилка"))}},style:{padding:"6px 12px",background:"#8b5cf6",color:"#fff",border:"none",borderRadius:6,fontSize:"0.85em",fontWeight:600,cursor:"pointer"},children:"\uD83D\uDCE4 Тест"}):(0,o.jsx)("span",{style:{color:"#9ca3af",fontSize:"0.85em"},children:"—"})})]},e.id))})]})})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"❌ Помилка:"})," ",eT.error||"Не вдалося завантажити чергу"]})}),null!==eR.ok&&(0,o.jsxs)("div",{style:{marginTop:16,padding:12,background:eR.ok?"#f0f9ff":"#fef2f2",borderRadius:8,border:"1px solid ".concat(eR.ok?"#bae6fd":"#fca5a5")},children:[(0,o.jsx)("strong",{style:{display:"block",marginBottom:12},children:"\uD83D\uDD0D Діагностика нагадувань:"}),(0,o.jsxs)("div",{style:{marginBottom:12},children:[(0,o.jsx)("strong",{children:"Webhook події:"}),(0,o.jsxs)("ul",{style:{margin:"4px 0",paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsxs)("li",{children:["Всього подій: ",(null===(x=eR.data)||void 0===x?void 0:null===(f=x.webhookEvents)||void 0===f?void 0:f.total)||0]}),(0,o.jsxs)("li",{children:["Подій по записах: ",(null===(y=eR.data)||void 0===y?void 0:null===(j=y.webhookEvents)||void 0===j?void 0:j.recordEvents)||0]}),(null===(v=eR.data)||void 0===v?void 0:null===(b=v.webhookEvents)||void 0===b?void 0:b.eventsByResource)&&(null===(D=eR.data)||void 0===D?void 0:null===(k=D.webhookEvents)||void 0===k?void 0:k.eventsByResource.length)>0&&(0,o.jsxs)("li",{children:["По ресурсах:"," ",null===(C=eR.data)||void 0===C?void 0:null===(S=C.webhookEvents)||void 0===S?void 0:S.eventsByResource.map(e=>"".concat(e.resource,": ").concat(e.count)).join(", ")]})]}),(null===(w=eR.data)||void 0===w?void 0:null===(I=w.webhookEvents)||void 0===I?void 0:I.lastRecordEvents)&&(null===(A=eR.data)||void 0===A?void 0:null===(T=A.webhookEvents)||void 0===T?void 0:T.lastRecordEvents.length)>0&&(0,o.jsxs)("details",{style:{marginTop:8},children:[(0,o.jsxs)("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:"0.9em"},children:["Останні події по записах (",(null===(z=eR.data)||void 0===z?void 0:null===(E=z.webhookEvents)||void 0===E?void 0:null===(R=E.lastRecordEvents)||void 0===R?void 0:R.length)||0,")"]}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"300px",overflowY:"auto"},children:null===(P=eR.data)||void 0===P?void 0:null===(W=P.webhookEvents)||void 0===W?void 0:null===(B=W.lastRecordEvents)||void 0===B?void 0:B.map((e,n)=>(0,o.jsxs)("div",{style:{marginBottom:8,padding:8,background:"#f8fafc",borderRadius:4,border:"1px solid #e0e7ef"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Дата:"})," ",new Date(e.receivedAt).toLocaleString("uk-UA")]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Статус:"})," ",e.status]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Visit ID:"})," ",e.visitId]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Дата візиту:"})," ",e.datetime||"—"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Клієнт:"})," ",e.clientName||"—"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Instagram:"})," ",e.instagram?(0,o.jsxs)("span",{style:{color:"#22c55e",fontWeight:600},children:["@",e.instagram]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"—"})]})]},n))})]}),(null===(O=eR.data)||void 0===O?void 0:null===(N=O.webhookEvents)||void 0===N?void 0:N.lastAllEvents)&&(null===(F=eR.data)||void 0===F?void 0:null===(_=F.webhookEvents)||void 0===_?void 0:_.lastAllEvents.length)>0&&(0,o.jsxs)("details",{style:{marginTop:8},children:[(0,o.jsxs)("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:"0.9em"},children:["Всі останні webhook події (",(null===(U=eR.data)||void 0===U?void 0:null===(M=U.webhookEvents)||void 0===M?void 0:null===(L=M.lastAllEvents)||void 0===L?void 0:L.length)||0,")"]}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"400px",overflowY:"auto"},children:null===(J=eR.data)||void 0===J?void 0:null===(H=J.webhookEvents)||void 0===H?void 0:null===(K=H.lastAllEvents)||void 0===K?void 0:K.map((e,n)=>(0,o.jsxs)("div",{style:{marginBottom:8,padding:8,background:"record"===e.resource?"#dcfce7":"#f8fafc",borderRadius:4,border:"1px solid ".concat("record"===e.resource?"#86efac":"#e0e7ef")},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Дата:"})," ",new Date(e.receivedAt).toLocaleString("uk-UA")]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Resource:"})," ",(0,o.jsx)("span",{style:{color:"record"===e.resource?"#22c55e":"#6b7280",fontWeight:"record"===e.resource?600:400},children:e.resource||"—"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Resource ID:"})," ",e.resource_id||"—"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Status:"})," ",e.status||"—"]}),"record"===e.resource&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Дата візиту:"})," ",e.datetime||"—"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Клієнт:"})," ",e.clientName||"—"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Instagram:"})," ",e.instagram?(0,o.jsxs)("span",{style:{color:"#22c55e",fontWeight:600},children:["@",e.instagram]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"—"})]})]}),(0,o.jsxs)("details",{style:{marginTop:4},children:[(0,o.jsx)("summary",{style:{cursor:"pointer",fontSize:"0.8em",color:"#6b7280"},children:"Повна структура події"}),(0,o.jsx)("pre",{style:{marginTop:4,padding:4,background:"#1e293b",color:"#e2e8f0",borderRadius:2,fontSize:"0.75em",overflowX:"auto"},children:JSON.stringify(e.fullBody||e,null,2)})]})]},n))})]})]}),(0,o.jsxs)("div",{style:{marginBottom:12},children:[(0,o.jsx)("strong",{children:"Job'и нагадувань:"}),(0,o.jsxs)("ul",{style:{margin:"4px 0",paddingLeft:20,fontSize:"0.9em"},children:[(0,o.jsxs)("li",{children:["Всього: ",(null===(Y=eR.data)||void 0===Y?void 0:null===(V=Y.jobs)||void 0===V?void 0:V.total)||0]}),(0,o.jsxs)("li",{children:["Pending: ",(null===(X=eR.data)||void 0===X?void 0:null===(G=X.jobs)||void 0===G?void 0:G.pending)||0]}),(0,o.jsxs)("li",{children:["Sent: ",(null===(Q=eR.data)||void 0===Q?void 0:null===(q=Q.jobs)||void 0===q?void 0:q.sent)||0]}),(0,o.jsxs)("li",{children:["Failed: ",(null===($=eR.data)||void 0===$?void 0:null===(Z=$.jobs)||void 0===Z?void 0:Z.failed)||0]}),(0,o.jsxs)("li",{children:["Canceled: ",(null===(en=eR.data)||void 0===en?void 0:null===(ee=en.jobs)||void 0===ee?void 0:ee.canceled)||0]})]}),(null===(eo=eR.data)||void 0===eo?void 0:null===(ei=eo.jobs)||void 0===ei?void 0:ei.byVisit)&&(null===(er=eR.data)||void 0===er?void 0:null===(et=er.jobs)||void 0===et?void 0:et.byVisit.length)>0&&(0,o.jsxs)("details",{style:{marginTop:8},children:[(0,o.jsxs)("summary",{style:{cursor:"pointer",fontWeight:600,fontSize:"0.9em"},children:["Job'и по візитах (",(null===(el=eR.data)||void 0===el?void 0:null===(ed=el.jobs)||void 0===ed?void 0:null===(es=ed.byVisit)||void 0===es?void 0:es.length)||0,")"]}),(0,o.jsx)("div",{style:{marginTop:8,padding:8,background:"#fff",borderRadius:4,fontSize:"0.85em",maxHeight:"300px",overflowY:"auto"},children:null===(eg=eR.data)||void 0===eg?void 0:null===(ec=eg.jobs)||void 0===ec?void 0:null===(ea=ec.byVisit)||void 0===ea?void 0:ea.map((e,n)=>(0,o.jsxs)("div",{style:{marginBottom:8,padding:8,background:"#f8fafc",borderRadius:4,border:"1px solid #e0e7ef"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Visit ID:"})," ",e.visitId," (",e.count," job'ів)"]}),e.jobs.map((e,n)=>(0,o.jsxs)("div",{style:{marginTop:4,padding:4,background:"#fff",borderRadius:2,fontSize:"0.8em"},children:[e.ruleId," - ",e.status," - Instagram: ",e.instagram||"—"," -"," ",e.dueAtFormatted]},n))]},n))})]})]})]})]}),(0,o.jsxs)(l,{title:"Відправлені нагадування",emoji:"✅",children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("p",{style:{marginBottom:12},children:"Історія відправлених нагадувань клієнтам через Instagram DM. Показує останні 50 записів."}),(0,o.jsx)("button",{onClick:ns,disabled:ez.loading,style:{padding:"10px 20px",background:"#22c55e",color:"#fff",border:"none",borderRadius:8,fontWeight:600,cursor:ez.loading?"not-allowed":"pointer",opacity:ez.loading?.6:1},children:ez.loading?"Завантаження...":"Оновити історію"})]}),null!==ez.ok&&(0,o.jsx)("div",{children:ez.ok?(0,o.jsxs)("div",{children:[void 0!==ez.total&&(0,o.jsxs)("div",{style:{marginBottom:12,padding:12,background:"#f0fdf4",borderRadius:8,border:"1px solid #86efac"},children:[(0,o.jsxs)("strong",{children:["Знайдено відправлених повідомлень: ",(null===(ep=ez.logs)||void 0===ep?void 0:ep.length)||0]}),void 0!==ez.total&&ez.total>((null===(eh=ez.logs)||void 0===eh?void 0:eh.length)||0)&&(0,o.jsxs)("span",{style:{color:"#6b7280",marginLeft:8},children:["(Всього в системі: ",ez.total,")"]})]}),ez.logs&&0!==ez.logs.length?(0,o.jsx)("div",{style:{maxHeight:"500px",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:6,padding:8},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9em"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{style:{borderBottom:"2px solid #86efac",textAlign:"left"},children:[(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Клієнт"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Instagram"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Дата візиту"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Відправлено"}),(0,o.jsx)("th",{style:{padding:"8px",fontWeight:600},children:"Статус"})]})}),(0,o.jsx)("tbody",{children:ez.logs.map((e,n)=>(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #e0e7ef",backgroundColor:n%2==0?"#fff":"#fafafa"},children:[(0,o.jsx)("td",{style:{padding:"8px",fontWeight:500},children:e.clientName||"—"}),(0,o.jsx)("td",{style:{padding:"8px",fontFamily:"monospace",fontSize:"0.85em"},children:e.instagram?(0,o.jsxs)("span",{style:{color:"#22c55e",fontWeight:600},children:["@",e.instagram]}):(0,o.jsx)("span",{style:{color:"#ef4444"},children:"—"})}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em"},children:e.visitDateTimeFormatted}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em",color:"#6b7280"},children:e.timestampFormatted}),(0,o.jsx)("td",{style:{padding:"8px",fontSize:"0.85em",fontWeight:600},children:e.success?(0,o.jsx)("span",{style:{color:"#22c55e"},children:"✅ Відправлено"}):(0,o.jsxs)("span",{style:{color:"#ef4444"},children:["❌ Помилка: ",e.error||"Невідома помилка"]})})]},e.jobId))})]})}):(0,o.jsx)("p",{style:{margin:0,color:"#6b7280"},children:"Немає відправлених повідомлень. Нагадування будуть відображатися тут після відправки через cron job."})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"❌ Помилка:"})," ",ez.error||"Не вдалося завантажити історію"]})})]}),(0,o.jsxs)(l,{title:"\uD83D\uDCE4 Експорт помилки для підтримки",emoji:"\uD83D\uDCE4",children:[(0,o.jsx)("p",{style:{marginBottom:16},children:"Щоб зробити скріншот для підтримки Altegio, натисніть кнопку нижче. Вона покаже всі деталі помилки в одному місці."}),(0,o.jsx)("button",{onClick:async()=>{var e,n,i,o,t,r,s,d,l,a,c,g,p,h,u,m,f;let x=null;try{let e=await fetch("/api/altegio/diagnostics",{cache:"no-store"}),n=await e.json();n.ok&&n.diagnostics&&(x=n.diagnostics)}catch(e){console.warn("Failed to get diagnostics:",e)}let j=(null==x?void 0:null===(e=x.environment)||void 0===e?void 0:e.companyId)||"1169323";null==x||null===(n=x.environment)||void 0===n||n.partnerTokenFull,null==x||null===(i=x.environment)||void 0===i||i.userTokenPreview,null==x||null===(o=x.environment)||void 0===o||o.applicationId,null==x||null===(t=x.environment)||void 0===t||t.partnerId;let y={timestamp:new Date().toISOString(),companyId:j,errors:{clients:ek.error||"Not tested",appointments:eS.error||"Not tested"},working:{companies:eb.ok?"✅ Working":"❌ Not working"},attemptedEndpoints:["POST /api/v1/clients (with company_id in body)","POST /api/v1/company/".concat(j,"/clients"),"GET /api/v1/company/".concat(j,"/appointments")],diagnostics:x},b=window.open("","_blank");b&&(b.document.write("\n                  <!DOCTYPE html>\n                  <html>\n                  <head>\n                    <title>Altegio API Error Details for Support</title>\n                    <style>\n                      body {\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                        max-width: 800px;\n                        margin: 40px auto;\n                        padding: 20px;\n                        background: #f5f5f5;\n                      }\n                      .card {\n                        background: white;\n                        padding: 30px;\n                        border-radius: 8px;\n                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n                        margin-bottom: 20px;\n                      }\n                      h1 { color: #d32f2f; margin-top: 0; }\n                      h2 { color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px; }\n                      .error { background: #ffebee; padding: 15px; border-radius: 4px; border-left: 4px solid #d32f2f; margin: 10px 0; }\n                      .success { background: #e8f5e9; padding: 15px; border-radius: 4px; border-left: 4px solid #4caf50; margin: 10px 0; }\n                      pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; }\n                      .info { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 10px 0; }\n                    </style>\n                  </head>\n                  <body>\n                    <div class=\"card\">\n                      <h1>\uD83D\uDEA8 Altegio API Error Report</h1>\n                      <p><strong>Date:</strong> ".concat(y.timestamp,"</p>\n                      <p><strong>Company ID:</strong> ").concat(y.companyId,'</p>\n                    </div>\n\n                    <div class="card">\n                      <h2>✅ What Works</h2>\n                      <div class="success">\n                        <strong>GET /api/v1/companies</strong> - Returns company information successfully\n                      </div>\n                    </div>\n\n                    <div class="card">\n                      <h2>❌ What Doesn\'t Work</h2>\n                      <div class="error">\n                        <strong>POST /api/v1/clients</strong><br>\n                        Error: ').concat(y.errors.clients,'\n                      </div>\n                      <div class="error">\n                        <strong>GET /api/v1/company/1169323/appointments</strong><br>\n                        Error: ').concat(y.errors.appointments,'\n                      </div>\n                    </div>\n\n                    <div class="card">\n                      <h2>\uD83D\uDCCB Attempted Endpoints</h2>\n                      <ul>\n                        ').concat(y.attemptedEndpoints.map(e=>"<li>".concat(e,"</li>")).join(""),'\n                      </ul>\n                    </div>\n\n                    <div class="card">\n                      <h2>\uD83D\uDD27 Request Details</h2>\n                      <div class="info">\n                        <strong>Authorization Header Format:</strong><br>\n                        <code>').concat((null===(s=y.diagnostics)||void 0===s?void 0:null===(r=s.headers)||void 0===r?void 0:r.authorization)||"Bearer [PARTNER_TOKEN], User [USER_TOKEN]",'</code>\n                      </div>\n                      <div class="info">\n                        <strong>Headers:</strong><br>\n                        <pre>Accept: application/vnd.api.v2+json\nContent-Type: application/json\nAuthorization: ').concat((null===(l=y.diagnostics)||void 0===l?void 0:null===(d=l.headers)||void 0===d?void 0:d.authorization)||"Bearer [PARTNER_TOKEN], User [USER_TOKEN]","\nX-Partner-ID: ").concat((null===(c=y.diagnostics)||void 0===c?void 0:null===(a=c.headers)||void 0===a?void 0:a.xPartnerId)||"[PARTNER_ID]","\nX-Application-ID: ").concat((null===(p=y.diagnostics)||void 0===p?void 0:null===(g=p.headers)||void 0===g?void 0:g.xApplicationId)||"[APPLICATION_ID]",'</pre>\n                      </div>\n                    </div>\n\n                    <div class="card">\n                      <h2>\uD83D\uDCDD Application Details</h2>\n                      <pre>Application ID: ').concat((null===(u=y.diagnostics)||void 0===u?void 0:null===(h=u.environment)||void 0===h?void 0:h.applicationId)||"[APPLICATION_ID]","\nPartner ID: ").concat((null===(f=y.diagnostics)||void 0===f?void 0:null===(m=f.environment)||void 0===m?void 0:m.partnerId)||"[PARTNER_ID]","\nCompany ID: ").concat(y.companyId,"\nApplication Type: Non-public</pre>\n                    </div>\n                    \n                    ").concat(y.diagnostics?'\n                    <div class="card">\n                      <h2>\uD83D\uDD0D Full Diagnostics</h2>\n                      <pre>'.concat(JSON.stringify(y.diagnostics,null,2),"</pre>\n                    </div>\n                    "):"",'\n\n                    <div class="card">\n                      <h2>\uD83D\uDCA1 Next Steps</h2>\n                      <p>Please provide:</p>\n                      <ol>\n                        <li>Why API returns 403 even though permissions are enabled?</li>\n                        <li>Correct endpoint and method for retrieving clients?</li>\n                        <li>Any additional settings needed for non-public applications?</li>\n                      </ol>\n                    </div>\n                  </body>\n                  </html>\n                ')),b.document.close(),alert("Відкрито нове вікно з деталями. Зробіть скріншот цього вікна для підтримки!"))},style:{padding:"12px 24px",backgroundColor:"#2a6df5",color:"white",border:"none",borderRadius:8,fontSize:16,fontWeight:600,cursor:"pointer",boxShadow:"0 2px 8px rgba(42, 109, 245, 0.3)"},children:"\uD83D\uDCF8 Створити звіт для підтримки"}),(0,o.jsx)("p",{style:{marginTop:12,fontSize:"0.9em",color:"#666"},children:"Кнопка відкриє нове вікно з усіма деталями помилки. Зробіть скріншот цього вікна."})]}),(0,o.jsx)(l,{title:"Статус",emoji:"\uD83D\uDEA7",children:(0,o.jsxs)("p",{children:["Технічне завдання зафіксоване у ",(0,o.jsx)("code",{children:"PROJECT_NOTES.md"}),". Поточний етап — налаштування підключення до Alteg.io API."]})}),(0,o.jsx)(l,{title:"Наступні кроки",emoji:"✅",children:(0,o.jsxs)("ol",{style:{margin:0,paddingLeft:22},children:[(0,o.jsx)("li",{children:"Перевірити підключення до API (використовується USER_TOKEN)."}),(0,o.jsx)("li",{children:"Отримати список компаній (салонів) для тестування."}),(0,o.jsx)("li",{children:"Реалізувати базові методи роботи з клієнтами та записами."}),(0,o.jsx)("li",{children:"Створити ETL-процес для синхронізації даних."})]})}),(0,o.jsx)(l,{title:"Посилання",emoji:"\uD83D\uDD17",children:(0,o.jsxs)("ul",{style:{margin:0,paddingLeft:18},children:[(0,o.jsx)("li",{children:(0,o.jsx)(r(),{href:"/admin/analytics",style:{color:"#2a6df5"},children:"Перейти до майбутнього дашборду"})}),(0,o.jsx)("li",{children:(0,o.jsx)(r(),{href:"/admin/debug",style:{color:"#2a6df5"},children:"Відкрити тестову сторінку ManyChat/KeyCRM"})})]})})]}),eG.open&&(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px"},onClick:()=>eX({open:!1,title:"",content:""}),children:(0,o.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:12,padding:"24px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[(0,o.jsx)("h2",{style:{margin:0,fontSize:"20px",fontWeight:600},children:eG.title}),(0,o.jsx)("button",{onClick:()=>eX({open:!1,title:"",content:""}),style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",padding:"0 8px",color:"#666"},children:"\xd7"})]}),(0,o.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,o.jsx)("button",{onClick:async()=>{let e=eG.jsonData?JSON.stringify(eG.jsonData,null,2):eG.content;await navigator.clipboard.writeText(e),alert("✅ Скопійовано в буфер обміну!")},style:{padding:"8px 16px",background:"#3b82f6",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:500,marginRight:"8px"},children:"\uD83D\uDCCB Копіювати JSON"}),(0,o.jsx)("button",{onClick:async()=>{await navigator.clipboard.writeText(eG.content),alert("✅ Текст скопійовано в буфер обміну!")},style:{padding:"8px 16px",background:"#10b981",color:"#fff",border:"none",borderRadius:6,cursor:"pointer",fontWeight:500},children:"\uD83D\uDCCB Копіювати текст"})]}),(0,o.jsx)("div",{style:{backgroundColor:"#f9fafb",padding:"16px",borderRadius:8,fontFamily:"monospace",fontSize:"13px",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:"60vh",overflow:"auto",border:"1px solid #e5e7eb"},children:eG.content}),eG.jsonData&&(0,o.jsxs)("details",{style:{marginTop:"16px"},children:[(0,o.jsx)("summary",{style:{cursor:"pointer",fontWeight:500,marginBottom:"8px"},children:"\uD83D\uDCC4 Показати повний JSON"}),(0,o.jsx)("pre",{style:{backgroundColor:"#1f2937",color:"#f9fafb",padding:"16px",borderRadius:8,overflow:"auto",fontSize:"12px",maxHeight:"40vh",marginTop:"8px"},children:JSON.stringify(eG.jsonData,null,2)})]})]})})]})}function l(e){let{children:n,title:i,emoji:t}=e;return(0,o.jsxs)("div",{style:{borderRadius:20,border:"1px solid #e8ebf0",background:"#fff",boxShadow:"0 8px 26px rgba(0,0,0,0.06)",padding:"22px 24px"},children:[(0,o.jsxs)("header",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:12},children:[t&&(0,o.jsx)("span",{style:{fontSize:28},children:t}),(0,o.jsx)("h2",{style:{margin:0,fontSize:24,fontWeight:800},children:i})]}),(0,o.jsx)("div",{style:{color:"rgba(0,0,0,0.72)",lineHeight:1.5},children:n})]})}}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=8232)}),_N_E=e.O()}]);