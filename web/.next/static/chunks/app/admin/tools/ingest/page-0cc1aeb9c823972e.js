(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[996],{891:function(e,t,l){Promise.resolve().then(l.bind(l,8279))},8279:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return d},dynamic:function(){return n}});var a=l(7437),s=l(2265);let n="force-dynamic";function i(e){let{title:t,children:l}=e;return(0,a.jsxs)("div",{className:"rounded-2xl border p-4 md:p-6",children:[(0,a.jsx)("h2",{className:"mb-3 text-lg font-semibold",children:t}),l]})}function r(e){let{label:t,value:l,setValue:s,placeholder:n,type:i="text"}=e;return(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,a.jsx)("input",{type:i,value:l,onChange:e=>s(e.target.value),placeholder:n,className:"rounded-lg border px-3 py-2 text-sm outline-none"})]})}function d(){let[e,t]=(0,s.useState)(""),[l,n]=(0,s.useState)(""),[d,c]=(0,s.useState)(""),[o,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(!1),[b,h]=(0,s.useState)(""),[f,y]=(0,s.useState)(""),[j,N]=(0,s.useState)(""),[S,v]=(0,s.useState)(null),[_,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(""),[O,D]=(0,s.useState)(""),[I,T]=(0,s.useState)(null),[V,P]=(0,s.useState)(!1);async function E(t){t.preventDefault(),g(!0),p(null);try{let t=new URLSearchParams;e&&t.set("token",e),o&&t.set("card_id",o);let a=await fetch("/api/mc/ingest?".concat(t.toString()),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,text:d})}),s=await a.json();p(s)}catch(e){p({ok:!1,error:String(e)})}finally{g(!1)}}async function J(e){e.preventDefault(),w(!0),v(null);try{let e=await fetch("/api/keycrm/card/move",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({card_id:b,to_pipeline_id:f,to_status_id:j})}),t=await e.json();v(t)}catch(e){v({ok:!1,error:String(e)})}finally{w(!1)}}async function R(e){e.preventDefault(),P(!0),T(null);try{let e=await fetch("/api/map/ig",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:k,card_id:O})}),t=await e.json();T(t)}catch(e){T({ok:!1,error:String(e)})}finally{P(!1)}}async function M(){P(!0),T(null);try{let e=await fetch("/api/map/ig?username=".concat(encodeURIComponent(k)),{credentials:"include"}),t=await e.json();T(t)}catch(e){T({ok:!1,error:String(e)})}finally{P(!1)}}return(0,s.useEffect)(()=>{let e=localStorage.getItem("mc_token")||"";e&&t(e)},[]),(0,s.useEffect)(()=>{e&&localStorage.setItem("mc_token",e)},[e]),(0,a.jsxs)("div",{className:"mx-auto max-w-4xl px-4 py-6",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Admin Tools"}),(0,a.jsx)("a",{href:"/admin/campaigns",className:"rounded-full border px-3 py-1.5 text-sm",children:"← До кампаній"})]}),(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(i,{title:"Map username → card_id (/api/map/ig)",children:[(0,a.jsxs)("form",{onSubmit:R,className:"grid gap-3",children:[(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsx)(r,{label:"username (IG)",value:k,setValue:C,placeholder:"ig_login"}),(0,a.jsx)(r,{label:"card_id",value:O,setValue:D,placeholder:"CARD_ID"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:V,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 disabled:opacity-60",children:"Зберегти мапінг"}),(0,a.jsx)("button",{type:"button",onClick:M,disabled:V||!k,className:"rounded-lg border px-3 py-2 text-sm",children:"Перевірити мапінг"}),(0,a.jsx)("button",{type:"button",className:"rounded-lg border px-3 py-2 text-sm",onClick:()=>T(null),children:"Очистити"})]})]}),I&&(0,a.jsx)("pre",{className:"mt-3 overflow-auto rounded-lg border bg-gray-50 p-3 text-xs",children:JSON.stringify(I,null,2)})]}),(0,a.jsxs)(i,{title:"ManiChat → /api/mc/ingest (POST)",children:[(0,a.jsxs)("form",{onSubmit:E,className:"grid gap-3",children:[(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsx)(r,{label:"MC_TOKEN",value:e,setValue:t,placeholder:"секрет токен"}),(0,a.jsx)(r,{label:"card_id (опц., швидкий тест)",value:o,setValue:u,placeholder:"CARD_ID"})]}),(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsx)(r,{label:"username (IG)",value:l,setValue:n,placeholder:"ig_login"}),(0,a.jsx)(r,{label:"text",value:d,setValue:c,placeholder:"yes / ключове слово"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:x,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 disabled:opacity-60",children:"Відправити ingest"}),(0,a.jsx)("button",{type:"button",className:"rounded-lg border px-3 py-2 text-sm",onClick:()=>p(null),children:"Очистити"})]})]}),m&&(0,a.jsx)("pre",{className:"mt-3 overflow-auto rounded-lg border bg-gray-50 p-3 text-xs",children:JSON.stringify(m,null,2)})]}),(0,a.jsxs)(i,{title:"KeyCRM Move → /api/keycrm/card/move (POST)",children:[(0,a.jsxs)("form",{onSubmit:J,className:"grid gap-3",children:[(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,a.jsx)(r,{label:"card_id",value:b,setValue:h,placeholder:"CARD_ID"}),(0,a.jsx)(r,{label:"to_pipeline_id",value:f,setValue:y,placeholder:"PID"}),(0,a.jsx)(r,{label:"to_status_id",value:j,setValue:N,placeholder:"SID"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:_,className:"rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700 disabled:opacity-60",children:"Тест move"}),(0,a.jsx)("button",{type:"button",className:"rounded-lg border px-3 py-2 text-sm",onClick:()=>v(null),children:"Очистити"})]})]}),S&&(0,a.jsx)("pre",{className:"mt-3 overflow-auto rounded-lg border bg-gray-50 p-3 text-xs",children:JSON.stringify(S,null,2)})]})]})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=891)}),_N_E=e.O()}]);