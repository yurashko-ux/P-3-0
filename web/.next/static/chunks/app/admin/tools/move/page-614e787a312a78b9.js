(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[525],{8720:function(e,l,t){Promise.resolve().then(t.bind(t,7014))},7014:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return i}});var a=t(7437),s=t(2265);async function n(e){let l=await fetch(e,{cache:"no-store"});if(!l.ok)return[];let t=await l.json().catch(()=>({}));return(Array.isArray(null==t?void 0:t.items)?t.items:Array.isArray(t)?t:[]).map(e=>{var l,t,a,s,n,i,d;return{id:String(null!==(t=null!==(l=null==e?void 0:e.id)&&void 0!==l?l:null==e?void 0:e.value)&&void 0!==t?t:""),title:String(null!==(d=null!==(i=null!==(n=null!==(s=null!==(a=null==e?void 0:e.title)&&void 0!==a?a:null==e?void 0:e.name)&&void 0!==s?s:null==e?void 0:e.label)&&void 0!==n?n:null==e?void 0:e.alias)&&void 0!==i?i:null==e?void 0:e.id)&&void 0!==d?d:"")}})}function i(){let[e,l]=(0,s.useState)(""),[t,i]=(0,s.useState)([]),[d,r]=(0,s.useState)(""),[c,o]=(0,s.useState)([]),[u,x]=(0,s.useState)(""),[m,p]=(0,s.useState)(!1),[h,v]=(0,s.useState)(null);async function b(l){if(l.preventDefault(),v(null),!e||!d||!u){v("Заповни Card ID, Воронку та Статус.");return}p(!0);try{let l=await fetch("/api/keycrm/card/move",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({card_id:e.trim(),to_pipeline_id:d,to_status_id:u})}),t=await l.json().catch(()=>({}));l.ok&&(null==t?void 0:t.ok)?v("✅ Перенесено успішно."):v("❌ Помилка: ".concat((null==t?void 0:t.error)||"".concat(l.status," ").concat(l.statusText)))}catch(e){v("❌ Помилка запиту: ".concat((null==e?void 0:e.message)||"unknown"))}finally{p(!1)}}return(0,s.useEffect)(()=>{(async()=>{i(await n("/api/keycrm/pipelines"))})()},[]),(0,s.useEffect)(()=>{(async()=>{o([]),x(""),d&&o(await n("/api/keycrm/statuses?pipeline_id=".concat(encodeURIComponent(d))))})()},[d]),(0,a.jsxs)("div",{className:"mx-auto max-w-3xl p-6 space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold",children:"Тест: Move Card у KeyCRM"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Введи ",(0,a.jsx)("b",{children:"Card ID"})," з KeyCRM і вибери цільову ",(0,a.jsx)("b",{children:"воронку"})," та"," ",(0,a.jsx)("b",{children:"статус"}),". Ендпойнт вимагає адмін-куку ",(0,a.jsx)("code",{children:"admin_pass"}),"."]}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4 rounded-2xl border p-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Card ID"}),(0,a.jsx)("input",{className:"w-full rounded-xl border px-3 py-2",placeholder:"напр. 123456",value:e,onChange:e=>l(e.target.value)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Цільова воронка"}),(0,a.jsxs)("select",{className:"w-full rounded-xl border px-3 py-2",value:d,onChange:e=>r(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"— Обери воронку —"}),t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Цільовий статус"}),(0,a.jsxs)("select",{className:"w-full rounded-xl border px-3 py-2",value:u,onChange:e=>x(e.target.value),disabled:!d||0===c.length,children:[(0,a.jsx)("option",{value:"",children:d?"— Обери статус —":"Спершу вибери воронку"}),c.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)("button",{type:"submit",disabled:m,className:"rounded-xl px-5 py-2 border bg-blue-600 text-white disabled:opacity-50",children:m?"Виконую…":"Перенести"})}),h&&(0,a.jsx)("div",{className:"text-sm",children:h})]})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=8720)}),_N_E=e.O()}]);