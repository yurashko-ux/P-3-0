(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{2878:function(e,t,n){Promise.resolve().then(n.bind(n,2102)),Promise.resolve().then(n.bind(n,2095)),Promise.resolve().then(n.bind(n,5163))},2095:function(e,t,n){"use strict";n.d(t,{FinanceReportClient:function(){return l}});var o=n(7437),r=n(2265),s=n(9260),i=n(5414);let a=[{i:"block-1",x:0,y:0,w:6,h:100},{i:"block-2",x:6,y:0,w:6,h:100},{i:"block-3",x:0,y:100,w:6,h:80},{i:"block-4",x:6,y:100,w:6,h:80},{i:"block-5",x:0,y:180,w:12,h:60}];function l(e){let{children:t}=e,{editMode:n}=(0,i.W)(),l=(0,r.useRef)(a);return(0,o.jsx)(s.R,{storageKey:"finance-report-dashboard-layout",layoutVersion:"7",defaultLayout:a,editMode:n,onSave:e=>{l.current=e},children:{"block-1":t.block1,"block-2":t.block2,"block-3":t.block3,"block-4":t.block4,"block-5":t.block5}})}},5163:function(e,t,n){"use strict";n.d(t,{FinanceReportPageClient:function(){return a}});var o=n(7437),r=n(5414),s=n(6246);function i(){let{editMode:e,setEditMode:t}=(0,r.W)();return(0,o.jsx)("div",{className:"p-3 bg-blue-50 border-2 border-blue-300 rounded-lg shadow-md",children:(0,o.jsx)(s.G,{storageKey:"finance-report-dashboard-layout",onEditModeChange:t,onSave:e=>{}})})}function a(e){let{children:t,summaryContent:n}=e;return(0,o.jsx)(r.S,{children:(0,o.jsxs)("div",{className:"mx-auto max-w-6xl px-2 py-2 space-y-2",children:[t,n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i,{}),n]})]})})}},5414:function(e,t,n){"use strict";n.d(t,{S:function(){return i},W:function(){return a}});var o=n(7437),r=n(2265);let s=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[n,i]=(0,r.useState)(!1);return(0,o.jsx)(s.Provider,{value:{editMode:n,setEditMode:i},children:t})}function a(){let e=(0,r.useContext)(s);if(!e)throw Error("useLayoutEdit must be used within LayoutEditProvider");return e}},2102:function(e,t,n){"use strict";n.d(t,{EditableCostCell:function(){return i}});var o=n(7437),r=n(2265),s=n(6463);function i(e){let{year:t,month:n,currentCost:i}=e,a=(0,s.useRouter)(),[l,c]=(0,r.useState)(!1),[u,d]=(0,r.useState)(!1),[b,h]=(0,r.useState)(""),[x,f]=(0,r.useState)(String(i)),[m,p]=(0,r.useTransition)(),[y,k]=(0,r.useState)(null),[C,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{f(String(i))},[i]);let v=()=>{let e=parseFloat(x);if(isNaN(e)||e<0){k("Собівартість має бути невід'ємним числом");return}k(null),p(async()=>{try{let o=await fetch("/api/admin/finance-report/cost?secret=".concat(encodeURIComponent(b)),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({year:t,month:n,cost:e})});if(!o.ok){let e=await o.json();throw Error(e.error||"Помилка збереження")}let r=await o.json();console.log("[EditableCostCell] Saved cost:",r),g("Збережено"),k(null),f(String(e)),c(!1),d(!1),h(""),a.refresh(),setTimeout(()=>{g(null)},2e3)}catch(e){console.error("[EditableCostCell] Save error:",e),k(e.message||"Помилка збереження")}})},S=()=>{f(String(i)),c(!1),d(!1),h(""),k(null)};return l?(0,o.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,o.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,o.jsx)("input",{type:"number",value:x,onChange:e=>f(e.target.value),placeholder:"Собівартість",className:"input input-bordered input-xs w-24 text-right",min:"0",step:"0.01",disabled:m,autoFocus:!0,onKeyDown:e=>{"Enter"===e.key?v():"Escape"===e.key&&S()}}),(0,o.jsx)("span",{className:"text-xs text-gray-600",children:"грн."}),(0,o.jsx)("button",{onClick:v,className:"btn btn-xs btn-primary",disabled:m,title:"Зберегти",children:m?"...":"\uD83D\uDCBE"}),(0,o.jsx)("button",{onClick:S,className:"btn btn-xs btn-ghost",disabled:m,title:"Скасувати",children:"✕"})]}),y&&(0,o.jsx)("div",{className:"text-xs text-error",children:y}),C&&(0,o.jsx)("div",{className:"text-xs text-success",children:C})]}):(0,o.jsxs)("span",{className:"text-xs font-bold whitespace-nowrap",children:[Math.round(i).toLocaleString("uk-UA",{minimumFractionDigits:0,maximumFractionDigits:0})," грн.",(0,o.jsx)("button",{onClick:()=>{if(l){c(!1),f(String(i)),d(!1),h(""),k(null);return}let e=prompt("Введіть CRON_SECRET для редагування собівартості:");e&&fetch("/api/admin/finance-report/cost?secret=".concat(encodeURIComponent(e),"&year=").concat(t,"&month=").concat(n)).then(t=>{t.ok?(d(!0),h(e),c(!0)):alert("Невірний CRON_SECRET")}).catch(e=>{console.error("Failed to verify secret:",e),alert("Помилка перевірки секрету")})},className:"btn btn-xs btn-ghost p-0.5 opacity-60 hover:opacity-100 ml-1 inline-flex items-center",title:"Редагувати собівартість (потрібен CRON_SECRET)",children:"✏️"})]})}}},function(e){e.O(0,[902,971,23,744],function(){return e(e.s=2878)}),_N_E=e.O()}]);