# –õ–æ–≥—ñ–∫–∞ —ñ–∫–æ–Ω–æ–∫ —Å—Ç–∞–Ω—ñ–≤ —É Direct Manager (–∫–æ–ª–æ–Ω–∫–∞ ¬´–°—Ç–∞–Ω¬ª)

## –ü–æ–Ω—è—Ç—Ç—è

### –ù–æ–≤–∏–π –∑–∞–ø–∏—Å
- **–ù–æ–≤–∏–π –∑–∞–ø–∏—Å** = –ø–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å –∫–ª—ñ—î–Ω—Ç–∞ (—â–µ –Ω–µ –±—É–ª–æ –ø–ª–∞—Ç–Ω–∏—Ö –≤—ñ–∑–∏—Ç—ñ–≤).
- –í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ **spent**: `spent === 0` –∞–±–æ `spent == null` (—Ç—Ä–∞–∫—Ç—É—î–º–æ —è–∫ 0).
- `spent` –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑ Altegio ‚Äî –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∫–ª—ñ—î–Ω—Ç–∞.

### –ü–µ—Ä–µ–∑–∞–ø–∏—Å
- **–ü–µ—Ä–µ–∑–∞–ø–∏—Å** = –Ω–æ–≤–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —É **–±—É–∫—ñ–Ω–≥-–¥–µ–Ω—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø–∏—Å—É**.
- –¢–æ–±—Ç–æ: `paidServiceRecordCreatedAt` (–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É) = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ (attended) –∑–∞–ø–∏—Å—É.
- –£ —Å–∏—Å—Ç–µ–º—ñ ‚Äî –ø–æ–ª–µ `paidServiceIsRebooking` (enriched —É records-grouping).

### –ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞
- **–ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É** = `paidServiceDate` ‚Äî –¥–∞—Ç–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ –≤—ñ–∑–∏—Ç—É.
- **–ó–µ–ª–µ–Ω–∏–π –¥–µ–Ω—å** = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ = —Å—å–æ–≥–æ–¥–Ω—ñ.
- **–ß–µ—Ä–≤–æ–Ω–∏–π –¥–µ–Ω—å** = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ < —Å—å–æ–≥–æ–¥–Ω—ñ (–º–∏–Ω—É–ª–∞ –¥–∞—Ç–∞).

---

## –õ–æ–≥—ñ–∫–∞ —ñ–∫–æ–Ω–æ–∫ (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤—ñ–¥ –≤–∏—â–æ–≥–æ –¥–æ –Ω–∏–∂—á–æ–≥–æ)

### 1. üî• –í–æ–≥–Ω–∏–∫ (–ü—Ä–æ–¥–∞–Ω–æ)
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ (`consultationAttended === true`)
- –Ñ –∞–∫—Ç–∏–≤–Ω–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (`paidServiceDate` —ñ –Ω–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ)
- **–ù–æ–≤–∏–π –∑–∞–ø–∏—Å** (`spent === 0` –∞–±–æ `null`)
- `paidServiceDate >= —Å—å–æ–≥–æ–¥–Ω—ñ` (—Å—å–æ–≥–æ–¥–Ω—ñ –∞–±–æ –º–∞–π–±—É—Ç–Ω—î)
- –ù–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ (`!paidServiceCancelled`), –Ω–µ no-show (`paidServiceAttended !== false`)

**–°–º–∏—Å–ª:** –ü–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å ‚Äî –ø—Ä–æ–¥–∞–∂ –∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó.

---

### 2. üîÅ –ü–µ—Ä–µ–∑–∞–ø–∏—Å
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ
- –Ñ –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (–Ω–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ, –Ω–µ no-show)
- **–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø–∏—Å—É** (`paidServiceIsRebooking === true`)
- –ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É = —Å—å–æ–≥–æ–¥–Ω—ñ –∞–±–æ –º–∞–π–±—É—Ç–Ω—î

**–ö–ª—é—á–æ–≤–∞ —É–º–æ–≤–∞:** `paidServiceRecordCreatedAt` (–ø–æ—Ç–æ—á–Ω–æ–≥–æ) = `paidServiceDate` (–ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ attended). –£ —Å–∏—Å—Ç–µ–º—ñ ‚Äî `paidServiceIsRebooking`.

**–°–º–∏—Å–ª:** –ù–æ–≤–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —É –±—É–∫—ñ–Ω–≥-–¥–µ–Ω—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ (–ø–µ—Ä–µ–∑–∞–ø–∏—Å).

---

### 3. ‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ
- –Ñ –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å
- **–ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É < —Å—å–æ–≥–æ–¥–Ω—ñ** (—á–µ—Ä–≤–æ–Ω–∏–π –¥–µ–Ω—å)

**–í–∞–∂–ª–∏–≤–æ:** `spent` –Ω–µ –≤–∞–∂–ª–∏–≤–∏–π ‚Äî —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ 2-–π, 3-–π, 5-–π –∑–∞–ø–∏—Å. –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ ‚è≥ —ñ üîÅ ‚Äî –ª–∏—à–µ –≤ –±—É–∫—ñ–Ω–≥ –¥–∞—Ç—ñ (–º–∏–Ω—É–ª–∞ vs —Å—å–æ–≥–æ–¥–Ω—ñ/–º–∞–π–±—É—Ç–Ω—î).

**–°–º–∏—Å–ª:** –ó–∞–ø–∏—Å —É –º–∏–Ω—É–ª–æ–º—É ‚Äî –æ—á—ñ–∫—É—î–º–æ –≤—ñ–∑–∏—Ç –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å.

---

### 4. –Ü–Ω—à—ñ —Å—Ç–∞–Ω–∏
- üíî –ù–µ –ø—Ä–æ–¥–∞–ª–∏ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ, –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—É –Ω–∞ –ø–ª–∞—Ç–Ω—É
- ‚ùå No-show –Ω–∞ –ø–ª–∞—Ç–Ω—É (–º–∏–Ω—É–ª–∞ –¥–∞—Ç–∞)
- üö´ –°–∫–∞—Å–æ–≤–∞–Ω–æ (attendance = -1 –¥–æ –¥–∞—Ç–∏ –∞–±–æ cancelled)
- üóìÔ∏è –°–∏–Ω—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä ‚Äî –ª–∏—à–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è (–Ω–µ–º–∞—î –ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É)

---

## –ü–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —É –∫–æ–¥—ñ

1. –ß–µ—Ä–≤–æ–Ω–∞ –¥–∞—Ç–∞ (paidServiceDate < —Å—å–æ–≥–æ–¥–Ω—ñ), –Ω–µ no-show, –Ω–µ cancelled ‚Üí ‚è≥
2. –ó–µ–ª–µ–Ω–∞/–º–∞–π–±—É—Ç–Ω—è –¥–∞—Ç–∞ + spent=0 (–Ω–æ–≤–∏–π –∑–∞–ø–∏—Å) ‚Üí üî•
3. –ó–µ–ª–µ–Ω–∞/–º–∞–π–±—É—Ç–Ω—è –¥–∞—Ç–∞ + paidServiceIsRebooking (–¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è = –±—É–∫—ñ–Ω–≥ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ) ‚Üí üîÅ
4. No-show –º–∏–Ω—É–ª–æ—ó –¥–∞—Ç–∏ ‚Üí ‚ùå, cancelled ‚Üí üö´, —ñ–Ω—à—ñ —Å—Ç–∞–Ω–∏‚Ä¶

---

## –§–∞–π–ª–∏

- `web/app/admin/direct/_components/DirectClientTable.tsx` ‚Äî –∫–æ–ª–æ–Ω–∫–∞ ¬´–°—Ç–∞–Ω¬ª, —Ä–µ–Ω–¥–µ—Ä —ñ–∫–æ–Ω–æ–∫
- `web/lib/altegio/records-grouping.ts` ‚Äî –æ–±—á–∏—Å–ª–µ–Ω–Ω—è `paidServiceIsRebooking`
- `web/app/api/admin/direct/clients/route.ts` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ `spent`, `paidServiceIsRebooking`
- `web/lib/direct-types.ts` ‚Äî —Ç–∏–ø–∏ `paidServiceIsRebooking`, `paidServiceRebookFromKyivDay`
