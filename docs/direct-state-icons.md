# –õ–æ–≥—ñ–∫–∞ —ñ–∫–æ–Ω–æ–∫ —Å—Ç–∞–Ω—ñ–≤ —É Direct Manager (–∫–æ–ª–æ–Ω–∫–∞ ¬´–°—Ç–∞–Ω¬ª)

## –ü–æ–Ω—è—Ç—Ç—è

### –ù–æ–≤–∏–π –∑–∞–ø–∏—Å
- **–ù–æ–≤–∏–π –∑–∞–ø–∏—Å** = –ø–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å –∫–ª—ñ—î–Ω—Ç–∞ (—â–µ –Ω–µ –±—É–ª–æ –ø–ª–∞—Ç–Ω–∏—Ö –≤—ñ–∑–∏—Ç—ñ–≤).
- –í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ **spent**: `spent === 0` –∞–±–æ `spent == null` (—Ç—Ä–∞–∫—Ç—É—î–º–æ —è–∫ 0).
- `spent` –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑ Altegio ‚Äî –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç –∫–ª—ñ—î–Ω—Ç–∞.

### –ü–µ—Ä–µ–∑–∞–ø–∏—Å
- **–ü–µ—Ä–µ–∑–∞–ø–∏—Å** = –Ω–æ–≤–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —É **–±—É–∫—ñ–Ω–≥-–¥–µ–Ω—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø–∏—Å—É**.
- –¢–æ–±—Ç–æ: `paidServiceRecordCreatedAt` (–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É) = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ (attended) –∑–∞–ø–∏—Å—É.
- –£ —Å–∏—Å—Ç–µ–º—ñ ‚Äî –ø–æ–ª–µ `paidServiceIsRebooking` (enriched —É records-grouping).

### –ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞
- **–ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É** = `paidServiceDate` ‚Äî –¥–∞—Ç–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ –≤—ñ–∑–∏—Ç—É.
- **–ó–µ–ª–µ–Ω–∏–π –¥–µ–Ω—å** = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ = —Å—å–æ–≥–æ–¥–Ω—ñ.
- **–ß–µ—Ä–≤–æ–Ω–∏–π –¥–µ–Ω—å** = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ < —Å—å–æ–≥–æ–¥–Ω—ñ (–º–∏–Ω—É–ª–∞ –¥–∞—Ç–∞).

---

## –õ–æ–≥—ñ–∫–∞ —ñ–∫–æ–Ω–æ–∫ (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –≤—ñ–¥ –≤–∏—â–æ–≥–æ –¥–æ –Ω–∏–∂—á–æ–≥–æ)

### 1. üî• –í–æ–≥–Ω–∏–∫ (–ü—Ä–æ–¥–∞–Ω–æ)
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ (`consultationAttended === true`)
- –Ñ –∞–∫—Ç–∏–≤–Ω–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (`paidServiceDate` —ñ –Ω–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ)
- **–ü–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å** ‚Äî –≤ —ñ—Å—Ç–æ—Ä—ñ—ó –ø–ª–∞—Ç–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ (records:log) –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É. –í–æ–≥–Ω–∏–∫ –∑'—è–≤–ª—è—î—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–µ—Ä—à–æ–≥–æ –ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É.
- `paidServiceDate >= —Å—å–æ–≥–æ–¥–Ω—ñ` (—Å—å–æ–≥–æ–¥–Ω—ñ –∞–±–æ –º–∞–π–±—É—Ç–Ω—î)
- –ù–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ (`!paidServiceCancelled`), –Ω–µ no-show (`paidServiceAttended !== false`)

**–°–º–∏—Å–ª:** –ü–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å ‚Äî –ø—Ä–æ–¥–∞–∂ –∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó.

---

### 2. üîÅ –ü–µ—Ä–µ–∑–∞–ø–∏—Å
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ
- –Ñ –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (–Ω–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ, –Ω–µ no-show)
- **–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É = –±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–ø–∏—Å—É** (`paidServiceIsRebooking === true`)
- –ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É = —Å—å–æ–≥–æ–¥–Ω—ñ –∞–±–æ –º–∞–π–±—É—Ç–Ω—î

**–ö–ª—é—á–æ–≤–∞ —É–º–æ–≤–∞:** `paidServiceRecordCreatedAt` (–ø–æ—Ç–æ—á–Ω–æ–≥–æ) = `paidServiceDate` (–ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ attended). –£ —Å–∏—Å—Ç–µ–º—ñ ‚Äî `paidServiceIsRebooking`.

**–°–º–∏—Å–ª:** –ù–æ–≤–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —É –±—É–∫—ñ–Ω–≥-–¥–µ–Ω—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ (–ø–µ—Ä–µ–∑–∞–ø–∏—Å).

---

### 3. ‚ö†Ô∏è –ñ–æ–≤—Ç–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ (–±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –≤ –º–∏–Ω—É–ª–æ–º—É)
- –Ñ –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å
- **–ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É < —Å—å–æ–≥–æ–¥–Ω—ñ** (—á–µ—Ä–≤–æ–Ω–∏–π –¥–µ–Ω—å)
- –ù–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ, –Ω–µ no-show

**–°–º–∏—Å–ª:** –ó–∞–ø–∏—Å —É –º–∏–Ω—É–ª–æ–º—É ‚Äî –ø–æ—Ç—Ä–µ–±—É—î —É–≤–∞–≥–∏.

---

### 4. ‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è (–±—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É)
- –Ñ –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å
- **–ë—É–∫—ñ–Ω–≥–¥–∞—Ç–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É > —Å—å–æ–≥–æ–¥–Ω—ñ** (–º–∞–π–±—É—Ç–Ω—î)
- –í–∏–Ω—è—Ç–∫–∏: üî• –ü—Ä–æ–¥–∞–∂ (–Ω–æ–≤–∏–π –∑–∞–ø–∏—Å), üîÅ –ü–µ—Ä–µ–∑–∞–ø–∏—Å

**–°–º–∏—Å–ª:** –û—á—ñ–∫—É—î–º–æ –≤—ñ–∑–∏—Ç —É –º–∞–π–±—É—Ç–Ω—å–æ–º—É.

---

### 5. –•–º–∞—Ä–∫–∏ –¥–ª—è –ª—ñ–¥—ñ–≤ (–±–µ–∑ Altegio ID, –±–µ–∑ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó, –±–µ–∑ –ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É)
- **–ö—Ä–æ–∫ 1:** –°–∏–Ω—è —Ö–º–∞—Ä–∫–∞ "–ù–æ–≤–∏–π –ª—ñ–¥" ‚Äî –ø–µ—Ä—à–∏–π –∫–æ–Ω—Ç–∞–∫—Ç —Å—å–æ–≥–æ–¥–Ω—ñ.
- **–ö—Ä–æ–∫ 2:** –ó–µ–ª–µ–Ω–∞ —Ö–º–∞—Ä–∫–∞ "–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" ‚Äî –ø–µ—Ä—à–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –±—É–≤ —Ä–∞–Ω—ñ—à–µ (–≤–∫–ª—é—á–Ω–æ –∑ —É—á–æ—Ä–∞).
- –î–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: `firstContactDate`, –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ ‚Äî `createdAt`.
- –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–Ω—ñ–≤ —É timezone Europe/Kyiv.
- –ö–æ–ª—å–æ—Ä–∏: —Å–∏–Ω—è ‚Äî `#3b82f6` fill, `#2563eb` stroke (—è–∫ —É LeadBadgeIcon); –∑–µ–ª–µ–Ω–∞ ‚Äî `#10b981`.

---

### 6. –Ü–Ω—à—ñ —Å—Ç–∞–Ω–∏
- üíî –ù–µ –ø—Ä–æ–¥–∞–ª–∏ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è ‚úÖ, –Ω–µ–º–∞—î –∑–∞–ø–∏—Å—É –Ω–∞ –ø–ª–∞—Ç–Ω—É
- üóìÔ∏è –°–∏–Ω—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä ‚Äî –ª–∏—à–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è (–Ω–µ–º–∞—î –ø–ª–∞—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É)

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –°—Ç–∞–Ω–∏ üö´ (—Å–∫–∞—Å–æ–≤–∞–Ω–æ) —Ç–∞ ‚ùå (no-show) —É –∫–æ–ª–æ–Ω—Ü—ñ ¬´–°—Ç–∞–Ω¬ª –Ω–µ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è ‚Äî –ª–æ–≥–∏–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–∞.

---

## –ü–æ—Ä—è–¥–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —É –∫–æ–¥—ñ

1. –ß–µ—Ä–≤–æ–Ω–∞ –¥–∞—Ç–∞ (paidServiceDate < —Å—å–æ–≥–æ–¥–Ω—ñ), –Ω–µ no-show, –Ω–µ cancelled ‚Üí ‚ö†Ô∏è
2. –ó–µ–ª–µ–Ω–∞/–º–∞–π–±—É—Ç–Ω—è –¥–∞—Ç–∞ + –ø–µ—Ä—à–∏–π –ø–ª–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (0 –∑–∞–ø–∏—Å—ñ–≤ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó) ‚Üí üî•
3. –ó–µ–ª–µ–Ω–∞/–º–∞–π–±—É—Ç–Ω—è –¥–∞—Ç–∞ + paidServiceIsRebooking ‚Üí üîÅ
4. –ú–∞–π–±—É—Ç–Ω—è –¥–∞—Ç–∞ (–±–µ–∑ üî•, üîÅ) ‚Üí ‚è≥
5. –Ü–Ω—à—ñ —Å—Ç–∞–Ω–∏‚Ä¶

---

## –ü—Ä–∏–º—ñ—Ç–∫–∏

- –Ü–∫–æ–Ω–∫–∏ ‚úÇÔ∏è —Ç–∞ –ù–∞—Ä–æ—â—É–≤–∞–Ω–Ω—è –≤–æ–ª–æ—Å—Å—è (image-client) –≤–∏–¥–∞–ª–µ–Ω–æ ‚Äî –¥–ª—è hair-extension, other-services —Ç–∞ –Ω–µ–≤—ñ–¥–æ–º–æ–≥–æ —Ç–∏–ø—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–æ–≥—ñ–∫–∞ ‚è≥/‚ö†Ô∏è.
- –†–æ–∑–º—ñ—Ä —ñ–∫–æ–Ω–æ–∫ ‚è≥ —Ç–∞ ‚ö†Ô∏è –≤ –∫–æ–ª–æ–Ω—Ü—ñ ¬´–°—Ç–∞–Ω¬ª ‚Äî 12px (50% –≤—ñ–¥ 24px).

## –§–∞–π–ª–∏

- `web/app/admin/direct/_components/DirectClientTable.tsx` ‚Äî –∫–æ–ª–æ–Ω–∫–∞ ¬´–°—Ç–∞–Ω¬ª, StateIcon (new-lead, message), —Ä–µ–Ω–¥–µ—Ä —ñ–∫–æ–Ω–æ–∫
- `web/app/admin/direct/_components/StateHistoryModal.tsx` ‚Äî —ñ–∫–æ–Ω–∫–∞ —Ç–∞ –º—ñ—Ç–∫–∞ –¥–ª—è —Å—Ç–∞–Ω—É `new-lead`
- `web/lib/altegio/records-grouping.ts` ‚Äî –æ–±—á–∏—Å–ª–µ–Ω–Ω—è `paidServiceIsRebooking`
- `web/app/api/admin/direct/clients/route.ts` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ `spent`, `paidServiceIsRebooking`
- `web/lib/direct-types.ts` ‚Äî —Ç–∏–ø–∏ `paidServiceIsRebooking`, `paidServiceRebookFromKyivDay`
