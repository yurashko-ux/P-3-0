# Поточний стан проєкту ManiChat → KeyCRM

## Що вже працює

- **Адмін-панель на Next.js** показує всі кампанії з назвами воронок/статусів, лічильниками та датою створення, дозволяє створювати нові кампанії і видаляти існуючі, використовуючи збереження у Vercel KV. Сторінки `/admin/login` та middleware забезпечують вхід за паролем із кукою `admin_token`.
- **Створення кампанії** через форму запитує довідники KeyCRM (воронки та статуси), збирає правила для V1/V2/EXP і відправляє `POST /api/campaigns`, який збагачує дані назвами з KeyCRM і кладе все у KV.
- **REST-проксі до KeyCRM**: ендпоінти `/api/keycrm/pipelines` і `/api/keycrm/statuses` стабільно повертають списки воронок та статусів, кешуючи відповіді в KV; `/api/keycrm/card/move` виконує переміщення картки, підбираючи робочий варіант API.
- **ManiChat вебхук** (`/api/mc/manychat`) нормалізує payload, читає кампанії з KV, шукає збіги за правилами `contains|equals`, та записує діагностичні логи у KV.

## Чого ще немає

- **Автоматичне переміщення карток** за результатами вебхука поки що не реалізоване: ендпоінт ManyChat лише повертає збіги, не викликаючи `/api/keycrm/card/move` і не інкрементуючи лічильники.
- **Редагування кампаній** існує лише як заготовка сторінки `/admin/campaigns/[id]/edit`, без робочої форми і збереження.
- **Лічильники V1/V2/EXP** не оновлюються автоматично: API зберігає нулі, і немає фонового процесу, що підраховував би інжести чи переміщення.
- **KV-індекси** частково мігрували: окрім нового ключа `campaign:index`, ще залишаються старі `cmp:*`, і cleanup/repair-ендпоінти потребують доведення та автоматизації.
- **Додаткові утиліти ManyChat** (наприклад кешування username→card_id, інструменти `/api/keycrm/sync/pair`) лишаються незавершеними або у вигляді діагностичних маршрутів без інтеграції у основний потік.
