# Поточний стан проєкту ManiChat → KeyCRM

## Що вже працює

- **Адмін-панель на Next.js.** Після авторизації через `/admin/login` можна переглядати кампанії з назвами воронок та статусів, поточними лічильниками і датою створення. Створення та видалення кампаній синхронізується з Vercel KV, а middleware видає/перевіряє куку `admin_token`.
- **Майстер створення кампанії.** Форма на сторінці `/admin/campaigns/new` підтягує з KeyCRM довідники воронок і статусів, дозволяє зібрати правила для потоків V1/V2/EXP і відправляє їх у `POST /api/campaigns`, де дані збагачуються назвами та зберігаються у KV.
- **REST-проксі до KeyCRM.** Публічні роутери `/api/keycrm/pipelines`, `/api/keycrm/statuses`, `/api/keycrm/card/move` і допоміжні інспекційні ендпоінти працюють стабільно: перші два кешують довідники в KV, а `card/move` пробує декілька шляхів API, щоб гарантовано зрушити картку у потрібну стадію.
- **ManiChat вебхук.** Ендпоінт `/api/mc/manychat` нормалізує payload, читає всі активні кампанії, рахує збіги за правилами `contains|equals` та складає діагностичні логи в KV (по одному списку на день).
- **Допоміжні адмін-утиліти.** Створено сторінки `/admin/tools/*` для ручного руху карток, перевірки індексів, діагностики звʼязки `username → card_id` та перегляду логів.

## Чого ще немає

- **Автоматичне переміщення карток і лічильників.** Вебхук ManyChat поки що обмежується поверненням збігів. Інтеграція з `/api/keycrm/card/move` та інкремент лічильників V1/V2/EXP залишаються на TODO.
- **Редагування кампаній.** Сторінка `/admin/campaigns/[id]/edit` не має робочої форми: очікує інший формат даних і не зберігає зміни назад у KV.
- **Очищення й міграція KV.** Новий індекс `campaign:index` співіснує зі старими ключами `cmp:*`. `cleanup`/`repair`-ендпоінти не доведені до автоматичного режиму.
- **Сервіси ManyChat для продакшену.** Кешування пари `username → card_id`, API `sync/pair` та обробка багаторазових інжестів існують як чернеткові роутери без тестів і без підключення до основного потоку.
- **Сповіщення та моніторинг.** Немає жодної інтеграції з alerting/metrics; доступні лише добові KV-логи.
