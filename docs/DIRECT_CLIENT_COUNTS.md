# Чому різна кількість клієнтів на Direct (558) і в Статистиці (554)

## Джерело цифр (уніфіковано)

Обидва екрани показують **одне й те саме число** з одного запиту.

| Екран | Джерело |
|-------|--------|
| **Direct** (таблиця, футер "Фільтри: Консультація (N)") | `GET /api/admin/direct/clients` → у відповіді `totalCount` = `clients.length` |
| **Статистика** (шапка "клієнтів: N") | `GET /api/admin/direct/clients?totalOnly=1` → у відповіді `totalCount` (той самий запит, без списку клієнтів). Fallback: mastersStats.totalClients поки не завантажилось |

## Історична причина різниці (до уніфікації)

Раніше Direct використовував `COUNT(*)`, а Статистика — `filteredClients.length` з masters-stats (інший запит). Після змін обидва екрани опираються на `getAllDirectClients().length`; можлива різниця лише через **час виконання** (різні запити в різний момент).

## Що зроблено для узгодження

- У **Статистиці** в шапці тепер показується **кількість клієнтів з того ж джерела, що й KPI**: `GET /api/admin/direct/stats/periods` повертає `totalClients: clients.length` (список з `getAllDirectClients()`).
- Сторінка Статистика використовує `periodTotalClients` (з stats/periods), якщо є, інакше fallback на `mastersStats.totalClients`.
- Таким чином "клієнтів" у шапці Статистики відповідає тому самому набору, по якому рахуються KPI по періодах. Якщо в той самий момент відкрити Direct, його `totalCount` (COUNT(*) з тієї ж таблиці) має збігатися з цим числом, якщо дані не змінювались.

## Висновок

Після уніфікації **таблиця Direct** і **Статистика** показують кількість клієнтів з одного джерела: довжина списку `getAllDirectClients()`. Числа мають збігатися при однаковому стані даних.
